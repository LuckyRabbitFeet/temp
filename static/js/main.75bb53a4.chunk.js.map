{"version":3,"sources":["components/loader/index.jsx","components/menu-icon/index.jsx","components/menu-layout/header.jsx","components/menu-layout/index.jsx","components/config/item.jsx","components/hexagon-button/index.jsx","components/switch/index.jsx","components/config/volume.jsx","engine/utils/index.ts","engine/sound/sound.ts","components/config/index.jsx","components/about/card.jsx","game/config/stage.js","game/config/about.js","game/config/asset.js","game/config/text.js","game/config/character/component.js","game/config/color.js","components/about/index.jsx","components/dialog/save.jsx","components/dialog/warning.jsx","engine/loader/index.ts","engine/render/renderer.ts","engine/core/object-pool.ts","engine/core/component.ts","engine/core/utils.ts","engine/core/entity.ts","engine/core/entity-query.ts","engine/core/entity-manager.ts","engine/core/system.ts","engine/core/system-manager.ts","engine/core/world.ts","engine/render/stage.ts","engine/render/scene.ts","engine/render/plugins/interaction/InteractionData.ts","engine/render/plugins/interaction/InteractionManager.ts","game/scene/title/flower.js","game/scene/title/index.js","engine/components/base/render.ts","engine/components/sprite.ts","engine/components/animation.ts","engine/lib/rainbow-text/rainbow-text.js","engine/components/text.ts","engine/components/typewriter.ts","engine/components/button.ts","engine/components/transform.ts","engine/components/transparent.ts","engine/components/sound.ts","engine/components/displacement.ts","engine/components/fade.ts","engine/systems/pixi-render.ts","engine/systems/text-update.ts","engine/systems/animation.ts","engine/systems/typewriter.ts","engine/systems/text-button.ts","engine/systems/transform.ts","engine/systems/sound.ts","game/components/singleton/input.js","game/components/singleton/story.js","game/systems/input.js","game/systems/story.js","game/components/tag/index.js","game/systems/remove.js","game/story/api/util.js","game/story/api/stage/util.js","game/story/api/stage/curtain.js","game/story/api/stage/voiceover.js","game/story/api/stage/index.js","game/story/api/flow/index.js","game/story/api/scene/util.js","game/story/api/scene/show.js","game/story/api/scene/hide.js","game/story/api/scene/index.js","game/story/api/scene/shake.js","game/story/api/dialog/util.js","game/story/api/dialog/show.js","game/story/api/dialog/index.js","game/story/api/dialog/hide.js","game/story/api/character/util.js","game/config/character/index.js","game/story/api/choice/util.js","game/story/api/choice/index.js","game/story/api/bgm/util.js","game/story/api/bgm/index.js","game/story/api/index.js","game/story/chapter1.js","game/story/index.js","game/scene/main/index.js","game/scene/cutscenes/index.js","game/index.js","components/love-memory/index.jsx","root.jsx","serviceWorker.js","index.jsx"],"names":["Loader","detailsHandle","setState","show","state","this","props","loader","loading","progress","error","style","className","display","width","color","onClick","React","Component","MenuIcon","e","Header","version","MenuLayout","children","onClose","Item","name","HexagonButton","Switch","checked","onChange","type","input","target","sliderStyle","position","touchAction","Volume","value","domain","mode","step","rootStyle","values","getRailProps","handles","getHandleProps","map","handle","key","id","right","tracks","getTrackProps","source","railOuterStyle","height","transform","borderRadius","cursor","railInnerStyle","pointerEvents","backgroundColor","SliderRail","Handle","min","max","percent","disabled","left","WebkitTapHighlightColor","zIndex","role","aria-valuemin","aria-valuemax","aria-valuenow","boxShadow","Track","utf8","parse","toString","Sound","alias","sound","find","options","play","stop","stopAll","muted","muteAll","unmuteAll","storageKey","data","volume","JSON","stringify","localStorage","setItem","mandatory","getItem","console","warn","loadFromLocalStorage","mute","volumeAll","isPlaying","Config","switchHandle","unmute","saveState","volumeHandle","exportHandle","textarea","current","getArchive","selectAllHandle","select","createRef","onPanel","onSave","onLoad","onBreak","ref","PureComponent","Card","item","title","url","content","href","rel","stageInfo","about","assets","onComplete","soundMiddleware","resource","singleInstance","baseSrtle","fontFamily","fontWeight","fontSize","lineJoin","fill","stroke","strokeThickness","startMenuStyle","voiceoverStyle","nameStyle","dialogStyle","background","padding","hand","res","layer","x","y","About","SaveDialog","isOpen","status","closeTimeoutMS","ariaHideApp","contentLabel","overlay","justifyContent","alignItems","margin","WarningDialog","onConfirm","lineHeight","textAlign","paddingTop","paddingLeft","baseUrl","concurrency","loaded","onProgressed","onCompleted","PIXI","Signal","Promise","resolve","resources","add","on","_onProgress","bind","_onComplete","reject","_onError","load","_onLoad","dispatch","reset","Renderer","pluginKey","renderer","plugins","antialias","interaction","autoPreventDefault","view","render","autoDensity","resize","pluginClass","ObjectPool","ObjectClass","freed","capacity","size","pool","pools","get","undefined","set","clear","delete","length","expand","pop","push","count","Math","round","i","componentRegister","IComponent","_componentClassMap","has","_id","_isRegister","_pools","of","WeakMap","entity","componentClass","component","acquire","_setProps","init","onComponentCreated","onComponentDestroyed","release","components","forEach","totalSize","free","totalFree","used","totalUsed","_isComponent","Map","now","window","performance","Date","Entity","d","getTime","replace","c","r","random","floor","generateUUID","isSingleton","_world","_components","onComponentChanged","removeAllComponent","Error","hasComponent","componentClassList","verifyComponent","create","destory","class","json","componentClassMap","classId","addComponent","world","_pool","_destory","QueryItem","queryComponents","matchType","entities","matchAll","matchAny","hasAllComponent","hasAnyComponent","indexOf","index","splice","numQueryComponents","numEntities","EntityQuery","queries","join","query","removeEntity","match","addEntity","stats","numQueries","EntityManager","entityQuery","entitiesWithComponentChanged","Set","initEntity","pushEntity","onEntityRemoved","QueryComponents","createQuery","onEntityComponentChanged","token","fromJSON","queryStats","SystemPriority","ISystem","_priority","_executeTime","delta","timestamp","isSystem","SystemManager","entityManager","systems","systemClass","system","Array","isArray","results","getEntity","systemCount","unshift","priority","isRegisterSystem","_injectQuery","_pushSystem","findIndex","startTime","execute","updateEntityQuery","numSystems","executeTime","constructor","World","systemManager","singleton","enabled","lastTimestamp","registerSystem","createEntity","hasEntity","overview","poolStats","Stage","numLayer","layerMap","addChildAt","addChild","_addLayer","removeChild","removeChildren","Scene","addLayer","createLayer","createParticleLayer","hasLayer","getLayer","removeLayer","layerId","sprite","Point","InteractionData","global","originalEvent","isDown","identifier","isPrimary","button","buttons","tiltX","tiltY","pointerType","pressure","rotationAngle","twist","tangentialPressure","event","Number","isInteger","which","InteractionManager","supportsTouchEvents","supportsPointerEvents","mouse","resolution","interactionDOMElement","eventsAdded","PointerEvent","onPointerUp","onPointerCancel","onPointerDown","onPointerMove","onPointerOut","onPointerOver","setTargetElement","element","removeEvents","addEvents","navigator","msPointerEnabled","msContentZooming","msTouchAction","dom","document","addEventListener","removeEventListener","rect","point","parentElement","getBoundingClientRect","resolutionMultiplier","top","interactionData","getInteractionData","configureInteractionDataForDOMEvent","normalizeToPointerData","processInteractive","onPointerComplete","pointerId","copyEvent","pointerEvent","mapPositionToPoint","clientX","clientY","globalX","globalY","normalizedEvents","TouchEvent","li","changedTouches","touch","touches","radiusX","radiusY","force","layerX","offsetX","layerY","offsetY","isNormalized","MouseEvent","tempEvent","Flower","texture","clientWidth","clientHeight","maxDist","z","vx","vy","rotation","PI","anchor","spin","Sprite","FlowerFlyBackground","amount","parent","textureId","flowerArr","Texture","from","flower","obj","xpos","update","fontStyle","btnDownStyle","Title","_bgmPlay","_addBackground","_addPtcLayer","_addMenu","ptcLayer","flowerFly","gameInfo","group","start","_createButton","_bgmStop","onStartClicked","onLoadClicked","setup","onSettingClicked","onAboutClicked","loop","text","clickHandle","btn","interactive","buttonMode","onButtonDown","onButtonUp","onButtonOver","onButtonOut","preventDefault","tick","isdown","scale","isOver","RenderComponent","visible","isRender","destroy","SpriteComponent","EMPTY","revert","getRenderJSON","AnimationComponent","texturesId","animationSpeed","playing","cycle","textures","fillFrames","getFillFrames","AnimatedSprite","interval","TEXT_GRADIENT","defaultDestroyOptions","baseTexture","processBbcode","tokens","magic","params","bbcode","slice","tmp","TextMetrics","tokenize","char","test","wordWrap","canvas","_canvas","context","getContext","line","lines","cache","letterSpacing","whiteSpace","collapseSpaces","collapseNewlines","canPrependSpaces","wordWrapWidth","result","isNewline","addLine","currIsBreakingSpace","isBreakingSpace","lastIsBreakingSpace","tokenWidth","getFromCache","canBreakWords","breakWords","characters","wordWrapSplit","j","k","nextChar","lastChar","canBreakChars","characterWidth","isLastToken","RainbowText","ownCanvas","createElement","orig","Rectangle","trim","_ownCanvas","_resolution","settings","RESOLUTION","_autoResolution","_text","_style","_styleListener","_font","localStyleID","bbcodeFillIndex","bbcodeStrokeIndex","respectDirty","styleID","dirty","toFontString","linePositionX","linePositionY","measured","measureText","lineWidths","maxLineWidth","fontProperties","ceil","clearRect","font","lineWidth","textBaseline","miterLimit","passesCount","dropShadow","isShadowPass","dsOffsetText","dsOffsetShadow","fillStyle","strokeStyle","dropShadowColor","rgb","hex2rgb","string2hex","shadowColor","dropShadowAlpha","shadowBlur","dropShadowBlur","shadowOffsetX","cos","dropShadowAngle","dropShadowDistance","shadowOffsetY","sin","_generateFillStyle","originText","split","ascent","align","drawLetterSpacing","updateTexture","isStroke","currentPosition","stringArray","previousWidth","currentWidth","currentChar","offset","strokeText","fillText","substring","trimmed","trimCanvas","putImageData","_texture","_frame","_onTextureUpdate","setRealSize","_recursivePostUpdateTransform","updateText","call","calculateVertices","_bounds","addQuad","vertexData","metrics","gradient","dropShadowCorrection","fillGradientStops","lengthPlus1","fillGradientType","createLinearGradient","lastIterationStop","gradStopLineHeight","thisLineTop","globalStop","clampedStop","addColorStop","totalIterations","currentIteration","Object","assign","abs","s","sign","_width","_height","TextStyle","String","TextComponent","bgTextureId","bgTexture","textView","btnView","Container","btnW","btnH","textW","textH","TypewriterComponent","speed","printDelay","deltaTimer","ButtonComponent","tag","useAnimation","isBind","isClick","origin","clickEvent","removeAllListeners","TransformComponent","angle","TransparentComponent","alpha","SoundComponent","firstPlay","resourceId","DisplacementComponent","end","duration","FadeComponent","PIXIRenderSystem","getComponent","configureSprite","transparent","pivot","scene","addSprite","TextUpdateSystem","Text","AnimationSystem","animation","gotoAndStop","TypewriterSystem","typewriter","time","charAt","removeComponent","string","TextButtonSystem","processButtonDown","processButtonUp","textC","btnC","TransformSystem","disp","Transform","Displacement","fade","Transparent","Fade","method","SoundSystem","BtnTypes","InputComponent","curEvent","preEvent","downPoint","readyClick","btnType","StoryComponent","curChapter","initialed","nodeIndex","subIndex","InputSystem","StorySystem","systemData","storyScript","Input","processStory","chapter","nodeCount","node","process","goto","removeAllEntity","BackgroundComponent","CGComponent","BGMComponent","CharacterComponent","DialogComponent","NameComponent","ChoiceComponent","RemoveComponent","RemoveSystem","bgm","GroupMap","getGroup","createCurtain","targetId","typewriterOptions","changeVoiceover","curtain","up","entityId","down","voiceover","texts","createVoiceover","hide","addTransform","configOption","setEntity","show_async","hide_async","shake","timer","amplitude","fadeIn","fadeOut","baseShake","changeDialog","textBackground","createDialog","createName","removeName","dialog","xing_nai1","util","colorText","chapter1","stage","log","Main","game","storyData","_initData","_initWorldModule","serialize","deserialize","story","Cutscenes","registerPlugin","_update","begin","isPlay","updated","curScene","requestAnimationFrame","_updateRenderScale","_setSceneScale","cutscenes","CutscenesScene","prevScene","Stats","added","addPanel","Panel","showPanel","_initSoundModule","_initRenderModule","body","appendChild","loadState","devicePixelRatio","sceneClass","_cutscenesWait","addOnce","cutscenesWait","then","setTimeout","_changeScene","saveArchive","loadArchive","windowWidth","innerWidth","windowHeight","innerHeight","LoveMemory","progressHandle","loadError","clickStartHandle","to","MainScene","menu","clickSettingHandle","clickAboutHandle","openMenuHandle","closeMenuHandle","togglePanelHandle","removeStats","addStats","closeDialogHandle","saveHandle","dialogStatus","loadHandle","breakTitleHandle","confirmWarnHandle","TitleScene","opacity","remove","pause","resume","gameStyle","bottom","maxWidth","maxHeight","App","Boolean","location","hostname","ReactDOM","StrictMode","getElementById","serviceWorker","ready","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.75bb53a4.chunk.js","sourcesContent":["import React from 'react'\r\nimport './index.css'\r\n\r\nclass Loader extends React.Component {\r\n  constructor() {\r\n    super()\r\n    this.state = {\r\n      show: false\r\n    }\r\n  }\r\n\r\n  detailsHandle = () => {\r\n    this.setState({\r\n      show: !this.state.show\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const { loading, progress, error } = this.props.loader\r\n    let style = 'loader'\r\n\r\n    if (this.state.show) {\r\n      style += ' open'\r\n    }\r\n\r\n    return (\r\n      <div className=\"loader-wrapper\" style={{display: loading ? 'block' : 'none'}}>\r\n        <div className=\"loader-container\">\r\n          <div className={style}>\r\n            <em style={{ width: `${progress}%` }}></em>\r\n            <div className=\"details-panel\">\r\n              <p>\r\n                <strong>Progress:</strong> <font>{`${progress}%`}</font>\r\n              </p>\r\n              {\r\n                error && (\r\n                  <p>\r\n                    <strong>Error:</strong> <font style={{color: 'red'}}>{'resource loading failed.'}</font>\r\n                  </p>\r\n                )\r\n              }\r\n            </div>\r\n          </div>\r\n          <div className=\"details button\" onClick={this.detailsHandle}>Details</div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Loader\r\n","import React from 'react'\r\nimport './index.css'\r\n\r\nfunction MenuIcon(props) {\r\n  function clickHandle(e) {\r\n    props.onClick && props.onClick(e)\r\n  }\r\n\r\n  return (\r\n    <div className=\"menu-icon\" onClick={clickHandle}>\r\n      <div className=\"top bar\"></div>\r\n      <div className=\"middle bar\"></div>\r\n      <div className=\"bottom bar\"></div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MenuIcon\r\n","import React from 'react'\r\nimport { version } from '../../../package.json'\r\n\r\nfunction Header() {\r\n  return (\r\n    <div className=\"menu-title\">\r\n    <h1>\r\n      {'湛蓝回忆'}\r\n      <p className=\"menu-subtitle\">\r\n        <span>{'恋爱物语'}</span>\r\n        <span className=\"menu-version\">{`ver: ${version}`}</span>\r\n      </p>\r\n    </h1>\r\n    <h2>{'Love Memory'}</h2>\r\n  </div>\r\n  )\r\n}\r\n\r\nexport default Header\r\n","import React from 'react'\r\nimport './index.css'\r\n\r\nimport Header from './header'\r\n\r\nfunction MenuLayout(props) {\r\n  const style = {\r\n    display: props.show > 0 ? 'block' : 'none'\r\n  }\r\n  return (\r\n    <div className=\"menu-wrapper\" style={style}>\r\n      <div className=\"menu-container\">\r\n        <Header />\r\n        <div className=\"menu-content\">{props.children}</div>\r\n        <div className=\"close\" onClick={props.onClose}></div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MenuLayout\r\n","import React from 'react'\r\n\r\nfunction Item(props) {\r\n  return (\r\n    <div className=\"config-item\">\r\n      <div className=\"config-name\">{props.name}</div>\r\n      <div className=\"config-content\">{props.children}</div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Item\r\n","import React from 'react'\r\nimport './index.css'\r\n\r\nfunction HexagonButton(props) {\r\n  function clickHandle(e) {\r\n    props.onClick && props.onClick(e)\r\n  }\r\n\r\n  return (\r\n    <div className=\"hexagon-button\">\r\n      <div onClick={clickHandle}>\r\n        <span>{props.children}</span>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default HexagonButton\r\n","import React from 'react'\r\nimport './index.css'\r\n\r\nfunction Switch(props) {\r\n  const { checked, onChange } = props\r\n  function changeHandle(e) {\r\n    const input = e.target\r\n    onChange && onChange(input.checked)\r\n  }\r\n\r\n  return (\r\n    <div className=\"switch-button\">\r\n      <input\r\n        className=\"switch-button-checkbox\"\r\n        type=\"checkbox\"\r\n        checked={checked}\r\n        onChange={changeHandle}\r\n      />\r\n      <div className=\"switch-button-handle\"></div>\r\n      <label className=\"switch-button-label\">开</label>\r\n      <label className=\"switch-button-label\">关</label>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Switch\r\n","import React from 'react'\r\nimport { Slider, Rail, Handles, Tracks } from 'react-compound-slider'\r\n\r\nconst sliderStyle = {\r\n  position: 'relative',\r\n  width: '100%',\r\n  touchAction: 'none'\r\n}\r\n\r\nfunction Volume(props) {\r\n  const { value = 80, onChange } = props\r\n  const domain = [0, 100]\r\n  function changeHandle(values) {\r\n    onChange && onChange(values[0])\r\n  }\r\n\r\n  return (\r\n    <Slider\r\n      mode={1}\r\n      step={1}\r\n      domain={domain}\r\n      rootStyle={sliderStyle}\r\n      onChange={changeHandle}\r\n      values={[value]}\r\n    >\r\n      <Rail>\r\n        {({ getRailProps }) => <SliderRail getRailProps={getRailProps} />}\r\n      </Rail>\r\n      <Handles>\r\n        {({ handles, getHandleProps }) => (\r\n          <div className=\"slider-handles\">\r\n            {handles.map(handle => (\r\n              <Handle\r\n                key={handle.id}\r\n                handle={handle}\r\n                domain={domain}\r\n                getHandleProps={getHandleProps}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </Handles>\r\n      <Tracks right={false}>\r\n        {({ tracks, getTrackProps }) => (\r\n          <div className=\"slider-tracks\">\r\n            {tracks.map(({ id, source, target }) => (\r\n              <Track\r\n                key={id}\r\n                source={source}\r\n                target={target}\r\n                getTrackProps={getTrackProps}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </Tracks>\r\n    </Slider>\r\n  )\r\n}\r\n\r\nexport default Volume\r\n\r\nconst railOuterStyle = {\r\n  position: 'absolute',\r\n  width: '100%',\r\n  height: 42,\r\n  transform: 'translate(0%, -50%)',\r\n  borderRadius: 7,\r\n  cursor: 'pointer'\r\n}\r\n\r\nconst railInnerStyle = {\r\n  position: 'absolute',\r\n  width: '100%',\r\n  height: 14,\r\n  transform: 'translate(0%, -50%)',\r\n  borderRadius: 7,\r\n  pointerEvents: 'none',\r\n  backgroundColor: 'rgb(155,155,155)'\r\n}\r\n\r\nconst SliderRail = ({ getRailProps }) => {\r\n  return (\r\n    <>\r\n      <div style={railOuterStyle} {...getRailProps()} />\r\n      <div style={railInnerStyle} />\r\n    </>\r\n  )\r\n}\r\n\r\nconst Handle = ({\r\n  domain: [min, max],\r\n  handle: { id, value, percent },\r\n  disabled = false,\r\n  getHandleProps\r\n}) => {\r\n  return (\r\n    <>\r\n      <div\r\n        style={{\r\n          left: `${percent}%`,\r\n          position: 'absolute',\r\n          transform: 'translate(-50%, -50%)',\r\n          WebkitTapHighlightColor: 'rgba(0,0,0,0)',\r\n          zIndex: 5,\r\n          width: 28,\r\n          height: 42,\r\n          cursor: 'pointer',\r\n          backgroundColor: 'none'\r\n        }}\r\n        {...getHandleProps(id)}\r\n      />\r\n      <div\r\n        role=\"slider\"\r\n        aria-valuemin={min}\r\n        aria-valuemax={max}\r\n        aria-valuenow={value}\r\n        style={{\r\n          left: `${percent}%`,\r\n          position: 'absolute',\r\n          transform: 'translate(-50%, -50%)',\r\n          zIndex: 2,\r\n          width: 24,\r\n          height: 24,\r\n          borderRadius: '50%',\r\n          boxShadow: '1px 1px 1px 1px rgba(0, 0, 0, 0.3)',\r\n          backgroundColor: disabled ? '#666' : '#9BBFD4'\r\n        }}\r\n      />\r\n    </>\r\n  )\r\n}\r\n\r\nconst Track = ({ source, target, getTrackProps, disabled = false }) => {\r\n  return (\r\n    <div\r\n      style={{\r\n        position: 'absolute',\r\n        transform: 'translate(0%, -50%)',\r\n        height: 14,\r\n        zIndex: 1,\r\n        backgroundColor: disabled ? '#999' : '#607E9E',\r\n        borderRadius: 7,\r\n        cursor: 'pointer',\r\n        left: `${source.percent}%`,\r\n        width: `${target.percent - source.percent}%`\r\n      }}\r\n      {...getTrackProps()}\r\n    />\r\n  )\r\n}\r\n","import Rabbit from 'crypto-js/rabbit'\r\nimport utf8 from 'crypto-js/enc-utf8'\r\n\r\n/**\r\n * 把数据保存到 localStorage\r\n * @param storageKey localStorage 键\r\n * @param data 要存储的数据\r\n */\r\nexport function saveToLocalStorage(storageKey: string, data: string) {\r\n  localStorage.setItem(storageKey, data)\r\n}\r\n\r\n/**\r\n * 从 localStorage 读取数据\r\n * @param storageKey localStorage 键\r\n * @param mandatory 启用强制读取，强制读取不存在的数据时不会在控制台发出警告\r\n */\r\nexport function loadFromLocalStorage(storageKey: string, mandatory: boolean = false) {\r\n  const data = localStorage.getItem(storageKey)\r\n  if (!data && mandatory === false) {\r\n    console.warn(`No data with the key value \"${storageKey}\" in localStorage.`)\r\n  }\r\n  return data\r\n}\r\n\r\n/**\r\n * 从 localStorage 删除数据\r\n * @param storageKey localStorage 键\r\n */\r\nexport function removeFromLocalStorage(storageKey: string) {\r\n  localStorage.removeItem(storageKey)\r\n}\r\n\r\n/**\r\n * time33 哈希算法\r\n * @param text 要加密的字符串\r\n */\r\nexport function time33(text: string) {\r\n  for (var i = 0, len = text.length, hash = 5381; i < len; ++i) {\r\n    hash += (hash << 5) + text.charAt(i).charCodeAt(0)\r\n  }\r\n  return hash & 0x7fffffff\r\n}\r\n\r\n/** 密钥，字符串是随机生成的 */\r\nconst key = utf8.parse('JQfTTft92kQ4').toString()\r\n\r\n/**\r\n * 使用 rabbit 加密数据\r\n * @param text 要加密的字符串\r\n */\r\nexport function encryptByRabbit(text: string) {\r\n  return Rabbit.encrypt(text, key).toString()\r\n}\r\n\r\n/**\r\n * 使用 rabbit 解密数据\r\n * @param text 要解密的字符串\r\n */\r\nexport function decryptByRabbit(text: string) {\r\n  const bytes = Rabbit.decrypt(text, key)\r\n  const originalText = bytes.toString(utf8)\r\n  return originalText\r\n}\r\n","import * as PIXI from 'pixi.js'\r\nimport sound from 'pixi-sound'\r\nimport { saveToLocalStorage, loadFromLocalStorage } from '../utils'\r\n\r\ntype PlayOptions = {\r\n  start?: number\r\n  end?: number\r\n  speed?: number\r\n  loop?: boolean\r\n  volume?: number\r\n  sprite?: string\r\n  muted?: boolean\r\n  complete?: any\r\n  loaded?: any\r\n}\r\n\r\nexport class Sound {\r\n  static muted = false\r\n\r\n  static set volume(value: number) {\r\n    sound.volumeAll = value\r\n  }\r\n\r\n  static get volume() {\r\n    return sound.volumeAll\r\n  }\r\n\r\n  static play(alias: string, options?: PlayOptions) {\r\n    sound.play(alias, options)\r\n  }\r\n\r\n  static stop(alias: string) {\r\n    sound.stop(alias)\r\n  }\r\n\r\n  static stopAll() {\r\n    sound.stopAll()\r\n  }\r\n\r\n  static mute() {\r\n    this.muted = true\r\n    sound.muteAll()\r\n  }\r\n\r\n  static unmute() {\r\n    this.muted = false\r\n    sound.unmuteAll()\r\n  }\r\n\r\n  static saveState() {\r\n    const state = {\r\n      muted: this.muted,\r\n      volume: this.volume\r\n    }\r\n    saveToLocalStorage('sound', JSON.stringify(state))\r\n  }\r\n\r\n  static loadState() {\r\n    const state = JSON.parse(loadFromLocalStorage('sound', true))\r\n    if (state) {\r\n      this.muted = state.muted\r\n      this.volume = state.volume\r\n\r\n      if (this.muted === true) {\r\n        this.mute()\r\n      }\r\n    } else {\r\n      this.volume = 0.8\r\n    }\r\n  }\r\n\r\n  private sound: PIXI.sound.Sound\r\n\r\n  constructor(public alias: string) {\r\n    this.sound = sound.find(alias)\r\n  }\r\n\r\n  get isPlaying() {\r\n    return this.sound.isPlaying\r\n  }\r\n\r\n  public play(options?: PlayOptions) {\r\n    this.sound.play(options)\r\n  }\r\n\r\n  public stop() {\r\n    this.sound.stop()\r\n  }\r\n}\r\n","import React from 'react'\r\nimport './index.css'\r\n\r\nimport Item from './item'\r\nimport HexagonButton from '../hexagon-button'\r\nimport Switch from '../switch'\r\nimport Volume from './volume'\r\n\r\nimport { Sound } from '../../engine/sound'\r\n\r\nclass Config extends React.PureComponent {\r\n  constructor() {\r\n    super()\r\n    this.data = React.createRef()\r\n    this.state = {\r\n      checked: false\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setState({\r\n      checked: !Sound.muted,\r\n      volume: Sound.volume\r\n    })\r\n  }\r\n\r\n  switchHandle = checked => {\r\n    if (checked) {\r\n      Sound.unmute()\r\n    } else {\r\n      Sound.mute()\r\n    }\r\n    Sound.saveState()\r\n    this.setState({\r\n      checked\r\n    })\r\n  }\r\n\r\n  volumeHandle = value => {\r\n    Sound.volume = value / 100\r\n    Sound.saveState()\r\n  }\r\n\r\n  exportHandle = () => {\r\n    const textarea = this.data.current\r\n    const data = this.props.getArchive() || ''\r\n    textarea.value = data\r\n  }\r\n\r\n  selectAllHandle = () => {\r\n    const textarea = this.data.current\r\n    textarea.select()\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"game-config\">\r\n        <section>\r\n          <h3 className=\"game-config-title\">系统</h3>\r\n          <Item name=\"声音\"><Switch checked={this.state.checked} onChange={this.switchHandle} /></Item>\r\n          <Item name=\"音量\"><Volume value={Sound.volume * 100} onChange={this.volumeHandle} /></Item>\r\n          <HexagonButton onClick={this.props.onPanel}>on/off<br />状态面板</HexagonButton>\r\n          {\r\n            this.props.show === 3 && (\r\n              <>\r\n                <HexagonButton onClick={this.props.onSave}>存储进度</HexagonButton>\r\n                <HexagonButton onClick={this.props.onLoad}>读取进度</HexagonButton>\r\n                <HexagonButton onClick={this.props.onBreak}>返回标题</HexagonButton>\r\n              </>\r\n            )\r\n          }\r\n        </section>\r\n        <section>\r\n          <h3 className=\"game-config-title\">数据</h3>\r\n          <textarea className=\"game-input-data\" ref={this.data}></textarea>\r\n          <div className=\"game-data-options\">\r\n            <button onClick={this.exportHandle}>导出</button>\r\n            <button onClick={this.selectAllHandle}>全选</button>\r\n            <button>导入</button>\r\n          </div>\r\n        </section>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Config\r\n","import React from 'react'\r\n\r\nfunction Card(props) {\r\n  const { title, url, content } = props.item\r\n  return (\r\n    <div className=\"about-item\">\r\n      <a href={url} target=\"_blank\" rel=\"noopener noreferrer\">\r\n        <p className=\"about-item-title\">{title}</p>\r\n        {url && <p className=\"about-item-content\">{url}</p>}\r\n        {content && <p className=\"about-item-content\">{content}</p>}\r\n      </a>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Card\r\n","export const stageInfo = {\r\n  width: 480,\r\n  height: 576\r\n}","import { version } from '../../../package.json'\r\n\r\nexport const about = [\r\n  {\r\n    title: '当前版本',\r\n    content: version\r\n  },\r\n  {\r\n    title: 'Blog',\r\n    url: 'https://xxxxxxxxx.net/'\r\n  },\r\n  {\r\n    title: 'Email',\r\n    url: '/'\r\n  },\r\n  {\r\n    title: 'Github',\r\n    url: 'https://github.com/LuckyRabbitFeet'\r\n  },\r\n  {\r\n    title: 'Bug反馈',\r\n    url: 'xxxxxxxxxxx'\r\n  },\r\n  {\r\n    title: 'License',\r\n    content: 'MIT'\r\n  }\r\n]","export const assetRootUrl =\r\n  process.env.NODE_ENV === 'development'\r\n    ? process.env.PUBLIC_URL\r\n    : ''\r\n\r\nexport const assets = [\r\n  // fonts\r\n  'assets/fonts/SourceHanSansSC-Regular.woff',\r\n  'assets/fonts/SourceHanSansSC-Bold.woff',\r\n  // images\r\n  'assets/images/map01.json',\r\n  'assets/images/map02.json',\r\n  'assets/images/map03.json',\r\n  // images/system\r\n  'assets/images/system/title_gold.json',\r\n  'assets/images/system/system.json',\r\n  // images/file\r\n  'assets/images/file/1001.json',\r\n  'assets/images/file/1002.json',\r\n  'assets/images/file/1003.json',\r\n  'assets/images/file/1004.json',\r\n  'assets/images/file/1005.json',\r\n  'assets/images/file/1006.json',\r\n  'assets/images/file/1007.json',\r\n  'assets/images/file/1008-1010.json',\r\n  'assets/images/file/2001.json',\r\n  'assets/images/file/2002-2004.json',\r\n  'assets/images/file/3001.json',\r\n  'assets/images/file/3002.json',\r\n  'assets/images/file/3003-3005.json',\r\n  'assets/images/file/4001.json',\r\n  'assets/images/file/4002.json',\r\n  // sound\r\n  {\r\n    name: 'funny',\r\n    url: 'assets/sound/funny.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'happy',\r\n    url: 'assets/sound/happy.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'hope',\r\n    url: 'assets/sound/hope.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'memory',\r\n    url: 'assets/sound/memory.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'nerves',\r\n    url: 'assets/sound/nerves.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'night',\r\n    url: 'assets/sound/night.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'romantix',\r\n    url: 'assets/sound/romantix.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'sad',\r\n    url: 'assets/sound/sad.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'shopping',\r\n    url: 'assets/sound/shopping.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'system_over',\r\n    url: 'assets/sound/system_over.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'system_title',\r\n    url: 'assets/sound/system_title.mp3',\r\n    onComplete: soundMiddleware\r\n  }\r\n]\r\n\r\nfunction soundMiddleware(resource) {\r\n  resource.sound.singleInstance = true\r\n}\r\n","const baseSrtle = {\r\n  fontFamily: ['Source Han Sans SC', 'Arial', 'sans-serif'],\r\n  fontWeight: 'bold',\r\n  fontSize: 20,\r\n  lineJoin: 'round',\r\n  fill: '#ffffff',\r\n  stroke: '#000000',\r\n  strokeThickness: 3\r\n}\r\n\r\nexport const startMenuStyle = {\r\n  ...baseSrtle,\r\n  fontSize: 22,\r\n  fill: '#6D8CD4',\r\n  stroke: '#ffffff'\r\n}\r\n\r\nexport const buttonStyle = baseSrtle\r\n\r\nexport const voiceoverStyle = baseSrtle\r\n\r\nexport const nameStyle = baseSrtle\r\n\r\nexport const dialogStyle = baseSrtle\r\n\r\nexport const background = {\r\n  button: {\r\n    id: 'button',\r\n    width: 220,\r\n    height: 45,\r\n    padding: 3\r\n  },\r\n  name: {\r\n    id: 'name_frame',\r\n    height: 44,\r\n    padding: 0\r\n  },\r\n  dialog: {\r\n    id: 'speak_frame',\r\n    height: 126,\r\n    padding: 12\r\n  }\r\n}","// 眼睛\r\nexport const eyes = {\r\n  '1001_e': {\r\n    res: ['1001_e-0', '1001_e-1', '1001_e-2', '1001_e-1', '1001_e-0'],\r\n    layer: 1,\r\n    x: 187,\r\n    y: 158\r\n  },\r\n  '1002_e': {\r\n    res: ['1002_e-0', '1002_e-1', '1002_e-2', '1002_e-1', '1002_e-0'],\r\n    layer: 1,\r\n    x: 187,\r\n    y: 158\r\n  },\r\n  '1003_e': {\r\n    res: ['1003_e-0', '1003_e-1', '1003_e-2', '1003_e-1', '1003_e-0'],\r\n    layer: 1,\r\n    x: 187,\r\n    y: 158\r\n  },\r\n  '1004_e': {\r\n    res: ['1004_e-0', '1004_e-1', '1004_e-2', '1004_e-1', '1004_e-0'],\r\n    layer: 1,\r\n    x: 187,\r\n    y: 158\r\n  },\r\n  '1005_e': {\r\n    res: ['1005_e-0', '1005_e-1', '1005_e-2', '1005_e-1', '1005_e-0'],\r\n    layer: 1,\r\n    x: 187,\r\n    y: 158\r\n  },\r\n  '1006_e': {\r\n    res: ['1006_e-0', '1006_e-1', '1006_e-2', '1006_e-1', '1006_e-0'],\r\n    layer: 1,\r\n    x: 187,\r\n    y: 158\r\n  },\r\n  '1007_e': {\r\n    res: ['1007_e-0', '1007_e-1', '1007_e-2', '1007_e-1', '1007_e-0'],\r\n    layer: 1,\r\n    x: 187,\r\n    y: 158\r\n  },\r\n  '1008_e': {\r\n    res: '1008_e',\r\n    layer: 1,\r\n    x: 187,\r\n    y: 158\r\n  },\r\n  '1009_e': {\r\n    res: ['1009_e-0', '1009_e-1', '1009_e-2', '1009_e-1', '1009_e-0'],\r\n    layer: 1,\r\n    x: 187,\r\n    y: 158\r\n  },\r\n  '1010_e': {\r\n    res: '1010_e',\r\n    layer: 1,\r\n    x: 187,\r\n    y: 155\r\n  },\r\n  '2001_e': ['2001_e-0', '2001_e-1', '2001_e-2', '2001_e-1', '2001_e-0'],\r\n  '2002_e': ['2002_e-0', '2002_e-1', '2002_e-2', '2002_e-1', '2002_e-0'],\r\n  '2003_e': ['2003_e-0', '2003_e-1', '2003_e-2', '2003_e-1', '2003_e-0'],\r\n  '2004_e': ['2004_e-0', '2004_e-1', '2004_e-2', '2004_e-1', '2004_e-0'],\r\n  '3001_e': ['3001_e-0', '3001_e-1', '3001_e-2', '3001_e-1', '3001_e-0'],\r\n  '3002_e': ['3002_e-0', '3002_e-1', '3002_e-2', '3002_e-1', '3002_e-0'],\r\n  '3003_e': ['3003_e-0', '3003_e-1', '3003_e-2', '3003_e-1', '3003_e-0'],\r\n  '3004_e': ['3004_e-0', '3004_e-1', '3004_e-2', '3004_e-1', '3004_e-0'],\r\n  '3005_e': '3005_e',\r\n  '4001_e': ['4001_e-0', '4001_e-1', '4001_e-2', '4001_e-1', '4001_e-0'],\r\n  '4002_e': ['4002_e-0', '4002_e-1', '4002_e-2', '4002_e-1', '4002_e-0']\r\n}\r\n\r\n// 嘴\r\nexport const mouth = {\r\n  '1001_m-01': {\r\n    res: '1001_m-01',\r\n    layer: 1,\r\n    x: 225,\r\n    y: 225\r\n  },\r\n  '1001_m-02': '1001_m-02',\r\n  '1001_m-03': '1001_m-03',\r\n  '1001_m-04': '1001_m-04',\r\n  '1001_m-05': '1001_m-05',\r\n  '1001_m-06': '1001_m-06',\r\n  '1001_m-07': '1001_m-07',\r\n  '1003_m': '1003_m'\r\n}\r\n\r\n// 头\r\nexport const head = {\r\n  '1001_he': {\r\n    res: '1001_he',\r\n    layer: 0,\r\n    x: 153,\r\n    y: 46\r\n  }\r\n}\r\n\r\n// 身体\r\nexport const body = {\r\n  '1001_b': {\r\n    res: '1001_b',\r\n    layer: 1,\r\n    x: 117,\r\n    y: 292\r\n  },\r\n  '1002_b': {\r\n    res: '1002_b',\r\n    layer: 1,\r\n    x: 107,\r\n    y: 294\r\n  },\r\n  '1003_b': '1003_b',\r\n  '2001_b': '2001_b',\r\n  '3001_b': '3001_b',\r\n  '3002_b': '3002_b',\r\n  '4001_b': '4001_b'\r\n}\r\n\r\n// 手\r\nexport const hand = {\r\n  '1001_ha': {\r\n    res: '1001_ha',\r\n    layer: 0,\r\n    x: 109,\r\n    y: 346\r\n  },\r\n  '1002_ha': {\r\n    res: '1002_ha',\r\n    layer: 0,\r\n    x: 297,\r\n    y: 362\r\n  }\r\n}\r\n\r\n// 其他\r\nexport const other = {\r\n\r\n}\r\n\r\n\r\n","const lightskyblue = '#87cefa'\r\n\r\nconst burlywood = '#deb887'\r\n\r\nconst deepskyblue = '#00bfff'\r\n\r\nexport default {\r\n  lightskyblue,\r\n  burlywood,\r\n  deepskyblue\r\n}","import React from 'react'\r\nimport './index.css'\r\n\r\nimport Card from './card'\r\n\r\nimport { about } from '../../game/config'\r\n\r\nfunction About() {\r\n  return (\r\n    <div className=\"game-about\">\r\n      {about.map(item => <Card key={item.title} item={item} />)}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default About\r\n","import React from 'react'\r\nimport ReactModal from 'react-modal'\r\n\r\nfunction SaveDialog(props) {\r\n  const { isOpen, onClose, status } = props\r\n\r\n  function closeHandle(e) {\r\n    onClose && onClose(e)\r\n  }\r\n\r\n  return (\r\n    <ReactModal\r\n      isOpen={isOpen}\r\n      closeTimeoutMS={200}\r\n      ariaHideApp={false}\r\n      contentLabel=\"save dialog\"\r\n      style={{\r\n        overlay: {\r\n          display: 'flex',\r\n          justifyContent: 'center',\r\n          alignItems: 'center',\r\n          zIndex: 6,\r\n          backgroundColor: null\r\n        }\r\n      }}\r\n      className=\"dialog\"\r\n    >\r\n      <div className=\"dialog-container\">\r\n        <div className=\"dialog-content\">\r\n          <div className=\"dialog-icon\">\r\n            {\r\n              status === 'saved'\r\n                ? (\r\n                  <div className=\"sa-success\">\r\n                    <div className=\"sa-success-tip\"></div>\r\n                    <div className=\"sa-success-long\"></div>\r\n                    <div className=\"sa-success-placeholder\"></div>\r\n                    <div className=\"sa-success-fix\"></div>\r\n                  </div>\r\n                )\r\n                : (\r\n                  <div className=\"spinner-box\">\r\n                    <div className=\"circle-border\">\r\n                      <div className=\"circle-core\"></div>\r\n                    </div>\r\n                  </div>\r\n                )\r\n            }\r\n          </div>\r\n          <div className=\"dialog-text\">\r\n            { status === 'saved' ? 'Saved success.' : 'Saving...' }\r\n          </div>\r\n        </div>\r\n        <div className=\"dialog-interaction\">\r\n          <div\r\n            className=\"dialog-button\"\r\n            style={{\r\n              margin: status === 'saved' ? 0 : -55\r\n            }}\r\n          >\r\n            <button onClick={closeHandle}>OK</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ReactModal>\r\n  )\r\n}\r\n\r\nexport default SaveDialog\r\n","import React from 'react'\r\nimport ReactModal from 'react-modal'\r\n\r\nfunction WarningDialog(props) {\r\n  const { isOpen, onConfirm, onClose } = props\r\n\r\n  function yesHandle(e) {\r\n    onConfirm && onConfirm(e)\r\n  }\r\n\r\n  function noHandle(e) {\r\n    onClose && onClose(e)\r\n  }\r\n\r\n  return (\r\n    <ReactModal\r\n      isOpen={isOpen}\r\n      closeTimeoutMS={200}\r\n      ariaHideApp={false}\r\n      contentLabel=\"warning dialog\"\r\n      style={{\r\n        overlay: {\r\n          display: 'flex',\r\n          justifyContent: 'center',\r\n          alignItems: 'center',\r\n          zIndex: 6,\r\n          backgroundColor: null\r\n        }\r\n      }}\r\n      className=\"dialog\"\r\n    >\r\n      <div className=\"dialog-container\">\r\n        <div className=\"dialog-content\">\r\n          <div className=\"dialog-icon\">\r\n            <div className=\"sa-warning\">\r\n              <span className=\"sa-warning-body\"></span>\r\n              <span className=\"sa-warning-dot\"></span>\r\n            </div>\r\n          </div>\r\n          <div className=\"dialog-text\" style={{\r\n            lineHeight: 1.2,\r\n            textAlign: 'left',\r\n            paddingTop: 5,\r\n            paddingLeft: 80\r\n          }}>\r\n            未保存的数据将会丢失，是否继续？\r\n          </div>\r\n        </div>\r\n        <div className=\"dialog-interaction\">\r\n          <div\r\n            className=\"dialog-button\"\r\n            style={{\r\n              margin: 0\r\n            }}\r\n          >\r\n            <button className=\"dialog-button-yes\" onClick={yesHandle}>Yes</button>\r\n            <button className=\"dialog-button-no\" onClick={noHandle}>No</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ReactModal>\r\n  )\r\n}\r\n\r\nexport default WarningDialog\r\n","import * as PIXI from 'pixi.js'\r\nimport 'pixi-sound'\r\nimport { Signal } from 'signals'\r\n\r\nexport default class Loader {\r\n  public source: PIXI.Loader\r\n  public loaded: boolean\r\n  public assets: any[] | undefined\r\n  public onProgressed: Signal\r\n  public onCompleted: Signal\r\n\r\n  constructor(baseUrl?: string, concurrency?: number) {\r\n    this.source = new PIXI.Loader(baseUrl, concurrency)\r\n    this.loaded = false\r\n    this.onProgressed = new Signal()\r\n    this.onCompleted = new Signal()\r\n  }\r\n\r\n  public load(assets: any[]): Promise<any> {\r\n    if (this.loaded === true) {\r\n      return Promise.resolve(this.source.resources)\r\n    }\r\n\r\n    this.assets = assets\r\n    this.source\r\n      .add(assets)\r\n      .on('progress', this._onProgress.bind(this))\r\n      .on('complete', this._onComplete.bind(this))\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.source\r\n        .on('error', this._onError(reject))\r\n        .load(this._onLoad(resolve))\r\n    })\r\n  }\r\n\r\n  private _onProgress(loader: PIXI.Loader, resource: PIXI.LoaderResource) {\r\n    this.onProgressed.dispatch(loader.progress, resource)\r\n  }\r\n\r\n  private _onComplete(loader: PIXI.Loader, resources: PIXI.IResourceDictionary) {\r\n    this.onCompleted.dispatch(loader.progress, resources)\r\n  }\r\n\r\n  private _onError(reject: (...args: any[]) => void) {\r\n    return (error: Error) => {\r\n      this.source.reset()\r\n      reject(error)\r\n    }\r\n  }\r\n\r\n  private _onLoad(resolve: (...args: any[]) => void) {\r\n    return (loader: PIXI.Loader, resources: PIXI.IResourceDictionary) => {\r\n      this.loaded = true\r\n      resolve(resources)\r\n    }\r\n  }\r\n}\r\n","import * as PIXI from 'pixi.js'\r\n\r\nexport type options = {\r\n  width?: number\r\n  height?: number\r\n  view?: HTMLCanvasElement\r\n  transparent?: boolean\r\n  autoDensity?: boolean\r\n  antialias?: boolean\r\n  forceFXAA?: boolean\r\n  resolution?: number\r\n  clearBeforeRender?: boolean\r\n  preserveDrawingBuffer?: boolean\r\n  backgroundColor?: number\r\n  powerPreference?: string\r\n  context?: any\r\n}\r\n\r\ntype Plugins = {\r\n  [key: string]: any\r\n}\r\n\r\nexport class Renderer {\r\n  static readonly plugins: Plugins = {}\r\n\r\n  private renderer: PIXI.Renderer\r\n  public readonly plugins: Plugins\r\n\r\n  constructor(options?: options) {\r\n    options = {\r\n      antialias: true, // 启用抗锯齿\r\n      ...options\r\n    }\r\n    this.renderer = PIXI.autoDetectRenderer(options)\r\n    this.plugins = {}\r\n    for (const pluginKey in Renderer.plugins) {\r\n      this.plugins[pluginKey] = new Renderer.plugins[pluginKey](\r\n        this.renderer,\r\n        options\r\n      )\r\n    }\r\n    this.renderer.plugins.interaction.autoPreventDefault = false\r\n    this.renderer.view.style.touchAction = 'auto'\r\n  }\r\n\r\n  static registerPlugin(id: string, pluginClass: () => any): void {\r\n    this.plugins[id] = pluginClass\r\n  }\r\n\r\n  get view() {\r\n    return this.renderer.view\r\n  }\r\n\r\n  public render(view: PIXI.Container) {\r\n    this.renderer.render(view)\r\n  }\r\n\r\n  public resize(width: number, height: number) {\r\n    this.renderer.autoDensity = true\r\n    this.renderer.resize(width, height)\r\n  }\r\n}\r\n\r\n/**\r\n * NOTE: PIXI Text 的换行是按空格来确定单词边界的，按空格将每个单词放入数组，\r\n * 然而中文语法中，没人写字带空格，于是会被认为一整串文字都为一个单词，\r\n * 这就导致英文与中文混合的时候，中文直接就被换到第二行去了，从而可能出现大面积空白。\r\n * 在这里，直接覆写 Text 的换行规则，让每个中文字符单独存入数组，以实现整齐的换行效果。\r\n * \r\n * NOTE: 如果使用里 lib 中的 Rainbow Text 模块，则可以不使用下面代码。\r\n *\r\n * 附1：如果要使用超~长的英文字符串时，可以启用 breakWords 来强制换行。\r\n * 附2：tokenize 是 TextMetrics 的私有方法，所以在这里使用 @ts-ignore 来规避 ts 的类型检查。\r\n * 参考: http://ts8zs.com/?p=309\r\n */\r\n// @ts-ignore\r\n// PIXI.TextMetrics.tokenize = function (text: string) {\r\n//   const tokens: string[] = []\r\n//   let token = ''\r\n//   if (typeof text !== 'string') {\r\n//     return tokens\r\n//   }\r\n\r\n//   for (let i = 0; i < text.length; i++) {\r\n//     const char = text[i]\r\n//     if (!/[a-z'-]/i.test(char)) {\r\n//       if (token !== '') {\r\n//         tokens.push(token)\r\n//         token = ''\r\n//       }\r\n//       tokens.push(char)\r\n//     } else {\r\n//       token += char\r\n//     }\r\n//   }\r\n\r\n//   if (token !== '') {\r\n//     tokens.push(token)\r\n//   }\r\n\r\n//   return tokens\r\n// }\r\n","/** 对象池 */\r\nexport class ObjectPool<T> {\r\n  private static pools: WeakMap<\r\n    { new (...args: any[]): any },\r\n    ObjectPool<any>\r\n    > = new WeakMap()\r\n  // 空闲对象\r\n  private freed: T[] = []\r\n  // 容量\r\n  private capacity: number = 100\r\n  // 计数器\r\n  private size: number = 0\r\n\r\n  /**\r\n   * 获取指定对象池\r\n   * @param ObjectClass 对象类\r\n   * @returns 对象池\r\n   */\r\n  public static of<T>(ObjectClass: { new (...args: any[]): T }) {\r\n    let pool = this.pools.get(ObjectClass)\r\n    if (pool === undefined) {\r\n      this.pools.set(ObjectClass, (pool = new ObjectPool<T>(ObjectClass)))\r\n    }\r\n    return pool as ObjectPool<T>\r\n  }\r\n\r\n  /**\r\n   * 释放指定对象池\r\n   * @param ObjectClass 对象类\r\n   */\r\n  public static free<T>(ObjectClass: { new (...args: any[]): T }) {\r\n    const pool = this.pools.get(ObjectClass)\r\n    if (pool) {\r\n      pool.clear()\r\n      this.pools.delete(ObjectClass)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 创建一个对象池\r\n   * @param ObjectClass 对象类型\r\n   */\r\n  constructor(private ObjectClass: { new (...args: any[]): T }) {}\r\n\r\n  /**\r\n   * 分配一个对象\r\n   * @returns 对象\r\n   */\r\n  public acquire() {\r\n    if (this.freed.length <= 0) {\r\n      this.expand()\r\n    }\r\n\r\n    const item = this.freed.pop()\r\n\r\n    return item as T\r\n  }\r\n\r\n  /**\r\n   * 释放一个对象\r\n   * @param item 对象\r\n   */\r\n  public release(item: T) {\r\n    this.freed.push(item)\r\n  }\r\n\r\n  /**\r\n   * 清空对象池\r\n   */\r\n  public clear() {\r\n    this.freed.length = 0\r\n  }\r\n\r\n  /**\r\n   * 扩展对象池\r\n   */\r\n  public expand() {\r\n    const count = Math.round(this.capacity * 0.2)\r\n    for (let i = 0; i < count; i++) {\r\n      const item = new this.ObjectClass()\r\n      this.freed.push(item)\r\n    }\r\n    this.size += count\r\n    if (this.size >= this.capacity) {\r\n      this.capacity += this.size\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 统计对象池空间大小\r\n   * @returns 对象池大小\r\n   */\r\n  public totalSize() {\r\n    return this.size\r\n  }\r\n\r\n  /**\r\n   * 统计空闲空间大小\r\n   * @returns 对象池空闲大小\r\n   */\r\n  public totalFree() {\r\n    return this.freed.length\r\n  }\r\n\r\n  /**\r\n   * 统计已使用空间大小\r\n   * @returns 对象池已使用大小\r\n   */\r\n  public totalUsed() {\r\n    return this.size - this.freed.length\r\n  }\r\n}\r\n","import { Signal } from 'signals'\r\nimport { ObjectPool } from './object-pool'\r\nimport { Entity } from './entity'\r\n\r\nexport type IComponentProps = {\r\n  [propName: string]: any\r\n}\r\n\r\nexport type IComponentClass<T extends IComponent> = {\r\n  new(): T\r\n  onComponentCreated: Signal\r\n  onComponentDestroyed: Signal\r\n  _id: string\r\n  _isRegister: boolean\r\n  _isComponent: boolean\r\n  _componentClassMap: Map<string, IComponentClass<IComponent>>\r\n  _pools: Map<string, ObjectPool<IComponent>>\r\n  create(\r\n    entity: Entity,\r\n    componentClass: IComponentClass<IComponent>,\r\n    values?: IComponentProps\r\n  ): IComponent\r\n  destory(componentClass: IComponentClass<IComponent>, component: IComponent): void\r\n}\r\n\r\n/**\r\n * 组件注册工具\r\n * @param id 组件唯一识别 id\r\n * @returns 注册器\r\n */\r\nexport function componentRegister(id: string) {\r\n  return function (target: IComponentClass<IComponent>) {\r\n    if (IComponent._componentClassMap.has(id)) {\r\n      console.warn(\r\n        `Component id: '${id}' already registered.`\r\n      )\r\n    } else {\r\n      target._id = id\r\n      target._isRegister = true\r\n      IComponent._componentClassMap.set(id, target)\r\n      // 注册的时候顺便把组件池也给开了\r\n      if (!IComponent._pools.has(id)) {\r\n        IComponent._pools.set(id, ObjectPool.of(target))\r\n      }\r\n    }\r\n    return target\r\n  }\r\n}\r\n\r\n/** 基础组件类 */\r\nexport class IComponent {\r\n  /** 当组件被创建时派发事件 */\r\n  public static readonly onComponentCreated: Signal = new Signal()\r\n  /** 当组件被销毁时派发事件 */\r\n  public static readonly onComponentDestroyed: Signal = new Signal()\r\n\r\n  public static _id: string\r\n  public static _isRegister: boolean = false\r\n  public static _isComponent: boolean = true\r\n  public static _componentClassMap: Map<string, IComponentClass<IComponent>> = new Map()\r\n  public static _pools: Map<string, ObjectPool<IComponent>> = new Map()\r\n  private entity?: Entity = null\r\n\r\n  /**\r\n   * 创建组件\r\n   * @param entity 组件挂载的实体\r\n   * @param componentClass 组件类\r\n   * @returns 组件\r\n   */\r\n  public static create(\r\n    entity: Entity,\r\n    componentClass: IComponentClass<IComponent>,\r\n    values?: IComponentProps\r\n  ) {\r\n    // const component = new componentClass()\r\n    const pool = this._pools.get(componentClass._id)\r\n    const component = pool.acquire()\r\n    component.entity = entity\r\n    if (values) {\r\n      component._setProps(values)\r\n    }\r\n    component.init()\r\n    this.onComponentCreated.dispatch({\r\n      componentClass,\r\n      component,\r\n      entity\r\n    })\r\n    return component\r\n  }\r\n\r\n  /**\r\n   * 移除组件\r\n   * @param componentClass 组件类\r\n   * @param component 组件\r\n   */\r\n  public static destory(componentClass: IComponentClass<IComponent>, component: IComponent) {\r\n    const pool = this._pools.get(componentClass._id)\r\n\r\n    this.onComponentDestroyed.dispatch({\r\n      componentClass,\r\n      component,\r\n      entity: component.entity\r\n    })\r\n    component.clear()\r\n    component.entity = null\r\n    pool.release(component)\r\n  }\r\n\r\n  /**\r\n   * 组件池统计\r\n   */\r\n  public static poolStats() {\r\n    const components = {} as any\r\n    this._pools.forEach((pool, id) => {\r\n      components[id] = {\r\n        size: pool.totalSize(),\r\n        free: pool.totalFree(),\r\n        used: pool.totalUsed()\r\n      }\r\n    })\r\n    return components\r\n  }\r\n\r\n  /** 初始化组件 */\r\n  public init() {}\r\n  /** 清理组件 */\r\n  public clear() {}\r\n\r\n  /**\r\n   * 设置组件属性\r\n   * @param values 属性\r\n   */\r\n  public _setProps(values: IComponentProps) {\r\n    for (const key in values) {\r\n      if (typeof values[key] !== 'undefined') {\r\n        (this as IComponentProps)[key] = values[key]\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 把组件转换为 json 数据\r\n   * \r\n   * NOTE: 该方法会被 JSON.stringify() 隐式调用，该方法定义什么值将被序列化。\r\n   * @returns 返回 json 数据\r\n   */\r\n  public toJSON(): any {\r\n    // 默认不序列化任何内容\r\n    return {}\r\n  }\r\n\r\n  /**\r\n   * 从 json 数据还原组件\r\n   * @param json json 数据\r\n   */\r\n  // public fromJSON(json: any) {\r\n  //   if (Object.prototype.toString.call(json) === '[object Object]') {\r\n  //     // 默认覆盖相应属性\r\n  //     this._setProps(json)\r\n  //   }\r\n  // }\r\n}\r\n","import { IComponentClass, IComponent } from './component'\r\n\r\n/**\r\n * 组合查询关键字\r\n * @param componentClassList 要查询的类数组\r\n */\r\nexport function queryKey(componentClassList: IComponentClass<IComponent>[]) {\r\n  return componentClassList.map(componentClass => componentClass._id).join('-')\r\n}\r\n\r\n/** uuid 生成器 */\r\nexport function generateUUID() {\r\n  let d = new Date().getTime()\r\n  let uuid = 'xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n    let r = (d + Math.random() * 16) % 16 | 0\r\n    d = Math.floor(d / 16)\r\n    return (c === 'x' ? r : (r & 0x3) | 0x8).toString(16)\r\n  })\r\n  return uuid\r\n}\r\n\r\n// Detector for browser's \"window\"\r\nexport const hasWindow = typeof window !== \"undefined\"\r\n\r\n// performance.now() \"polyfill\"\r\nexport const now =\r\n  hasWindow && typeof window.performance !== \"undefined\"\r\n    ? performance.now.bind(performance)\r\n    : Date.now.bind(Date)\r\n","import { IComponentClass, IComponent } from './component'\r\nimport { ObjectPool } from './object-pool'\r\nimport { generateUUID } from './utils'\r\nimport { World } from './world'\r\n\r\nexport type EntityClass = {\r\n  onComponentAdded(): void\r\n  onComponentRemoved(): void\r\n}\r\n\r\nexport class Entity {\r\n  public static _pool: ObjectPool<Entity> = ObjectPool.of(Entity)\r\n  public id: string = generateUUID()\r\n  public alias?: string\r\n  public isSingleton: boolean = false\r\n  public _world?: World\r\n  private _components: Map<IComponentClass<IComponent>, IComponent> = new Map()\r\n  public onComponentChanged?: (arg0: Entity) => void\r\n\r\n  /**\r\n   * 创建实体\r\n   * @returns 实体\r\n   */\r\n  public static create(world: World, alias?: string) {\r\n    const entity = this._pool.acquire()\r\n    entity._world = world\r\n    if (alias) {\r\n      entity.alias = alias\r\n    }\r\n    return entity\r\n  }\r\n\r\n  /**\r\n   * 销毁实体\r\n   * @param entity 实体\r\n   */\r\n  public static destory(entity: Entity) {\r\n    if (entity.isSingleton) {\r\n      throw new Error('Cannot destroy singleton entities.')\r\n    }\r\n    entity._destory()\r\n    this._pool.release(entity)\r\n  }\r\n\r\n  /**\r\n   * 单例实体\r\n   * @returns 实体\r\n   */\r\n  public static singleton(world: World) {\r\n    const entity = new Entity()\r\n    entity._world = world\r\n    entity.alias = 'singleton components'\r\n    entity.isSingleton = true\r\n\r\n    return entity\r\n  }\r\n\r\n  /**\r\n   * 实体池统计\r\n   */\r\n  public static poolStats() {\r\n    return {\r\n      size: this._pool.totalSize(),\r\n      free: this._pool.totalFree(),\r\n      used: this._pool.totalUsed()\r\n    }\r\n  }\r\n\r\n  /** 销毁实体 */\r\n  protected _destory() {\r\n    this.alias = undefined\r\n    this._world = undefined\r\n    this.onComponentChanged = undefined\r\n    this.removeAllComponent()\r\n  }\r\n\r\n  /**\r\n   * 校验组件是否符合规范\r\n   * @param componentClass 组件类\r\n   * @returns true - 符合， false - 不符合\r\n   */\r\n  public verifyComponent(componentClass: IComponentClass<IComponent>) {\r\n    // 如果组件没有继承基础组件类，或者组件没有注册，就必须报异常\r\n    if (\r\n      !componentClass._isComponent ||\r\n      !componentClass._isRegister\r\n    ) {\r\n      throw new Error(`The Component does not meet specifications.\\n` +\r\n        `Entity: ${this.alias || this.id} Component: ${componentClass._id || componentClass.name}`)\r\n    }\r\n    // 如果组件已经添加过了，就报个警告\r\n    if (this.hasComponent(componentClass)) {\r\n      console.warn(`Component already exists on entity.\\n` +\r\n        `Entity: ${this.alias || this.id} Component: ${componentClass._id}`)\r\n      return false\r\n    } else {\r\n      return true\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 查询实体是否包含组件\r\n   * @param componentClass 组件类\r\n   * @returns true - 包含， false - 不包含\r\n   */\r\n  public hasComponent(componentClass: IComponentClass<IComponent>) {\r\n    return this._components.has(componentClass)\r\n  }\r\n\r\n  /**\r\n   * 查询实体是否包含一组组件\r\n   * @param componentClassList 组件类数组\r\n   * @returns true - 包含， false - 不包含\r\n   */\r\n  public hasAllComponent(componentClassList: IComponentClass<IComponent>[]) {\r\n    for (const componentClass of componentClassList) {\r\n      if (!this.hasComponent(componentClass)) {\r\n        return false\r\n      }\r\n    }\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * 查询实体是否包含一组组件中的任意一个组件\r\n   * @param componentClassList 组件类类型数组\r\n   * @returns true - 包含， false - 不包含\r\n   */\r\n  public hasAnyComponent(componentClassList: IComponentClass<IComponent>[]) {\r\n    for (const componentClass of componentClassList) {\r\n      if (this.hasComponent(componentClass)) {\r\n        return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * 获得组件\r\n   * @param componentClass 组件类\r\n   * @returns 组件数据\r\n   */\r\n  public getComponent<T extends IComponent>(componentClass: IComponentClass<T>) {\r\n    if (this._components.has(componentClass)) {\r\n      return this._components.get(componentClass) as T\r\n    } else {\r\n      console.warn('getComponent: Component not found.\\n' +\r\n        `Component: ${ componentClass }`)\r\n      return {} as T\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 添加组件\r\n   * @param componentClass 组件类\r\n   * @param values 覆盖默认组件状态\r\n   * @returns this\r\n   */\r\n  public addComponent<T extends IComponent>(\r\n    componentClass: IComponentClass<T>,\r\n    values?: Partial<T>\r\n  ) {\r\n    if (!this.verifyComponent(componentClass)) {\r\n      return this\r\n    }\r\n    const component = IComponent.create(this, componentClass, values)\r\n    this._components.set(componentClass, component)\r\n    this.onComponentChanged && this.onComponentChanged(this)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 移除组件\r\n   * @param componentClass 组件类类型\r\n   * @returns this\r\n   */\r\n  public removeComponent(componentClass: IComponentClass<IComponent>) {\r\n    if (this._components.has(componentClass)) {\r\n      const component = this._components.get(componentClass)\r\n      IComponent.destory(componentClass, component)\r\n      this._components.delete(componentClass)\r\n      this.onComponentChanged && this.onComponentChanged(this)\r\n    }\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 移除全部组件\r\n   * @returns this\r\n   */\r\n  public removeAllComponent() {\r\n    this._components.forEach((component, key) => {\r\n      IComponent.destory(key, component)\r\n      this._components.delete(key)\r\n    })\r\n    this.onComponentChanged && this.onComponentChanged(this)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 把实体转换为 json 数据\r\n   * \r\n   * NOTE: 该方法会被 JSON.stringify() 隐式调用，该方法定义什么值将被序列化。\r\n   * @returns 返回 json 数据\r\n   */\r\n  public toJSON() {\r\n    const components: any[] = []\r\n    this._components.forEach((component, componentClass) => {\r\n      components.push({\r\n        class: componentClass._id,\r\n        content: component\r\n      })\r\n    })\r\n    const json: any = {\r\n      id: this.id,\r\n      alias: this.alias,\r\n      isSingleton: this.isSingleton,\r\n      components\r\n    }\r\n    return json\r\n  }\r\n\r\n  /**\r\n   * 从 json 数据还原实体\r\n   * @param json json 数据\r\n   */\r\n  public fromJSON(json: any) {\r\n    const componentClassMap = IComponent._componentClassMap\r\n    this.id = json.id\r\n    this.alias = json.alias\r\n    this.isSingleton = json.isSingleton\r\n    const components = json.components as any[]\r\n    for (const item of components) {\r\n      const classId = item.class\r\n      const content = item.content\r\n      if (!componentClassMap.has(classId)) {\r\n        console.warn(`Cannot find component with id '${classId}'.`)\r\n        continue\r\n      }\r\n      const componentClass = componentClassMap.get(classId)\r\n      this.addComponent(componentClass, content)\r\n    }\r\n  }\r\n}\r\n","import { Entity } from './entity'\r\nimport { IComponentClass, IComponent } from './component'\r\nimport { queryKey } from './utils'\r\n\r\n/** 查询项目 */\r\nexport class QueryItem {\r\n  private entities: Entity[] = []\r\n  public key: string = null\r\n\r\n  constructor(\r\n    private queryComponents: IComponentClass<IComponent>[],\r\n    private matchType: string\r\n  ) {\r\n    if (queryComponents.length === 0) {\r\n      throw new Error(`Can't create a query without \"components\" on System.`)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 判断实体是否通过查询条件\r\n   * @param entity 实体\r\n   * @returns true - 通过， false - 未通过\r\n   */\r\n  public match(entity: Entity) {\r\n    if (this.matchType === 'all') {\r\n      return this.matchAll(entity)\r\n    } else if (this.matchType === 'any') {\r\n      return this.matchAny(entity)\r\n    } else {\r\n      return false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 判断实体是否通过全部查询条件\r\n   * @param entity 实体\r\n   * @returns true - 通过， false - 未通过\r\n   */\r\n  public matchAll(entity: Entity) {\r\n    return entity.hasAllComponent(this.queryComponents)\r\n  }\r\n\r\n  /**\r\n   * 判断实体是否通过任意一个查询条件\r\n   * @param entity 实体\r\n   * @returns true - 通过， false - 未通过\r\n   */\r\n  public matchAny(entity: Entity) {\r\n    return entity.hasAnyComponent(this.queryComponents)\r\n  }\r\n\r\n  /**\r\n   * 获取实体列表\r\n   * @returns 符合查询条件的实体数组\r\n   */\r\n  public getEntity() {\r\n    return this.entities\r\n  }\r\n\r\n  /**\r\n   * 添加实体\r\n   * @param entity 实体\r\n   */\r\n  public addEntity(entity: Entity) {\r\n    if (this.entities.indexOf(entity) === -1) {\r\n      this.entities.push(entity)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 移除实体\r\n   * @param entity 实体\r\n   */\r\n  public removeEntity(entity: Entity) {\r\n    const index = this.entities.indexOf(entity)\r\n    if (index !== -1) {\r\n      this.entities.splice(index, 1)\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * 统计查询\r\n   * @returns 统计数据\r\n   */\r\n  public stats() {\r\n    const queryComponents = this.queryComponents.map(componentClass => componentClass._id)\r\n    return {\r\n      matchType: this.matchType,\r\n      numQueryComponents: this.queryComponents.length,\r\n      numEntities: this.entities.length,\r\n      queryComponents\r\n    }\r\n  }\r\n}\r\n\r\n/** 实体查询管理 */\r\nexport class EntityQuery {\r\n  private queries: Map<string, QueryItem> = new Map()\r\n\r\n  /**\r\n   * 创建查询项目\r\n   * @param queryComponents 查询条件\r\n   * @param matchType 查询类型 all | any\r\n   * @returns 查询项目\r\n   */\r\n  public createQuery(queryComponents: IComponentClass<IComponent>[], matchType: string) {\r\n    const key = matchType + queryKey(queryComponents)\r\n    // 如果不同 system 具有相同的查询条件，就没必要创建新的查询了\r\n    if (this.queries.has(key)) {\r\n      return this.queries.get(key)\r\n    } else {\r\n      const query = new QueryItem(queryComponents, matchType)\r\n      query.key = key\r\n      this.queries.set(key, query)\r\n      return query\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 实体删除事件\r\n   * @param entity 实体\r\n   */\r\n  public onEntityRemoved(entity: Entity) {\r\n    this.queries.forEach(query => {\r\n      query.removeEntity(entity)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 实体组件变化事件\r\n   * @param entity 实体\r\n   */\r\n  public onEntityComponentChanged(entity: Entity) {\r\n    this.queries.forEach(query => {\r\n      if (query.match(entity)) {\r\n        query.addEntity(entity)\r\n      } else {\r\n        query.removeEntity(entity)\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 统计查询\r\n   * @returns 统计数据\r\n   */\r\n  public stats() {\r\n    const queries = [] as any[]\r\n    this.queries.forEach(query => {\r\n      queries.push(query.stats())\r\n    })\r\n    const numQueries = queries.length\r\n    \r\n    return {\r\n      numQueries,\r\n      queries\r\n    }\r\n  }\r\n}","import { Entity } from './entity'\r\nimport { IComponentClass, IComponent } from './component'\r\nimport { EntityQuery } from './entity-query'\r\nimport { World } from './world'\r\n\r\nexport class EntityManager {\r\n  private entities: Map<string, Entity> = new Map()\r\n  private numEntities: number = 0\r\n  private entityQuery: EntityQuery = new EntityQuery()\r\n  private entitiesWithComponentChanged: Set<Entity> = new Set()\r\n\r\n  constructor(private world: World) {}\r\n\r\n  /**\r\n   * 创建实体\r\n   * @param alias 别名\r\n   * @returns 创建的实体对象\r\n   */\r\n  public createEntity(alias?: string) {\r\n    const entity = this.initEntity(alias)\r\n    this.pushEntity(entity)\r\n    return entity\r\n  }\r\n\r\n  /**\r\n   * 初始化实体\r\n   * @param alias \r\n   */\r\n  private initEntity(alias?: string): Entity {\r\n    const entity = Entity.create(this.world, alias)\r\n    entity.onComponentChanged = entity => {\r\n      this.entitiesWithComponentChanged.add(entity)\r\n    }\r\n    return entity\r\n  }\r\n\r\n  /**\r\n   * 把实体放入实体队列\r\n   * @param entity \r\n   */\r\n  private pushEntity(entity: Entity): void {\r\n    this.numEntities++\r\n    this.entities.set(entity.id, entity)\r\n  }\r\n\r\n  /**\r\n   * 移除实体\r\n   * @param entity 实体\r\n   */\r\n  public removeEntity(entity: Entity) {\r\n    this.entityQuery.onEntityRemoved(entity)\r\n    this.numEntities--\r\n    this.entities.delete(entity.id)\r\n    Entity.destory(entity)\r\n  }\r\n\r\n  /**\r\n   * 判断是否包含实体\r\n   * @param entity \r\n   * @returns true —— 包含, false —— 不包含\r\n   */\r\n  public hasEntity(entity: Entity) {\r\n    return this.entities.has(entity.id)\r\n  }\r\n\r\n  /**\r\n   * 通过实体 id 获取指定实体\r\n   * @param {string} id \r\n   * @returns {Entity | undefined}\r\n   */\r\n  public getEntity(id: string): Entity | undefined {\r\n    return this.entities.get(id)\r\n  }\r\n\r\n  /** 销毁全部实体 */\r\n  public clear() {\r\n    this.entities.forEach(entity => {\r\n      this.removeEntity(entity)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 为 System 创建实体查询\r\n   * @param QueryComponents 查询条件\r\n   * @param matchType 查询类型 all | any\r\n   * @returns 查询项目\r\n   */\r\n  public createQuery(QueryComponents: IComponentClass<IComponent>[], matchType: string) {\r\n    return this.entityQuery.createQuery(QueryComponents, matchType)\r\n  }\r\n\r\n  /**\r\n   * 更新修改过组件的实体的实体查询\r\n   */\r\n  public updateEntityQuery() {\r\n    this.entitiesWithComponentChanged.forEach(entity => {\r\n      this.entityQuery.onEntityComponentChanged(entity)\r\n    })\r\n    this.entitiesWithComponentChanged.clear()\r\n  }\r\n\r\n  /**\r\n   * 把游戏状态转换为 json 数据\r\n   * \r\n   * NOTE: 该方法会被 JSON.stringify() 隐式调用，该方法定义什么值将被序列化。\r\n   */\r\n  public toJSON() {\r\n    const json: any[] = []\r\n    this.entities.forEach(entity => {\r\n      json.push(entity)\r\n    })\r\n    return json\r\n  }\r\n\r\n  /**\r\n   * 从 json 数据还原游戏状态\r\n   */\r\n  public fromJSON(json: any) {\r\n    for (const token of json) {\r\n      const entity = this.initEntity()\r\n      entity.fromJSON(token)\r\n      this.pushEntity(entity)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 统计实体数据\r\n   * @returns 统计数据\r\n   */\r\n  public stats() {\r\n    const queryStats = this.entityQuery.stats()\r\n\r\n    const numEntities = this.numEntities\r\n    const numQueries = queryStats.numQueries\r\n    const queries = queryStats.queries\r\n    return {\r\n      numEntities,\r\n      numQueries,\r\n      queries,\r\n    }\r\n  }\r\n}\r\n","import { Entity } from './entity'\r\nimport { IComponentClass, IComponent } from './component'\r\nimport { World } from './world'\r\n\r\nexport type ISystemQuery = {\r\n  [queryName: string]: {\r\n    type: 'all' | 'any'\r\n    components: IComponentClass<IComponent>[]\r\n  } | IComponentClass<IComponent>[]\r\n}\r\n\r\nexport type ISystemQueries = {\r\n  [queryName: string]: {\r\n    results: Entity[]\r\n  }\r\n}\r\n\r\nexport type ISystemClass<T extends ISystem> = {\r\n  new (...args: any[]): T\r\n  isSystem: true\r\n  queries?: ISystemQuery\r\n}\r\n\r\n/**\r\n * 系统优先级\r\n */\r\nexport const SystemPriority = {\r\n  Begin: 0,\r\n  Start: 1,\r\n  FixedUpdate: 2,\r\n  Update: 3,\r\n  Animation: 4,\r\n  LateUpdate: 5,\r\n  BeforeRenderer: 6,\r\n  Renderer: 7,\r\n  End: 8\r\n}\r\n\r\nexport class ISystem {\r\n  public static readonly isSystem: true = true\r\n  public static queries?: ISystemQuery\r\n  public world: World = null\r\n  public queries: ISystemQueries = {}\r\n  public _priority: number = -1\r\n  public _executeTime: number = 0\r\n  public init() {}\r\n  public execute(delta: number, timestamp: number) {}\r\n}\r\n","import { World } from './world'\r\nimport { EntityManager } from './entity-manager'\r\nimport { ISystemClass, ISystem, SystemPriority } from './system'\r\nimport { now } from './utils'\r\n\r\nexport class SystemManager {\r\n  private systems: ISystem[] = []\r\n\r\n  constructor(\r\n    private world: World,\r\n    private entityManager: EntityManager\r\n  ) {}\r\n  \r\n  /**\r\n   * 向 system 中注入查询\r\n   * @param systemClass\r\n   * @param system\r\n   */\r\n  private _injectQuery<T extends ISystem>(\r\n    systemClass: ISystemClass<T>,\r\n    system: ISystem\r\n  ) {\r\n    const queries = systemClass.queries\r\n\r\n    if (queries) {\r\n      for (const key in queries) {\r\n        // 偷懒写法，如果是数组，那就当作是\"完全匹配查询\"\r\n        // 如果是 Object，那就判断下属性是否符合要求，不符合就跳过\r\n        if (Array.isArray(queries[key])) {\r\n          const query = this.entityManager.createQuery(queries[key] as any, 'all')\r\n          system.queries[key] = {\r\n            results: query.getEntity()\r\n          }\r\n        } else {\r\n          const { type = 'all', components } = queries[key] as any\r\n          if (type !== 'all' && type !== 'any' && Array.isArray(components)) {\r\n            continue\r\n          }\r\n          const query = this.entityManager.createQuery(components, type)\r\n          system.queries[key] = {\r\n            results: query.getEntity()\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 把 system 放进 system 队列\r\n   * @param system \r\n   */\r\n  private _pushSystem(system: ISystem) {\r\n    const systemCount = this.systems.length\r\n\r\n    if (systemCount > 0) {\r\n      if (system._priority < this.systems[0]._priority) {\r\n        this.systems.unshift(system)\r\n        return\r\n      } else if (system._priority >= this.systems[systemCount - 1]._priority) {\r\n        this.systems.push(system)\r\n        return\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < systemCount; i++) {\r\n      if (system._priority < this.systems[i]._priority) {\r\n        this.systems.splice(i, 0, system)\r\n        return\r\n      }\r\n    }\r\n    this.systems.push(system)\r\n  }\r\n\r\n  /**\r\n   * 注册 system\r\n   * @param systemClass system 类\r\n   * @param priority system 优先级\r\n   */\r\n  public registerSystem<T extends ISystem>(\r\n    systemClass: ISystemClass<T>,\r\n    priority: number = SystemPriority.Update\r\n  ) {\r\n    if (!systemClass.isSystem) {\r\n      throw new Error(`System \"${systemClass.name}\" must extend \"System\" class.`)\r\n    }\r\n    if (this.isRegisterSystem(systemClass)) {\r\n      console.warn(`System \"${systemClass.name}\" already registered.`)\r\n      return\r\n    }\r\n    const system = new systemClass()\r\n    system._priority = priority\r\n    system.world = this.world\r\n    this._injectQuery(systemClass, system)\r\n    this._pushSystem(system)\r\n    system.init()\r\n  }\r\n\r\n  /**\r\n   * 判断 system 是否已经注册\r\n   * @param systemClass\r\n   * @returns true - 已注册，false - 未注册\r\n   */\r\n  public isRegisterSystem<T extends ISystem>(systemClass: ISystemClass<T>) {\r\n    return this.systems.findIndex(system => system instanceof systemClass) !== -1\r\n  }\r\n\r\n  /**\r\n   * 执行 system\r\n   * @param delta 时间差\r\n   * @param timestamp 时间戳\r\n   */\r\n  public execute(delta: number, timestamp: number) {\r\n    this.systems.forEach(system => {\r\n      const startTime = now()\r\n      system.execute(delta, timestamp)\r\n      this.entityManager.updateEntityQuery()\r\n      system._executeTime = now() - startTime\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 统计 System 数据\r\n   * @returns 统计数据\r\n   */\r\n  public stats() {\r\n    return {\r\n      numSystems: this.systems.length,\r\n      executeTime: this.systems.map(system => {\r\n        const systemClass = system.constructor\r\n        return {\r\n          name: systemClass.name,\r\n          executeTime: system._executeTime\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n","import { Entity } from './entity'\r\nimport { IComponent } from './component'\r\nimport { EntityManager } from './entity-manager'\r\nimport { SystemManager } from './system-manager'\r\nimport { ISystemClass, ISystem, SystemPriority } from './system'\r\nimport { now } from './utils'\r\n\r\nexport class World {\r\n  private entityManager: EntityManager = new EntityManager(this)\r\n  private systemManager: SystemManager = new SystemManager(this, this.entityManager)\r\n  public singleton: Entity = Entity.singleton(this)\r\n  private enabled: boolean = false\r\n  private lastTimestamp: number = 0\r\n\r\n  /**\r\n   * 注册 system\r\n   * @param systemClass system 类\r\n   * @param priority system 优先级\r\n   * @returns this\r\n   */\r\n  public registerSystem<T extends ISystem>(\r\n    systemClass: ISystemClass<T>,\r\n    priority: number = SystemPriority.Update\r\n  ) {\r\n    this.systemManager.registerSystem(systemClass, priority)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 创建实体\r\n   * @param alias 实体别名\r\n   * @returns 实体\r\n   */\r\n  public createEntity(alias?: string) {\r\n    return this.entityManager.createEntity(alias)\r\n  }\r\n\r\n  /**\r\n   * 移除实体\r\n   * @param entity 实体\r\n   */\r\n  public removeEntity(entity: Entity) {\r\n    this.entityManager.removeEntity(entity)\r\n  }\r\n\r\n  /**\r\n   * 移除全部实体\r\n   * @param entity 实体\r\n   */\r\n  public removeAllEntity() {\r\n    this.entityManager.clear()\r\n  }\r\n\r\n  /**\r\n   * 判断是否包含实体\r\n   * @param entity \r\n   * @returns true —— 包含, false —— 不包含\r\n   */\r\n  public hasEntity(entity: Entity) {\r\n    return this.entityManager.hasEntity(entity)\r\n  }\r\n\r\n  /**\r\n   * 通过实体 id 获取指定实体\r\n   * @param {string} id \r\n   * @returns {Entity | undefined}\r\n   */\r\n  public getEntity(id: string): Entity | undefined {\r\n    return this.entityManager.getEntity(id)\r\n  }\r\n\r\n  /** 强制更新实体查询 */\r\n  public mandatoryUpdateEntityQuery() {\r\n    this.entityManager.updateEntityQuery()\r\n  }\r\n\r\n  /**\r\n   * 执行帧\r\n   * @param {number} timestamp - 帧时间戳\r\n   */\r\n  public execute(timestamp: number) {\r\n    if (typeof timestamp === 'undefined') {\r\n      timestamp = now()\r\n    }\r\n    let delta = 0\r\n    if (this.lastTimestamp !== 0) {\r\n      delta = timestamp - this.lastTimestamp\r\n    }\r\n    this.lastTimestamp = timestamp\r\n    if (this.enabled) {\r\n      this.systemManager.execute(delta, timestamp)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 启动 world\r\n   */\r\n  public start() {\r\n    this.enabled = true\r\n    this.lastTimestamp = 0\r\n  }\r\n\r\n  /**\r\n   * 停止 world\r\n   */\r\n  public stop() {\r\n    this.enabled = false\r\n  }\r\n\r\n  /**\r\n   * 清理 world 中的实体\r\n   */\r\n  public clear() {\r\n    this.entityManager.clear()\r\n    this.singleton.removeAllComponent()\r\n  }\r\n\r\n  /**\r\n   * 序列化游戏状态\r\n   * @returns 序列化字符串\r\n   */\r\n  public serialize() {\r\n    const token = JSON.stringify({\r\n      entity: this.entityManager,\r\n      singleton: this.singleton\r\n    })\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.log(JSON.parse(token))\r\n    }\r\n    return token\r\n  }\r\n\r\n  /**\r\n   * 反序列化游戏状态\r\n   * @param token 序列化字符串\r\n   */\r\n  public deserialize(token: string) {\r\n    this.clear()\r\n    const json = JSON.parse(token)\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.log(json)\r\n    }\r\n    this.entityManager.fromJSON(json.entity)\r\n    this.singleton.fromJSON(json.singleton)\r\n  }\r\n\r\n  /**\r\n   * 统计实体数据\r\n   * @returns 统计数据\r\n   */\r\n  public stats() {\r\n    const { numEntities, numQueries, queries } = this.entityManager.stats()\r\n    const { numSystems, executeTime } = this.systemManager.stats()\r\n\r\n    return {\r\n      overview: {\r\n        numEntities,\r\n        numSystems,\r\n        numQueries\r\n      },\r\n      systems: executeTime,\r\n      queries,\r\n      pool: {\r\n        entity: Entity.poolStats(),\r\n        component: IComponent.poolStats()\r\n      }\r\n    }\r\n  }\r\n}\r\n","import * as PIXI from 'pixi.js'\r\n\r\nexport class Stage extends PIXI.Container {\r\n  public numLayer: number = 0\r\n  public layerMap: Map<string, PIXI.Container | PIXI.ParticleContainer> = new Map()\r\n\r\n  /**\r\n   * 添加图层到 Stage 中\r\n   * @param layer \r\n   * @param id \r\n   * @param index \r\n   * @private\r\n   */\r\n  private _addLayer(\r\n    layer: PIXI.Container | PIXI.ParticleContainer,\r\n    id: string,\r\n    index?: number\r\n  ) {\r\n    if (index) {\r\n      this.addChildAt(layer, index)\r\n    } else {\r\n      this.addChild(layer)\r\n    }\r\n    this.layerMap.set(id, layer)\r\n    this.numLayer++\r\n  }\r\n\r\n  /**\r\n   * 创建图层\r\n   * @param id \r\n   * @param index \r\n   */\r\n  public createLayer(id: string, index?: number) {\r\n    const layer = new PIXI.Container()\r\n    this._addLayer(layer, id, index)\r\n  }\r\n\r\n  /**\r\n   * 创建粒子图层\r\n   * @param id \r\n   * @param index \r\n   */\r\n  public createParticleLayer(id: string, index?: number) {\r\n    const layer = new PIXI.ParticleContainer()\r\n    this._addLayer(layer, id, index)\r\n  }\r\n\r\n  /**\r\n   * 判断图层是否存在\r\n   * @param id \r\n   */\r\n  public hasLayer(id: string) {\r\n    return this.layerMap.has(id)\r\n  }\r\n\r\n  /**\r\n   * 获得图层\r\n   * @param id \r\n   */\r\n  public getLayer(id: string) {\r\n    if (!this.layerMap.has(id)) {\r\n      console.warn(`There is no layer whose id is \"${id}\".`)\r\n    }\r\n    return this.layerMap.get(id)\r\n  }\r\n\r\n  /**\r\n   * 移除图层\r\n   * @param id \r\n   */\r\n  public removeLayer(id: string) {\r\n    if (this.layerMap.has(id)) {\r\n      const layer = this.layerMap.get(id)\r\n      this.removeChild(layer)\r\n      this.numLayer--\r\n    } else {\r\n      console.warn(`There is no layer whose id is \"${id}\".`)\r\n    }\r\n  }\r\n\r\n  /**清理图层 */\r\n  public clearLayer() {\r\n    this.layerMap.forEach(layer => {\r\n      layer.removeChildren(0)\r\n    })\r\n  }\r\n}","import { World } from '../core'\r\nimport { Stage } from './stage'\r\n\r\nexport class Scene extends World {\r\n  public view: Stage\r\n\r\n  constructor() {\r\n    super()\r\n    this.view = new Stage()\r\n    // 预设11个用户图层\r\n    for (let i = 0; i <= 10; i++) {\r\n      this.addLayer(`UserLayer${i}`)\r\n    }\r\n  }\r\n\r\n  public addLayer(id: string, index?: number) {\r\n    this.view.createLayer(id, index)\r\n  }\r\n\r\n  public addParticleLayer(id: string, index?: number) {\r\n    this.view.createParticleLayer(id, index)\r\n  }\r\n\r\n  public hasLayer(id: string) {\r\n    return this.view.hasLayer(id)\r\n  }\r\n\r\n  public getLayer(id: string) {\r\n    return this.view.getLayer(id)\r\n  }\r\n\r\n  public removeLayer(id: string) {\r\n    this.view.removeLayer(id)\r\n  }\r\n\r\n  public addSprite(layerId: string, sprite: PIXI.Container) {\r\n    const layer = this.getLayer(layerId)\r\n    layer?.addChild(sprite)\r\n  }\r\n\r\n  public removeSprite(layerId: string, sprite: PIXI.Container) {\r\n    const layer = this.getLayer(layerId)\r\n    layer?.removeChild(sprite)\r\n  }\r\n}\r\n","export type InteractivePointerEvent = PointerEvent | TouchEvent | MouseEvent\r\n\r\nexport class Point {\r\n  public x: number\r\n  public y: number\r\n\r\n  constructor(x: number = 0, y: number = x) {\r\n    this.x = x\r\n    this.y = y\r\n  }\r\n\r\n  public set(x: number, y: number = x) {\r\n    this.x = x\r\n    this.y = y\r\n  }\r\n}\r\n\r\n/**\r\n * Holds all information related to an Interaction event\r\n *\r\n * @class\r\n * @memberof PIXI\r\n */\r\nexport class InteractionData {\r\n  /**\r\n   * This point stores the global coords of where the touch/mouse event happened\r\n   *\r\n   * @member {Point}\r\n   */\r\n  public global: Point\r\n\r\n  /**\r\n   * When passed to an event handler, this will be the original DOM Event that was captured\r\n   *\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent\r\n   * @member {MouseEvent|TouchEvent|PointerEvent}\r\n   */\r\n  public originalEvent: InteractivePointerEvent\r\n\r\n  /**\r\n   * Mouse or Touch is down?\r\n   * \r\n   * @member {boolean}\r\n   */\r\n  public isDown: boolean\r\n\r\n  /**\r\n   * Unique identifier for this interaction\r\n   *\r\n   * @member {number}\r\n   */\r\n  public identifier: number\r\n\r\n  /**\r\n   * Indicates whether or not the pointer device that created the event is the primary pointer.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/isPrimary\r\n   * @type {Boolean}\r\n   */\r\n  public isPrimary: boolean\r\n\r\n  /**\r\n   * Indicates which button was pressed on the mouse or pointer device to trigger the event.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/button\r\n   * @type {number}\r\n   */\r\n  public button: number\r\n\r\n  /**\r\n   * Indicates which buttons are pressed on the mouse or pointer device when the event is triggered.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/buttons\r\n   * @type {number}\r\n   */\r\n  public buttons: number\r\n\r\n  /**\r\n   * The width of the pointer's contact along the x-axis, measured in CSS pixels.\r\n   * radiusX of TouchEvents will be represented by this value.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/width\r\n   * @type {number}\r\n   */\r\n  public width: number\r\n\r\n  /**\r\n   * The height of the pointer's contact along the y-axis, measured in CSS pixels.\r\n   * radiusY of TouchEvents will be represented by this value.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/height\r\n   * @type {number}\r\n   */\r\n  public height: number\r\n\r\n  /**\r\n   * The angle, in degrees, between the pointer device and the screen.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/tiltX\r\n   * @type {number}\r\n   */\r\n  public tiltX: number\r\n\r\n  /**\r\n   * The angle, in degrees, between the pointer device and the screen.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/tiltY\r\n   * @type {number}\r\n   */\r\n  public tiltY: number\r\n\r\n  /**\r\n   * The type of pointer that triggered the event.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/pointerType\r\n   * @type {string}\r\n   */\r\n  public pointerType: string\r\n\r\n  /**\r\n   * Pressure applied by the pointing device during the event. A Touch's force property\r\n   * will be represented by this value.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/pressure\r\n   * @type {number}\r\n   */\r\n  public pressure: number\r\n\r\n  /**\r\n   * From TouchEvents (not PointerEvents triggered by touches), the rotationAngle of the Touch.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Touch/rotationAngle\r\n   * @type {number}\r\n   */\r\n  public rotationAngle: number\r\n\r\n  /**\r\n   * Twist of a stylus pointer.\r\n   * @see https://w3c.github.io/pointerevents/#pointerevent-interface\r\n   * @type {number}\r\n   */\r\n  public twist: number\r\n\r\n  /**\r\n   * Barrel pressure on a stylus pointer.\r\n   * @see https://w3c.github.io/pointerevents/#pointerevent-interface\r\n   * @type {number}\r\n   */\r\n  public tangentialPressure: number\r\n\r\n  constructor() {\r\n    this.global = new Point()\r\n    this.originalEvent = null\r\n    this.isDown = false\r\n\r\n    this.identifier = null\r\n    this.isPrimary = false\r\n    this.button = 0\r\n    this.buttons = 0\r\n    this.width = 0\r\n    this.height = 0\r\n    this.tiltX = 0\r\n    this.tiltY = 0\r\n    this.pointerType = null\r\n    this.pressure = 0\r\n    this.rotationAngle = 0\r\n    this.twist = 0\r\n    this.tangentialPressure = 0\r\n  }\r\n\r\n  /**\r\n   * The unique identifier of the pointer. It will be the same as `identifier`.\r\n   * @readonly\r\n   * @member {number}\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/pointerId\r\n   */\r\n  get pointerId(): number {\r\n    return this.identifier\r\n  }\r\n\r\n  /**\r\n   * Copies properties from normalized event data.\r\n   *\r\n   * @param {Touch|MouseEvent|PointerEvent} event - The normalized event data\r\n   */\r\n  public copyEvent(event: Touch | InteractivePointerEvent): void {\r\n    // isPrimary should only change on touchstart/pointerdown, so we don't want to overwrite\r\n    // it with \"false\" on later events when our shim for it on touch events might not be\r\n    // accurate\r\n    if ('isPrimary' in event && event.isPrimary) {\r\n      this.isPrimary = true\r\n    }\r\n    this.button = 'button' in event && event.button\r\n    // event.buttons is not available in all browsers (ie. Safari), but it does have a non-standard\r\n    // event.which property instead, which conveys the same information.\r\n    const buttons = 'buttons' in event && event.buttons\r\n\r\n    this.buttons = Number.isInteger(buttons)\r\n      ? buttons\r\n      : 'which' in event && event.which\r\n    this.width = 'width' in event && event.width\r\n    this.height = 'height' in event && event.height\r\n    this.tiltX = 'tiltX' in event && event.tiltX\r\n    this.tiltY = 'tiltY' in event && event.tiltY\r\n    this.pointerType = 'pointerType' in event && event.pointerType\r\n    this.pressure = 'pressure' in event && event.pressure\r\n    this.rotationAngle = 'rotationAngle' in event && event.rotationAngle\r\n    this.twist = ('twist' in event && event.twist) || 0\r\n    this.tangentialPressure =\r\n      ('tangentialPressure' in event && event.tangentialPressure) || 0\r\n  }\r\n\r\n  /**\r\n   * Resets the data for pooling.\r\n   */\r\n  public reset(): void {\r\n    // isPrimary is the only property that we really need to reset - everything else is\r\n    // guaranteed to be overwritten\r\n    this.isPrimary = false\r\n  }\r\n}\r\n","import type { AbstractRenderer } from 'pixi.js'\r\nimport { InteractionData, Point } from './InteractionData'\r\nimport type { InteractivePointerEvent } from './InteractionData'\r\n\r\nconst MOUSE_POINTER_ID = 1\r\n\r\ninterface CrossCSSStyleDeclaration extends CSSStyleDeclaration {\r\n  msContentZooming: string\r\n  msTouchAction: string\r\n}\r\n\r\nexport class InteractionManager {\r\n  /**\r\n   * Does the device support touch events\r\n   * https://www.w3.org/TR/touch-events/\r\n   *\r\n   * @readonly\r\n   * @member {boolean}\r\n   */\r\n  public readonly supportsTouchEvents: boolean\r\n\r\n  /**\r\n   * Does the device support pointer events\r\n   * https://www.w3.org/Submission/pointer-events/\r\n   *\r\n   * @readonly\r\n   * @member {boolean}\r\n   */\r\n  public readonly supportsPointerEvents: boolean\r\n\r\n  /**\r\n   * The renderer this interaction manager works for.\r\n   *\r\n   * @member {PIXI.AbstractRenderer}\r\n   */\r\n  public renderer: AbstractRenderer\r\n\r\n  /**\r\n   * The mouse data\r\n   *\r\n   * @member {InteractionData}\r\n   */\r\n  public mouse: InteractionData\r\n\r\n  /**\r\n   * The current resolution / device pixel ratio.\r\n   *\r\n   * @member {number}\r\n   * @default 1\r\n   */\r\n  public resolution: number\r\n\r\n  /**\r\n   * The DOM element to bind to.\r\n   *\r\n   * @protected\r\n   * @member {HTMLElement}\r\n   */\r\n  protected interactionDOMElement: HTMLElement\r\n\r\n  /**\r\n   * Have events been attached to the dom element?\r\n   *\r\n   * @protected\r\n   * @member {boolean}\r\n   */\r\n  protected eventsAdded: boolean\r\n\r\n  /**\r\n   * @param {PIXI.CanvasRenderer|PIXI.Renderer} renderer - A reference to the current renderer\r\n   */\r\n  constructor(renderer: AbstractRenderer) {\r\n    this.renderer = renderer\r\n    this.mouse = new InteractionData()\r\n    this.mouse.identifier = MOUSE_POINTER_ID\r\n    this.mouse.global.set(-1)\r\n    this.interactionDOMElement = null\r\n    this.eventsAdded = false\r\n    this.supportsTouchEvents = 'ontouchstart' in window\r\n    this.supportsPointerEvents = !!window.PointerEvent\r\n    this.resolution = 1\r\n\r\n    // this will make it so that you don't have to call bind all the time\r\n    this.onPointerUp = this.onPointerUp.bind(this)\r\n    this.onPointerCancel = this.onPointerCancel.bind(this)\r\n    this.onPointerDown = this.onPointerDown.bind(this)\r\n    this.onPointerMove = this.onPointerMove.bind(this)\r\n    this.onPointerOut = this.onPointerOut.bind(this)\r\n    this.onPointerOver = this.onPointerOver.bind(this)\r\n\r\n    this.setTargetElement(this.renderer.view, this.renderer.resolution)\r\n  }\r\n\r\n  /**\r\n   * Sets the DOM element which will receive mouse/touch events. This is useful for when you have\r\n   * other DOM elements on top of the renderers Canvas element. With this you'll be bale to delegate\r\n   * another DOM element to receive those events.\r\n   *\r\n   * @param {HTMLElement} element - the DOM element which will receive mouse and touch events.\r\n   * @param {number} [resolution=1] - The resolution / device pixel ratio of the new element (relative to the canvas).\r\n   */\r\n  public setTargetElement(element: HTMLElement, resolution: number = 1): void {\r\n    this.removeEvents()\r\n\r\n    this.interactionDOMElement = element\r\n\r\n    this.resolution = resolution\r\n\r\n    this.addEvents()\r\n  }\r\n\r\n  /**\r\n   * Registers all the DOM events\r\n   *\r\n   * @private\r\n   */\r\n  private addEvents(): void {\r\n    if (this.eventsAdded || !this.interactionDOMElement) {\r\n      return\r\n    }\r\n\r\n    const style = this.interactionDOMElement.style as CrossCSSStyleDeclaration\r\n\r\n    if (window.navigator.msPointerEnabled) {\r\n      style.msContentZooming = 'none'\r\n      style.msTouchAction = 'none'\r\n    } else if (this.supportsPointerEvents) {\r\n      style.touchAction = 'none'\r\n    }\r\n\r\n    /*\r\n     * These events are added first, so that if pointer events are normalized, they are fired\r\n     * in the same order as non-normalized events. ie. pointer event 1st, mouse / touch 2nd\r\n     */\r\n    const dom = this.interactionDOMElement\r\n    if (this.supportsPointerEvents) {\r\n      window.document.addEventListener('pointermove', this.onPointerMove, true)\r\n      dom.addEventListener('pointerdown', this.onPointerDown, true)\r\n      // pointerout is fired in addition to pointerup (for touch events) and pointercancel\r\n      // we already handle those, so for the purposes of what we do in onPointerOut, we only\r\n      // care about the pointerleave event\r\n      dom.addEventListener('pointerleave', this.onPointerOut, true)\r\n      dom.addEventListener('pointerover', this.onPointerOver, true)\r\n      window.addEventListener('pointercancel', this.onPointerCancel, true)\r\n      window.addEventListener('pointerup', this.onPointerUp, true)\r\n    } else {\r\n      window.document.addEventListener('mousemove', this.onPointerMove, true)\r\n      dom.addEventListener('mousedown', this.onPointerDown, true)\r\n      dom.addEventListener('mouseout', this.onPointerOut, true)\r\n      dom.addEventListener('mouseover', this.onPointerOver, true)\r\n      window.addEventListener('mouseup', this.onPointerUp, true)\r\n    }\r\n\r\n    // always look directly for touch events so that we can provide original data\r\n    // In a future version we should change this to being just a fallback and rely solely on\r\n    // PointerEvents whenever available\r\n    if (this.supportsTouchEvents) {\r\n      dom.addEventListener('touchstart', this.onPointerDown, true)\r\n      dom.addEventListener('touchcancel', this.onPointerCancel, true)\r\n      dom.addEventListener('touchend', this.onPointerUp, true)\r\n      dom.addEventListener('touchmove', this.onPointerMove, true)\r\n    }\r\n\r\n    this.eventsAdded = true\r\n  }\r\n\r\n  /**\r\n   * Removes all the DOM events that were previously registered\r\n   *\r\n   * @private\r\n   */\r\n  private removeEvents(): void {\r\n    if (!this.eventsAdded || !this.interactionDOMElement) {\r\n      return\r\n    }\r\n\r\n    const style = this.interactionDOMElement.style as CrossCSSStyleDeclaration\r\n\r\n    if (window.navigator.msPointerEnabled) {\r\n      style.msContentZooming = ''\r\n      style.msTouchAction = ''\r\n    } else if (this.supportsPointerEvents) {\r\n      style.touchAction = ''\r\n    }\r\n\r\n    const dom = this.interactionDOMElement\r\n    if (this.supportsPointerEvents) {\r\n      window.document.removeEventListener('pointermove', this.onPointerMove, true)\r\n      dom.removeEventListener('pointerdown', this.onPointerDown, true)\r\n      dom.removeEventListener('pointerleave', this.onPointerOut, true)\r\n      dom.removeEventListener('pointerover', this.onPointerOver, true)\r\n      window.removeEventListener('pointercancel', this.onPointerCancel, true)\r\n      window.removeEventListener('pointerup', this.onPointerUp, true)\r\n    } else {\r\n      window.document.removeEventListener('mousemove', this.onPointerMove, true)\r\n      dom.removeEventListener('mousedown', this.onPointerDown, true)\r\n      dom.removeEventListener('mouseout', this.onPointerOut, true)\r\n      dom.removeEventListener('mouseover', this.onPointerOver, true)\r\n      window.removeEventListener('mouseup', this.onPointerUp, true)\r\n    }\r\n\r\n    if (this.supportsTouchEvents) {\r\n      dom.removeEventListener('touchstart', this.onPointerDown, true)\r\n      dom.removeEventListener('touchcancel', this.onPointerCancel, true)\r\n      dom.removeEventListener('touchend', this.onPointerUp, true)\r\n      dom.removeEventListener('touchmove', this.onPointerMove, true)\r\n    }\r\n\r\n    this.interactionDOMElement = null\r\n\r\n    this.eventsAdded = false\r\n  }\r\n\r\n  /**\r\n   * Maps x and y coords from a DOM object and maps them correctly to the PixiJS view. The\r\n   * resulting value is stored in the point. This takes into account the fact that the DOM\r\n   * element could be scaled and positioned anywhere on the screen.\r\n   *\r\n   * @param  {number} x - the x coord of the position to map\r\n   * @param  {number} y - the y coord of the position to map\r\n   */\r\n  public mapPositionToPoint(x: number, y: number): Point {\r\n    const point = new Point(0)\r\n    let rect\r\n\r\n    // IE 11 fix\r\n    if (!this.interactionDOMElement.parentElement) {\r\n      rect = { x: 0, y: 0, width: 0, height: 0 }\r\n    } else {\r\n      rect = this.interactionDOMElement.getBoundingClientRect()\r\n    }\r\n\r\n    const resolutionMultiplier = 1.0 / this.resolution\r\n\r\n    point.x =\r\n      (x - rect.left) *\r\n      ((this.interactionDOMElement as any).width / rect.width) *\r\n      resolutionMultiplier\r\n    point.y =\r\n      (y - rect.top) *\r\n      ((this.interactionDOMElement as any).height / rect.height) *\r\n      resolutionMultiplier\r\n\r\n    return point\r\n  }\r\n\r\n  /**\r\n   * Process mouse event.\r\n   * @param event \r\n   * @param isDown\r\n   */\r\n  public processInteractive(event: PointerEvent, isDown?: boolean): void {\r\n    const interactionData = this.getInteractionData(event)\r\n\r\n    if (typeof isDown === 'boolean') {\r\n      interactionData.isDown = isDown\r\n    } else {\r\n      interactionData.isDown = this.mouse.isDown\r\n    }\r\n\r\n    this.configureInteractionDataForDOMEvent(event, interactionData)\r\n\r\n    this.mouse = interactionData\r\n  }\r\n\r\n  /**\r\n   * Is called when the pointer button is pressed down on the renderer element\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} originalEvent - The DOM event of a pointer button being pressed down\r\n   */\r\n  private onPointerDown(originalEvent: InteractivePointerEvent): void {\r\n    // if we support touch events, then only use those for touch events, not pointer events\r\n    if (\r\n      this.supportsTouchEvents &&\r\n      (originalEvent as PointerEvent).pointerType === 'touch'\r\n    ) {\r\n      return\r\n    }\r\n\r\n    const events = this.normalizeToPointerData(originalEvent)\r\n\r\n    /*\r\n     * No need to prevent default on natural pointer events, as there are no side effects\r\n     * Normalized events, however, may have the double mousedown/touchstart issue on the native android browser,\r\n     * so still need to be prevented.\r\n     */\r\n\r\n    // Guaranteed that there will be at least one event in events, and all events must have the same pointer type\r\n\r\n    const event = events[0]\r\n\r\n    // if ((event as any).isNormalized) {\r\n    //   const cancelable =\r\n    //     originalEvent.cancelable || !('cancelable' in originalEvent)\r\n\r\n    //   if (cancelable) {\r\n    //     originalEvent.preventDefault()\r\n    //   }\r\n    // }\r\n\r\n    this.processInteractive(event, true)\r\n  }\r\n\r\n  /**\r\n   * Is called when the pointer button is released on the renderer element\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} originalEvent - The DOM event of a pointer button being released\r\n   */\r\n  private onPointerComplete(originalEvent: InteractivePointerEvent): void {\r\n    const events = this.normalizeToPointerData(originalEvent)\r\n\r\n    const event = events[0]\r\n\r\n    this.processInteractive(event, false)\r\n  }\r\n\r\n  /**\r\n   * Is called when the pointer button is cancelled\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} event - The DOM event of a pointer button being released\r\n   */\r\n  private onPointerCancel(event: InteractivePointerEvent): void {\r\n    // if we support touch events, then only use those for touch events, not pointer events\r\n    if (\r\n      this.supportsTouchEvents &&\r\n      (event as PointerEvent).pointerType === 'touch'\r\n    ) {\r\n      return\r\n    }\r\n\r\n    this.onPointerComplete(event)\r\n  }\r\n\r\n  /**\r\n   * Is called when the pointer button is released on the renderer element\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} event - The DOM event of a pointer button being released\r\n   */\r\n  private onPointerUp(event: InteractivePointerEvent): void {\r\n    // if we support touch events, then only use those for touch events, not pointer events\r\n    if (\r\n      this.supportsTouchEvents &&\r\n      (event as PointerEvent).pointerType === 'touch'\r\n    ) {\r\n      return\r\n    }\r\n\r\n    this.onPointerComplete(event)\r\n  }\r\n\r\n  /**\r\n   * Is called when the pointer moves across the renderer element\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} originalEvent - The DOM event of a pointer moving\r\n   */\r\n  private onPointerMove(originalEvent: InteractivePointerEvent): void {\r\n    // if we support touch events, then only use those for touch events, not pointer events\r\n    if (\r\n      this.supportsTouchEvents &&\r\n      (originalEvent as PointerEvent).pointerType === 'touch'\r\n    ) {\r\n      return\r\n    }\r\n\r\n    const events = this.normalizeToPointerData(originalEvent)\r\n\r\n    const event = events[0]\r\n\r\n    this.processInteractive(event)\r\n  }\r\n\r\n  /**\r\n   * Is called when the pointer is moved out of the renderer element\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} originalEvent - The DOM event of a pointer being moved out\r\n   */\r\n  private onPointerOut(originalEvent: InteractivePointerEvent): void {\r\n    // if we support touch events, then only use those for touch events, not pointer events\r\n    if (\r\n      this.supportsTouchEvents &&\r\n      (originalEvent as PointerEvent).pointerType === 'touch'\r\n    ) {\r\n      return\r\n    }\r\n\r\n    const events = this.normalizeToPointerData(originalEvent)\r\n\r\n    // Only mouse and pointer can call onPointerOut, so events will always be length 1\r\n    const event = events[0]\r\n\r\n    this.processInteractive(event)\r\n  }\r\n\r\n  /**\r\n   * Is called when the pointer is moved into the renderer element\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} originalEvent - The DOM event of a pointer button being moved into the renderer view\r\n   */\r\n  private onPointerOver(originalEvent: InteractivePointerEvent): void {\r\n    const events = this.normalizeToPointerData(originalEvent)\r\n\r\n    // Only mouse and pointer can call onPointerOver, so events will always be length 1\r\n    const event = events[0]\r\n\r\n    this.processInteractive(event)\r\n  }\r\n\r\n  /**\r\n   * Get InteractionData.\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} event - Normalized pointer event, output from normalizeToPointerData\r\n   * @return {InteractionData} - Interaction data for the given pointer identifier\r\n   */\r\n  private getInteractionData(event: PointerEvent): InteractionData {\r\n    const pointerId = event.pointerId\r\n\r\n    const interactionData = new InteractionData()\r\n    interactionData.identifier = pointerId\r\n\r\n    // copy properties from the event, so that we can make sure that touch/pointer specific\r\n    // data is available\r\n    interactionData.copyEvent(event)\r\n\r\n    return interactionData\r\n  }\r\n\r\n  /**\r\n   * Configure DOM PointerEvent and InteractionData\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} pointerEvent - The DOM event that will be paired with the InteractionEvent\r\n   * @param {PIXI.InteractionData} interactionData - The InteractionData that will be paired\r\n   *        with the InteractionEvent\r\n   */\r\n  private configureInteractionDataForDOMEvent(\r\n    pointerEvent: PointerEvent,\r\n    interactionData: InteractionData\r\n  ): void {\r\n    interactionData.global = this.mapPositionToPoint(\r\n      pointerEvent.clientX,\r\n      pointerEvent.clientY\r\n    )\r\n\r\n    // Not really sure why this is happening, but it's how a previous version handled things\r\n    if (pointerEvent.pointerType === 'touch') {\r\n      ;(pointerEvent as any).globalX = interactionData.global.x\r\n      ;(pointerEvent as any).globalY = interactionData.global.y\r\n    }\r\n\r\n    interactionData.originalEvent = pointerEvent\r\n  }\r\n\r\n  /**\r\n   * Ensures that the original event object contains all data that a regular pointer event would have\r\n   *\r\n   * @private\r\n   * @param {TouchEvent|MouseEvent|PointerEvent} event - The original event data from a touch or mouse event\r\n   * @return {PointerEvent[]} An array containing a single normalized pointer event, in the case of a pointer\r\n   *  or mouse event, or a multiple normalized pointer events if there are multiple changed touches\r\n   */\r\n  private normalizeToPointerData(\r\n    event: InteractivePointerEvent\r\n  ): PointerEvent[] {\r\n    const normalizedEvents = []\r\n\r\n    if (this.supportsTouchEvents && event instanceof TouchEvent) {\r\n      for (let i = 0, li = event.changedTouches.length; i < li; i++) {\r\n        const touch = event.changedTouches[i] as TouchPointerEvent\r\n\r\n        if (typeof touch.button === 'undefined')\r\n          touch.button = event.touches.length ? 1 : 0\r\n        if (typeof touch.buttons === 'undefined')\r\n          touch.buttons = event.touches.length ? 1 : 0\r\n        if (typeof touch.isPrimary === 'undefined') {\r\n          touch.isPrimary =\r\n            event.touches.length === 1 && event.type === 'touchstart'\r\n        }\r\n        if (typeof touch.width === 'undefined') touch.width = touch.radiusX || 1\r\n        if (typeof touch.height === 'undefined')\r\n          touch.height = touch.radiusY || 1\r\n        if (typeof touch.tiltX === 'undefined') touch.tiltX = 0\r\n        if (typeof touch.tiltY === 'undefined') touch.tiltY = 0\r\n        if (typeof touch.pointerType === 'undefined')\r\n          touch.pointerType = 'touch'\r\n        if (typeof touch.pointerId === 'undefined')\r\n          touch.pointerId = touch.identifier || 0\r\n        if (typeof touch.pressure === 'undefined')\r\n          touch.pressure = touch.force || 0.5\r\n        if (typeof touch.twist === 'undefined') touch.twist = 0\r\n        if (typeof touch.tangentialPressure === 'undefined')\r\n          touch.tangentialPressure = 0\r\n        // TODO: Remove these, as layerX/Y is not a standard, is deprecated, has uneven\r\n        // support, and the fill ins are not quite the same\r\n        // offsetX/Y might be okay, but is not the same as clientX/Y when the canvas's top\r\n        // left is not 0,0 on the page\r\n        if (typeof touch.layerX === 'undefined')\r\n          touch.layerX = touch.offsetX = touch.clientX\r\n        if (typeof touch.layerY === 'undefined')\r\n          touch.layerY = touch.offsetY = touch.clientY\r\n\r\n        // mark the touch as normalized, just so that we know we did it\r\n        touch.isNormalized = true\r\n\r\n        normalizedEvents.push(touch)\r\n      }\r\n    }\r\n    // apparently PointerEvent subclasses MouseEvent, so yay\r\n    else if (\r\n      event instanceof MouseEvent &&\r\n      (!this.supportsPointerEvents || !(event instanceof window.PointerEvent))\r\n    ) {\r\n      const tempEvent = event as MousePointerEvent\r\n\r\n      if (typeof tempEvent.isPrimary === 'undefined') tempEvent.isPrimary = true\r\n      if (typeof tempEvent.width === 'undefined') tempEvent.width = 1\r\n      if (typeof tempEvent.height === 'undefined') tempEvent.height = 1\r\n      if (typeof tempEvent.tiltX === 'undefined') tempEvent.tiltX = 0\r\n      if (typeof tempEvent.tiltY === 'undefined') tempEvent.tiltY = 0\r\n      if (typeof tempEvent.pointerType === 'undefined')\r\n        tempEvent.pointerType = 'mouse'\r\n      if (typeof tempEvent.pointerId === 'undefined')\r\n        tempEvent.pointerId = MOUSE_POINTER_ID\r\n      if (typeof tempEvent.pressure === 'undefined') tempEvent.pressure = 0.5\r\n      if (typeof tempEvent.twist === 'undefined') tempEvent.twist = 0\r\n      if (typeof tempEvent.tangentialPressure === 'undefined')\r\n        tempEvent.tangentialPressure = 0\r\n\r\n      // mark the mouse event as normalized, just so that we know we did it\r\n      tempEvent.isNormalized = true\r\n\r\n      normalizedEvents.push(tempEvent)\r\n    } else {\r\n      normalizedEvents.push(event)\r\n    }\r\n\r\n    return normalizedEvents as PointerEvent[]\r\n  }\r\n\r\n  /**\r\n   * Destroys the interaction manager\r\n   *\r\n   */\r\n  public destroy(): void {\r\n    this.removeEvents()\r\n\r\n    this.renderer = null\r\n\r\n    this.mouse = null\r\n\r\n    this.interactionDOMElement = null\r\n\r\n    this.onPointerDown = null\r\n\r\n    this.onPointerUp = null\r\n\r\n    this.onPointerCancel = null\r\n\r\n    this.onPointerMove = null\r\n\r\n    this.onPointerOut = null\r\n\r\n    this.onPointerOver = null\r\n  }\r\n}\r\n\r\ninterface MousePointerEvent extends PointerEvent {\r\n  isPrimary: boolean\r\n  width: number\r\n  height: number\r\n  tiltX: number\r\n  tiltY: number\r\n  pointerType: string\r\n  pointerId: number\r\n  pressure: number\r\n  twist: number\r\n  tangentialPressure: number\r\n  isNormalized: boolean\r\n}\r\n\r\ninterface TouchPointerEvent extends Touch {\r\n  button: number\r\n  buttons: number\r\n  isPrimary: boolean\r\n  width: number\r\n  height: number\r\n  tiltX: number\r\n  tiltY: number\r\n  pointerType: string\r\n  pointerId: number\r\n  pressure: number\r\n  twist: number\r\n  tangentialPressure: number\r\n  layerX: number\r\n  layerY: number\r\n  offsetX: number\r\n  offsetY: number\r\n  isNormalized: boolean\r\n}\r\n","import { Sprite, Texture } from 'pixi.js'\r\n\r\nclass Flower extends Sprite {\r\n  constructor(texture, clientWidth, clientHeight, maxDist) {\r\n    super(texture)\r\n    this.x = Math.random() * (clientWidth + maxDist) - maxDist / 2\r\n    this.y = Math.random() * (clientHeight + maxDist) - maxDist / 2\r\n    this.z = Math.random() * 0.5 + 0.3\r\n    this.vx = (Math.random() * 1 + 1) * this.z\r\n    this.vy = (Math.random() * 0.5 + 1) * this.z\r\n    this.rotation = Math.random() * Math.PI * 2\r\n    this.anchor.set(0.5)\r\n    this.spin = this.rotation > Math.PI ? 1 : -1\r\n  }\r\n}\r\n\r\nexport default class FlowerFlyBackground {\r\n  constructor({ width, height, amount, maxDist, parent, textureId }) {\r\n    this.width = width\r\n    this.height = height\r\n    this.amount = amount\r\n    this.maxDist = maxDist\r\n    this.parent = parent\r\n    this.textureId = textureId\r\n    this.flowerArr = []\r\n\r\n    this.init()\r\n  }\r\n\r\n  init() {\r\n    const { width, height, amount, maxDist, parent } = this\r\n\r\n    for (let i = 0; i < amount; i++) {\r\n      const texture = Texture.from(`title_gold-${this.textureId}`)\r\n      const flower = new Flower(texture, width, height, maxDist)\r\n      this.flowerArr.push(flower)\r\n      parent.addChild(flower)\r\n    }\r\n  }\r\n\r\n  update(obj) {\r\n    const { width, height, maxDist } = this\r\n    obj.rotation += (0.003 * obj.spin)\r\n    obj.x += obj.vx\r\n    obj.y += obj.vy\r\n    if (obj.x > width + maxDist / 2) {\r\n      obj.x = -(maxDist / 2)\r\n    } else if (obj.xpos < -(maxDist / 2)) {\r\n      obj.x = width + maxDist / 2\r\n    }\r\n    if (obj.y > height + maxDist / 2) {\r\n      obj.y = -(maxDist / 2)\r\n    } else if (obj.y < -(maxDist / 2)) {\r\n      obj.y = height + maxDist / 2\r\n    }\r\n  }\r\n\r\n  tick() {\r\n    const { flowerArr } = this\r\n\r\n    flowerArr.forEach(obj => {\r\n      this.update(obj)\r\n    })\r\n  }\r\n}\r\n","import * as PIXI from 'pixi.js'\r\nimport { Signal } from 'signals'\r\nimport FlowerFlyBackground from './flower'\r\nimport { gameInfo, startMenuStyle } from '../../config'\r\nimport { Sound } from '../../../engine/sound'\r\n\r\nconst fontStyle = startMenuStyle\r\n\r\nconst btnDownStyle = {\r\n  fill: '#ffffff',\r\n  stroke: '#F9B541'\r\n}\r\n\r\nexport class Title {\r\n  static onStartClicked = new Signal()\r\n  static onLoadClicked = new Signal()\r\n  static onSettingClicked = new Signal()\r\n  static onAboutClicked = new Signal()\r\n\r\n  constructor() {\r\n    this.view = new PIXI.Container()\r\n    this.init()\r\n  }\r\n\r\n  init() {\r\n    this._bgmPlay()\r\n    this._addBackground()\r\n    this._addPtcLayer()\r\n    this._addMenu()\r\n  }\r\n\r\n  _addBackground() {\r\n    const background = PIXI.Sprite.from('title_background')\r\n    this.view.addChild(background)\r\n  }\r\n\r\n  _addPtcLayer() {\r\n    this.ptcLayer = new PIXI.Container()\r\n    this.view.addChild(this.ptcLayer)\r\n    this.flowerFly = []\r\n    for (let i = 0; i < 5; i++) {\r\n      let amount = 5\r\n      if (i === 2) {\r\n        amount = 2\r\n      }\r\n      this.flowerFly.push(new FlowerFlyBackground({\r\n        width: gameInfo.width,\r\n        height: gameInfo.height,\r\n        amount,\r\n        maxDist: 100,\r\n        parent: this.ptcLayer,\r\n        textureId: i\r\n      }))\r\n    }\r\n  }\r\n\r\n  _addMenu() {\r\n    const group = new PIXI.Container()\r\n    group.x = 365\r\n    group.y = 380\r\n    const start = this._createButton(0, '开始游戏', () => {\r\n      this._bgmStop()\r\n      Title.onStartClicked.dispatch()\r\n    })\r\n    const load = this._createButton(1, '继续游戏', () => {\r\n      this._bgmStop()\r\n      Title.onLoadClicked.dispatch()\r\n    })\r\n    const setup = this._createButton(2, '系统设置', () => {\r\n      Title.onSettingClicked.dispatch()\r\n    })\r\n    const about = this._createButton(3, '关于游戏', () => {\r\n      Title.onAboutClicked.dispatch()\r\n    })\r\n    group.addChild(start, load, setup, about)\r\n    this.view.addChild(group)\r\n  }\r\n\r\n  _bgmPlay() {\r\n    Sound.play('system_title', {\r\n      loop: true\r\n    })\r\n  }\r\n\r\n  _bgmStop() {\r\n    Sound.stop('system_title')\r\n  }\r\n\r\n  _createButton(index, text, clickHandle) {\r\n    const btnSpace = 30\r\n    const btn = new PIXI.Text(text, fontStyle)\r\n    btn.y = btnSpace * index\r\n    btn.interactive = true\r\n    btn.buttonMode = true\r\n    // 解决文字模糊问题\r\n    btn.resolution = 2\r\n    btn.anchor.set(0.5)\r\n    btn\r\n      .on('pointerdown', onButtonDown)\r\n      .on('pointerup', onButtonUp)\r\n      .on('pointerupoutside', onButtonUp)\r\n      .on('pointerover', onButtonOver)\r\n      .on('pointerout', onButtonOut)\r\n      .on('pointertap', (e) => {\r\n        e.data.originalEvent.preventDefault()\r\n        clickHandle()\r\n      })\r\n    return btn\r\n  }\r\n\r\n  update() {\r\n    this.flowerFly.forEach(item => {\r\n      item.tick()\r\n    })\r\n  }\r\n}\r\n\r\nfunction onButtonDown() {\r\n  const btn = this\r\n  // console.log('pointerdown')\r\n  btn.isdown = true\r\n  btn.scale.set(0.95)\r\n}\r\n\r\nfunction onButtonUp() {\r\n  const btn = this\r\n  if (btn.isOver) {\r\n    btn.style.fill = btnDownStyle.fill\r\n    btn.style.stroke = btnDownStyle.stroke\r\n  } else {\r\n    btn.style.fill = fontStyle.fill\r\n    btn.style.stroke = fontStyle.stroke\r\n  }\r\n  if (!btn.isdown) {\r\n    return\r\n  }\r\n  // console.log('pointerup')\r\n  btn.isdown = false\r\n  btn.scale.set(1)\r\n}\r\n\r\nfunction onButtonOver() {\r\n  const btn = this\r\n  btn.isOver = true\r\n  // console.log('pointerover')\r\n  if (btn.isdown) {\r\n    return\r\n  }\r\n  btn.style.fill = btnDownStyle.fill\r\n  btn.style.stroke = btnDownStyle.stroke\r\n}\r\n\r\nfunction onButtonOut() {\r\n  const btn = this\r\n  btn.isOver = false\r\n  if (btn.isdown) {\r\n    return\r\n  }\r\n  // console.log('pointerout')\r\n  btn.style.fill = fontStyle.fill\r\n  btn.style.stroke = fontStyle.stroke\r\n}\r\n","import * as PIXI from 'pixi.js'\r\nimport { IComponent } from '../../core'\r\n\r\ntype Anchor = {\r\n  x: number\r\n  y: number\r\n}\r\n\r\nexport default class RenderComponent extends IComponent {\r\n  // serialize fields\r\n  public layer: string\r\n  /** 锚点（百分比） */\r\n  public anchor: Anchor\r\n  public visible: boolean\r\n  // temp fields\r\n  public view: PIXI.Container\r\n  public isRender: boolean\r\n\r\n  constructor() {\r\n    super()\r\n    this.layer = 'UserLayer0'\r\n    this.anchor = {\r\n      x: 0,\r\n      y: 0\r\n    }\r\n    this.visible = true\r\n\r\n    this.view = null\r\n    this.isRender = false\r\n  }\r\n\r\n  public revert() {\r\n    this.layer = 'UserLayer0'\r\n    this.anchor = {\r\n      x: 0,\r\n      y: 0\r\n    }\r\n    this.visible = true\r\n\r\n    if (this.view) {\r\n      this.view.destroy()\r\n      this.view = null\r\n    }\r\n    this.isRender = false\r\n  }\r\n\r\n  public getRenderJSON() {\r\n    const { layer, anchor, visible } = this\r\n    return { layer, anchor, visible }\r\n  }\r\n}\r\n","import { Sprite, Texture } from 'pixi.js'\r\nimport RenderComponent from './base/render'\r\nimport { componentRegister } from '../core'\r\n\r\nexport class SpriteComponent extends RenderComponent {\r\n  // serialize fields\r\n  public textureId: string\r\n  // temp fields\r\n  public texture: Texture\r\n\r\n  constructor() {\r\n    super()\r\n    this.textureId = null\r\n    this.texture = null\r\n  }\r\n\r\n  public init() {\r\n    if (this.textureId) {\r\n      this.texture = Texture.from(this.textureId)\r\n    } else {\r\n      this.texture = Texture.EMPTY\r\n    }\r\n    this.view = new Sprite(this.texture)\r\n  }\r\n\r\n  public clear() {\r\n    this.revert()\r\n    this.textureId = null\r\n    this.texture = null\r\n  }\r\n\r\n  public toJSON() {\r\n    const { textureId } = this\r\n    const render = this.getRenderJSON()\r\n\r\n    return {\r\n      textureId,\r\n      ...render\r\n    }\r\n  }\r\n}\r\n\r\ncomponentRegister('SpriteComponent')(SpriteComponent)\r\n","import { AnimatedSprite, Texture } from 'pixi.js'\r\nimport RenderComponent from './base/render'\r\nimport { componentRegister } from '../core'\r\n\r\nexport class AnimationComponent extends RenderComponent {\r\n  // serialize fields\r\n  public texturesId: string[]\r\n  public loop: boolean\r\n  public animationSpeed: number\r\n  public playing: boolean\r\n  /** 动画周期 */\r\n  public cycle: number\r\n  // temp fields\r\n  public textures: Texture[]\r\n\r\n  constructor() {\r\n    super()\r\n    this.texturesId = null\r\n    this.loop = true\r\n    this.animationSpeed = 1\r\n    this.playing = true\r\n    this.cycle = 0\r\n\r\n    this.textures = null\r\n  }\r\n\r\n  public init() {\r\n    if (this.texturesId === null) {\r\n      this.textures = [Texture.EMPTY]\r\n    } else {\r\n      const count = this.texturesId.length\r\n      const fillFrames = this.getFillFrames()\r\n      this.textures = []\r\n\r\n      for (let i = 0; i < fillFrames - count; i++) {\r\n        const texture = Texture.from(this.texturesId[0])\r\n        this.textures.push(texture)\r\n      }\r\n      for (let i = 0; i < count; i++) {\r\n        const texture = Texture.from(this.texturesId[i])\r\n        this.textures.push(texture)\r\n      }\r\n    }\r\n\r\n    this.view = new AnimatedSprite(this.textures)\r\n  }\r\n\r\n  /**\r\n   * 根据动画周期计算补帧帧数\r\n   * \r\n   * @returns {number}\r\n   */\r\n  public getFillFrames(): number {\r\n    return this.cycle * this.animationSpeed / 1000 * 60\r\n  }\r\n\r\n  public clear() {\r\n    this.revert()\r\n    this.texturesId = null\r\n    this.loop = true\r\n    this.animationSpeed = 1\r\n    this.playing = true\r\n    this.cycle = 0\r\n\r\n    this.textures = null\r\n  }\r\n\r\n  public toJSON() {\r\n    const { texturesId, loop, animationSpeed, playing, cycle: interval } = this\r\n    const render = this.getRenderJSON()\r\n\r\n    return {\r\n      texturesId, loop, animationSpeed, playing, interval,\r\n      ...render\r\n    }\r\n  }\r\n}\r\n\r\ncomponentRegister('AnimationComponent')(AnimationComponent)\r\n","/* eslint max-depth: [2, 8] */\r\nimport { Sprite } from '@pixi/sprite';\r\nimport { Texture } from '@pixi/core';\r\nimport { settings } from '@pixi/settings';\r\nimport { Rectangle } from '@pixi/math';\r\nimport { sign, trimCanvas, hex2rgb, string2hex } from '@pixi/utils';\r\nimport { TextStyle, TextMetrics } from '@pixi/text';\r\n\r\nconst TEXT_GRADIENT = {\r\n    LINEAR_VERTICAL: 0,\r\n    LINEAR_HORIZONTAL: 1,\r\n};\r\n\r\nconst defaultDestroyOptions = {\r\n    texture: true,\r\n    children: false,\r\n    baseTexture: true,\r\n};\r\n\r\nfunction processBbcode(tokens, token, i, magic) {\r\n    let type = 'none';\r\n    let index = i;\r\n    let params = {};\r\n    if (token === '[') {\r\n        index += magic; // magic should be 3 or 7\r\n        let bbcode = tokens.slice(i, index + 1).join('');\r\n        if (bbcode === '[style={') {\r\n            let json = '';\r\n            let tmp;\r\n            do {\r\n                tmp = tokens[index];\r\n                json += tmp;\r\n                index++;\r\n            } while (tmp !== '}')\r\n            params = JSON.parse(json);\r\n            type = 'open';\r\n        } else if (bbcode === '[/style]') {\r\n            type = 'close';\r\n        }\r\n    }\r\n\r\n    return {\r\n        type,\r\n        index,\r\n        params\r\n    };\r\n}\r\n\r\nTextMetrics.tokenize = function (text) {\r\n    const tokens = [];\r\n    let token = '';\r\n    if (typeof text !== 'string') {\r\n        return tokens;\r\n    }\r\n\r\n    for (let i = 0; i < text.length; i++) {\r\n        const char = text[i];\r\n        if (!/[a-z'-]/i.test(char)) {\r\n            if (token !== '') {\r\n                tokens.push(token);\r\n                token = '';\r\n            }\r\n            tokens.push(char);\r\n        } else {\r\n            token += char;\r\n        }\r\n    }\r\n\r\n    if (token !== '') {\r\n        tokens.push(token);\r\n    }\r\n\r\n    return tokens;\r\n}\r\n\r\nTextMetrics.wordWrap = function(text, style, canvas = TextMetrics._canvas) {\r\n    const context = canvas.getContext('2d');\r\n    let width = 0;\r\n    let line = '';\r\n    let lines = '';\r\n    const cache = {};\r\n    const { letterSpacing, whiteSpace } = style;\r\n    // How to handle whitespaces\r\n    const collapseSpaces = TextMetrics.collapseSpaces(whiteSpace);\r\n    const collapseNewlines = TextMetrics.collapseNewlines(whiteSpace);\r\n    // whether or not spaces may be added to the beginning of lines\r\n    let canPrependSpaces = !collapseSpaces;\r\n    // There is letterSpacing after every char except the last one\r\n    // t_h_i_s_' '_i_s_' '_a_n_' '_e_x_a_m_p_l_e_' '_!\r\n    // so for convenience the above needs to be compared to width + 1 extra letterSpace\r\n    // t_h_i_s_' '_i_s_' '_a_n_' '_e_x_a_m_p_l_e_' '_!_\r\n    // ________________________________________________\r\n    // And then the final space is simply no appended to each line\r\n    const wordWrapWidth = style.wordWrapWidth + letterSpacing;\r\n    // break text into words, spaces and newline chars\r\n    const tokens = TextMetrics.tokenize(text);\r\n    for (let i = 0; i < tokens.length; i++) {\r\n        // get the word, space or newlineChar\r\n        let token = tokens[i];\r\n        // parse bbcode and adjust index\r\n        const result = processBbcode(tokens, token, i, 3);\r\n        if (result.type !== 'none') {\r\n            i = result.index + 1;\r\n            if (i >= tokens.length) {\r\n                continue;\r\n            }\r\n            token = tokens[i];\r\n        }\r\n        // if word is a new line\r\n        if (TextMetrics.isNewline(token)) {\r\n            // keep the new line\r\n            if (!collapseNewlines) {\r\n                lines += TextMetrics.addLine(line);\r\n                canPrependSpaces = !collapseSpaces;\r\n                line = '';\r\n                width = 0;\r\n                continue;\r\n            }\r\n            // if we should collapse new lines\r\n            // we simply convert it into a space\r\n            token = ' ';\r\n        }\r\n        // if we should collapse repeated whitespaces\r\n        if (collapseSpaces) {\r\n            // check both this and the last tokens for spaces\r\n            const currIsBreakingSpace = TextMetrics.isBreakingSpace(token);\r\n            const lastIsBreakingSpace = TextMetrics.isBreakingSpace(line[line.length - 1]);\r\n            if (currIsBreakingSpace && lastIsBreakingSpace) {\r\n                continue;\r\n            }\r\n        }\r\n        // get word width from cache if possible\r\n        const tokenWidth = TextMetrics.getFromCache(token, letterSpacing, cache, context);\r\n        // word is longer than desired bounds\r\n        if (tokenWidth > wordWrapWidth) {\r\n            // if we are not already at the beginning of a line\r\n            if (line !== '') {\r\n                // start newlines for overflow words\r\n                lines += TextMetrics.addLine(line);\r\n                line = '';\r\n                width = 0;\r\n            }\r\n            // break large word over multiple lines\r\n            if (TextMetrics.canBreakWords(token, style.breakWords)) {\r\n                // break word into characters\r\n                const characters = TextMetrics.wordWrapSplit(token);\r\n                // loop the characters\r\n                for (let j = 0; j < characters.length; j++) {\r\n                    let char = characters[j];\r\n                    let k = 1;\r\n                    // we are not at the end of the token\r\n                    while (characters[j + k]) {\r\n                        const nextChar = characters[j + k];\r\n                        const lastChar = char[char.length - 1];\r\n                        // should not split chars\r\n                        if (!TextMetrics.canBreakChars(lastChar, nextChar, token, j, style.breakWords)) {\r\n                            // combine chars & move forward one\r\n                            char += nextChar;\r\n                        }\r\n                        else {\r\n                            break;\r\n                        }\r\n                        k++;\r\n                    }\r\n                    j += char.length - 1;\r\n                    const characterWidth = TextMetrics.getFromCache(char, letterSpacing, cache, context);\r\n                    if (characterWidth + width > wordWrapWidth) {\r\n                        lines += TextMetrics.addLine(line);\r\n                        canPrependSpaces = false;\r\n                        line = '';\r\n                        width = 0;\r\n                    }\r\n                    line += char;\r\n                    width += characterWidth;\r\n                }\r\n            }\r\n            // run word out of the bounds\r\n            else {\r\n                // if there are words in this line already\r\n                // finish that line and start a new one\r\n                if (line.length > 0) {\r\n                    lines += TextMetrics.addLine(line);\r\n                    line = '';\r\n                    width = 0;\r\n                }\r\n                const isLastToken = i === tokens.length - 1;\r\n                // give it its own line if it's not the end\r\n                lines += TextMetrics.addLine(token, !isLastToken);\r\n                canPrependSpaces = false;\r\n                line = '';\r\n                width = 0;\r\n            }\r\n        }\r\n        // word could fit\r\n        else {\r\n            // word won't fit because of existing words\r\n            // start a new line\r\n            if (tokenWidth + width > wordWrapWidth) {\r\n                // if its a space we don't want it\r\n                canPrependSpaces = false;\r\n                // add a new line\r\n                lines += TextMetrics.addLine(line);\r\n                // start a new line\r\n                line = '';\r\n                width = 0;\r\n            }\r\n            // don't add spaces to the beginning of lines\r\n            if (line.length > 0 || !TextMetrics.isBreakingSpace(token) || canPrependSpaces) {\r\n                // add the word to the current line\r\n                line += token;\r\n                // update width counter\r\n                width += tokenWidth;\r\n            }\r\n        }\r\n    }\r\n    lines += TextMetrics.addLine(line, false);\r\n    return lines;\r\n}\r\n\r\nexport class RainbowText extends Sprite {\r\n    /**\r\n     * @param {string} text - The string that you would like the text to display\r\n     * @param {object|PIXI.TextStyle} [style] - The style parameters\r\n     * @param {HTMLCanvasElement} [canvas] - The canvas element for drawing text\r\n     */\r\n    constructor(text, style, canvas) {\r\n        let ownCanvas = false;\r\n        if (!canvas) {\r\n            canvas = document.createElement('canvas');\r\n            ownCanvas = true;\r\n        }\r\n        canvas.width = 3;\r\n        canvas.height = 3;\r\n        const texture = Texture.from(canvas);\r\n        texture.orig = new Rectangle();\r\n        texture.trim = new Rectangle();\r\n        super(texture);\r\n        /**\r\n         * Keep track if this Text object created it's own canvas\r\n         * element (`true`) or uses the constructor argument (`false`).\r\n         * Used to workaround a GC issues with Safari < 13 when\r\n         * destroying Text. See `destroy` for more info.\r\n         *\r\n         * @member {boolean}\r\n         * @private\r\n         */\r\n        this._ownCanvas = ownCanvas;\r\n        /**\r\n         * The canvas element that everything is drawn to\r\n         *\r\n         * @member {HTMLCanvasElement}\r\n         */\r\n        this.canvas = canvas;\r\n        /**\r\n         * The canvas 2d context that everything is drawn with\r\n         * @member {CanvasRenderingContext2D}\r\n         */\r\n        this.context = this.canvas.getContext('2d');\r\n        /**\r\n         * The resolution / device pixel ratio of the canvas.\r\n         * This is set to automatically match the renderer resolution by default, but can be overridden by setting manually.\r\n         * @member {number}\r\n         * @default 1\r\n         */\r\n        this._resolution = settings.RESOLUTION;\r\n        this._autoResolution = true;\r\n        /**\r\n         * Private tracker for the current text.\r\n         *\r\n         * @member {string}\r\n         * @private\r\n         */\r\n        this._text = null;\r\n        /**\r\n         * Private tracker for the current style.\r\n         *\r\n         * @member {object}\r\n         * @private\r\n         */\r\n        this._style = null;\r\n        /**\r\n         * Private listener to track style changes.\r\n         *\r\n         * @member {Function}\r\n         * @private\r\n         */\r\n        this._styleListener = null;\r\n        /**\r\n         * Private tracker for the current font.\r\n         *\r\n         * @member {string}\r\n         * @private\r\n         */\r\n        this._font = '';\r\n        this.text = text;\r\n        this.style = style;\r\n        this.localStyleID = -1;\r\n        this.bbcodeFillIndex = 0;\r\n        this.bbcodeStrokeIndex = 0;\r\n    }\r\n    /**\r\n     * Renders text to its canvas, and updates its texture.\r\n     * By default this is used internally to ensure the texture is correct before rendering,\r\n     * but it can be used called externally, for example from this class to 'pre-generate' the texture from a piece of text,\r\n     * and then shared across multiple Sprites.\r\n     *\r\n     * @param {boolean} respectDirty - Whether to abort updating the text if the Text isn't dirty and the function is called.\r\n     */\r\n    updateText(respectDirty) {\r\n        const style = this._style;\r\n        // check if style has changed..\r\n        if (this.localStyleID !== style.styleID) {\r\n            this.dirty = true;\r\n            this.localStyleID = style.styleID;\r\n        }\r\n        if (!this.dirty && respectDirty) {\r\n            return;\r\n        }\r\n        this._font = this._style.toFontString();\r\n        const context = this.context;\r\n        const measured = TextMetrics.measureText(this._text || ' ', this._style, this._style.wordWrap, this.canvas);\r\n        const width = measured.width;\r\n        const height = measured.height;\r\n        const lines = measured.lines;\r\n        const lineHeight = measured.lineHeight;\r\n        const lineWidths = measured.lineWidths;\r\n        const maxLineWidth = measured.maxLineWidth;\r\n        const fontProperties = measured.fontProperties;\r\n        this.canvas.width = Math.ceil((Math.max(1, width) + (style.padding * 2)) * this._resolution);\r\n        this.canvas.height = Math.ceil((Math.max(1, height) + (style.padding * 2)) * this._resolution);\r\n        context.scale(this._resolution, this._resolution);\r\n        context.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        context.font = this._font;\r\n        context.lineWidth = style.strokeThickness;\r\n        context.textBaseline = style.textBaseline;\r\n        context.lineJoin = style.lineJoin;\r\n        context.miterLimit = style.miterLimit;\r\n        let linePositionX;\r\n        let linePositionY;\r\n        // require 2 passes if a shadow; the first to draw the drop shadow, the second to draw the text\r\n        const passesCount = style.dropShadow ? 2 : 1;\r\n        // For v4, we drew text at the colours of the drop shadow underneath the normal text. This gave the correct zIndex,\r\n        // but features such as alpha and shadowblur did not look right at all, since we were using actual text as a shadow.\r\n        //\r\n        // For v5.0.0, we moved over to just use the canvas API for drop shadows, which made them look much nicer and more\r\n        // visually please, but now because the stroke is drawn and then the fill, drop shadows would appear on both the fill\r\n        // and the stroke; and fill drop shadows would appear over the top of the stroke.\r\n        //\r\n        // For v5.1.1, the new route is to revert to v4 style of drawing text first to get the drop shadows underneath normal\r\n        // text, but instead drawing text in the correct location, we'll draw it off screen (-paddingY), and then adjust the\r\n        // drop shadow so only that appears on screen (+paddingY). Now we'll have the correct draw order of the shadow\r\n        // beneath the text, whilst also having the proper text shadow styling.\r\n        for (let i = 0; i < passesCount; ++i) {\r\n            const isShadowPass = style.dropShadow && i === 0;\r\n            const dsOffsetText = isShadowPass ? height * 2 : 0; // we only want the drop shadow, so put text way off-screen\r\n            const dsOffsetShadow = dsOffsetText * this.resolution;\r\n            if (isShadowPass) {\r\n                // On Safari, text with gradient and drop shadows together do not position correctly\r\n                // if the scale of the canvas is not 1: https://bugs.webkit.org/show_bug.cgi?id=197689\r\n                // Therefore we'll set the styles to be a plain black whilst generating this drop shadow\r\n                context.fillStyle = 'black';\r\n                context.strokeStyle = 'black';\r\n                const dropShadowColor = style.dropShadowColor;\r\n                const rgb = hex2rgb(typeof dropShadowColor === 'number' ? dropShadowColor : string2hex(dropShadowColor));\r\n                context.shadowColor = `rgba(${rgb[0] * 255},${rgb[1] * 255},${rgb[2] * 255},${style.dropShadowAlpha})`;\r\n                context.shadowBlur = style.dropShadowBlur;\r\n                context.shadowOffsetX = Math.cos(style.dropShadowAngle) * style.dropShadowDistance;\r\n                context.shadowOffsetY = (Math.sin(style.dropShadowAngle) * style.dropShadowDistance) + dsOffsetShadow;\r\n            }\r\n            else {\r\n                // set canvas text styles\r\n                context.fillStyle = this._generateFillStyle(style, lines, measured);\r\n                // TODO: Can't have different types for getter and setter. The getter shouldn't have the number type as\r\n                //       the setter converts to string. See this thread for more details:\r\n                //       https://github.com/microsoft/TypeScript/issues/2521\r\n                context.strokeStyle = style.stroke;\r\n                context.shadowColor = '0';\r\n                context.shadowBlur = 0;\r\n                context.shadowOffsetX = 0;\r\n                context.shadowOffsetY = 0;\r\n            }\r\n            // draw lines line by line\r\n            const text = this._text.replace(/(?:\\r\\n|\\r|\\n)/g, '');\r\n            const originText = Array.from ? Array.from(text) : text.split('');\r\n            for (let i = 0; i < lines.length; i++) {\r\n                linePositionX = style.strokeThickness / 2;\r\n                linePositionY = ((style.strokeThickness / 2) + (i * lineHeight)) + fontProperties.ascent;\r\n                if (style.align === 'right') {\r\n                    linePositionX += maxLineWidth - lineWidths[i];\r\n                }\r\n                else if (style.align === 'center') {\r\n                    linePositionX += (maxLineWidth - lineWidths[i]) / 2;\r\n                }\r\n\r\n                if (style.stroke && style.strokeThickness) {\r\n                    this.drawLetterSpacing(originText, lines[i], linePositionX + style.padding, linePositionY + style.padding - dsOffsetText, true);\r\n                }\r\n                if (style.fill) {\r\n                    this.drawLetterSpacing(originText, lines[i], linePositionX + style.padding, linePositionY + style.padding - dsOffsetText);\r\n                }\r\n            }\r\n            this.bbcodeFillIndex = 0\r\n            this.bbcodeStrokeIndex = 0\r\n        }\r\n        this.updateTexture();\r\n    }\r\n    /**\r\n     * Render the text with letter-spacing.\r\n     * @param {string} text - The text to draw\r\n     * @param {number} x - Horizontal position to draw the text\r\n     * @param {number} y - Vertical position to draw the text\r\n     * @param {boolean} [isStroke=false] - Is this drawing for the outside stroke of the\r\n     *  text? If not, it's for the inside fill\r\n     * @private\r\n     */\r\n    drawLetterSpacing(originText, text, x, y, isStroke = false) {\r\n        const style = this._style;\r\n        // letterSpacing of 0 means normal\r\n        const letterSpacing = style.letterSpacing;\r\n        let currentPosition = x;\r\n        // Using Array.from correctly splits characters whilst keeping emoji together.\r\n        // This is not supported on IE as it requires ES6, so regular text splitting occurs.\r\n        // This also doesn't account for emoji that are multiple emoji put together to make something else.\r\n        // Handling all of this would require a big library itself.\r\n        // https://medium.com/@giltayar/iterating-over-emoji-characters-the-es6-way-f06e4589516\r\n        // https://github.com/orling/grapheme-splitter\r\n        const stringArray = Array.from ? Array.from(text) : text.split('');\r\n        let previousWidth = this.context.measureText(text).width;\r\n        let currentWidth = 0;\r\n        for (let i = 0; i < stringArray.length; ++i) {\r\n            const currentChar = stringArray[i];\r\n            if (isStroke) {\r\n                const result = processBbcode(originText, originText[this.bbcodeStrokeIndex], this.bbcodeStrokeIndex, 7);\r\n                if (result.type === 'open') {\r\n                    const params = result.params;\r\n                    if (params.fill) {\r\n                        this.context.strokeStyle = params.stroke;\r\n                    }\r\n                } else if (result.type === 'close') {\r\n                    this.context.strokeStyle = style.stroke;\r\n                }\r\n                if (result.type !== 'none') {\r\n                    const offset = result.index - this.bbcodeStrokeIndex;\r\n                    this.bbcodeStrokeIndex = this.bbcodeStrokeIndex + offset + 1;\r\n                    if (this.bbcodeStrokeIndex >= originText.length) {\r\n                        continue;\r\n                    }\r\n                }\r\n                this.bbcodeStrokeIndex++;\r\n                this.context.strokeText(currentChar, currentPosition, y);\r\n            }\r\n            else {\r\n                const result = processBbcode(originText, originText[this.bbcodeFillIndex], this.bbcodeFillIndex, 7);\r\n                if (result.type === 'open') {\r\n                    const params = result.params;\r\n                    if (params.fill) {\r\n                        this.context.fillStyle = params.fill;\r\n                    }\r\n                } else if (result.type === 'close') {\r\n                    this.context.fillStyle = style.fill;\r\n                }\r\n                if (result.type !== 'none') {\r\n                    const offset = result.index - this.bbcodeFillIndex;\r\n                    this.bbcodeFillIndex = this.bbcodeFillIndex + offset + 1;\r\n                    if (this.bbcodeFillIndex >= originText.length) {\r\n                        continue;\r\n                    }\r\n                }\r\n                this.bbcodeFillIndex++;\r\n                this.context.fillText(currentChar, currentPosition, y);\r\n            }\r\n            currentWidth = this.context.measureText(text.substring(i + 1)).width;\r\n            currentPosition += previousWidth - currentWidth + letterSpacing;\r\n            previousWidth = currentWidth;\r\n        }\r\n    }\r\n    /**\r\n     * Updates texture size based on canvas size\r\n     *\r\n     * @private\r\n     */\r\n    updateTexture() {\r\n        const canvas = this.canvas;\r\n        if (this._style.trim) {\r\n            const trimmed = trimCanvas(canvas);\r\n            if (trimmed.data) {\r\n                canvas.width = trimmed.width;\r\n                canvas.height = trimmed.height;\r\n                this.context.putImageData(trimmed.data, 0, 0);\r\n            }\r\n        }\r\n        const texture = this._texture;\r\n        const style = this._style;\r\n        const padding = style.trim ? 0 : style.padding;\r\n        const baseTexture = texture.baseTexture;\r\n        texture.trim.width = texture._frame.width = Math.ceil(canvas.width / this._resolution);\r\n        texture.trim.height = texture._frame.height = Math.ceil(canvas.height / this._resolution);\r\n        texture.trim.x = -padding;\r\n        texture.trim.y = -padding;\r\n        texture.orig.width = texture._frame.width - (padding * 2);\r\n        texture.orig.height = texture._frame.height - (padding * 2);\r\n        // call sprite onTextureUpdate to update scale if _width or _height were set\r\n        this._onTextureUpdate();\r\n        baseTexture.setRealSize(canvas.width, canvas.height, this._resolution);\r\n        // Recursively updates transform of all objects from the root to this one\r\n        this._recursivePostUpdateTransform();\r\n        this.dirty = false;\r\n    }\r\n    /**\r\n     * Renders the object using the WebGL renderer\r\n     *\r\n     * @protected\r\n     * @param {PIXI.Renderer} renderer - The renderer\r\n     */\r\n    _render(renderer) {\r\n        if (this._autoResolution && this._resolution !== renderer.resolution) {\r\n            this._resolution = renderer.resolution;\r\n            this.dirty = true;\r\n        }\r\n        this.updateText(true);\r\n        super._render(renderer);\r\n    }\r\n    /**\r\n     * Gets the local bounds of the text object.\r\n     *\r\n     * @param {PIXI.Rectangle} rect - The output rectangle.\r\n     * @return {PIXI.Rectangle} The bounds.\r\n     */\r\n    getLocalBounds(rect) {\r\n        this.updateText(true);\r\n        return super.getLocalBounds.call(this, rect);\r\n    }\r\n    /**\r\n     * calculates the bounds of the Text as a rectangle. The bounds calculation takes the worldTransform into account.\r\n     * @protected\r\n     */\r\n    _calculateBounds() {\r\n        this.updateText(true);\r\n        this.calculateVertices();\r\n        // if we have already done this on THIS frame.\r\n        this._bounds.addQuad(this.vertexData);\r\n    }\r\n    /**\r\n     * Generates the fill style. Can automatically generate a gradient based on the fill style being an array\r\n     *\r\n     * @private\r\n     * @param {object} style - The style.\r\n     * @param {string[]} lines - The lines of text.\r\n     * @return {string|number|CanvasGradient} The fill style\r\n     */\r\n    _generateFillStyle(style, lines, metrics) {\r\n        // TODO: Can't have different types for getter and setter. The getter shouldn't have the number type as\r\n        //       the setter converts to string. See this thread for more details:\r\n        //       https://github.com/microsoft/TypeScript/issues/2521\r\n        const fillStyle = style.fill;\r\n        if (!Array.isArray(fillStyle)) {\r\n            return fillStyle;\r\n        }\r\n        else if (fillStyle.length === 1) {\r\n            return fillStyle[0];\r\n        }\r\n        // the gradient will be evenly spaced out according to how large the array is.\r\n        // ['#FF0000', '#00FF00', '#0000FF'] would created stops at 0.25, 0.5 and 0.75\r\n        let gradient;\r\n        // a dropshadow will enlarge the canvas and result in the gradient being\r\n        // generated with the incorrect dimensions\r\n        const dropShadowCorrection = (style.dropShadow) ? style.dropShadowDistance : 0;\r\n        // should also take padding into account, padding can offset the gradient\r\n        const padding = style.padding || 0;\r\n        const width = Math.ceil(this.canvas.width / this._resolution) - dropShadowCorrection - (padding * 2);\r\n        const height = Math.ceil(this.canvas.height / this._resolution) - dropShadowCorrection - (padding * 2);\r\n        // make a copy of the style settings, so we can manipulate them later\r\n        const fill = fillStyle.slice();\r\n        const fillGradientStops = style.fillGradientStops.slice();\r\n        // wanting to evenly distribute the fills. So an array of 4 colours should give fills of 0.25, 0.5 and 0.75\r\n        if (!fillGradientStops.length) {\r\n            const lengthPlus1 = fill.length + 1;\r\n            for (let i = 1; i < lengthPlus1; ++i) {\r\n                fillGradientStops.push(i / lengthPlus1);\r\n            }\r\n        }\r\n        // stop the bleeding of the last gradient on the line above to the top gradient of the this line\r\n        // by hard defining the first gradient colour at point 0, and last gradient colour at point 1\r\n        fill.unshift(fillStyle[0]);\r\n        fillGradientStops.unshift(0);\r\n        fill.push(fillStyle[fillStyle.length - 1]);\r\n        fillGradientStops.push(1);\r\n        if (style.fillGradientType === TEXT_GRADIENT.LINEAR_VERTICAL) {\r\n            // start the gradient at the top center of the canvas, and end at the bottom middle of the canvas\r\n            gradient = this.context.createLinearGradient(width / 2, padding, width / 2, height + padding);\r\n            // we need to repeat the gradient so that each individual line of text has the same vertical gradient effect\r\n            // ['#FF0000', '#00FF00', '#0000FF'] over 2 lines would create stops at 0.125, 0.25, 0.375, 0.625, 0.75, 0.875\r\n            // There's potential for floating point precision issues at the seams between gradient repeats.\r\n            // The loop below generates the stops in order, so track the last generated one to prevent\r\n            // floating point precision from making us go the teeniest bit backwards, resulting in\r\n            // the first and last colors getting swapped.\r\n            let lastIterationStop = 0;\r\n            // Actual height of the text itself, not counting spacing for lineHeight/leading/dropShadow etc\r\n            const textHeight = metrics.fontProperties.fontSize + style.strokeThickness;\r\n            // textHeight, but as a 0-1 size in global gradient stop space\r\n            const gradStopLineHeight = textHeight / height;\r\n            for (let i = 0; i < lines.length; i++) {\r\n                const thisLineTop = metrics.lineHeight * i;\r\n                for (let j = 0; j < fill.length; j++) {\r\n                    // 0-1 stop point for the current line, multiplied to global space afterwards\r\n                    let lineStop = 0;\r\n                    if (typeof fillGradientStops[j] === 'number') {\r\n                        lineStop = fillGradientStops[j];\r\n                    }\r\n                    else {\r\n                        lineStop = j / fill.length;\r\n                    }\r\n                    const globalStop = (thisLineTop / height) + (lineStop * gradStopLineHeight);\r\n                    // Prevent color stop generation going backwards from floating point imprecision\r\n                    let clampedStop = Math.max(lastIterationStop, globalStop);\r\n                    clampedStop = Math.min(clampedStop, 1); // Cap at 1 as well for safety's sake to avoid a possible throw.\r\n                    gradient.addColorStop(clampedStop, fill[j]);\r\n                    lastIterationStop = clampedStop;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            // start the gradient at the center left of the canvas, and end at the center right of the canvas\r\n            gradient = this.context.createLinearGradient(padding, height / 2, width + padding, height / 2);\r\n            // can just evenly space out the gradients in this case, as multiple lines makes no difference\r\n            // to an even left to right gradient\r\n            const totalIterations = fill.length + 1;\r\n            let currentIteration = 1;\r\n            for (let i = 0; i < fill.length; i++) {\r\n                let stop;\r\n                if (typeof fillGradientStops[i] === 'number') {\r\n                    stop = fillGradientStops[i];\r\n                }\r\n                else {\r\n                    stop = currentIteration / totalIterations;\r\n                }\r\n                gradient.addColorStop(stop, fill[i]);\r\n                currentIteration++;\r\n            }\r\n        }\r\n        return gradient;\r\n    }\r\n    /**\r\n     * Destroys this text object.\r\n     * Note* Unlike a Sprite, a Text object will automatically destroy its baseTexture and texture as\r\n     * the majority of the time the texture will not be shared with any other Sprites.\r\n     *\r\n     * @param {object|boolean} [options] - Options parameter. A boolean will act as if all options\r\n     *  have been set to that value\r\n     * @param {boolean} [options.children=false] - if set to true, all the children will have their\r\n     *  destroy method called as well. 'options' will be passed on to those calls.\r\n     * @param {boolean} [options.texture=true] - Should it destroy the current texture of the sprite as well\r\n     * @param {boolean} [options.baseTexture=true] - Should it destroy the base texture of the sprite as well\r\n     */\r\n    destroy(options) {\r\n        if (typeof options === 'boolean') {\r\n            options = { children: options };\r\n        }\r\n        options = Object.assign({}, defaultDestroyOptions, options);\r\n        super.destroy(options);\r\n        // set canvas width and height to 0 to workaround memory leak in Safari < 13\r\n        // https://stackoverflow.com/questions/52532614/total-canvas-memory-use-exceeds-the-maximum-limit-safari-12\r\n        if (this._ownCanvas) {\r\n            this.canvas.height = this.canvas.width = 0;\r\n        }\r\n        // make sure to reset the the context and canvas.. dont want this hanging around in memory!\r\n        this.context = null;\r\n        this.canvas = null;\r\n        this._style = null;\r\n    }\r\n    /**\r\n     * The width of the Text, setting this will actually modify the scale to achieve the value set\r\n     *\r\n     * @member {number}\r\n     */\r\n    get width() {\r\n        this.updateText(true);\r\n        return Math.abs(this.scale.x) * this._texture.orig.width;\r\n    }\r\n    set width(value) {\r\n        this.updateText(true);\r\n        const s = sign(this.scale.x) || 1;\r\n        this.scale.x = s * value / this._texture.orig.width;\r\n        this._width = value;\r\n    }\r\n    /**\r\n     * The height of the Text, setting this will actually modify the scale to achieve the value set\r\n     *\r\n     * @member {number}\r\n     */\r\n    get height() {\r\n        this.updateText(true);\r\n        return Math.abs(this.scale.y) * this._texture.orig.height;\r\n    }\r\n    set height(value) {\r\n        this.updateText(true);\r\n        const s = sign(this.scale.y) || 1;\r\n        this.scale.y = s * value / this._texture.orig.height;\r\n        this._height = value;\r\n    }\r\n    /**\r\n     * Set the style of the text. Set up an event listener to listen for changes on the style\r\n     * object and mark the text as dirty.\r\n     *\r\n     * @member {object|PIXI.TextStyle}\r\n     */\r\n    get style() {\r\n        // TODO: Can't have different types for getter and setter. The getter shouldn't have the ITextStyle\r\n        //       since the setter creates the TextStyle. See this thread for more details:\r\n        //       https://github.com/microsoft/TypeScript/issues/2521\r\n        return this._style;\r\n    }\r\n    set style(style) {\r\n        style = style || {};\r\n        if (style instanceof TextStyle) {\r\n            this._style = style;\r\n        }\r\n        else {\r\n            this._style = new TextStyle(style);\r\n        }\r\n        this.localStyleID = -1;\r\n        this.dirty = true;\r\n    }\r\n    /**\r\n     * Set the copy for the text object. To split a line you can use '\\n'.\r\n     *\r\n     * @member {string}\r\n     */\r\n    get text() {\r\n        return this._text;\r\n    }\r\n    set text(text) {\r\n        text = String(text === null || text === undefined ? '' : text);\r\n        if (this._text === text) {\r\n            return;\r\n        }\r\n        this._text = text;\r\n        this.dirty = true;\r\n    }\r\n    /**\r\n     * The resolution / device pixel ratio of the canvas.\r\n     * This is set to automatically match the renderer resolution by default, but can be overridden by setting manually.\r\n     * @member {number}\r\n     * @default 1\r\n     */\r\n    get resolution() {\r\n        return this._resolution;\r\n    }\r\n    set resolution(value) {\r\n        this._autoResolution = false;\r\n        if (this._resolution === value) {\r\n            return;\r\n        }\r\n        this._resolution = value;\r\n        this.dirty = true;\r\n    }\r\n}\r\n","import { Sprite, Texture, Text, Container } from 'pixi.js'\r\nimport RenderComponent from './base/render'\r\nimport { componentRegister } from '../core'\r\nimport RainbowText from '../lib/rainbow-text'\r\n\r\ntype AxisPosition = {\r\n  x: 'left' | 'center' | 'right'\r\n  y: 'top' | 'center' | 'bottom'\r\n}\r\n\r\ntype TextStyle = {\r\n  fontFamily?: string | string[],\r\n  fontWeight?: string,\r\n  fontSize?: number,\r\n  fill?: string,\r\n  lineJoin?: 'round',\r\n  stroke?: string,\r\n  strokeThickness?: number,\r\n  wordWrap?: boolean,\r\n  wordWrapWidth?: number\r\n}\r\n\r\nexport class TextComponent extends RenderComponent {\r\n  // serialize fields\r\n  public text: string\r\n  public style: TextStyle\r\n  public position: AxisPosition\r\n  public bgTextureId: string\r\n  public padding: number\r\n  // temp fields\r\n  public bgTexture: Texture\r\n  public textView: Text\r\n  public btnView: Sprite\r\n\r\n  constructor() {\r\n    super()\r\n    this.text = ''\r\n    this.style = {}\r\n    this.position = {\r\n      x: 'left',\r\n      y: 'top'\r\n    }\r\n    this.bgTextureId = null\r\n    this.padding = 0\r\n\r\n    this.bgTexture = null\r\n    this.textView = null\r\n    this.btnView = null\r\n  }\r\n\r\n  public init() {\r\n    this.view = new Container()\r\n    if (this.bgTextureId) {\r\n      this.bgTexture = Texture.from(this.bgTextureId)\r\n    } else {\r\n      this.bgTexture = Texture.EMPTY\r\n    }\r\n    this.btnView = new Sprite(this.bgTexture)\r\n    if (this.bgTextureId) {\r\n      this.style = {\r\n        wordWrap: true,\r\n        wordWrapWidth: this.btnView.width - this.padding * 2,\r\n        ...this.style\r\n      }\r\n    }\r\n    this.textView = new RainbowText(this.text, this.style)\r\n    this.textView.resolution = 2\r\n    this.justifyContent()\r\n    this.view.addChild(this.btnView, this.textView)\r\n  }\r\n\r\n  public justifyContent() {\r\n    const { position } = this\r\n    const { width: btnW, height: btnH } = this.btnView\r\n    const { width: textW, height: textH } = this.textView\r\n\r\n    if (position.x === 'left') {\r\n      this.textView.x = this.padding\r\n    } else if (position.x === 'center') {\r\n      this.textView.x = Math.abs(btnW - textW) / 2\r\n    } else if (position.x === 'right') {\r\n      this.textView.x = Math.abs(btnW - textW) - this.padding\r\n    }\r\n    if (position.y === 'top') {\r\n      this.textView.y = this.padding\r\n    } else if (position.y === 'center') {\r\n      this.textView.y = Math.abs(btnH - textH) / 2\r\n    } else if (position.y === 'bottom') {\r\n      this.textView.y = Math.abs(btnH - textH) - this.padding\r\n    }\r\n  }\r\n\r\n  public clear() {\r\n    this.revert()\r\n    this.text = ''\r\n    this.style = {}\r\n    this.position = {\r\n      x: 'left',\r\n      y: 'top'\r\n    }\r\n    this.bgTextureId = null\r\n    this.padding = 0\r\n\r\n    this.textView?.destroy()\r\n    this.textView = null\r\n    this.btnView?.destroy()\r\n    this.btnView = null\r\n    this.bgTexture = null\r\n  }\r\n\r\n  public toJSON() {\r\n    const { text, style, position, bgTextureId, padding } = this\r\n    const render = this.getRenderJSON()\r\n\r\n    return { text, style, position, bgTextureId, padding,\r\n      ...render\r\n    }\r\n  }\r\n}\r\n\r\ncomponentRegister('TextComponent')(TextComponent)\r\n","import { IComponent, componentRegister } from '../core'\r\n\r\nexport class TypewriterComponent extends IComponent {\r\n  /** 完整文本 */\r\n  public text: string\r\n  /**\r\n   * 打字速度（个/秒）\r\n   */\r\n  public speed: number\r\n  /**\r\n   * 打印延时，等待指定时间后才开始打印\r\n   */\r\n  public printDelay: number\r\n\r\n  public deltaTimer: number\r\n\r\n  constructor() {\r\n    super()\r\n    this.text = ''\r\n    this.speed = 10\r\n    this.printDelay = 0\r\n    this.deltaTimer = 0\r\n  }\r\n\r\n  clear() {\r\n    this.text = ''\r\n    this.speed = 10\r\n    this.printDelay = 0\r\n    this.deltaTimer = 0\r\n  }\r\n\r\n  toJSON() {\r\n    const { text, speed, printDelay } = this\r\n    return { text, speed, printDelay }\r\n  }\r\n}\r\n\r\ncomponentRegister('TypewriterComponent')(TypewriterComponent)\r\n","import { Texture, Container } from 'pixi.js'\r\nimport { IComponent, componentRegister } from '../core'\r\n\r\nexport class ButtonComponent extends IComponent {\r\n  // serialize fields\r\n  /** button 标记 */\r\n  public tag: string\r\n  /** button down 时使用的纹理id */\r\n  public textureId: string\r\n  /** 文字样式 */\r\n  public style: any\r\n  /** 是否使用点击动画 */\r\n  public useAnimation: boolean\r\n  // temp fields\r\n  /** 纹理 */\r\n  public texture: Texture\r\n  /** 是否绑定按钮事件 */\r\n  public isBind: boolean\r\n  /** 是否点击按钮 */\r\n  public isClick: boolean\r\n  /** 按钮本体，卸载组件时清理事件用 */\r\n  public origin: Container\r\n\r\n  /** 接收点击事件，是否为点击 */\r\n  public clickEvent: boolean\r\n  /** 点击动画延时计时器 */\r\n  public deltaTimer: number\r\n\r\n  constructor() {\r\n    super()\r\n    this.tag = null\r\n    this.textureId = null\r\n    this.style = {}\r\n    this.useAnimation = true\r\n\r\n    this.texture = null\r\n    this.isBind = false\r\n    this.isClick = false\r\n    this.origin = null\r\n\r\n    this.clickEvent = false\r\n    this.deltaTimer = 0\r\n  }\r\n\r\n  public init() {\r\n    if (this.textureId) {\r\n      this.texture = Texture.from(this.textureId)\r\n    }\r\n  }\r\n\r\n  public clear() {\r\n    this.tag = null\r\n    this.textureId = null\r\n    this.style = {}\r\n    this.useAnimation = true\r\n\r\n    this.texture = null\r\n    this.isBind = false\r\n    this.isClick = false\r\n    if (this.origin) {\r\n      this.origin.interactive = false\r\n      this.origin.buttonMode = false\r\n      this.origin.removeAllListeners()\r\n    }\r\n    this.origin = null\r\n\r\n    this.clickEvent = false\r\n    this.deltaTimer = 0\r\n  }\r\n\r\n  public toJSON() {\r\n    const { tag, textureId, style, useAnimation } = this\r\n    return { tag, textureId, style, useAnimation }\r\n  }\r\n}\r\n\r\ncomponentRegister('ButtonComponent')(ButtonComponent)\r\n","import { IComponent, componentRegister } from '../core'\r\n\r\nexport class TransformComponent extends IComponent {\r\n  public x: number\r\n  public y: number\r\n  public angle: number\r\n  public scale: number\r\n\r\n  constructor() {\r\n    super()\r\n    this.x = 0\r\n    this.y = 0\r\n    this.angle = 0\r\n    this.scale = 1\r\n  }\r\n\r\n  clear() {\r\n    this.x = 0\r\n    this.y = 0\r\n    this.angle = 0\r\n    this.scale = 1\r\n  }\r\n\r\n  toJSON() {\r\n    const { x, y, angle, scale } = this\r\n    return { x, y, angle, scale }\r\n  }\r\n}\r\n\r\ncomponentRegister('TransformComponent')(TransformComponent)\r\n","import { IComponent, componentRegister } from '../core'\r\n\r\nexport class TransparentComponent extends IComponent {\r\n  public alpha : number\r\n\r\n  constructor() {\r\n    super()\r\n    this.alpha = 0\r\n  }\r\n\r\n  clear() {\r\n    this.alpha = 0\r\n  }\r\n\r\n  toJSON() {\r\n    const { alpha } = this\r\n    return { alpha }\r\n  }\r\n}\r\n\r\ncomponentRegister('TransparentComponent')(TransparentComponent)\r\n","import { IComponent, componentRegister } from '../core'\r\nimport { Sound } from '../sound'\r\n\r\ntype PlayOptions = {\r\n  start?: number\r\n  end?: number\r\n  speed?: number\r\n  loop?: boolean\r\n  sprite?: string\r\n  muted?: boolean\r\n}\r\n\r\nexport class SoundComponent extends IComponent {\r\n  public alias: string\r\n  public options: PlayOptions\r\n\r\n  public firstPlay: boolean\r\n  public isPlaying: boolean\r\n  public sound: Sound\r\n\r\n  constructor() {\r\n    super()\r\n    this.alias = null\r\n    this.options = {}\r\n\r\n    this.firstPlay = true\r\n    this.isPlaying = false\r\n    this.sound = null\r\n  }\r\n\r\n  init() {\r\n    this.sound = new Sound(this.alias)\r\n  }\r\n\r\n  clear() {\r\n    this.alias = null\r\n    this.options = {}\r\n\r\n    this.firstPlay = true\r\n    this.isPlaying = false\r\n    this.sound.stop()\r\n    this.sound = null\r\n  }\r\n\r\n  toJSON() {\r\n    const { alias: resourceId, options } = this\r\n    return { resourceId, options }\r\n  }\r\n}\r\n\r\ncomponentRegister('SoundComponent')(SoundComponent)\r\n","import { IComponent, componentRegister } from '../core'\r\n\r\ntype Vars = {\r\n  x?: number\r\n  y?: number\r\n  angle?: number\r\n  scale?: number\r\n}\r\n\r\n/**\r\n * 位移组件\r\n */\r\nexport class DisplacementComponent extends IComponent {\r\n  public start: Vars\r\n  public end: Vars\r\n  public duration: number\r\n\r\n  constructor() {\r\n    super()\r\n    this.start = {}\r\n    this.end = {}\r\n    this.duration = 0\r\n  }\r\n\r\n  public clear() {\r\n    this.start = {}\r\n    this.end = {}\r\n    this.duration = 0\r\n  }\r\n\r\n  public toJSON() {\r\n    const { start, end, duration } = this\r\n    return { start, end, duration }\r\n  }\r\n}\r\n\r\ncomponentRegister('DisplacementComponent')(DisplacementComponent)\r\n","import { IComponent, componentRegister } from '../core'\r\n\r\ntype Vars = {\r\n  alpha?: number\r\n}\r\n\r\n/**\r\n * 淡入淡出组件\r\n */\r\nexport class FadeComponent extends IComponent {\r\n  public start: Vars\r\n  public end: Vars\r\n  public duration: number\r\n\r\n  constructor() {\r\n    super()\r\n    this.start = {}\r\n    this.end = {}\r\n    this.duration = 0\r\n  }\r\n\r\n  public clear() {\r\n    this.start = {}\r\n    this.end = {}\r\n    this.duration = 0\r\n  }\r\n\r\n  public toJSON() {\r\n    const { start, end, duration } = this\r\n    return { start, end, duration }\r\n  }\r\n}\r\n\r\ncomponentRegister('FadeComponent')(FadeComponent)\r\n","import { IComponentClass, ISystem } from '../core'\r\nimport { Entity } from '../core/entity'\r\nimport {\r\n  SpriteComponent,\r\n  AnimationComponent,\r\n  TextComponent,\r\n  TransformComponent,\r\n  TransparentComponent\r\n} from '../components'\r\nimport RenderComponent from '../components/base/render'\r\nimport { Scene } from '../render'\r\n\r\nexport class PIXIRenderSystem extends ISystem {\r\n  public execute() {\r\n    const entities = this.queries.entities.results\r\n\r\n    for (const entity of entities) {\r\n      this.match(entity, SpriteComponent)\r\n      this.match(entity, AnimationComponent)\r\n      this.match(entity, TextComponent)\r\n    }\r\n  }\r\n\r\n  private match<T extends RenderComponent>(\r\n    entity: Entity,\r\n    componentClass: IComponentClass<T>\r\n  ) {\r\n    if (entity.hasComponent(componentClass)) {\r\n      const sprite = entity.getComponent(componentClass)\r\n      this.configureSprite(sprite)\r\n      this.transform(entity, sprite)\r\n      this.transparent(entity, sprite)\r\n    }\r\n  }\r\n\r\n  private configureSprite(sprite: RenderComponent) {\r\n    sprite.view.visible = sprite.visible\r\n    const anchor = {\r\n      x: sprite.anchor.x * sprite.view.width,\r\n      y: sprite.anchor.y * sprite.view.height\r\n    }\r\n    sprite.view.pivot.set(anchor.x, anchor.y)\r\n    if (!sprite.isRender) {\r\n      const scene = this.world as Scene\r\n      sprite.isRender = true\r\n      scene.addSprite(sprite.layer, sprite.view)\r\n    }\r\n  }\r\n\r\n  private transform(entity: Entity, sprite: RenderComponent) {\r\n    if (entity.hasComponent(TransformComponent)) {\r\n      const transform = entity.getComponent(TransformComponent)\r\n      sprite.view.x = transform.x\r\n      sprite.view.y = transform.y\r\n      sprite.view.angle = transform.angle\r\n      sprite.view.scale.set(transform.scale)\r\n    }\r\n  }\r\n\r\n  private transparent(entity: Entity, sprite: RenderComponent) {\r\n    if (entity.hasComponent(TransparentComponent)) {\r\n      const transparent = entity.getComponent(TransparentComponent)\r\n      sprite.view.alpha = transparent.alpha\r\n    }\r\n  }\r\n}\r\n\r\nPIXIRenderSystem.queries = {\r\n  entities: {\r\n    type: 'any',\r\n    components: [SpriteComponent, AnimationComponent, TextComponent]\r\n  }\r\n}\r\n","import { ISystem } from '../core'\r\nimport { TextComponent } from '../components'\r\n\r\nexport class TextUpdateSystem extends ISystem {\r\n  public execute() {\r\n    const entities = this.queries.entities.results\r\n\r\n    for (const entity of entities) {\r\n      const Text = entity.getComponent(TextComponent)\r\n      if (Text.textView.text !== Text.text) {\r\n        Text.textView.text = Text.text\r\n        Text.justifyContent()\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nTextUpdateSystem.queries = {\r\n  entities: [TextComponent]\r\n}\r\n","import { ISystem } from '../core'\r\nimport { AnimationComponent } from '../components'\r\n\r\nexport class AnimationSystem extends ISystem {\r\n  public execute() {\r\n    const entities = this.queries.entities.results\r\n\r\n    for (const entity of entities) {\r\n      const animation = entity.getComponent(AnimationComponent)\r\n      const view = animation.view as PIXI.AnimatedSprite\r\n\r\n      if (view.loop !== animation.loop) {\r\n        view.loop = animation.loop\r\n      }\r\n\r\n      if (view.animationSpeed !== animation.animationSpeed) {\r\n        view.animationSpeed = animation.animationSpeed\r\n      }\r\n\r\n      if (animation.playing === true) {\r\n        if (view.playing === false) {\r\n          view.play()\r\n        }\r\n      } else {\r\n        if (view.playing === true) {\r\n          view.gotoAndStop(0)\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nAnimationSystem.queries = {\r\n  entities: [AnimationComponent]\r\n}\r\n","import { ISystem } from '../core'\r\nimport { TextComponent, TypewriterComponent } from '../components'\r\n\r\nexport class TypewriterSystem extends ISystem {\r\n  public execute(delta: number) {\r\n    const entities = this.queries.entities.results\r\n\r\n    for (const entity of entities) {\r\n      const Text = entity.getComponent(TextComponent)\r\n      const typewriter = entity.getComponent(TypewriterComponent)\r\n      if (typewriter.text.length > Text.text.length) {\r\n        if (typewriter.speed <= 0) {\r\n          typewriter.speed = 10\r\n        }\r\n        typewriter.deltaTimer += delta\r\n        let time = 1000 / typewriter.speed\r\n        if (Text.text.length === 0 && typewriter.printDelay >= 0) {\r\n          // 打印延时，不至于显示的太快\r\n          time = typewriter.printDelay\r\n        }\r\n        if (typewriter.deltaTimer >= time) {\r\n          let char\r\n          do {\r\n            char = typewriter.text.charAt(Text.text.length)\r\n            // 打印时处理下 bbcode 要不然会把标签也打印出来\r\n            const result = processBbcode(typewriter.text, char, Text.text.length, 7)\r\n            if (result.type === 'tag') {\r\n              Text.text +=  result.bbcode\r\n              char = typewriter.text.charAt(Text.text.length)\r\n            }\r\n            Text.text += char\r\n            // 干掉空格，要不然会出现不自然的等待时间\r\n          } while (char === ' ')\r\n          // Text.text += typewriter.text.charAt(Text.text.length)\r\n          typewriter.deltaTimer = 0\r\n        }\r\n      } else {\r\n        entity.removeComponent(TypewriterComponent)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nTypewriterSystem.queries = {\r\n  entities: [TextComponent, TypewriterComponent]\r\n}\r\n\r\nfunction processBbcode(string: string, char: string, i: number, magic: number) {\r\n  let type = 'none'\r\n  let bbcode = ''\r\n  if (char === '[') {\r\n    let index = i\r\n    index += magic // magic should be 7\r\n    bbcode = string.slice(i, index + 1)\r\n    if (bbcode === '[style={') {\r\n      let tmp\r\n      do {\r\n        index++\r\n        tmp = string.charAt(index)\r\n        bbcode += tmp\r\n      } while (tmp !== ']')\r\n      type = 'tag'\r\n    } else if (bbcode === '[/style]') {\r\n      type = 'tag'\r\n    }\r\n  }\r\n\r\n  return {\r\n    type,\r\n    bbcode\r\n  }\r\n}\r\n","import { ISystem } from '../core'\r\nimport { Entity } from '../core/entity'\r\nimport { TextComponent, ButtonComponent, TransformComponent } from '../components'\r\n\r\nexport class TextButtonSystem extends ISystem {\r\n  public execute(delta: number) {\r\n    const entities = this.queries.entities.results\r\n\r\n    for (const entity of entities) {\r\n      const text = entity.getComponent(TextComponent)\r\n      const button = entity.getComponent(ButtonComponent)\r\n\r\n      if (button.isBind === false) {\r\n        button.isBind = true\r\n        text.view.interactive = true\r\n        text.view.buttonMode = true\r\n        text.view\r\n          .on('pointerdown', this.processButtonDown(entity))\r\n          .on('pointerup', this.processButtonUp(entity))\r\n          .on('pointerupoutside', this.processButtonUp(entity))\r\n          .on('pointertap', () => {\r\n            button.clickEvent = true\r\n            button.deltaTimer = 0\r\n          })\r\n        button.origin = text.view\r\n      }\r\n\r\n      button.isClick = false\r\n      if (button.clickEvent === true) {\r\n        if (button.deltaTimer >= 10) {\r\n          button.isClick = true\r\n          button.clickEvent = false\r\n          button.deltaTimer = 0\r\n        } else {\r\n          button.deltaTimer += delta\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private processButtonUp(entity: Entity) {\r\n    const text = entity.getComponent(TextComponent)\r\n    const button = entity.getComponent(ButtonComponent)\r\n    const view = text.view\r\n\r\n    return () => {\r\n      if (button.useAnimation === true) {\r\n        if (entity.hasComponent(TransformComponent)) {\r\n          entity.getComponent(TransformComponent).scale = 1\r\n        } else {\r\n          view.scale.set(1)\r\n        }\r\n        text.anchor = { x: 0, y: 0 }\r\n      }\r\n\r\n      this.onButtonUp(text)\r\n    }\r\n  }\r\n\r\n  private processButtonDown(entity: Entity) {\r\n    const text = entity.getComponent(TextComponent)\r\n    const button = entity.getComponent(ButtonComponent)\r\n    const view = text.view\r\n\r\n    return () => {\r\n      if (button.useAnimation === true) {\r\n        if (entity.hasComponent(TransformComponent)) {\r\n          entity.getComponent(TransformComponent).scale = 0.95\r\n        } else {\r\n          view.scale.set(0.95)\r\n        }\r\n        // 0.025 = (1 - 0.95) / 2\r\n        text.anchor = { x: -0.025, y: -0.025 }\r\n      }\r\n\r\n      this.onButtonDown(text, button)\r\n    }\r\n  }\r\n\r\n  private onButtonUp(textC: TextComponent) {\r\n    textC.btnView.texture = textC.bgTexture\r\n    Object.assign(textC.textView.style, textC.style)\r\n  }\r\n\r\n  private onButtonDown(textC: TextComponent, btnC: ButtonComponent) {\r\n    if (btnC.texture) {\r\n      textC.btnView.texture = btnC.texture\r\n    }\r\n    Object.assign(textC.textView.style, btnC.style)\r\n  }\r\n}\r\n\r\nTextButtonSystem.queries = {\r\n  entities: [TextComponent, ButtonComponent]\r\n}\r\n","import { IComponent, ISystem } from '../core'\r\nimport {\r\n  TransformComponent,\r\n  TransparentComponent,\r\n  DisplacementComponent,\r\n  FadeComponent\r\n} from '../components'\r\n\r\nexport class TransformSystem extends ISystem {\r\n  public execute(delta: number) {\r\n    const disp = this.queries.disp.results\r\n\r\n    for (const entity of disp) {\r\n      const Transform = entity.getComponent(TransformComponent)\r\n      const Displacement = entity.getComponent(DisplacementComponent)\r\n      const result = this.transform(Transform, Displacement, delta)\r\n      if (result === true) {\r\n        entity.removeComponent(DisplacementComponent)\r\n      }\r\n    }\r\n\r\n    const fade = this.queries.fade.results\r\n\r\n    for (const entity of fade) {\r\n      const Transparent = entity.getComponent(TransparentComponent)\r\n      const Fade = entity.getComponent(FadeComponent)\r\n      const result = this.transform(Transparent, Fade, delta)\r\n      if (result === true) {\r\n        entity.removeComponent(FadeComponent)\r\n      }\r\n    }\r\n  }\r\n\r\n  public transform(\r\n    target: IComponent,\r\n    method: IComponent,\r\n    delta: number\r\n  ): boolean {\r\n    const component = target as any\r\n    const { start, end, duration } = method as any\r\n\r\n    for (const key in end) {\r\n      const offset = end[key] - start[key]\r\n      if (component[key] !== end[key]) {\r\n        component[key] += (offset / duration * delta)\r\n        if (offset >= 0) {\r\n          if (component[key] >= end[key]) {\r\n            component[key] = end[key]\r\n            return true\r\n          }\r\n        } else {\r\n          if (component[key] <= end[key]) {\r\n            component[key] = end[key]\r\n            return true\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return false\r\n  }\r\n}\r\n\r\nTransformSystem.queries = {\r\n  disp: [TransformComponent, DisplacementComponent],\r\n  fade: [TransparentComponent, FadeComponent]\r\n}\r\n","import { ISystem } from '../core'\r\nimport { SoundComponent } from '../components'\r\n\r\nexport class SoundSystem extends ISystem {\r\n  public execute() {\r\n    const entities = this.queries.entities.results\r\n\r\n    for (const entity of entities) {\r\n      const Sound = entity.getComponent(SoundComponent)\r\n\r\n      if (Sound.firstPlay === true) {\r\n        // 说明音乐还没开始播放，把声音放起来\r\n        Sound.sound.play(Sound.options)\r\n        Sound.firstPlay = false\r\n        Sound.isPlaying = true\r\n      } else {\r\n        if (Sound.isPlaying === true) {\r\n          if (Sound.sound.isPlaying === false) {\r\n            // 说明音乐已经放完了，移除声音组件\r\n            entity.removeComponent(SoundComponent)\r\n          }\r\n        } else {\r\n          // 主动停止播放，并移除组件\r\n          Sound.sound.stop()\r\n          entity.removeComponent(SoundComponent)\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nSoundSystem.queries = {\r\n  entities: [SoundComponent]\r\n}\r\n","import { IComponent, componentRegister } from '../../../engine/core'\r\n\r\nconst BtnTypes = {\r\n  letf: 0,\r\n  center: 1,\r\n  right: 2\r\n}\r\n\r\nexport class InputComponent extends IComponent {\r\n  constructor() {\r\n    super()\r\n    this.curEvent = {\r\n      isDown: false,\r\n      buttons: 0,\r\n      x: -1,\r\n      y: -1\r\n    }\r\n    this.preEvent = {\r\n      isDown: false,\r\n      buttons: 0,\r\n      x: -1,\r\n      y: -1\r\n    }\r\n\r\n    /** 按下时的坐标 */\r\n    this.downPoint = { x: 0, y: 0 }\r\n    /** 是否单击 */\r\n    this.isClick = false\r\n    /** 接收点击事件，准备改变isClick */\r\n    this.readyClick = false\r\n    /** 单击延时 */\r\n    this.deltaTimer = 0\r\n  }\r\n\r\n  clear() {\r\n    this.curEvent = {\r\n      isDown: false,\r\n      buttons: 0,\r\n      x: -1,\r\n      y: -1\r\n    }\r\n    this.preEvent = {\r\n      isDown: false,\r\n      buttons: 0,\r\n      x: -1,\r\n      y: -1\r\n    }\r\n\r\n    this.downPoint = { x: 0, y: 0 }\r\n    this.isClick = false\r\n    this.readyClick = false\r\n    this.deltaTimer = 0\r\n  }\r\n\r\n  isMouseUp(btnType) {\r\n    const { isDown, buttons: button } = this.curEvent\r\n\r\n    if (isDown) {\r\n      return false\r\n    }\r\n    if (btnType === BtnTypes.letf) {\r\n      return button === 0\r\n    } else if (btnType === BtnTypes.center) {\r\n      return button === 1\r\n    } else if (btnType === BtnTypes.right) {\r\n      return button === 2\r\n    } else {\r\n      return false\r\n    }\r\n  }\r\n\r\n  isMouseDown(btnType) {\r\n    const { isDown, buttons: button } = this.curEvent\r\n\r\n    if (!isDown) {\r\n      return false\r\n    }\r\n    if (btnType === BtnTypes.letf) {\r\n      return button === 0\r\n    } else if (btnType === BtnTypes.center) {\r\n      return button === 1\r\n    } else if (btnType === BtnTypes.right) {\r\n      return button === 2\r\n    } else {\r\n      return false\r\n    }\r\n  }\r\n}\r\n\r\ncomponentRegister('InputComponent')(InputComponent)\r\n","import { IComponent, componentRegister } from '../../../engine/core'\r\n\r\nexport class StoryComponent extends IComponent {\r\n  constructor() {\r\n    super()\r\n    this.entities = {}\r\n    this.curChapter = null\r\n    this.initialed = false\r\n    this.nodeIndex = 0\r\n    this.subIndex = 0\r\n  }\r\n\r\n  clear() {\r\n    this.entities = {}\r\n    this.curChapter = null\r\n    this.initialed = false\r\n    this.nodeIndex = 0\r\n    this.subIndex = 0\r\n  }\r\n\r\n  toJSON() {\r\n    const { entities, curChapter, initialed, nodeIndex, subIndex } = this\r\n    return { entities, curChapter, initialed, nodeIndex, subIndex }\r\n  }\r\n}\r\n\r\ncomponentRegister('StoryComponent')(StoryComponent)\r\n","import { ISystem } from '../../engine/core'\r\nimport { InputComponent } from '../components/singleton'\r\n\r\nexport class InputSystem extends ISystem {\r\n  execute(delta) {\r\n    const singleton = this.world.singleton\r\n    const input = singleton.getComponent(InputComponent)\r\n\r\n    if (this.world.interaction) {\r\n      const interaction = this.world.interaction.mouse\r\n      input.preEvent = {\r\n        ...input.curEvent\r\n      }\r\n\r\n      // 更新鼠标位置\r\n      input.curEvent.x = interaction.global.x\r\n      input.curEvent.y = interaction.global.y\r\n\r\n      // 更新按键信息\r\n      input.curEvent.buttons = interaction.buttons\r\n\r\n      // 更新鼠标按键状态\r\n      if (interaction.isDown) {\r\n        if (input.curEvent.isDown === false) {\r\n          input.downPoint.x = input.curEvent.x\r\n          input.downPoint.y = input.curEvent.y\r\n        }\r\n        input.curEvent.isDown = true\r\n      } else {\r\n        input.curEvent.isDown = false\r\n      }\r\n\r\n      if (\r\n        input.preEvent.isDown === true &&\r\n        input.preEvent.buttons === 1 &&\r\n        input.curEvent.isDown === false &&\r\n        Math.abs(input.downPoint.x - input.curEvent.x) <= 50 &&\r\n        Math.abs(input.downPoint.y - input.curEvent.y) <= 50\r\n      ) {\r\n        input.readyClick = true\r\n        input.deltaTimer = 0\r\n      }\r\n\r\n      input.isClick = false\r\n      if (input.readyClick === true) {\r\n        if (input.deltaTimer >= 10) {\r\n          input.isClick = true\r\n          input.readyClick = false\r\n          input.deltaTimer = 0\r\n        } else {\r\n          input.deltaTimer += delta\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { ISystem } from '../../engine/core'\r\nimport { InputComponent } from '../components/singleton'\r\n\r\nexport class StorySystem extends ISystem {\r\n  execute(delta) {\r\n    const singleton = this.world.singleton\r\n\r\n    if (this.world.systemData && this.world.storyScript) {\r\n      const Input = singleton.getComponent(InputComponent)\r\n      let result = true\r\n      while (result) {\r\n        result = this.processStory(delta)\r\n        // 合并多条命令的时候，需要重制下 input ，防止对后面的命令造成影响\r\n        Input.isClick = false\r\n      }\r\n    }\r\n  }\r\n\r\n  processStory(delta) {\r\n    if (typeof this.world.storyScript === 'undefined') {\r\n      return false\r\n    }\r\n\r\n    const system = this.world.systemData\r\n    const chapter = this.world.storyScript[system.chapter]\r\n\r\n    if (typeof chapter === 'undefined') {\r\n      return false\r\n    }\r\n\r\n    const nodeCount = chapter.length\r\n    const node = chapter[system.nodeIndex]\r\n\r\n    if (typeof node === 'undefined') {\r\n      return false\r\n    }\r\n\r\n    if (system.initialed === false && node.init) {\r\n      node.init(this.world)\r\n      system.initialed = true\r\n    }\r\n\r\n    const result = node.process(this.world, delta)\r\n\r\n    if (result === true) {\r\n      if (node.goto) {\r\n        // 如果节点存在 goto 命令，就开始进行跳转\r\n        const goto = node.goto()\r\n\r\n        if (\r\n          goto && (\r\n          typeof goto.chapter !== 'undefined' ||\r\n          typeof goto.node !== 'undefined')\r\n        ) {\r\n          // 跳转时清除全部实体\r\n          this.world.removeAllEntity()\r\n          system.entities = {}\r\n          system.initialed = false\r\n          system.subIndex = 0\r\n\r\n          if (typeof goto.chapter !== 'undefined') {\r\n            system.nodeIndex = 0\r\n            system.chapter = goto.chapter\r\n          }\r\n          if (typeof goto.node !== 'undefined') {\r\n            system.nodeIndex = goto.node\r\n          }\r\n        } else if (system.nodeIndex < nodeCount) {\r\n          system.nodeIndex++\r\n          system.subIndex = 0\r\n          system.initialed = false\r\n        }\r\n\r\n      } else if (system.nodeIndex < nodeCount) {\r\n        system.nodeIndex++\r\n        system.subIndex = 0\r\n        system.initialed = false\r\n      }\r\n    }\r\n\r\n    return result\r\n  }\r\n}\r\n","import { IComponent, componentRegister } from '../../../engine/core'\r\n\r\n/** 背景标记组件 */\r\nexport class BackgroundComponent extends IComponent { }\r\ncomponentRegister('BackgroundComponent')(BackgroundComponent)\r\n\r\n/** CG 标记组件 */\r\nexport class CGComponent extends IComponent { }\r\ncomponentRegister('CGComponent')(CGComponent)\r\n\r\n/** BGM 标记组件 */\r\nexport class BGMComponent extends IComponent { }\r\ncomponentRegister('BGMComponent')(BGMComponent)\r\n\r\n/** 人物标记组件 */\r\nexport class CharacterComponent extends IComponent { }\r\ncomponentRegister('CharacterComponent')(CharacterComponent)\r\n\r\n/** 对话标记组件 */\r\nexport class DialogComponent extends IComponent { }\r\ncomponentRegister('DialogComponent')(DialogComponent)\r\n\r\n/** 名称标记组件 */\r\nexport class NameComponent extends IComponent { }\r\ncomponentRegister('NameComponent')(NameComponent)\r\n\r\n/** 选项标记组件 */\r\nexport class ChoiceComponent extends IComponent { }\r\ncomponentRegister('ChoiceComponent')(ChoiceComponent)\r\n\r\n/** 移除标记组件 */\r\nexport class RemoveComponent extends IComponent { }\r\ncomponentRegister('RemoveComponent')(RemoveComponent)\r\n","import { ISystem } from '../../engine/core'\r\nimport { DisplacementComponent, FadeComponent, SoundComponent } from '../../engine/components'\r\nimport { BGMComponent, RemoveComponent } from '../components/tag'\r\n\r\nexport class RemoveSystem extends ISystem {\r\n  execute() {\r\n    const entities = this.queries.entities.results\r\n\r\n    for (const entity of entities) {\r\n      if (entity.hasAnyComponent([DisplacementComponent, FadeComponent])) {\r\n        continue\r\n      }\r\n      this.world.removeEntity(entity)\r\n    }\r\n\r\n    const bgm = this.queries.bgm.results\r\n\r\n    for (const entity of bgm) {\r\n      if (!entity.hasComponent(SoundComponent)) {\r\n        this.world.removeEntity(entity)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nRemoveSystem.queries = {\r\n  entities: [RemoveComponent],\r\n  bgm: [BGMComponent]\r\n}\r\n","export class GroupMap {\r\n  constructor(group) {\r\n    this.group = group\r\n  }\r\n\r\n  getGroup(world) {\r\n    if (typeof world.systemData.entities[this.group] === 'undefined') {\r\n      world.systemData.entities[this.group] = {}\r\n    }\r\n  \r\n    return world.systemData.entities[this.group]\r\n  }\r\n\r\n  set(world, id, value) {\r\n    this.getGroup(world)[id] = value\r\n  }\r\n\r\n  get(world, id) {\r\n    return this.getGroup(world)[id]\r\n  }\r\n\r\n  delete(world, id) {\r\n    this.set(world, id, undefined)\r\n  }\r\n}\r\n\r\nexport function colorText(texts, color) {\r\n  if (Array.isArray(texts)) {\r\n    return texts.map(text => (`[style={\"fill\": \"${color}\"}]${text}[/style]`))\r\n  } else {\r\n    return `[style={\"fill\": \"${color}\"}]${texts}[/style]`\r\n  }\r\n}\r\n","import { GroupMap } from '../util'\r\n\r\nexport const group = new GroupMap('stage')\r\n","import {\r\n  SpriteComponent,\r\n  TransparentComponent,\r\n  FadeComponent\r\n} from '../../../../engine/components'\r\nimport { group } from './util'\r\n\r\nfunction createCurtain(world, duration, alpha) {\r\n  const entity = world.createEntity()\r\n    .addComponent(SpriteComponent, {\r\n      layer: 'UserLayer10',\r\n      textureId: 'curtain'\r\n    })\r\n  \r\n  if (duration > 0) {\r\n    entity\r\n      .addComponent(TransparentComponent, {\r\n        alpha: 1 - alpha\r\n      })\r\n      .addComponent(FadeComponent, {\r\n        targetId: 'TransparentComponent',\r\n        start: {\r\n          alpha: 1 - alpha\r\n        },\r\n        end: {\r\n          alpha\r\n        },\r\n        duration\r\n      })\r\n  } else {\r\n    entity\r\n      .addComponent(TransparentComponent, {\r\n        alpha\r\n      })\r\n  }\r\n\r\n  return entity\r\n}\r\n\r\nexport function up(duration = 0) {\r\n  function init(world) {\r\n    const entityId = group.get(world, 'curtain')\r\n    if (!entityId) {\r\n      const entity = createCurtain(world, duration, 0)\r\n      group.set(world, 'curtain', entity.id)\r\n      return\r\n    }\r\n\r\n    const entity = world.getEntity(entityId)\r\n    if (entity.hasComponent(FadeComponent)) {\r\n      entity.removeComponent(FadeComponent)\r\n    }\r\n    const Transparent = entity.getComponent(TransparentComponent)\r\n\r\n    if (duration > 0) {\r\n      Transparent.alpha = 1\r\n      entity.addComponent(FadeComponent, {\r\n        targetId: 'TransparentComponent',\r\n        start: {\r\n          alpha: 1\r\n        },\r\n        end: {\r\n          alpha: 0\r\n        },\r\n        duration\r\n      })\r\n    } else {\r\n      Transparent.alpha = 0\r\n    }\r\n  }\r\n\r\n  function process(world) {\r\n    const entityId = group.get(world, 'curtain')\r\n\r\n    if (!entityId) {\r\n      return true\r\n    }\r\n\r\n    const entity = world.getEntity(entityId)\r\n    if (entity.hasComponent(FadeComponent)) {\r\n      return false\r\n    } else {\r\n      group.delete(world, 'curtain')\r\n      world.removeEntity(entity)\r\n      return true\r\n    }\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n\r\nexport function down(duration = 0) {\r\n  function init(world) {\r\n    const entityId = group.get(world, 'curtain')\r\n    if (entityId) {\r\n      return\r\n    }\r\n\r\n    const entity = createCurtain(world, duration, 1)\r\n    group.set(world, 'curtain', entity.id)\r\n  }\r\n\r\n  function process(world) {\r\n    const entityId = group.get(world, 'curtain')\r\n\r\n    if (!entityId) {\r\n      return true\r\n    }\r\n\r\n    const entity = world.getEntity(entityId)\r\n    if (entity.hasComponent(FadeComponent)) {\r\n      return false\r\n    } else {\r\n      return true\r\n    }\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n","import {\r\n  TextComponent,\r\n  TypewriterComponent\r\n} from '../../../../engine/components'\r\nimport { InputComponent } from '../../../components/singleton'\r\nimport { voiceoverStyle } from '../../../config'\r\nimport { group } from './util'\r\n\r\nconst typewriterOptions = {\r\n  speed: 22\r\n}\r\n\r\nfunction createVoiceover(world, text) {\r\n  const entityId = group.get(world, 'voiceover')\r\n  if (entityId) {\r\n    changeVoiceover(world.getEntity(entityId), text)\r\n    return\r\n  }\r\n\r\n  const entity = world.createEntity('voiceover')\r\n    .addComponent(TextComponent, {\r\n      layer: 'UserLayer9',\r\n      style: voiceoverStyle,\r\n      bgTextureId: 'voiceover',\r\n      padding: 22,\r\n      position: {\r\n        x: 'left',\r\n        y: 'center'\r\n      }\r\n    })\r\n    .addComponent(TypewriterComponent, { text, ...typewriterOptions })\r\n  \r\n  group.set(world, 'voiceover', entity.id)\r\n}\r\n\r\nfunction changeVoiceover(entity, text) {\r\n  const Text = entity.getComponent(TextComponent)\r\n  Text.text = ''\r\n\r\n  if (entity.hasComponent(TypewriterComponent)) {\r\n    const Typewriter = entity.getComponent(TypewriterComponent)\r\n    Typewriter.text = text\r\n  } else {\r\n    entity.addComponent(TypewriterComponent, { text, ...typewriterOptions })\r\n  }\r\n}\r\n\r\nexport function show(texts) {\r\n  function init(world) {\r\n    let text\r\n\r\n    if (Array.isArray(texts)) {\r\n      world.systemData.subIndex = 0\r\n      text = texts[0]\r\n      world.systemData.subIndex++\r\n    } else {\r\n      text = texts\r\n    }\r\n    createVoiceover(world, text)\r\n  }\r\n\r\n  function process(world) {\r\n    const entityId = group.get(world, 'voiceover')\r\n    const voiceover = world.getEntity(entityId)\r\n    const input = world.singleton.getComponent(InputComponent)\r\n\r\n    if (input.isClick === false) {\r\n      return false\r\n    }\r\n\r\n    if (voiceover.hasComponent(TypewriterComponent)) {\r\n      const text = voiceover.getComponent(TypewriterComponent).text\r\n      voiceover.getComponent(TextComponent).text = text\r\n      return false\r\n    }\r\n\r\n    if (\r\n      Array.isArray(texts) &&\r\n      world.systemData.subIndex < texts.length\r\n    ) {\r\n      const text = texts[world.systemData.subIndex]\r\n      world.systemData.subIndex++\r\n      changeVoiceover(voiceover, text)\r\n      return false\r\n    } else {\r\n      return true\r\n    }\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n\r\nexport function hide() {\r\n  function process(world) {\r\n    const entityId = group.get(world, 'voiceover')\r\n    if (entityId) {\r\n      const voiceover = world.getEntity(entityId)\r\n      group.delete(world, 'voiceover')\r\n      world.removeEntity(voiceover)\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  return { process }\r\n}\r\n","import { up, down } from './curtain'\r\nimport { show, hide } from './voiceover'\r\n\r\nexport default {\r\n  curtain: { up, down },\r\n  voiceover: { show, hide }\r\n}\r\n","import { InputComponent } from '../../../components/singleton'\r\n\r\nfunction wait(delay) {\r\n  let timer = 0\r\n  function process(world, delta) {\r\n    if (timer >= delay) {\r\n      return true\r\n    } else {\r\n      timer += delta\r\n      return false\r\n    }\r\n  }\r\n\r\n  return { process }\r\n}\r\n\r\nfunction waitClick() {\r\n  function process(world) {\r\n    const input = world.singleton.getComponent(InputComponent)\r\n\r\n    if (input.isClick === false) {\r\n      return false\r\n    } else {\r\n      return true\r\n    }\r\n  }\r\n\r\n  return {\r\n    process\r\n  }\r\n}\r\n\r\nfunction goto(chapter, node) {\r\n  function process() {\r\n    return true\r\n  }\r\n\r\n  function goto() {\r\n    return {\r\n      chapter,\r\n      node\r\n    }\r\n  }\r\n\r\n  return {\r\n    process,\r\n    goto\r\n  }\r\n}\r\n\r\nexport default { wait, waitClick, goto }","import { GroupMap } from '../util'\r\n\r\nexport const group = new GroupMap('scene')\r\n\r\nexport function addTransform(entity, componentClass, start, end, duration) {\r\n  if (entity.hasComponent(componentClass)) {\r\n    entity.removeComponent(componentClass)\r\n  }\r\n\r\n  entity.addComponent(componentClass, {\r\n    start,\r\n    end,\r\n    duration\r\n  })\r\n}\r\n\r\n\r\nexport const fadeIn = {\r\n  render: {\r\n    alpha: 0\r\n  },\r\n  animation: {\r\n    duration: 1000,\r\n    alpha: 1\r\n  }\r\n}\r\n\r\nexport const fadeOut = {\r\n  render: {\r\n    alpha: 1\r\n  },\r\n  animation: {\r\n    duration: 1000,\r\n    alpha: 0\r\n  }\r\n}\r\n\r\nexport const baseShake = {\r\n  amplitude: 10,\r\n  duration: 100\r\n}\r\n","import {\r\n  SpriteComponent,\r\n  TransformComponent,\r\n  TransparentComponent,\r\n  DisplacementComponent,\r\n  FadeComponent\r\n} from '../../../../engine/components'\r\nimport { BackgroundComponent } from '../../../components/tag'\r\nimport { group, addTransform } from './util'\r\n\r\nfunction configOption(options) {\r\n  options = options || {}\r\n\r\n  options.render = {\r\n    alpha: 1,\r\n    ...options.render\r\n  }\r\n\r\n  if (options.animation) {\r\n    options.animation = {\r\n      duration: 1000,\r\n      ...options.animation\r\n    }\r\n  }\r\n\r\n  return options\r\n}\r\n\r\nfunction createEntity(world, id, resource, options) {\r\n  options = configOption(options)\r\n  const entityId = group.get(world, id)\r\n  if (entityId) {\r\n    return\r\n  }\r\n\r\n  const { render, animation } = options\r\n  const entity = world.createEntity(id)\r\n    .addComponent(BackgroundComponent)\r\n    .addComponent(SpriteComponent, {\r\n      layer: 'UserLayer0',\r\n      textureId: resource\r\n    })\r\n    .addComponent(TransformComponent, {\r\n      ...render.position\r\n    })\r\n    .addComponent(TransparentComponent, {\r\n      alpha: render.alpha\r\n    })\r\n\r\n  group.set(world, id, entity.id)\r\n\r\n  if (typeof animation === 'undefined') {\r\n    return\r\n  }\r\n\r\n  const { position, alpha, duration = 1000 } = animation\r\n\r\n  if (position) {\r\n    addTransform(\r\n      entity,\r\n      DisplacementComponent,\r\n      render.position,\r\n      position,\r\n      duration\r\n    )\r\n  }\r\n\r\n  if (typeof alpha === 'number') {\r\n    addTransform(\r\n      entity,\r\n      FadeComponent,\r\n      { alpha: render.alpha },\r\n      { alpha },\r\n      duration\r\n    )\r\n  }\r\n}\r\n\r\nexport function show(id, resource, options) {\r\n  function init(world) {\r\n    createEntity(world, id, resource, options)\r\n  }\r\n\r\n  function process() {\r\n    return true\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n\r\nexport function show_async(id, resource, options) {\r\n  function init(world) {\r\n    createEntity(world, id, resource, options)\r\n  }\r\n\r\n  function process(world) {\r\n    const entityId = group.get(world, id)\r\n    if (entityId) {\r\n      const entity = world.getEntity(entityId)\r\n      if (\r\n        entity.hasComponent(DisplacementComponent) ||\r\n        entity.hasComponent(FadeComponent)\r\n      ) {\r\n        return false\r\n      } else {\r\n        return true\r\n      }\r\n    } else {\r\n      return true\r\n    }\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}","import {\r\n  TransformComponent,\r\n  TransparentComponent,\r\n  DisplacementComponent,\r\n  FadeComponent\r\n} from '../../../../engine/components'\r\nimport { RemoveComponent } from '../../../components/tag'\r\nimport { group, addTransform } from './util'\r\n\r\nfunction configOption(options) {\r\n  options = options || {}\r\n\r\n  if (options.animation) {\r\n    options.animation = {\r\n      duration: 1000,\r\n      ...options.animation\r\n    }\r\n  }\r\n\r\n  return options\r\n}\r\n\r\nfunction getEntity(world, id) {\r\n  const entityId = group.get(world, id)\r\n\r\n  if (!entityId) {\r\n    return null\r\n  }\r\n\r\n  const entity = world.getEntity(entityId)\r\n\r\n  if (!entity) {\r\n    return null\r\n  }\r\n\r\n  return entity\r\n}\r\n\r\nfunction setEntity(world, id, options) {\r\n  options = configOption(options)\r\n  let { render, animation } = options\r\n  const entity = getEntity(world, id)\r\n\r\n  if (entity === null) {\r\n    return\r\n  }\r\n\r\n  const Transform = entity.getComponent(TransformComponent)\r\n  const Transparent = entity.getComponent(TransparentComponent)\r\n\r\n  render = {\r\n    position: {\r\n      x: Transform.x,\r\n      y: Transform.y,\r\n    },\r\n    alpha: Transparent.alpha,\r\n    ...render\r\n  }\r\n\r\n  if (!animation) {\r\n    return\r\n  }\r\n\r\n  const { position, alpha, duration = 1000 } = animation\r\n\r\n  if (position) {\r\n    addTransform(\r\n      entity,\r\n      DisplacementComponent,\r\n      render.position,\r\n      position,\r\n      duration\r\n    )\r\n  }\r\n\r\n  if (typeof alpha === 'number') {\r\n    addTransform(\r\n      entity,\r\n      FadeComponent,\r\n      { alpha: render.alpha },\r\n      { alpha },\r\n      duration\r\n    )\r\n  }\r\n}\r\n\r\nexport function hide(id, options) {\r\n  function init(world) {\r\n    setEntity(world, id, options)\r\n  }\r\n\r\n  function process(world) {\r\n    const entity = getEntity(world, id)\r\n\r\n    if (entity === null) {\r\n      return true\r\n    } else {\r\n      group.delete(world, id)\r\n      entity.addComponent(RemoveComponent)\r\n      return true\r\n    }\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n\r\nexport function hide_async(id, options) {\r\n  function init(world) {\r\n    setEntity(world, id, options)\r\n  }\r\n\r\n  function process(world) {\r\n    const entity = getEntity(world, id)\r\n\r\n    if (entity === null) {\r\n      return true\r\n    } else {\r\n      if (\r\n        entity.hasComponent(DisplacementComponent) ||\r\n        entity.hasComponent(FadeComponent)\r\n      ) {\r\n        return false\r\n      } else {\r\n        group.delete(world, id)\r\n        world.removeEntity(entity)\r\n        return true\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n","import { show, show_async } from './show'\r\nimport { hide, hide_async } from './hide'\r\nimport { shake } from './shake'\r\nimport { fadeIn, fadeOut, baseShake } from './util'\r\n\r\nexport default { show, hide, show_async, hide_async, shake, fadeIn, fadeOut, baseShake }\r\n","import {\r\n  TransformComponent\r\n} from '../../../../engine/components'\r\nimport { group } from './util'\r\n\r\nfunction getEntity(world, id) {\r\n  const entityId = group.get(world, id)\r\n\r\n  if (!entityId) {\r\n    return null\r\n  }\r\n\r\n  const entity = world.getEntity(entityId)\r\n\r\n  if (!entity) {\r\n    return null\r\n  }\r\n\r\n  return entity\r\n}\r\n\r\nexport function shake(id, options) {\r\n  let timer = 0\r\n  options = options || {}\r\n\r\n  function process(world) {\r\n    const { amplitude = 0, duration = 0 } = options\r\n    const entity = getEntity(world, id)\r\n\r\n    if (entity === null) {\r\n      timer = 0\r\n      return true\r\n    } else {\r\n      const Transform = entity.getComponent(TransformComponent)\r\n      if (duration <= timer) {\r\n        Transform.x = 0\r\n        Transform.y = 0\r\n        timer = 0\r\n        return true\r\n      }\r\n      Transform.x = Math.round(Math.random() * amplitude * 2) - amplitude\r\n      Transform.y = Math.round(Math.random() * amplitude * 2) - amplitude\r\n      timer++\r\n      return false\r\n    }\r\n  }\r\n\r\n  return {\r\n    process\r\n  }\r\n}\r\n","import { GroupMap } from '../util'\r\n\r\nexport const group = new GroupMap('dialog')\r\n","import {\r\n  TextComponent,\r\n  TransformComponent,\r\n  TypewriterComponent\r\n} from '../../../../engine/components'\r\nimport { InputComponent } from '../../../components/singleton'\r\nimport { DialogComponent, NameComponent } from '../../../components/tag'\r\nimport { gameInfo, nameStyle, dialogStyle, textBackground } from '../../../config'\r\nimport { group } from './util'\r\n\r\nconst typewriterOptions = {\r\n  speed: 22\r\n}\r\n\r\nfunction createDialog(world, text) {\r\n  const entityId = group.get(world, 'text')\r\n  if (entityId) {\r\n    changeDialog(world.getEntity(entityId), text)\r\n    return\r\n  }\r\n\r\n  const entity = world.createEntity('dialog')\r\n    .addComponent(DialogComponent)\r\n    .addComponent(TextComponent, {\r\n      layer: 'UserLayer8',\r\n      style: dialogStyle,\r\n      bgTextureId: textBackground.dialog.id,\r\n      padding: textBackground.dialog.padding\r\n    })\r\n    .addComponent(TransformComponent, {\r\n      x: 0,\r\n      y: gameInfo.height - textBackground.dialog.height\r\n    })\r\n    .addComponent(TypewriterComponent, { text, ...typewriterOptions })\r\n\r\n  group.set(world, 'text', entity.id)\r\n}\r\n\r\nfunction changeDialog(entity, text) {\r\n  const Text = entity.getComponent(TextComponent)\r\n  Text.text = ''\r\n\r\n  if (entity.hasComponent(TypewriterComponent)) {\r\n    const Typewriter = entity.getComponent(TypewriterComponent)\r\n    Typewriter.text = text\r\n  } else {\r\n    entity.addComponent(TypewriterComponent, { text, ...typewriterOptions })\r\n  }\r\n}\r\n\r\nfunction createName(world, text) {\r\n  const entityId = group.get(world, 'name')\r\n  if (entityId) {\r\n    const Text = world.getEntity(entityId).getComponent(TextComponent)\r\n    Text.text = text\r\n    return\r\n  }\r\n\r\n  const entity = world.createEntity('name')\r\n    .addComponent(TextComponent, {\r\n      layer: 'UserLayer9',\r\n      text,\r\n      style: nameStyle,\r\n      bgTextureId: textBackground.name.id,\r\n      padding: textBackground.name.padding,\r\n      position: {\r\n        x: 'center',\r\n        y: 'center'\r\n      }\r\n    })\r\n    .addComponent(TransformComponent, {\r\n      x: 0,\r\n      y: gameInfo.height - textBackground.name.height - textBackground.dialog.height\r\n    })\r\n    .addComponent(NameComponent)\r\n\r\n  group.set(world, 'name', entity.id)\r\n}\r\n\r\nfunction removeName(world) {\r\n  const entityId = group.get(world, 'name')\r\n  if (entityId) {\r\n    const name = world.getEntity(entityId)\r\n    world.removeEntity(name)\r\n    group.delete(world, 'name')\r\n  }\r\n}\r\n\r\nexport function show(texts, name) {\r\n  function init(world) {\r\n    let text\r\n\r\n    if (Array.isArray(texts)) {\r\n      world.systemData.subIndex = 0\r\n      text = texts[0]\r\n      world.systemData.subIndex++\r\n    } else {\r\n      text = texts\r\n    }\r\n    createDialog(world, text)\r\n\r\n    if (name) {\r\n      createName(world, name)\r\n    } else {\r\n      removeName(world)\r\n    }\r\n  }\r\n\r\n  function process(world) {\r\n    const dialog = world.getEntity(group.get(world, 'text'))\r\n    const input = world.singleton.getComponent(InputComponent)\r\n\r\n    if (input.isClick === false) {\r\n      return false\r\n    }\r\n\r\n    if (dialog.hasComponent(TypewriterComponent)) {\r\n      const text = dialog.getComponent(TypewriterComponent).text\r\n      dialog.getComponent(TextComponent).text = text\r\n      dialog.removeComponent(TypewriterComponent)\r\n      return false\r\n    }\r\n\r\n    if (\r\n      Array.isArray(texts) &&\r\n      world.systemData.subIndex < texts.length\r\n    ) {\r\n      const text = texts[world.systemData.subIndex]\r\n      world.systemData.subIndex++\r\n      changeDialog(dialog, text)\r\n      return false\r\n    } else {\r\n      return true\r\n    }\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n","import { show } from './show'\r\nimport { hide } from './hide'\r\n\r\nexport default { show, hide }\r\n","import { group } from './util'\r\n\r\nexport function hide() {\r\n  function process(world) {\r\n    let entityId = group.get(world, 'text')\r\n    if (entityId) {\r\n      const dialog = world.getEntity(entityId)\r\n      group.delete(world, 'text')\r\n      world.removeEntity(dialog)\r\n    }\r\n\r\n    entityId = group.get(world, 'name')\r\n    if (entityId) {\r\n      const name = world.getEntity(entityId)\r\n      group.delete(world, 'name')\r\n      world.removeEntity(name)\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  return { process }\r\n}\r\n","import {\r\n  SpriteComponent,\r\n  AnimationComponent,\r\n  TransformComponent\r\n} from '../../../../engine/components'\r\nimport { CharacterComponent } from '../../../components/tag'\r\nimport { GroupMap } from '../util'\r\n\r\nexport const group = new GroupMap('character')\r\n\r\nexport function createComponent(world, component) {\r\n  const entity = world.createEntity()\r\n    .addComponent(CharacterComponent)\r\n    .addComponent(TransformComponent, {\r\n      x: component.x,\r\n      y: component.y\r\n    })\r\n\r\n  if (Array.isArray(component.res)) {\r\n    entity.addComponent(AnimationComponent, {\r\n      layer: `UserLayer${component.layer + 2}`,\r\n      texturesId: component.res,\r\n      cycle: 5000,\r\n      animationSpeed: 0.2\r\n    })\r\n  } else {\r\n    entity.addComponent(SpriteComponent, {\r\n      layer: `UserLayer${component.layer + 2}`,\r\n      textureId: component.res\r\n    })\r\n  }\r\n\r\n  return entity\r\n}\r\n","import { eyes, mouth, head, body, hand } from './component'\r\n\r\nexport const xing_nai1 = [\r\n  eyes['1001_e'],\r\n  mouth['1001_m-01'],\r\n  body['1001_b'],\r\n  head['1001_he'],\r\n  hand['1001_ha'],\r\n  hand['1002_ha']\r\n]\r\n","import { GroupMap } from '../util'\r\n\r\nexport const group = new GroupMap('choice')\r\n","import { select } from './select'\r\nexport default { select }\r\n","import { GroupMap } from '../util'\r\n\r\nexport const group = new GroupMap('bgm')\r\n","import { SoundComponent } from '../../../../engine/components'\r\nimport { BGMComponent } from '../../../components/tag'\r\nimport { group } from './util'\r\n\r\nfunction play(alias, options) {\r\n  options = options || {}\r\n\r\n  function init(world) {\r\n    const entityId = group.get(world, alias)\r\n\r\n    if (entityId) {\r\n      return\r\n    }\r\n\r\n    const entity = world.createEntity()\r\n      .addComponent(BGMComponent)\r\n      .addComponent(SoundComponent, {\r\n        alias,\r\n        options\r\n      })\r\n\r\n    group.set(world, alias, entity.id)\r\n  }\r\n\r\n  function process() {\r\n    return true\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n\r\nfunction stop(alias) {\r\n  function init(world) {\r\n    const entityId = group.get(world, alias)\r\n\r\n    if (entityId) {\r\n      const entity = world.getEntity(entityId)\r\n      const Sound = entity.getComponent(SoundComponent)\r\n      Sound.isPlaying = false\r\n      group.delete(world, alias)\r\n    }\r\n  }\r\n\r\n  function process() {\r\n    return true\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n\r\nexport default {\r\n  play,\r\n  stop\r\n}\r\n","import { colorText } from './util'\r\n\r\nexport { default as stage } from './stage'\r\nexport { default as flow } from './flow'\r\nexport { default as scene } from './scene'\r\nexport { default as dialog } from './dialog'\r\nexport { default as character } from './character'\r\nexport { default as choice } from './choice'\r\nexport { default as bgm } from './bgm'\r\nexport const util = {\r\n  colorText\r\n}\r\n","import { bgm, stage, scene, dialog, choice, character, flow, util } from './api'\r\nimport { eyes, body, color } from '../config'\r\n\r\nconst chapter1 = [\r\n  stage.voiceover.show([\r\n    ...util.colorText(\r\n      [\r\n        '我始终认为，人生就像一幅复杂的拼图，每个人总有属于自己的回忆碎片。',\r\n        '总是在不自觉的当下，一片片平凑着，直到看见事件的原始轮廓',\r\n        '自从那次旅行，即使到现在，我的脑海里仍深深烙印着那年夏天的艳阳、海风，以及……',\r\n        '你的微笑……'\r\n      ],\r\n      color.lightskyblue\r\n    ),\r\n    util.colorText('第一章    《 邂 逅 》', color.burlywood),\r\n    util.colorText('海边', color.deepskyblue)\r\n  ]),\r\n  stage.curtain.down(500),\r\n  stage.voiceover.hide(),\r\n  scene.show('hai_bian_d', 'map01001'),\r\n  stage.curtain.up(500),\r\n\r\n  bgm.play('shopping', {\r\n    loop: true\r\n  }),\r\n\r\n  dialog.show(\r\n    [\r\n      '哇！好刺眼的太阳啊！坐了那么久的车，终于到达海风镇啦！',\r\n      '哦！是海耶！凉爽的海风……哇……心情都好了起来啊……',\r\n      '真不愧是每年举办音浪祭的专属地点啊……',\r\n      '……\\n这么漂亮的景色……她看到也会很开心的吧……',\r\n      '虽然我们约好要在这边会和……但是她……',\r\n      '唉……有事耽搁了，也是没办法的事啊……'\r\n    ],\r\n    '? ? ?'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '我，以翔，一个平凡的大一生。',\r\n        '努力打工了这么久，总算存到了这趟来海风镇的旅费……',\r\n        '虽然很辛苦……',\r\n        '但是，这是我必须为她做的……',\r\n        '补偿吧……'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '彩虹天堂民宿应该离这没多远吧……',\r\n      '记得民宿的人说……下车后步行五百公尺，看到小吃店再左转三百公尺，穿过帆船公园之后再往右走一百公尺就到了……',\r\n      '……\\n还……还真不是普通的近哈……'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '阳光穿过云层，照射在阵雨过后还有些滋润的公路上。路上一大滩雨后的积水，正一点一滴因为热度而蒸发。',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '看这里也不像有计程车经过的样子……',\r\n      '好吧！只好走到民宿去了，顺便欣赏海风镇的海景也很不错啊！'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '我振奋精神，绕过脚边雨后残留的水坑，沿着路旁青翠的草地，迈开脚步准备往前走时……',\r\n        '噗呲~'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  scene.shake('hai_bian_d', scene.baseShake),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '一辆车子从我身旁呼啸而过，狠狠碾过我刻意避开的积水，我连忙往旁边的草地一跳，试图闪过溅起的水花。',\r\n        '但是我毕竟不是练就飞檐走壁轻功的武林高手。溅起的水花飞快地袭击了我的下半身。'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '哇啊！这……这车子怎么搞的！？这可是我为了这次旅行新买的海滩裤啊……！！',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '我低头看着惨遭“海啸”洗礼的裤子，水还意犹未尽地在裤管边缘往下滴。',\r\n        '而被水花溅透的地方，湿的有些巧妙……让我看起来活像个尿失禁的家伙……',\r\n        '这时，脚下除了柔软的草地之外，还有另一种奇怪的触感……该……该不会……',\r\n        '我紧张地缓缓抬起脚，忽然觉得脚踝沉重了起来……'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n\r\n  bgm.stop('shopping'),\r\n  bgm.play('funny', {\r\n    loop: true\r\n  }),\r\n\r\n  dialog.show(\r\n    '呃啊！',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '我抬起脚底，一坨热呼呼湿黏黏的动物排泄物，正对着我的海滩鞋死缠烂打地做亲密接触……',\r\n        '其间还有金黄灿烂的玉米粒娇羞地瑟缩在我的鞋底缝隙间……',\r\n        '我急忙就着人行道的台阶疯狂地蹭着鞋子……'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '哇啊！气死我了！',\r\n      '离民宿到底有多远啊……！？',\r\n      '方圆百里居然看不到什么商家……'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '这……这是地狱吗……！？我该不会糊里糊涂搭上通往地狱入口的班车吧？！',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '哎……想不到刚下车就遇到这些事情，真不知道后面还会有什么事在等着我……',\r\n      '如果……如果……她在的话，想必会笑我像个笨蛋吧……'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '我的脑海中不自觉浮现她的笑脸，温柔的笑声仿佛就在我的耳边回荡着……',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '……\\n是啊，计划这次旅行的目的不就是为了她吗……？',\r\n      '为了……弥补那道……裂痕……不是吗……？'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '想到这里，我收回一直蹭在阶梯上的脚，假装忘记半颗缩在鞋底的玉米粒与双腿间湿黏的闷热感……',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '看来，只好走一步算一步了。',\r\n      '反正船到桥头自然直吧！'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '揉揉鼻子，我再次拉紧背包，继续往前走去。',\r\n        '暗暗期待可以让我换下这身狼狈的地方，会出现在一个转角……'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n\r\n  stage.curtain.down(500),\r\n  dialog.hide(),\r\n  scene.hide('hai_bian_d'),\r\n  bgm.stop('funny'),\r\n  scene.show('voiceover', 'voiceover'),\r\n  stage.curtain.up(500),\r\n\r\n  stage.voiceover.show(\r\n    util.colorText('帆船公园', color.deepskyblue)\r\n  ),\r\n\r\n  stage.curtain.down(500),\r\n  stage.voiceover.hide(),\r\n  scene.hide('voiceover'),\r\n  scene.show('gong_yuan', 'map01008'),\r\n  stage.curtain.up(500),\r\n\r\n  bgm.play('shopping', {\r\n    loop: true\r\n  }),\r\n\r\n  dialog.show(\r\n    [\r\n      '这海风镇的规划也太好了吧？走到这里竟然周围连一家商店都没有……',\r\n      '民宿快到了吧！？总觉得路程比民宿的人说得还远……',\r\n      '好想快点换衣服啊……'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '我有些绝望地在心里呐喊着，从重要部位传来的闷热感，已经把我逼到悬崖的边缘.世界的尽头.神明的故乡……',\r\n        '简单的说就是“极限”啦……'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '嗯？那不是……',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '是……是上天听到我的求救吗……？',\r\n        '我看见离步道距离不远的树叶中，有个水龙头因为阳光照射，辉映着柔和的金属光泽。'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '啊……这是……是神迹吧！太……太令人感动了……！',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '现在回想起来，那个水龙头对当时的我来说，简直是……',\r\n        '神的礼物啊！！'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '太好了！我终于得到救赎了！',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '我感动不已地扭开水龙头，冰凉的水流在掌心聚集成一池迷人的水波。接着心存感激的一仰而尽，让泉水顺着食道，将体内的热气一扫而空。',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '哇啊……好舒服啊……这水有种甘甜的味道呢……',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '我贪婪地喝着，甚至奢侈地大把大把泼在脸上、手上、以及脚上，顺道将鞋上残留的不净之物给清理干净。',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '对不起，玉米粒，我想我们不合适，你还是走吧……',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    '……',\r\n    '玉米粒'\r\n  ),\r\n\r\n  // dialog.hide(),\r\n  // flow.wait(500),\r\n\r\n  // character.show('xingnai', 'xing_nai1'),\r\n  // choice.select(['海风公园', '海神神社']),\r\n  // stage.curtain.down(1000),\r\n  // character.update('xingnai', 0, eyes['1002_e']),\r\n  // character.update('xingnai', 2, body['1002_b']),\r\n  // stage.curtain.up(1000)\r\n]\r\n\r\nconsole.log('chapter1 length:', chapter1.length)\r\n\r\nexport default chapter1\r\n","import chapter1 from './chapter1'\r\n\r\nexport default {\r\n  chapter1\r\n}\r\n","import { Scene } from '../../../engine/render'\r\nimport {\r\n  PIXIRenderSystem,\r\n  AnimationSystem,\r\n  TypewriterSystem,\r\n  TextButtonSystem,\r\n  TransformSystem,\r\n  TextUpdateSystem,\r\n  SoundSystem\r\n} from '../../../engine/systems'\r\nimport {\r\n  InputSystem,\r\n  StorySystem,\r\n  RemoveSystem\r\n} from '../../systems'\r\nimport {\r\n  InputComponent,\r\n  // StoryComponent\r\n} from '../../components/singleton'\r\n\r\nimport story from '../../story'\r\n\r\nexport class Main {\r\n  constructor(game) {\r\n    this.game = game\r\n    this.world = null\r\n    this.view = null\r\n\r\n    this.systemData = null\r\n    this.storyData = null\r\n\r\n    this.init()\r\n  }\r\n\r\n  init() {\r\n    this._initData()\r\n    this._initWorldModule()\r\n    this.world.start()\r\n  }\r\n\r\n  saveArchive() {\r\n    return this.world.serialize()\r\n  }\r\n\r\n  loadArchive(data) {\r\n    this.world.deserialize(data)\r\n  }\r\n\r\n  _initData() {\r\n    this.systemData = {\r\n      entities: {},\r\n      chapter: 'chapter1',\r\n      initialed: false,\r\n      nodeIndex: 0,\r\n      subIndex: 0\r\n    }\r\n    this.storyData = {}\r\n  }\r\n\r\n  _initWorldModule() {\r\n    this.world = new Scene()\r\n    this.world.interaction = this.game.renderer.plugins.interaction\r\n    this.world.storyScript = story\r\n    this.world.storyData = this.storyData\r\n    this.world.systemData = this.systemData\r\n    this.view = this.world.view\r\n    window.world = this.world\r\n\r\n    this.world\r\n      .registerSystem(InputSystem)\r\n      .registerSystem(StorySystem)\r\n      .registerSystem(TypewriterSystem)\r\n      .registerSystem(TextButtonSystem)\r\n      .registerSystem(AnimationSystem)\r\n      .registerSystem(TransformSystem)\r\n      .registerSystem(TextUpdateSystem)\r\n      .registerSystem(SoundSystem)\r\n      .registerSystem(RemoveSystem)\r\n      .registerSystem(PIXIRenderSystem)\r\n\r\n    this.world.singleton\r\n      .addComponent(InputComponent)\r\n      // .addComponent(StoryComponent, {\r\n      //   curChapter: 'chapter1',\r\n      // })\r\n  }\r\n\r\n  update(delta) {\r\n    this.world.execute(delta)\r\n  }\r\n\r\n  stats(stats) {\r\n    stats.entity.update(this.world.stats().overview.numEntities, 30)\r\n  }\r\n}\r\n","import * as PIXI from 'pixi.js'\r\n\r\nexport class Cutscenes{\r\n  constructor() {\r\n    this.view = new PIXI.Container()\r\n  }\r\n\r\n  update() {}\r\n}\r\n","import Stats from 'stats.js'\r\nimport { Signal } from 'signals'\r\nimport Loader from '../engine/loader'\r\nimport { Renderer } from '../engine/render'\r\nimport { InteractionManager } from '../engine/render/plugins'\r\nimport { gameInfo, assetRootUrl, assets } from './config'\r\nimport { Sound } from '../engine/sound'\r\nimport { CutscenesScene } from './scene'\r\n\r\nRenderer.registerPlugin('interaction', InteractionManager)\r\n\r\nclass Game {\r\n  constructor(title) {\r\n    this.title = title\r\n\r\n    this.scale = 1\r\n    this.renderer = null\r\n\r\n    this.loader = new Loader(assetRootUrl)\r\n\r\n    this.cutscenes = new CutscenesScene(this)\r\n\r\n    this.prevScene = null\r\n    this.curScene = null\r\n    this.show = null\r\n\r\n    this.isPlay = true\r\n    this.updated = new Signal()\r\n\r\n    this.stats = new Stats()\r\n    this.stats.added = false\r\n    this.stats.entity = this.stats.addPanel( new Stats.Panel( 'ENTITY', '#ff8', '#221' ) )\r\n    this.stats.showPanel(0) // 0: fps, 1: ms, 2: mb, 3+: custom\r\n\r\n    this.init()\r\n  }\r\n\r\n  init() {\r\n    if (process.env.NODE_ENV === 'development') {\r\n      this.addStats()\r\n    }\r\n    this._initSoundModule()\r\n    this._initRenderModule()\r\n  }\r\n\r\n  load() {\r\n    return this.loader.load(assets)\r\n  }\r\n\r\n  addStats() {\r\n    if (!this.stats.added) {\r\n      document.body.appendChild(this.stats.dom)\r\n      this.stats.added = true\r\n    }\r\n  }\r\n\r\n  removeStats() {\r\n    if (this.stats.added) {\r\n      document.body.removeChild(this.stats.dom)\r\n      this.stats.added = false\r\n    }\r\n  }\r\n\r\n  _initSoundModule() {\r\n    Sound.loadState()\r\n  }\r\n\r\n  _initRenderModule() {\r\n    const resolution = window.devicePixelRatio || 1\r\n    const width = gameInfo.width\r\n    const height = gameInfo.height\r\n\r\n    this.renderer = new Renderer({\r\n      width,\r\n      height,\r\n      resolution\r\n    })\r\n  }\r\n\r\n  to(sceneClass) {\r\n    Sound.stopAll()\r\n    const scene = new sceneClass(this)\r\n    return this._cutscenesWait(scene)\r\n  }\r\n\r\n  break() {\r\n    if (this.prevScene) {\r\n      Sound.stopAll()\r\n      return this._cutscenesWait(this.prevScene)\r\n    } else {\r\n      return Promise.resolve()\r\n    }\r\n  }\r\n\r\n  _cutscenesWait(scene) {\r\n    this.updated.addOnce(() => {\r\n      this.show = this.cutscenes\r\n    })\r\n    const cutscenesWait = new Promise(resolve => {\r\n      if (scene.load) {\r\n        // 在这里可以做些类似加载的事\r\n        scene.load().then(resolve)\r\n      } else {\r\n        // 否则就停一下然后切换场景\r\n        setTimeout(resolve, 150)\r\n      }\r\n    })\r\n    cutscenesWait.then(() => {\r\n      this.updated.addOnce(() => {\r\n        this._changeScene(scene)\r\n      })\r\n    })\r\n    return cutscenesWait\r\n  }\r\n\r\n  start(sceneClass) {\r\n    if (sceneClass) {\r\n      const scene = new sceneClass(this)\r\n      this._changeScene(scene)\r\n    }\r\n    requestAnimationFrame(this._update)\r\n  }\r\n\r\n  pause() {\r\n    this.isPlay = false\r\n  }\r\n\r\n  resume() {\r\n    this.isPlay = true\r\n  }\r\n\r\n  _changeScene(scene) {\r\n    this.prevScene = this.curScene\r\n    this.curScene = scene\r\n    this.show = scene\r\n    this._setSceneScale()\r\n  }\r\n\r\n  _update = delta => {\r\n    this.stats.begin()\r\n    if (this.show && this.isPlay) {\r\n      this.show.update && this.show.update(delta)\r\n      this.renderer.render(this.show.view)\r\n    }\r\n    this.updated.dispatch(this)\r\n    this.stats.end()\r\n    if (this.curScene.stats) {\r\n      this.curScene.stats(this.stats)\r\n    } else {\r\n      this.stats.entity.update(0, 30)\r\n    }\r\n    requestAnimationFrame(this._update)\r\n  }\r\n\r\n  saveArchive() {\r\n    return new Promise(resolve => {\r\n      this.updated.addOnce(() => {\r\n        if (this.curScene.saveArchive) {\r\n          const data = this.curScene.saveArchive()\r\n          console.log(data)\r\n        }\r\n        resolve()\r\n      })\r\n    })\r\n  }\r\n\r\n  loadArchive() {\r\n    return new Promise(resolve => {\r\n      this.updated.addOnce(() => {\r\n        if (this.curScene.loadArchive) {\r\n          const data = '{}'\r\n          this.curScene.loadArchive(data)\r\n          console.log(data)\r\n        }\r\n        resolve()\r\n      })\r\n    })\r\n  }\r\n\r\n  resize = () => {\r\n    this._updateRenderScale()\r\n    this._setSceneScale()\r\n  }\r\n\r\n  _updateRenderScale() {\r\n    const windowWidth = window.innerWidth\r\n    const windowHeight = window.innerHeight\r\n\r\n    if (\r\n      windowWidth < gameInfo.width ||\r\n      windowHeight < gameInfo.height\r\n    ) {\r\n      this.scale = Math.min(\r\n        windowWidth / gameInfo.width,\r\n        windowHeight / gameInfo.height\r\n      )\r\n    }\r\n\r\n    console.log('renderScale: ', this.scale)\r\n    this.renderer.resize(\r\n      gameInfo.width * this.scale,\r\n      gameInfo.height * this.scale\r\n    )\r\n  }\r\n\r\n  _setSceneScale() {\r\n    if (this.show) {\r\n      this.show.view.scale.set(this.scale)\r\n    }\r\n  }\r\n}\r\n\r\nconst game = new Game('love-memory')\r\n\r\nexport default game\r\n","import React from 'react'\r\nimport './index.css'\r\n\r\nimport Loader from '../loader'\r\nimport MenuIcon from '../menu-icon'\r\nimport MenuLayout from '../menu-layout'\r\nimport Config from '../config'\r\nimport About from '../about'\r\n\r\nimport SaveDialog from '../dialog/save'\r\nimport WarningDialog from '../dialog/warning'\r\nimport '../dialog/index.css'\r\n\r\nimport game from '../../game'\r\nimport { TitleScene, MainScene } from '../../game/scene'\r\n\r\nclass LoveMemory extends React.Component {\r\n  constructor() {\r\n    super()\r\n    this.loadError = false\r\n    this.loader = React.createRef()\r\n    this.canvas = React.createRef()\r\n    this.state = {\r\n      show: 0,\r\n      menu: false,\r\n      loader: {\r\n        loading: true,\r\n        progress: 0,\r\n        error: null\r\n      },\r\n      width: 0,\r\n      height: 0,\r\n      dialog: 0, // 1: save dialog; 2: warning dialog\r\n      dialogStatus: ''\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.resize()\r\n    this.addEvents()\r\n    game.load().then(\r\n      () => {\r\n        // 让 loading 动画缓缓先\r\n        setTimeout(() => {\r\n          this.setState({\r\n            loader: {\r\n              ...this.state.loader,\r\n              loading: false\r\n            }\r\n          }, () => {\r\n            // show\r\n            game.start(TitleScene)\r\n            this.clickStartHandle()\r\n            game.renderer.view.style.opacity = 1\r\n          })\r\n        }, 1000)\r\n      },\r\n      error => {\r\n        console.warn(error)\r\n        this.loadError = true\r\n        this.loader.current.detailsHandle()\r\n        this.setState({\r\n          loader: {\r\n            ...this.state.loader,\r\n            error\r\n          }\r\n        })\r\n      }\r\n    )\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.removeEvents()\r\n  }\r\n\r\n  addEvents() {\r\n    this.canvas.current.appendChild(game.renderer.view)\r\n\r\n    window.addEventListener('resize', this.resize)\r\n\r\n    game.loader.onProgressed.add(this.progressHandle)\r\n\r\n    TitleScene.onStartClicked.add(this.clickStartHandle)\r\n    TitleScene.onSettingClicked.add(this.clickSettingHandle)\r\n    TitleScene.onAboutClicked.add(this.clickAboutHandle)\r\n  }\r\n\r\n  removeEvents() {\r\n    window.removeEventListener('resize', this.resize)\r\n\r\n    game.loader.onProgressed.remove(this.progressHandle)\r\n\r\n    TitleScene.onStartClicked.remove(this.clickStartHandle)\r\n    TitleScene.onSettingClicked.remove(this.clickSettingHandle)\r\n    TitleScene.onAboutClicked.remove(this.clickAboutHandle)\r\n  }\r\n\r\n  resize = () => {\r\n    game.resize()\r\n    this.setState({\r\n      width: game.renderer.view.style.width,\r\n      height: game.renderer.view.style.height\r\n    })\r\n  }\r\n\r\n  progressHandle = (progress) => {\r\n    if (this.loadError) {\r\n      return\r\n    }\r\n    progress = Math.ceil(progress)\r\n    const prevProgress = this.state.loader.progress\r\n    const offset = progress - prevProgress\r\n\r\n    if (offset >= 20 || progress >= 100) {\r\n      this.setState({\r\n        loader: {\r\n          ...this.state.loader,\r\n          progress\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  clickStartHandle = () => {\r\n    game.to(MainScene).then(() => {\r\n      this.setState({\r\n        menu: true\r\n      })\r\n    })\r\n  }\r\n\r\n  clickSettingHandle = () => {\r\n    this.setState({\r\n      show: 1\r\n    })\r\n  }\r\n\r\n  clickAboutHandle = () => {\r\n    this.setState({\r\n      show: 2\r\n    })\r\n  }\r\n\r\n  openMenuHandle = () => {\r\n    this.setState({\r\n      show: 3\r\n    })\r\n  }\r\n\r\n  closeMenuHandle = () => {\r\n    this.setState({\r\n      show: 0\r\n    })\r\n  }\r\n\r\n  togglePanelHandle = () => {\r\n    const added = game.stats.added\r\n    if (added) {\r\n      game.removeStats()\r\n    } else {\r\n      game.addStats()\r\n    }\r\n  }\r\n\r\n  closeDialogHandle = () => {\r\n    this.setState({\r\n      dialog: 0\r\n    })\r\n  }\r\n\r\n  saveHandle = () => {\r\n    this.setState({\r\n      dialog: 1,\r\n      dialogStatus: 'saving'\r\n    })\r\n    game.saveArchive().then(() => {\r\n      setTimeout(() => {\r\n        this.setState({\r\n          dialogStatus: 'saved'\r\n        })\r\n      }, 500)\r\n    })\r\n  }\r\n\r\n  loadHandle = () => {\r\n    // game.loadArchive()\r\n  }\r\n\r\n  getArchive = () => {\r\n\r\n  }\r\n\r\n  breakTitleHandle = () => {\r\n    this.setState({\r\n      dialog: 2\r\n    })\r\n  }\r\n\r\n  confirmWarnHandle = () => {\r\n    game.to(TitleScene).then(() => {\r\n      this.setState({\r\n        dialog: 0\r\n      })\r\n      // 因为 dialog 有个 200ms 的动画，所以这里延迟 200ms\r\n      setTimeout(() => {\r\n        this.setState({\r\n          show: 0,\r\n          menu: false\r\n        })\r\n      }, 200)\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const { show, menu, width, height, loader } = this.state\r\n    const style = {\r\n      width,\r\n      height\r\n    }\r\n\r\n    if (show > 0) {\r\n      game.pause()\r\n    } else if (game.isPlay === false) {\r\n      game.resume()\r\n    }\r\n\r\n    return (\r\n      <>\r\n        <div className=\"love-memory\" style={style}>\r\n          <Loader ref={this.loader} loader={loader} />\r\n          {menu && (\r\n            <div className=\"menu-icon-wrapper\">\r\n              <MenuIcon onClick={this.openMenuHandle} />\r\n            </div>\r\n          )}\r\n          <MenuLayout show={show} onClose={this.closeMenuHandle}>\r\n            {(show === 1 || show === 3) && (\r\n              <Config\r\n                show={show}\r\n                onPanel={this.togglePanelHandle}\r\n                onSave={this.saveHandle}\r\n                onLoad={this.loadHandle}\r\n                onBreak={this.breakTitleHandle}\r\n                getArchive={this.getArchive}\r\n              />\r\n            )}\r\n            {show === 2 && <About />}\r\n          </MenuLayout>\r\n          <div ref={this.canvas}></div>\r\n        </div>\r\n        <SaveDialog\r\n          isOpen={this.state.dialog === 1}\r\n          status={this.state.dialogStatus}\r\n          onClose={this.closeDialogHandle}\r\n        />\r\n        <WarningDialog\r\n          isOpen={this.state.dialog === 2}\r\n          onConfirm={this.confirmWarnHandle}\r\n          onClose={this.closeDialogHandle}\r\n        />\r\n      </>\r\n    )\r\n  }\r\n}\r\n\r\nexport default LoveMemory\r\n","import React from 'react'\r\nimport LoveMemory from './components/love-memory'\r\n\r\nconst gameStyle = {\r\n  position: 'absolute',\r\n  top: 0,\r\n  left: 0,\r\n  right: 0,\r\n  bottom: 0,\r\n  display: 'flex',\r\n  justifyContent: 'center',\r\n  alignItems: 'center'\r\n}\r\n\r\nconst style = {\r\n  display: 'flex',\r\n  alignItems: 'center',\r\n  height: '100%',\r\n  maxWidth: 480,\r\n  maxHeight: 853,\r\n  background: 'black'\r\n}\r\n\r\nfunction App() {\r\n  return (\r\n    <div style={gameStyle}>\r\n      <div style={style}>\r\n        <LoveMemory />\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default App\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport App from './root'\r\nimport * as serviceWorker from './serviceWorker'\r\n\r\nimport 'normalize.css'\r\nimport './style/font.css'\r\nimport './style/index.css'\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n)\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister()\r\n"],"sourceRoot":""}