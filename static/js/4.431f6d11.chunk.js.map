{"version":3,"sources":["components/loader/index.jsx","components/menu-icon/index.jsx","components/menu-layout/header.jsx","components/menu-layout/index.jsx","components/config/item.jsx","components/hexagon-button/index.jsx","components/switch/index.jsx","components/config/volume.jsx","engine/utils/index.ts","engine/sound/sound.ts","components/config/index.jsx","components/about/card.jsx","game/config/stage.js","game/config/about.js","game/config/asset.js","game/config/text.js","game/config/character/component.js","game/config/color.js","components/about/index.jsx","components/dialog/save.jsx","components/dialog/warning.jsx","engine/loader/index.ts","engine/render/renderer.ts","engine/core/object-pool.ts","engine/core/component.ts","engine/core/utils.ts","engine/core/entity.ts","engine/core/entity-query.ts","engine/core/entity-manager.ts","engine/core/system.ts","engine/core/system-manager.ts","engine/core/world.ts","engine/render/stage.ts","engine/render/scene.ts","engine/render/plugins/interaction/InteractionData.ts","engine/render/plugins/interaction/InteractionManager.ts","game/scene/title/flower.js","game/scene/title/index.js","engine/components/base/render.ts","engine/components/sprite.ts","engine/components/animation.ts","engine/lib/rainbow-text/rainbow-text.js","engine/components/text.ts","engine/components/typewriter.ts","engine/components/button.ts","engine/components/transform.ts","engine/components/transparent.ts","engine/components/sound.ts","engine/components/displacement.ts","engine/components/fade.ts","engine/systems/pixi-render.ts","engine/systems/text-update.ts","engine/systems/animation.ts","engine/systems/typewriter.ts","engine/systems/text-button.ts","engine/systems/transform.ts","engine/systems/sound.ts","game/components/singleton/input.js","game/components/singleton/story.js","game/systems/input.js","game/systems/story.js","game/components/tag/index.js","game/systems/remove.js","game/story/api/util.js","game/story/api/stage/util.js","game/story/api/stage/curtain.js","game/story/api/stage/voiceover.js","game/story/api/stage/index.js","game/story/api/flow/index.js","game/story/api/scene/util.js","game/story/api/scene/show.js","game/story/api/scene/hide.js","game/story/api/scene/index.js","game/story/api/scene/shake.js","game/story/api/dialog/util.js","game/story/api/dialog/show.js","game/story/api/dialog/index.js","game/story/api/dialog/hide.js","game/story/api/character/util.js","game/config/character/index.js","game/story/api/character/show.js","game/story/api/character/index.js","game/story/api/character/hide.js","game/story/api/character/update.js","game/story/api/choice/util.js","game/story/api/choice/index.js","game/story/api/bgm/util.js","game/story/api/bgm/index.js","game/story/api/index.js","game/story/chapter1.js","game/story/index.js","game/scene/main/index.js","game/scene/cutscenes/index.js","game/index.js","components/love-memory/index.jsx"],"names":["Loader","detailsHandle","setState","show","state","this","props","loader","loading","progress","error","style","className","display","width","color","onClick","React","Component","MenuIcon","e","Header","version","MenuLayout","children","onClose","Item","name","HexagonButton","Switch","checked","onChange","type","input","target","sliderStyle","position","touchAction","Volume","value","domain","mode","step","rootStyle","values","getRailProps","handles","getHandleProps","map","handle","key","id","right","tracks","getTrackProps","source","railOuterStyle","height","transform","borderRadius","cursor","railInnerStyle","pointerEvents","backgroundColor","SliderRail","Handle","min","max","percent","disabled","left","WebkitTapHighlightColor","zIndex","role","aria-valuemin","aria-valuemax","aria-valuenow","boxShadow","Track","saveToLocalStorage","storageKey","data","localStorage","setItem","loadFromLocalStorage","force","getItem","console","warn","utf8","parse","toString","Sound","alias","sound","find","options","play","stop","stopAll","muted","muteAll","unmuteAll","volume","JSON","stringify","mute","volumeAll","isPlaying","Config","switchHandle","unmute","saveState","volumeHandle","exportHandle","textarea","current","getArchive","selectAllHandle","select","createRef","onPanel","onSave","onLoad","onBack","ref","PureComponent","Card","item","title","url","content","href","rel","stageInfo","about","assets","onComplete","soundMiddleware","resource","singleInstance","baseSrtle","fontFamily","fontWeight","fontSize","lineJoin","fill","stroke","strokeThickness","startMenuStyle","voiceoverStyle","nameStyle","dialogStyle","background","padding","eyes","res","layer","x","y","mouth","head","body","hand","About","SaveDialog","isOpen","status","closeTimeoutMS","ariaHideApp","contentLabel","overlay","justifyContent","alignItems","margin","WarningDialog","onConfirm","lineHeight","textAlign","paddingTop","paddingLeft","baseUrl","concurrency","loaded","onProgressed","onCompleted","PIXI","Signal","Promise","resolve","resources","add","on","_onProgress","bind","_onComplete","reject","_onError","load","_onLoad","dispatch","reset","Renderer","pluginKey","renderer","plugins","antialias","interaction","autoPreventDefault","view","render","autoDensity","resize","pluginClass","ObjectPool","ObjectClass","freed","capacity","size","pool","pools","get","undefined","set","clear","delete","length","expand","pop","push","count","Math","round","i","componentRegister","IComponent","_componentClassMap","has","_id","_isRegister","_pools","of","WeakMap","entity","componentClass","component","acquire","_setProps","init","onComponentCreated","onComponentDestroyed","release","components","forEach","totalSize","free","totalFree","used","totalUsed","_isComponent","Map","now","window","performance","Date","Entity","d","getTime","replace","c","r","random","floor","generateUUID","isSingleton","_world","_components","onComponentChanged","removeAllComponent","Error","hasComponent","componentClassList","verifyComponent","create","destory","class","json","componentClassMap","classId","addComponent","world","_pool","_destory","QueryItem","queryComponents","matchType","entities","matchAll","matchAny","hasAllComponent","hasAnyComponent","indexOf","index","splice","numQueryComponents","numEntities","EntityQuery","queries","join","query","removeEntity","match","addEntity","stats","numQueries","EntityManager","entityQuery","entitiesWithComponentChanged","Set","initEntity","pushEntity","onEntityRemoved","QueryComponents","createQuery","onEntityComponentChanged","token","fromJSON","queryStats","SystemPriority","ISystem","_priority","_executeTime","delta","timestamp","isSystem","SystemManager","entityManager","systems","systemClass","system","Array","isArray","results","getEntity","systemCount","unshift","priority","isRegisterSystem","_injectQuery","_pushSystem","findIndex","startTime","execute","updateEntityQuery","numSystems","executeTime","constructor","World","systemManager","singleton","enabled","lastTimestamp","registerSystem","createEntity","hasEntity","overview","poolStats","Stage","numLayer","layerMap","addChildAt","addChild","_addLayer","removeChild","removeChildren","Scene","addLayer","createLayer","createParticleLayer","hasLayer","getLayer","removeLayer","layerId","sprite","Point","InteractionData","global","originalEvent","isDown","identifier","isPrimary","button","buttons","tiltX","tiltY","pointerType","pressure","rotationAngle","twist","tangentialPressure","event","Number","isInteger","which","InteractionManager","supportsTouchEvents","supportsPointerEvents","mouse","resolution","interactionDOMElement","eventsAdded","PointerEvent","onPointerUp","onPointerCancel","onPointerDown","onPointerMove","onPointerOut","onPointerOver","setTargetElement","element","removeEvents","addEvents","navigator","msPointerEnabled","msContentZooming","msTouchAction","dom","document","addEventListener","removeEventListener","rect","point","parentElement","getBoundingClientRect","resolutionMultiplier","top","interactionData","getInteractionData","configureInteractionDataForDOMEvent","normalizeToPointerData","processInteractive","onPointerComplete","pointerId","copyEvent","pointerEvent","mapPositionToPoint","clientX","clientY","globalX","globalY","normalizedEvents","TouchEvent","li","changedTouches","touch","touches","radiusX","radiusY","layerX","offsetX","layerY","offsetY","isNormalized","MouseEvent","tempEvent","Flower","texture","clientWidth","clientHeight","maxDist","z","vx","vy","rotation","PI","anchor","spin","Sprite","FlowerFlyBackground","amount","parent","textureId","flowerArr","Texture","from","flower","obj","xpos","update","fontStyle","btnDownStyle","Title","_bgmPlay","_addBackground","_addPtcLayer","_addMenu","ptcLayer","flowerFly","gameInfo","group","start","_createButton","_bgmStop","onStartClicked","onLoadClicked","setup","onSettingClicked","onAboutClicked","loop","text","clickHandle","btn","interactive","buttonMode","onButtonDown","onButtonUp","onButtonOver","onButtonOut","preventDefault","tick","isdown","scale","isOver","RenderComponent","visible","isRender","destroy","SpriteComponent","EMPTY","revert","getRenderJSON","AnimationComponent","texturesId","animationSpeed","playing","cycle","textures","fillFrames","getFillFrames","AnimatedSprite","TEXT_GRADIENT","defaultDestroyOptions","baseTexture","processBbcode","tokens","magic","params","bbcode","slice","tmp","TextMetrics","tokenize","char","test","wordWrap","canvas","_canvas","context","getContext","line","lines","cache","letterSpacing","whiteSpace","collapseSpaces","collapseNewlines","canPrependSpaces","wordWrapWidth","result","isNewline","addLine","currIsBreakingSpace","isBreakingSpace","lastIsBreakingSpace","tokenWidth","getFromCache","canBreakWords","breakWords","characters","wordWrapSplit","j","k","nextChar","lastChar","canBreakChars","characterWidth","isLastToken","RainbowText","ownCanvas","createElement","orig","Rectangle","trim","_ownCanvas","_resolution","settings","RESOLUTION","_autoResolution","_text","_style","_styleListener","_font","localStyleID","bbcodeFillIndex","bbcodeStrokeIndex","respectDirty","styleID","dirty","toFontString","linePositionX","linePositionY","measured","measureText","lineWidths","maxLineWidth","fontProperties","ceil","clearRect","font","lineWidth","textBaseline","miterLimit","passesCount","dropShadow","isShadowPass","dsOffsetText","dsOffsetShadow","fillStyle","strokeStyle","dropShadowColor","rgb","hex2rgb","string2hex","shadowColor","dropShadowAlpha","shadowBlur","dropShadowBlur","shadowOffsetX","cos","dropShadowAngle","dropShadowDistance","shadowOffsetY","sin","_generateFillStyle","originText","split","ascent","align","drawLetterSpacing","updateTexture","isStroke","currentPosition","stringArray","previousWidth","currentWidth","currentChar","offset","strokeText","fillText","substring","trimmed","trimCanvas","putImageData","_texture","_frame","_onTextureUpdate","setRealSize","_recursivePostUpdateTransform","updateText","call","calculateVertices","_bounds","addQuad","vertexData","metrics","gradient","dropShadowCorrection","fillGradientStops","lengthPlus1","fillGradientType","createLinearGradient","lastIterationStop","gradStopLineHeight","thisLineTop","globalStop","clampedStop","addColorStop","totalIterations","currentIteration","Object","assign","abs","s","sign","_width","_height","TextStyle","String","TextComponent","bgTextureId","bgTexture","textView","btnView","Container","btnW","btnH","textW","textH","TypewriterComponent","speed","printDelay","deltaTimer","ButtonComponent","tag","useAnimation","isBind","isClick","origin","clickEvent","removeAllListeners","TransformComponent","angle","TransparentComponent","alpha","SoundComponent","firstPlay","DisplacementComponent","end","duration","FadeComponent","PIXIRenderSystem","getComponent","configureSprite","transparent","pivot","scene","addSprite","TextUpdateSystem","Text","AnimationSystem","animation","gotoAndStop","TypewriterSystem","typewriter","time","charAt","removeComponent","string","TextButtonSystem","processButtonDown","processButtonUp","textC","btnC","TransformSystem","disp","Transform","Displacement","fade","Transparent","Fade","method","SoundSystem","BtnTypes","InputComponent","curEvent","preEvent","downPoint","readyClick","btnType","StoryComponent","curChapter","initialed","nodeIndex","subIndex","InputSystem","StorySystem","systemData","storyScript","Input","processStory","chapter","nodeCount","node","process","goto","removeAllEntity","BackgroundComponent","CGComponent","BGMComponent","CharacterComponent","DialogComponent","NameComponent","ChoiceComponent","RemoveComponent","RemoveSystem","removed","bgm","GroupMap","getGroup","createCurtain","targetId","typewriterOptions","changeVoiceover","curtain","up","entityId","down","voiceover","texts","createVoiceover","hide","wait","delay","timer","waitClick","addTransform","configOption","setEntity","show_async","hide_async","shake","amplitude","fadeIn","fadeOut","baseShake","changeDialog","textBackground","createDialog","createName","removeName","dialog","createComponent","addFade","fadeCompleted","xing_nai_1","xing_nai_2","xing_nai_2_1","xing_nai_3","xing_nai_map_1","createChar","character","entityIdList","flag","util","colorText","chapter1","stage","flow","log","Main","game","_initWorldModule","_initData","engine","serialize","story","storyData","Rabbit","encrypt","decrypt","deserialize","Cutscenes","registerPlugin","_update","begin","isPlay","updated","curScene","requestAnimationFrame","_updateRenderScale","_setSceneScale","cutscenes","CutscenesScene","prevScene","Stats","added","addPanel","Panel","showPanel","_initSoundModule","_initRenderModule","appendChild","loadState","devicePixelRatio","sceneClass","callback","_cutscenesWait","addOnce","cutscenesWait","then","setTimeout","_changeScene","saveArchive","loadArchive","windowWidth","innerWidth","windowHeight","innerHeight","love_memory","LoveMemory","progressHandle","loadError","clickStartHandle","to","MainScene","menu","clickLoadHandle","clickSettingHandle","clickAboutHandle","openMenuHandle","closeMenuHandle","togglePanelHandle","removeStats","addStats","closeDialogHandle","dialogStatus","openSaveDialogHandle","openLoadDialogHandle","openBackTitleDialogHandle","confirmWarnHandle","backTitle","TitleScene","opacity","remove","pause","resume"],"mappings":"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","file":"static/js/4.431f6d11.chunk.js","sourcesContent":["import React from 'react'\r\nimport './index.css'\r\n\r\nclass Loader extends React.Component {\r\n  constructor() {\r\n    super()\r\n    this.state = {\r\n      show: false\r\n    }\r\n  }\r\n\r\n  detailsHandle = () => {\r\n    this.setState({\r\n      show: !this.state.show\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const { loading, progress, error } = this.props.loader\r\n    let style = 'loader'\r\n\r\n    if (this.state.show) {\r\n      style += ' open'\r\n    }\r\n\r\n    return (\r\n      <div className=\"loader-wrapper\" style={{display: loading ? 'block' : 'none'}}>\r\n        <div className=\"loader-container\">\r\n          <div className={style}>\r\n            <em style={{ width: `${progress}%` }}></em>\r\n            <div className=\"details-panel\">\r\n              <p>\r\n                <strong>Progress:</strong> <font>{`${progress}%`}</font>\r\n              </p>\r\n              {\r\n                error && (\r\n                  <p>\r\n                    <strong>Error:</strong> <font style={{color: 'red'}}>{'resource loading failed.'}</font>\r\n                  </p>\r\n                )\r\n              }\r\n            </div>\r\n          </div>\r\n          <div className=\"details button\" onClick={this.detailsHandle}>Details</div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Loader\r\n","import React from 'react'\r\nimport './index.css'\r\n\r\nfunction MenuIcon(props) {\r\n  function clickHandle(e) {\r\n    props.onClick && props.onClick(e)\r\n  }\r\n\r\n  return (\r\n    <div className=\"menu-icon\" onClick={clickHandle}>\r\n      <div className=\"top bar\"></div>\r\n      <div className=\"middle bar\"></div>\r\n      <div className=\"bottom bar\"></div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MenuIcon\r\n","import React from 'react'\r\nimport { version } from '../../../package.json'\r\n\r\nfunction Header() {\r\n  return (\r\n    <div className=\"menu-title\">\r\n    <h1>\r\n      {'湛蓝回忆'}\r\n      <p className=\"menu-subtitle\">\r\n        <span>{'恋爱物语'}</span>\r\n        <span className=\"menu-version\">{`ver: ${version}`}</span>\r\n      </p>\r\n    </h1>\r\n    <h2>{'Love Memory'}</h2>\r\n  </div>\r\n  )\r\n}\r\n\r\nexport default Header\r\n","import React from 'react'\r\nimport './index.css'\r\n\r\nimport Header from './header'\r\n\r\nfunction MenuLayout(props) {\r\n  const style = {\r\n    display: props.show > 0 ? 'block' : 'none'\r\n  }\r\n  return (\r\n    <div className=\"menu-wrapper\" style={style}>\r\n      <div className=\"menu-container\">\r\n        <Header />\r\n        <div className=\"menu-content\">{props.children}</div>\r\n        <div className=\"close\" onClick={props.onClose}></div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MenuLayout\r\n","import React from 'react'\r\n\r\nfunction Item(props) {\r\n  return (\r\n    <div className=\"config-item\">\r\n      <div className=\"config-name\">{props.name}</div>\r\n      <div className=\"config-content\">{props.children}</div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Item\r\n","import React from 'react'\r\nimport './index.css'\r\n\r\nfunction HexagonButton(props) {\r\n  function clickHandle(e) {\r\n    props.onClick && props.onClick(e)\r\n  }\r\n\r\n  return (\r\n    <div className=\"hexagon-button\">\r\n      <div onClick={clickHandle}>\r\n        <span>{props.children}</span>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default HexagonButton\r\n","import React from 'react'\r\nimport './index.css'\r\n\r\nfunction Switch(props) {\r\n  const { checked, onChange } = props\r\n  function changeHandle(e) {\r\n    const input = e.target\r\n    onChange && onChange(input.checked)\r\n  }\r\n\r\n  return (\r\n    <div className=\"switch-button\">\r\n      <input\r\n        className=\"switch-button-checkbox\"\r\n        type=\"checkbox\"\r\n        checked={checked}\r\n        onChange={changeHandle}\r\n      />\r\n      <div className=\"switch-button-handle\"></div>\r\n      <label className=\"switch-button-label\">开</label>\r\n      <label className=\"switch-button-label\">关</label>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Switch\r\n","import React from 'react'\r\nimport { Slider, Rail, Handles, Tracks } from 'react-compound-slider'\r\n\r\nconst sliderStyle = {\r\n  position: 'relative',\r\n  width: '100%',\r\n  touchAction: 'none'\r\n}\r\n\r\nfunction Volume(props) {\r\n  const { value = 80, onChange } = props\r\n  const domain = [0, 100]\r\n  function changeHandle(values) {\r\n    onChange && onChange(values[0])\r\n  }\r\n\r\n  return (\r\n    <Slider\r\n      mode={1}\r\n      step={1}\r\n      domain={domain}\r\n      rootStyle={sliderStyle}\r\n      onChange={changeHandle}\r\n      values={[value]}\r\n    >\r\n      <Rail>\r\n        {({ getRailProps }) => <SliderRail getRailProps={getRailProps} />}\r\n      </Rail>\r\n      <Handles>\r\n        {({ handles, getHandleProps }) => (\r\n          <div className=\"slider-handles\">\r\n            {handles.map(handle => (\r\n              <Handle\r\n                key={handle.id}\r\n                handle={handle}\r\n                domain={domain}\r\n                getHandleProps={getHandleProps}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </Handles>\r\n      <Tracks right={false}>\r\n        {({ tracks, getTrackProps }) => (\r\n          <div className=\"slider-tracks\">\r\n            {tracks.map(({ id, source, target }) => (\r\n              <Track\r\n                key={id}\r\n                source={source}\r\n                target={target}\r\n                getTrackProps={getTrackProps}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </Tracks>\r\n    </Slider>\r\n  )\r\n}\r\n\r\nexport default Volume\r\n\r\nconst railOuterStyle = {\r\n  position: 'absolute',\r\n  width: '100%',\r\n  height: 42,\r\n  transform: 'translate(0%, -50%)',\r\n  borderRadius: 7,\r\n  cursor: 'pointer'\r\n}\r\n\r\nconst railInnerStyle = {\r\n  position: 'absolute',\r\n  width: '100%',\r\n  height: 14,\r\n  transform: 'translate(0%, -50%)',\r\n  borderRadius: 7,\r\n  pointerEvents: 'none',\r\n  backgroundColor: 'rgb(155,155,155)'\r\n}\r\n\r\nconst SliderRail = ({ getRailProps }) => {\r\n  return (\r\n    <>\r\n      <div style={railOuterStyle} {...getRailProps()} />\r\n      <div style={railInnerStyle} />\r\n    </>\r\n  )\r\n}\r\n\r\nconst Handle = ({\r\n  domain: [min, max],\r\n  handle: { id, value, percent },\r\n  disabled = false,\r\n  getHandleProps\r\n}) => {\r\n  return (\r\n    <>\r\n      <div\r\n        style={{\r\n          left: `${percent}%`,\r\n          position: 'absolute',\r\n          transform: 'translate(-50%, -50%)',\r\n          WebkitTapHighlightColor: 'rgba(0,0,0,0)',\r\n          zIndex: 5,\r\n          width: 28,\r\n          height: 42,\r\n          cursor: 'pointer',\r\n          backgroundColor: 'none'\r\n        }}\r\n        {...getHandleProps(id)}\r\n      />\r\n      <div\r\n        role=\"slider\"\r\n        aria-valuemin={min}\r\n        aria-valuemax={max}\r\n        aria-valuenow={value}\r\n        style={{\r\n          left: `${percent}%`,\r\n          position: 'absolute',\r\n          transform: 'translate(-50%, -50%)',\r\n          zIndex: 2,\r\n          width: 24,\r\n          height: 24,\r\n          borderRadius: '50%',\r\n          boxShadow: '1px 1px 1px 1px rgba(0, 0, 0, 0.3)',\r\n          backgroundColor: disabled ? '#666' : '#9BBFD4'\r\n        }}\r\n      />\r\n    </>\r\n  )\r\n}\r\n\r\nconst Track = ({ source, target, getTrackProps, disabled = false }) => {\r\n  return (\r\n    <div\r\n      style={{\r\n        position: 'absolute',\r\n        transform: 'translate(0%, -50%)',\r\n        height: 14,\r\n        zIndex: 1,\r\n        backgroundColor: disabled ? '#999' : '#607E9E',\r\n        borderRadius: 7,\r\n        cursor: 'pointer',\r\n        left: `${source.percent}%`,\r\n        width: `${target.percent - source.percent}%`\r\n      }}\r\n      {...getTrackProps()}\r\n    />\r\n  )\r\n}\r\n","import Rabbit from 'crypto-js/rabbit'\r\nimport utf8 from 'crypto-js/enc-utf8'\r\n\r\n/**\r\n * 把数据保存到 localStorage\r\n * @param storageKey localStorage 键\r\n * @param data 要存储的数据\r\n */\r\nexport function saveToLocalStorage(storageKey: string, data: string) {\r\n  localStorage.setItem(storageKey, data)\r\n}\r\n\r\n/**\r\n * 从 localStorage 读取数据\r\n * @param storageKey localStorage 键\r\n * @param force 启用强行读取，强行读取不存在的数据时不会在控制台发出警告\r\n */\r\nexport function loadFromLocalStorage(storageKey: string, force: boolean = false) {\r\n  const data = localStorage.getItem(storageKey)\r\n  if (!data && force === false) {\r\n    console.warn(`No data with the key value \"${storageKey}\" in localStorage.`)\r\n  }\r\n  return data\r\n}\r\n\r\n/**\r\n * 从 localStorage 删除数据\r\n * @param storageKey localStorage 键\r\n */\r\nexport function removeFromLocalStorage(storageKey: string) {\r\n  localStorage.removeItem(storageKey)\r\n}\r\n\r\n/**\r\n * time33 哈希算法\r\n * @param text 要加密的字符串\r\n */\r\nexport function time33(text: string) {\r\n  for (var i = 0, len = text.length, hash = 5381; i < len; ++i) {\r\n    hash += (hash << 5) + text.charAt(i).charCodeAt(0)\r\n  }\r\n  return hash & 0x7fffffff\r\n}\r\n\r\n/** 密钥，字符串是随机生成的 */\r\nconst key = utf8.parse('JQfTTft92kQ4').toString()\r\n\r\n/**\r\n * 使用 rabbit 加密数据\r\n * @param text 要加密的字符串\r\n */\r\nexport function encryptByRabbit(text: string) {\r\n  return Rabbit.encrypt(text, key).toString()\r\n}\r\n\r\n/**\r\n * 使用 rabbit 解密数据\r\n * @param text 要解密的字符串\r\n */\r\nexport function decryptByRabbit(text: string) {\r\n  const bytes = Rabbit.decrypt(text, key)\r\n  const originalText = bytes.toString(utf8)\r\n  return originalText\r\n}\r\n","import * as PIXI from 'pixi.js'\r\nimport sound from 'pixi-sound'\r\nimport { saveToLocalStorage, loadFromLocalStorage } from '../utils'\r\n\r\ntype PlayOptions = {\r\n  start?: number\r\n  end?: number\r\n  speed?: number\r\n  loop?: boolean\r\n  volume?: number\r\n  sprite?: string\r\n  muted?: boolean\r\n  complete?: any\r\n  loaded?: any\r\n}\r\n\r\nexport class Sound {\r\n  static muted = false\r\n\r\n  static set volume(value: number) {\r\n    sound.volumeAll = value\r\n  }\r\n\r\n  static get volume() {\r\n    return sound.volumeAll\r\n  }\r\n\r\n  static play(alias: string, options?: PlayOptions) {\r\n    sound.play(alias, options)\r\n  }\r\n\r\n  static stop(alias: string) {\r\n    sound.stop(alias)\r\n  }\r\n\r\n  static stopAll() {\r\n    sound.stopAll()\r\n  }\r\n\r\n  static mute() {\r\n    this.muted = true\r\n    sound.muteAll()\r\n  }\r\n\r\n  static unmute() {\r\n    this.muted = false\r\n    sound.unmuteAll()\r\n  }\r\n\r\n  static saveState() {\r\n    const state = {\r\n      muted: this.muted,\r\n      volume: this.volume\r\n    }\r\n    saveToLocalStorage('sound', JSON.stringify(state))\r\n  }\r\n\r\n  static loadState() {\r\n    const state = JSON.parse(loadFromLocalStorage('sound', true))\r\n    if (state) {\r\n      this.muted = state.muted\r\n      this.volume = state.volume\r\n\r\n      if (this.muted === true) {\r\n        this.mute()\r\n      }\r\n    } else {\r\n      this.volume = 0.8\r\n    }\r\n  }\r\n\r\n  private sound: PIXI.sound.Sound\r\n\r\n  constructor(public alias: string) {\r\n    this.sound = sound.find(alias)\r\n  }\r\n\r\n  get isPlaying() {\r\n    return this.sound.isPlaying\r\n  }\r\n\r\n  public play(options?: PlayOptions) {\r\n    this.sound.play(options)\r\n  }\r\n\r\n  public stop() {\r\n    this.sound.stop()\r\n  }\r\n}\r\n","import React from 'react'\r\nimport './index.css'\r\n\r\nimport Item from './item'\r\nimport HexagonButton from '../hexagon-button'\r\nimport Switch from '../switch'\r\nimport Volume from './volume'\r\n\r\nimport { Sound } from '../../engine/sound'\r\n\r\nclass Config extends React.PureComponent {\r\n  constructor() {\r\n    super()\r\n    this.data = React.createRef()\r\n    this.state = {\r\n      checked: false\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setState({\r\n      checked: !Sound.muted,\r\n      volume: Sound.volume\r\n    })\r\n  }\r\n\r\n  switchHandle = checked => {\r\n    if (checked) {\r\n      Sound.unmute()\r\n    } else {\r\n      Sound.mute()\r\n    }\r\n    Sound.saveState()\r\n    this.setState({\r\n      checked\r\n    })\r\n  }\r\n\r\n  volumeHandle = value => {\r\n    Sound.volume = value / 100\r\n    Sound.saveState()\r\n  }\r\n\r\n  exportHandle = () => {\r\n    const textarea = this.data.current\r\n    const data = this.props.getArchive() || ''\r\n    textarea.value = data\r\n  }\r\n\r\n  selectAllHandle = () => {\r\n    const textarea = this.data.current\r\n    textarea.select()\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"game-config\">\r\n        <section>\r\n          <h3 className=\"game-config-title\">系统</h3>\r\n          <Item name=\"声音\"><Switch checked={this.state.checked} onChange={this.switchHandle} /></Item>\r\n          <Item name=\"音量\"><Volume value={Sound.volume * 100} onChange={this.volumeHandle} /></Item>\r\n          <HexagonButton onClick={this.props.onPanel}>on/off<br />状态面板</HexagonButton>\r\n          {\r\n            this.props.show === 3 && (\r\n              <>\r\n                <HexagonButton onClick={this.props.onSave}>存储进度</HexagonButton>\r\n                <HexagonButton onClick={this.props.onLoad}>读取进度</HexagonButton>\r\n                <HexagonButton onClick={this.props.onBack}>返回标题</HexagonButton>\r\n              </>\r\n            )\r\n          }\r\n        </section>\r\n        <section>\r\n          <h3 className=\"game-config-title\">数据</h3>\r\n          <textarea className=\"game-input-data\" ref={this.data}></textarea>\r\n          <div className=\"game-data-options\">\r\n            <button onClick={this.exportHandle}>导出</button>\r\n            <button onClick={this.selectAllHandle}>全选</button>\r\n            <button>导入</button>\r\n          </div>\r\n        </section>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Config\r\n","import React from 'react'\r\n\r\nfunction Card(props) {\r\n  const { title, url, content } = props.item\r\n  return (\r\n    <div className=\"about-item\">\r\n      <a href={url} target=\"_blank\" rel=\"noopener noreferrer\">\r\n        <p className=\"about-item-title\">{title}</p>\r\n        {url && <p className=\"about-item-content\">{url}</p>}\r\n        {content && <p className=\"about-item-content\">{content}</p>}\r\n      </a>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Card\r\n","export const stageInfo = {\r\n  width: 480,\r\n  height: 576\r\n}","import { version } from '../../../package.json'\r\n\r\nexport const about = [\r\n  {\r\n    title: '当前版本',\r\n    content: version\r\n  },\r\n  {\r\n    title: 'Blog',\r\n    url: 'https://xxxxxxxxx.net/'\r\n  },\r\n  {\r\n    title: 'Email',\r\n    url: '/'\r\n  },\r\n  {\r\n    title: 'Github',\r\n    url: 'https://github.com/LuckyRabbitFeet'\r\n  },\r\n  {\r\n    title: 'Bug反馈',\r\n    url: 'xxxxxxxxxxx'\r\n  },\r\n  {\r\n    title: 'License',\r\n    content: 'MIT'\r\n  }\r\n]","export const assetRootUrl =\r\n  process.env.NODE_ENV === 'development'\r\n    ? process.env.PUBLIC_URL\r\n    : 'https://cdn.jsdelivr.net/gh/LuckyRabbitFeet/temp@main/'\r\n\r\nexport const assets = [\r\n  // fonts\r\n  'assets/fonts/SourceHanSansSC-Regular.woff',\r\n  'assets/fonts/SourceHanSansSC-Bold.woff',\r\n  // images\r\n  'assets/images/map01.json',\r\n  'assets/images/map02.json',\r\n  'assets/images/map03.json',\r\n  // images/system\r\n  'assets/images/system/title_gold.json',\r\n  'assets/images/system/system.json',\r\n  // images/file\r\n  'assets/images/file/1001.json',\r\n  'assets/images/file/1002.json',\r\n  'assets/images/file/1003.json',\r\n  'assets/images/file/1004.json',\r\n  'assets/images/file/1005.json',\r\n  'assets/images/file/1006.json',\r\n  'assets/images/file/1007.json',\r\n  'assets/images/file/1008-1010.json',\r\n  'assets/images/file/2001.json',\r\n  'assets/images/file/2002-2004.json',\r\n  'assets/images/file/3001.json',\r\n  'assets/images/file/3002.json',\r\n  'assets/images/file/3003-3005.json',\r\n  'assets/images/file/4001.json',\r\n  'assets/images/file/4002.json',\r\n  // sound\r\n  {\r\n    name: 'funny',\r\n    url: 'assets/sound/funny.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'happy',\r\n    url: 'assets/sound/happy.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'hope',\r\n    url: 'assets/sound/hope.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'memory',\r\n    url: 'assets/sound/memory.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'nerves',\r\n    url: 'assets/sound/nerves.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'night',\r\n    url: 'assets/sound/night.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'romantix',\r\n    url: 'assets/sound/romantix.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'sad',\r\n    url: 'assets/sound/sad.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'shopping',\r\n    url: 'assets/sound/shopping.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'system_over',\r\n    url: 'assets/sound/system_over.mp3',\r\n    onComplete: soundMiddleware\r\n  },\r\n  {\r\n    name: 'system_title',\r\n    url: 'assets/sound/system_title.mp3',\r\n    onComplete: soundMiddleware\r\n  }\r\n]\r\n\r\nfunction soundMiddleware(resource) {\r\n  resource.sound.singleInstance = true\r\n}\r\n","const baseSrtle = {\r\n  fontFamily: ['Source Han Sans SC', 'Arial', 'sans-serif'],\r\n  fontWeight: 'bold',\r\n  fontSize: 20,\r\n  lineJoin: 'round',\r\n  fill: '#ffffff',\r\n  stroke: '#000000',\r\n  strokeThickness: 3\r\n}\r\n\r\nexport const startMenuStyle = {\r\n  ...baseSrtle,\r\n  fontSize: 22,\r\n  fill: '#6D8CD4',\r\n  stroke: '#ffffff'\r\n}\r\n\r\nexport const buttonStyle = baseSrtle\r\n\r\nexport const voiceoverStyle = baseSrtle\r\n\r\nexport const nameStyle = baseSrtle\r\n\r\nexport const dialogStyle = baseSrtle\r\n\r\nexport const background = {\r\n  button: {\r\n    id: 'button',\r\n    width: 220,\r\n    height: 45,\r\n    padding: 3\r\n  },\r\n  name: {\r\n    id: 'name_frame',\r\n    height: 44,\r\n    padding: 0\r\n  },\r\n  dialog: {\r\n    id: 'speak_frame',\r\n    height: 126,\r\n    padding: 12\r\n  }\r\n}","// 眼睛\r\nexport const eyes = {\r\n  '1001_e': {\r\n    res: ['1001_e-0', '1001_e-1', '1001_e-2', '1001_e-1', '1001_e-0'],\r\n    layer: 1,\r\n    x: 180,\r\n    y: 158\r\n  },\r\n  '1002_e': ['1002_e-0', '1002_e-1', '1002_e-2', '1002_e-1', '1002_e-0'],\r\n  '1003_e': ['1003_e-0', '1003_e-1', '1003_e-2', '1003_e-1', '1003_e-0'],\r\n  '1004_e': ['1004_e-0', '1004_e-1', '1004_e-2', '1004_e-1', '1004_e-0'],\r\n  '1005_e': ['1005_e-0', '1005_e-1', '1005_e-2', '1005_e-1', '1005_e-0'],\r\n  '1006_e': {\r\n    res: ['1006_e-0', '1006_e-1', '1006_e-2', '1006_e-1', '1006_e-0'],\r\n    layer: 1,\r\n    x: 180,\r\n    y: 158\r\n  },\r\n  '1007_e': {\r\n    res: ['1007_e-0', '1007_e-1', '1007_e-2', '1007_e-1', '1007_e-0'],\r\n    layer: 1,\r\n    x: 180,\r\n    y: 155\r\n  },\r\n  '1008_e': '1008_e',\r\n  '1009_e': ['1009_e-0', '1009_e-1', '1009_e-2', '1009_e-1', '1009_e-0'],\r\n  '1010_e': {\r\n    res: '1010_e',\r\n    layer: 1,\r\n    x: 180,\r\n    y: 154\r\n  },\r\n  '2001_e': ['2001_e-0', '2001_e-1', '2001_e-2', '2001_e-1', '2001_e-0'],\r\n  '2002_e': ['2002_e-0', '2002_e-1', '2002_e-2', '2002_e-1', '2002_e-0'],\r\n  '2003_e': ['2003_e-0', '2003_e-1', '2003_e-2', '2003_e-1', '2003_e-0'],\r\n  '2004_e': ['2004_e-0', '2004_e-1', '2004_e-2', '2004_e-1', '2004_e-0'],\r\n  '3001_e': ['3001_e-0', '3001_e-1', '3001_e-2', '3001_e-1', '3001_e-0'],\r\n  '3002_e': ['3002_e-0', '3002_e-1', '3002_e-2', '3002_e-1', '3002_e-0'],\r\n  '3003_e': ['3003_e-0', '3003_e-1', '3003_e-2', '3003_e-1', '3003_e-0'],\r\n  '3004_e': ['3004_e-0', '3004_e-1', '3004_e-2', '3004_e-1', '3004_e-0'],\r\n  '3005_e': '3005_e',\r\n  '4001_e': ['4001_e-0', '4001_e-1', '4001_e-2', '4001_e-1', '4001_e-0'],\r\n  '4002_e': ['4002_e-0', '4002_e-1', '4002_e-2', '4002_e-1', '4002_e-0']\r\n}\r\n\r\n// 嘴\r\nexport const mouth = {\r\n  '1001_m-01': {\r\n    res: '1001_m-01',\r\n    layer: 1,\r\n    x: 218,\r\n    y: 225\r\n  },\r\n  '1001_m-02': '1001_m-02',\r\n  '1001_m-03': '1001_m-03',\r\n  '1001_m-04': {\r\n    res: '1001_m-04',\r\n    layer: 1,\r\n    x: 218,\r\n    y: 225\r\n  },\r\n  '1001_m-05': '1001_m-05',\r\n  '1001_m-06': '1001_m-06',\r\n  '1001_m-07': {\r\n    res: '1001_m-07',\r\n    layer: 1,\r\n    x: 218,\r\n    y: 224\r\n  },\r\n  '1003_m': {\r\n    res: '1003_m',\r\n    layer: 1,\r\n    x: 216,\r\n    y: 226\r\n  }\r\n}\r\n\r\n// 头\r\nexport const head = {\r\n  '1001_he': {\r\n    res: '1001_he',\r\n    layer: 0,\r\n    x: 146,\r\n    y: 46\r\n  }\r\n}\r\n\r\n//脸\r\nexport const face = {\r\n  'map02001a': 'map02001a',\r\n  'map02001b': 'map02001b',\r\n  'map02001c': 'map02001c',\r\n  'map02001d': 'map02001d',\r\n  'map02001f': {\r\n    res: 'map02001f',\r\n    layer: 2,\r\n    x: 96,\r\n    y: 192\r\n  },\r\n  'map02001g': 'map02001g',\r\n  'map02001h': 'map02001h'\r\n}\r\n\r\n// 身体\r\nexport const body = {\r\n  '1001_b': {\r\n    res: '1001_b',\r\n    layer: 1,\r\n    x: 110,\r\n    y: 292\r\n  },\r\n  '1002_b': '1002_b',\r\n  '1003_b': '1003_b',\r\n  '2001_b': '2001_b',\r\n  '3001_b': '3001_b',\r\n  '3002_b': '3002_b',\r\n  '4001_b': '4001_b',\r\n  'map02001': {\r\n    res: 'map02001',\r\n    layer: 1,\r\n    x: 48,\r\n    y: 0\r\n  },\r\n  'map02002': 'map02002',\r\n  'map02003': 'map02003'\r\n}\r\n\r\n// 手\r\nexport const hand = {\r\n  '1001_ha': {\r\n    res: '1001_ha',\r\n    layer: 0,\r\n    x: 102,\r\n    y: 346\r\n  },\r\n  '1002_ha': {\r\n    res: '1002_ha',\r\n    layer: 0,\r\n    x: 290,\r\n    y: 362\r\n  },\r\n  '1005_ha': {\r\n    res: '1005_ha',\r\n    layer: 2,\r\n    x: 96,\r\n    y: 340\r\n  },\r\n  '1007_ha': {\r\n    res: '1007_ha',\r\n    layer: 2,\r\n    x: 92,\r\n    y: 329\r\n  }\r\n}\r\n\r\n// 其他\r\nexport const other = {\r\n\r\n}\r\n\r\n\r\n","const lightskyblue = '#87cefa'\r\n\r\nconst burlywood = '#deb887'\r\n\r\nconst deepskyblue = '#00bfff'\r\n\r\nexport default {\r\n  lightskyblue,\r\n  burlywood,\r\n  deepskyblue\r\n}","import React from 'react'\r\nimport './index.css'\r\n\r\nimport Card from './card'\r\n\r\nimport { about } from '../../game/config'\r\n\r\nfunction About() {\r\n  return (\r\n    <div className=\"game-about\">\r\n      {about.map(item => <Card key={item.title} item={item} />)}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default About\r\n","import React from 'react'\r\nimport ReactModal from 'react-modal'\r\n\r\nfunction SaveDialog(props) {\r\n  const { isOpen, onClose, status } = props\r\n\r\n  function closeHandle(e) {\r\n    onClose && onClose(e)\r\n  }\r\n\r\n  return (\r\n    <ReactModal\r\n      isOpen={isOpen}\r\n      closeTimeoutMS={200}\r\n      ariaHideApp={false}\r\n      contentLabel=\"save dialog\"\r\n      style={{\r\n        overlay: {\r\n          display: 'flex',\r\n          justifyContent: 'center',\r\n          alignItems: 'center',\r\n          zIndex: 6,\r\n          backgroundColor: null\r\n        }\r\n      }}\r\n      className=\"dialog\"\r\n    >\r\n      <div className=\"dialog-container\">\r\n        <div className=\"dialog-content\">\r\n          <div className=\"dialog-icon\">\r\n            {\r\n              status === 'saving'\r\n                ? (\r\n                  <div className=\"spinner-box\">\r\n                    <div className=\"circle-border\">\r\n                      <div className=\"circle-core\"></div>\r\n                    </div>\r\n                  </div>\r\n                )\r\n                : (\r\n                  <div className=\"sa-success\">\r\n                    <div className=\"sa-success-tip\"></div>\r\n                    <div className=\"sa-success-long\"></div>\r\n                    <div className=\"sa-success-placeholder\"></div>\r\n                    <div className=\"sa-success-fix\"></div>\r\n                  </div>\r\n                )\r\n            }\r\n          </div>\r\n          <div className=\"dialog-text\">\r\n            { status === 'saving' ? 'Saving...' : 'Saved.' }\r\n          </div>\r\n        </div>\r\n        <div className=\"dialog-interaction\">\r\n          <div\r\n            className=\"dialog-button\"\r\n            style={{\r\n              margin: status === 'saving' ? -55 : 0\r\n            }}\r\n          >\r\n            <button onClick={closeHandle}>OK</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ReactModal>\r\n  )\r\n}\r\n\r\nexport default SaveDialog\r\n","import React from 'react'\r\nimport ReactModal from 'react-modal'\r\n\r\nfunction WarningDialog(props) {\r\n  const { isOpen, onConfirm, onClose } = props\r\n\r\n  function yesHandle(e) {\r\n    onConfirm && onConfirm(e)\r\n  }\r\n\r\n  function noHandle(e) {\r\n    onClose && onClose(e)\r\n  }\r\n\r\n  return (\r\n    <ReactModal\r\n      isOpen={isOpen}\r\n      closeTimeoutMS={200}\r\n      ariaHideApp={false}\r\n      contentLabel=\"warning dialog\"\r\n      style={{\r\n        overlay: {\r\n          display: 'flex',\r\n          justifyContent: 'center',\r\n          alignItems: 'center',\r\n          zIndex: 6,\r\n          backgroundColor: null\r\n        }\r\n      }}\r\n      className=\"dialog\"\r\n    >\r\n      <div className=\"dialog-container\">\r\n        <div className=\"dialog-content\">\r\n          <div className=\"dialog-icon\">\r\n            <div className=\"sa-warning\">\r\n              <span className=\"sa-warning-body\"></span>\r\n              <span className=\"sa-warning-dot\"></span>\r\n            </div>\r\n          </div>\r\n          <div className=\"dialog-text\" style={{\r\n            lineHeight: 1.2,\r\n            textAlign: 'left',\r\n            paddingTop: 5,\r\n            paddingLeft: 80\r\n          }}>\r\n            未保存的数据将会丢失，是否继续？\r\n          </div>\r\n        </div>\r\n        <div className=\"dialog-interaction\">\r\n          <div\r\n            className=\"dialog-button\"\r\n            style={{\r\n              margin: 0\r\n            }}\r\n          >\r\n            <button className=\"dialog-button-yes\" onClick={yesHandle}>Yes</button>\r\n            <button className=\"dialog-button-no\" onClick={noHandle}>No</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ReactModal>\r\n  )\r\n}\r\n\r\nexport default WarningDialog\r\n","import * as PIXI from 'pixi.js'\r\nimport 'pixi-sound'\r\nimport { Signal } from 'signals'\r\n\r\nexport default class Loader {\r\n  public source: PIXI.Loader\r\n  public loaded: boolean\r\n  public assets: any[] | undefined\r\n  public onProgressed: Signal\r\n  public onCompleted: Signal\r\n\r\n  constructor(baseUrl?: string, concurrency?: number) {\r\n    this.source = new PIXI.Loader(baseUrl, concurrency)\r\n    this.loaded = false\r\n    this.onProgressed = new Signal()\r\n    this.onCompleted = new Signal()\r\n  }\r\n\r\n  public load(assets: any[]): Promise<any> {\r\n    if (this.loaded === true) {\r\n      return Promise.resolve(this.source.resources)\r\n    }\r\n\r\n    this.assets = assets\r\n    this.source\r\n      .add(assets)\r\n      .on('progress', this._onProgress.bind(this))\r\n      .on('complete', this._onComplete.bind(this))\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.source\r\n        .on('error', this._onError(reject))\r\n        .load(this._onLoad(resolve))\r\n    })\r\n  }\r\n\r\n  private _onProgress(loader: PIXI.Loader, resource: PIXI.LoaderResource) {\r\n    this.onProgressed.dispatch(loader.progress, resource)\r\n  }\r\n\r\n  private _onComplete(loader: PIXI.Loader, resources: PIXI.IResourceDictionary) {\r\n    this.onCompleted.dispatch(loader.progress, resources)\r\n  }\r\n\r\n  private _onError(reject: (...args: any[]) => void) {\r\n    return (error: Error) => {\r\n      this.source.reset()\r\n      reject(error)\r\n    }\r\n  }\r\n\r\n  private _onLoad(resolve: (...args: any[]) => void) {\r\n    return (loader: PIXI.Loader, resources: PIXI.IResourceDictionary) => {\r\n      this.loaded = true\r\n      resolve(resources)\r\n    }\r\n  }\r\n}\r\n","import * as PIXI from 'pixi.js'\r\n\r\nexport type options = {\r\n  width?: number\r\n  height?: number\r\n  view?: HTMLCanvasElement\r\n  transparent?: boolean\r\n  autoDensity?: boolean\r\n  antialias?: boolean\r\n  forceFXAA?: boolean\r\n  resolution?: number\r\n  clearBeforeRender?: boolean\r\n  preserveDrawingBuffer?: boolean\r\n  backgroundColor?: number\r\n  powerPreference?: string\r\n  context?: any\r\n}\r\n\r\ntype Plugins = {\r\n  [key: string]: any\r\n}\r\n\r\nexport class Renderer {\r\n  static readonly plugins: Plugins = {}\r\n\r\n  private renderer: PIXI.Renderer\r\n  public readonly plugins: Plugins\r\n\r\n  constructor(options?: options) {\r\n    options = {\r\n      antialias: true, // 启用抗锯齿\r\n      ...options\r\n    }\r\n    this.renderer = PIXI.autoDetectRenderer(options)\r\n    this.plugins = {}\r\n    for (const pluginKey in Renderer.plugins) {\r\n      this.plugins[pluginKey] = new Renderer.plugins[pluginKey](\r\n        this.renderer,\r\n        options\r\n      )\r\n    }\r\n    this.renderer.plugins.interaction.autoPreventDefault = false\r\n    this.renderer.view.style.touchAction = 'auto'\r\n  }\r\n\r\n  static registerPlugin(id: string, pluginClass: () => any): void {\r\n    this.plugins[id] = pluginClass\r\n  }\r\n\r\n  get view() {\r\n    return this.renderer.view\r\n  }\r\n\r\n  public render(view: PIXI.Container) {\r\n    this.renderer.render(view)\r\n  }\r\n\r\n  public resize(width: number, height: number) {\r\n    this.renderer.autoDensity = true\r\n    this.renderer.resize(width, height)\r\n  }\r\n}\r\n\r\n/**\r\n * NOTE: PIXI Text 的换行是按空格来确定单词边界的，按空格将每个单词放入数组，\r\n * 然而中文语法中，没人写字带空格，于是会被认为一整串文字都为一个单词，\r\n * 这就导致英文与中文混合的时候，中文直接就被换到第二行去了，从而可能出现大面积空白。\r\n * 在这里，直接覆写 Text 的换行规则，让每个中文字符单独存入数组，以实现整齐的换行效果。\r\n * \r\n * NOTE: 如果使用里 lib 中的 Rainbow Text 模块，则可以不使用下面代码。\r\n *\r\n * 附1：如果要使用超~长的英文字符串时，可以启用 breakWords 来强制换行。\r\n * 附2：tokenize 是 TextMetrics 的私有方法，所以在这里使用 @ts-ignore 来规避 ts 的类型检查。\r\n * 参考: http://ts8zs.com/?p=309\r\n */\r\n// @ts-ignore\r\n// PIXI.TextMetrics.tokenize = function (text: string) {\r\n//   const tokens: string[] = []\r\n//   let token = ''\r\n//   if (typeof text !== 'string') {\r\n//     return tokens\r\n//   }\r\n\r\n//   for (let i = 0; i < text.length; i++) {\r\n//     const char = text[i]\r\n//     if (!/[a-z'-]/i.test(char)) {\r\n//       if (token !== '') {\r\n//         tokens.push(token)\r\n//         token = ''\r\n//       }\r\n//       tokens.push(char)\r\n//     } else {\r\n//       token += char\r\n//     }\r\n//   }\r\n\r\n//   if (token !== '') {\r\n//     tokens.push(token)\r\n//   }\r\n\r\n//   return tokens\r\n// }\r\n","/** 对象池 */\r\nexport class ObjectPool<T> {\r\n  private static pools: WeakMap<\r\n    { new (...args: any[]): any },\r\n    ObjectPool<any>\r\n    > = new WeakMap()\r\n  // 空闲对象\r\n  private freed: T[] = []\r\n  // 容量\r\n  private capacity: number = 100\r\n  // 计数器\r\n  private size: number = 0\r\n\r\n  /**\r\n   * 获取指定对象池\r\n   * @param ObjectClass 对象类\r\n   * @returns 对象池\r\n   */\r\n  public static of<T>(ObjectClass: { new (...args: any[]): T }) {\r\n    let pool = this.pools.get(ObjectClass)\r\n    if (pool === undefined) {\r\n      this.pools.set(ObjectClass, (pool = new ObjectPool<T>(ObjectClass)))\r\n    }\r\n    return pool as ObjectPool<T>\r\n  }\r\n\r\n  /**\r\n   * 释放指定对象池\r\n   * @param ObjectClass 对象类\r\n   */\r\n  public static free<T>(ObjectClass: { new (...args: any[]): T }) {\r\n    const pool = this.pools.get(ObjectClass)\r\n    if (pool) {\r\n      pool.clear()\r\n      this.pools.delete(ObjectClass)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 创建一个对象池\r\n   * @param ObjectClass 对象类型\r\n   */\r\n  constructor(private ObjectClass: { new (...args: any[]): T }) {}\r\n\r\n  /**\r\n   * 分配一个对象\r\n   * @returns 对象\r\n   */\r\n  public acquire() {\r\n    if (this.freed.length <= 0) {\r\n      this.expand()\r\n    }\r\n\r\n    const item = this.freed.pop()\r\n\r\n    return item as T\r\n  }\r\n\r\n  /**\r\n   * 释放一个对象\r\n   * @param item 对象\r\n   */\r\n  public release(item: T) {\r\n    this.freed.push(item)\r\n  }\r\n\r\n  /**\r\n   * 清空对象池\r\n   */\r\n  public clear() {\r\n    this.freed.length = 0\r\n  }\r\n\r\n  /**\r\n   * 扩展对象池\r\n   */\r\n  public expand() {\r\n    const count = Math.round(this.capacity * 0.2)\r\n    for (let i = 0; i < count; i++) {\r\n      const item = new this.ObjectClass()\r\n      this.freed.push(item)\r\n    }\r\n    this.size += count\r\n    if (this.size >= this.capacity) {\r\n      this.capacity += this.size\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 统计对象池空间大小\r\n   * @returns 对象池大小\r\n   */\r\n  public totalSize() {\r\n    return this.size\r\n  }\r\n\r\n  /**\r\n   * 统计空闲空间大小\r\n   * @returns 对象池空闲大小\r\n   */\r\n  public totalFree() {\r\n    return this.freed.length\r\n  }\r\n\r\n  /**\r\n   * 统计已使用空间大小\r\n   * @returns 对象池已使用大小\r\n   */\r\n  public totalUsed() {\r\n    return this.size - this.freed.length\r\n  }\r\n}\r\n","import { Signal } from 'signals'\r\nimport { ObjectPool } from './object-pool'\r\nimport { Entity } from './entity'\r\n\r\nexport type IComponentProps = {\r\n  [propName: string]: any\r\n}\r\n\r\nexport type IComponentClass<T extends IComponent> = {\r\n  new(): T\r\n  onComponentCreated: Signal\r\n  onComponentDestroyed: Signal\r\n  _id: string\r\n  _isRegister: boolean\r\n  _isComponent: boolean\r\n  _componentClassMap: Map<string, IComponentClass<IComponent>>\r\n  _pools: Map<string, ObjectPool<IComponent>>\r\n  create(\r\n    entity: Entity,\r\n    componentClass: IComponentClass<IComponent>,\r\n    values?: IComponentProps\r\n  ): IComponent\r\n  destory(componentClass: IComponentClass<IComponent>, component: IComponent): void\r\n}\r\n\r\n/**\r\n * 组件注册工具\r\n * @param id 组件唯一识别 id\r\n * @returns 注册器\r\n */\r\nexport function componentRegister(id: string) {\r\n  return function (target: IComponentClass<IComponent>) {\r\n    if (IComponent._componentClassMap.has(id)) {\r\n      console.warn(\r\n        `Component id: '${id}' already registered.`\r\n      )\r\n    } else {\r\n      target._id = id\r\n      target._isRegister = true\r\n      IComponent._componentClassMap.set(id, target)\r\n      // 注册的时候顺便把组件池也给开了\r\n      if (!IComponent._pools.has(id)) {\r\n        IComponent._pools.set(id, ObjectPool.of(target))\r\n      }\r\n    }\r\n    return target\r\n  }\r\n}\r\n\r\n/** 基础组件类 */\r\nexport class IComponent {\r\n  /** 当组件被创建时派发事件 */\r\n  public static readonly onComponentCreated: Signal = new Signal()\r\n  /** 当组件被销毁时派发事件 */\r\n  public static readonly onComponentDestroyed: Signal = new Signal()\r\n\r\n  public static _id: string\r\n  public static _isRegister: boolean = false\r\n  public static _isComponent: boolean = true\r\n  public static _componentClassMap: Map<string, IComponentClass<IComponent>> = new Map()\r\n  public static _pools: Map<string, ObjectPool<IComponent>> = new Map()\r\n  private entity?: Entity = null\r\n\r\n  /**\r\n   * 创建组件\r\n   * @param entity 组件挂载的实体\r\n   * @param componentClass 组件类\r\n   * @returns 组件\r\n   */\r\n  public static create(\r\n    entity: Entity,\r\n    componentClass: IComponentClass<IComponent>,\r\n    values?: IComponentProps\r\n  ) {\r\n    // const component = new componentClass()\r\n    const pool = this._pools.get(componentClass._id)\r\n    const component = pool.acquire()\r\n    component.entity = entity\r\n    if (values) {\r\n      component._setProps(values)\r\n    }\r\n    component.init()\r\n    this.onComponentCreated.dispatch({\r\n      componentClass,\r\n      component,\r\n      entity\r\n    })\r\n    return component\r\n  }\r\n\r\n  /**\r\n   * 移除组件\r\n   * @param componentClass 组件类\r\n   * @param component 组件\r\n   */\r\n  public static destory(componentClass: IComponentClass<IComponent>, component: IComponent) {\r\n    const pool = this._pools.get(componentClass._id)\r\n\r\n    this.onComponentDestroyed.dispatch({\r\n      componentClass,\r\n      component,\r\n      entity: component.entity\r\n    })\r\n    component.clear()\r\n    component.entity = null\r\n    pool.release(component)\r\n  }\r\n\r\n  /**\r\n   * 组件池统计\r\n   */\r\n  public static poolStats() {\r\n    const components = {} as any\r\n    this._pools.forEach((pool, id) => {\r\n      components[id] = {\r\n        size: pool.totalSize(),\r\n        free: pool.totalFree(),\r\n        used: pool.totalUsed()\r\n      }\r\n    })\r\n    return components\r\n  }\r\n\r\n  /** 初始化组件 */\r\n  public init() {}\r\n  /** 清理组件 */\r\n  public clear() {}\r\n\r\n  /**\r\n   * 设置组件属性\r\n   * @param values 属性\r\n   */\r\n  public _setProps(values: IComponentProps) {\r\n    for (const key in values) {\r\n      if (typeof values[key] !== 'undefined') {\r\n        (this as IComponentProps)[key] = values[key]\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 把组件转换为 json 数据\r\n   * \r\n   * NOTE: 该方法会被 JSON.stringify() 隐式调用，该方法定义什么值将被序列化。\r\n   * @returns 返回 json 数据\r\n   */\r\n  public toJSON(): any {\r\n    // 默认不序列化任何内容\r\n    return {}\r\n  }\r\n\r\n  /**\r\n   * 从 json 数据还原组件\r\n   * @param json json 数据\r\n   */\r\n  // public fromJSON(json: any) {\r\n  //   if (Object.prototype.toString.call(json) === '[object Object]') {\r\n  //     // 默认覆盖相应属性\r\n  //     this._setProps(json)\r\n  //   }\r\n  // }\r\n}\r\n","import { IComponentClass, IComponent } from './component'\r\n\r\n/**\r\n * 组合查询关键字\r\n * @param componentClassList 要查询的类数组\r\n */\r\nexport function queryKey(componentClassList: IComponentClass<IComponent>[]) {\r\n  return componentClassList.map(componentClass => componentClass._id).join('-')\r\n}\r\n\r\n/** uuid 生成器 */\r\nexport function generateUUID() {\r\n  let d = new Date().getTime()\r\n  let uuid = 'xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n    let r = (d + Math.random() * 16) % 16 | 0\r\n    d = Math.floor(d / 16)\r\n    return (c === 'x' ? r : (r & 0x3) | 0x8).toString(16)\r\n  })\r\n  return uuid\r\n}\r\n\r\n// Detector for browser's \"window\"\r\nexport const hasWindow = typeof window !== \"undefined\"\r\n\r\n// performance.now() \"polyfill\"\r\nexport const now =\r\n  hasWindow && typeof window.performance !== \"undefined\"\r\n    ? performance.now.bind(performance)\r\n    : Date.now.bind(Date)\r\n","import { IComponentClass, IComponent } from './component'\r\nimport { ObjectPool } from './object-pool'\r\nimport { generateUUID } from './utils'\r\nimport { World } from './world'\r\n\r\nexport type EntityClass = {\r\n  onComponentAdded(): void\r\n  onComponentRemoved(): void\r\n}\r\n\r\nexport class Entity {\r\n  public static _pool: ObjectPool<Entity> = ObjectPool.of(Entity)\r\n  public id: string = generateUUID()\r\n  public alias?: string\r\n  public isSingleton: boolean = false\r\n  public _world?: World\r\n  private _components: Map<IComponentClass<IComponent>, IComponent> = new Map()\r\n  public onComponentChanged?: (arg0: Entity) => void\r\n\r\n  /**\r\n   * 创建实体\r\n   * @returns 实体\r\n   */\r\n  public static create(world: World, alias?: string) {\r\n    const entity = this._pool.acquire()\r\n    entity._world = world\r\n    if (alias) {\r\n      entity.alias = alias\r\n    }\r\n    return entity\r\n  }\r\n\r\n  /**\r\n   * 销毁实体\r\n   * @param entity 实体\r\n   */\r\n  public static destory(entity: Entity) {\r\n    if (entity.isSingleton) {\r\n      throw new Error('Cannot destroy singleton entities.')\r\n    }\r\n    entity._destory()\r\n    this._pool.release(entity)\r\n  }\r\n\r\n  /**\r\n   * 单例实体\r\n   * @returns 实体\r\n   */\r\n  public static singleton(world: World) {\r\n    const entity = new Entity()\r\n    entity._world = world\r\n    entity.alias = 'singleton components'\r\n    entity.isSingleton = true\r\n\r\n    return entity\r\n  }\r\n\r\n  /**\r\n   * 实体池统计\r\n   */\r\n  public static poolStats() {\r\n    return {\r\n      size: this._pool.totalSize(),\r\n      free: this._pool.totalFree(),\r\n      used: this._pool.totalUsed()\r\n    }\r\n  }\r\n\r\n  /** 销毁实体 */\r\n  protected _destory() {\r\n    this.alias = undefined\r\n    this._world = undefined\r\n    this.onComponentChanged = undefined\r\n    this.removeAllComponent()\r\n  }\r\n\r\n  /**\r\n   * 校验组件是否符合规范\r\n   * @param componentClass 组件类\r\n   * @returns true - 符合， false - 不符合\r\n   */\r\n  public verifyComponent(componentClass: IComponentClass<IComponent>) {\r\n    // 如果组件没有继承基础组件类，或者组件没有注册，就必须报异常\r\n    if (\r\n      !componentClass._isComponent ||\r\n      !componentClass._isRegister\r\n    ) {\r\n      throw new Error(`The Component does not meet specifications.\\n` +\r\n        `Entity: ${this.alias || this.id} Component: ${componentClass._id || componentClass.name}`)\r\n    }\r\n    // 如果组件已经添加过了，就报个警告\r\n    if (this.hasComponent(componentClass)) {\r\n      console.warn(`Component already exists on entity.\\n` +\r\n        `Entity: ${this.alias || this.id} Component: ${componentClass._id}`)\r\n      return false\r\n    } else {\r\n      return true\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 查询实体是否包含组件\r\n   * @param componentClass 组件类\r\n   * @returns true - 包含， false - 不包含\r\n   */\r\n  public hasComponent(componentClass: IComponentClass<IComponent>) {\r\n    return this._components.has(componentClass)\r\n  }\r\n\r\n  /**\r\n   * 查询实体是否包含一组组件\r\n   * @param componentClassList 组件类数组\r\n   * @returns true - 包含， false - 不包含\r\n   */\r\n  public hasAllComponent(componentClassList: IComponentClass<IComponent>[]) {\r\n    for (const componentClass of componentClassList) {\r\n      if (!this.hasComponent(componentClass)) {\r\n        return false\r\n      }\r\n    }\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * 查询实体是否包含一组组件中的任意一个组件\r\n   * @param componentClassList 组件类类型数组\r\n   * @returns true - 包含， false - 不包含\r\n   */\r\n  public hasAnyComponent(componentClassList: IComponentClass<IComponent>[]) {\r\n    for (const componentClass of componentClassList) {\r\n      if (this.hasComponent(componentClass)) {\r\n        return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * 获得组件\r\n   * @param componentClass 组件类\r\n   * @returns 组件数据\r\n   */\r\n  public getComponent<T extends IComponent>(componentClass: IComponentClass<T>) {\r\n    if (this._components.has(componentClass)) {\r\n      return this._components.get(componentClass) as T\r\n    } else {\r\n      console.warn('getComponent: Component not found.\\n' +\r\n        `Component: ${ componentClass }`)\r\n      return {} as T\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 添加组件\r\n   * @param componentClass 组件类\r\n   * @param values 覆盖默认组件状态\r\n   * @returns this\r\n   */\r\n  public addComponent<T extends IComponent>(\r\n    componentClass: IComponentClass<T>,\r\n    values?: Partial<T>\r\n  ) {\r\n    if (!this.verifyComponent(componentClass)) {\r\n      return this\r\n    }\r\n    const component = IComponent.create(this, componentClass, values)\r\n    this._components.set(componentClass, component)\r\n    this.onComponentChanged && this.onComponentChanged(this)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 移除组件\r\n   * @param componentClass 组件类类型\r\n   * @returns this\r\n   */\r\n  public removeComponent(componentClass: IComponentClass<IComponent>) {\r\n    if (this._components.has(componentClass)) {\r\n      const component = this._components.get(componentClass)\r\n      IComponent.destory(componentClass, component)\r\n      this._components.delete(componentClass)\r\n      this.onComponentChanged && this.onComponentChanged(this)\r\n    }\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 移除全部组件\r\n   * @returns this\r\n   */\r\n  public removeAllComponent() {\r\n    this._components.forEach((component, key) => {\r\n      IComponent.destory(key, component)\r\n      this._components.delete(key)\r\n    })\r\n    this.onComponentChanged && this.onComponentChanged(this)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 把实体转换为 json 数据\r\n   * \r\n   * NOTE: 该方法会被 JSON.stringify() 隐式调用，该方法定义什么值将被序列化。\r\n   * @returns 返回 json 数据\r\n   */\r\n  public toJSON() {\r\n    const components: any[] = []\r\n    this._components.forEach((component, componentClass) => {\r\n      components.push({\r\n        class: componentClass._id,\r\n        content: component\r\n      })\r\n    })\r\n    const json: any = {\r\n      id: this.id,\r\n      alias: this.alias,\r\n      isSingleton: this.isSingleton,\r\n      components\r\n    }\r\n    return json\r\n  }\r\n\r\n  /**\r\n   * 从 json 数据还原实体\r\n   * @param json json 数据\r\n   */\r\n  public fromJSON(json: any) {\r\n    const componentClassMap = IComponent._componentClassMap\r\n    this.id = json.id\r\n    this.alias = json.alias\r\n    this.isSingleton = json.isSingleton\r\n    const components = json.components as any[]\r\n    for (const item of components) {\r\n      const classId = item.class\r\n      const content = item.content\r\n      if (!componentClassMap.has(classId)) {\r\n        console.warn(`Cannot find component with id '${classId}'.`)\r\n        continue\r\n      }\r\n      const componentClass = componentClassMap.get(classId)\r\n      this.addComponent(componentClass, content)\r\n    }\r\n  }\r\n}\r\n","import { Entity } from './entity'\r\nimport { IComponentClass, IComponent } from './component'\r\nimport { queryKey } from './utils'\r\n\r\n/** 查询项目 */\r\nexport class QueryItem {\r\n  private entities: Entity[] = []\r\n  public key: string = null\r\n\r\n  constructor(\r\n    private queryComponents: IComponentClass<IComponent>[],\r\n    private matchType: string\r\n  ) {\r\n    if (queryComponents.length === 0) {\r\n      throw new Error(`Can't create a query without \"components\" on System.`)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 判断实体是否通过查询条件\r\n   * @param entity 实体\r\n   * @returns true - 通过， false - 未通过\r\n   */\r\n  public match(entity: Entity) {\r\n    if (this.matchType === 'all') {\r\n      return this.matchAll(entity)\r\n    } else if (this.matchType === 'any') {\r\n      return this.matchAny(entity)\r\n    } else {\r\n      return false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 判断实体是否通过全部查询条件\r\n   * @param entity 实体\r\n   * @returns true - 通过， false - 未通过\r\n   */\r\n  public matchAll(entity: Entity) {\r\n    return entity.hasAllComponent(this.queryComponents)\r\n  }\r\n\r\n  /**\r\n   * 判断实体是否通过任意一个查询条件\r\n   * @param entity 实体\r\n   * @returns true - 通过， false - 未通过\r\n   */\r\n  public matchAny(entity: Entity) {\r\n    return entity.hasAnyComponent(this.queryComponents)\r\n  }\r\n\r\n  /**\r\n   * 获取实体列表\r\n   * @returns 符合查询条件的实体数组\r\n   */\r\n  public getEntity() {\r\n    return this.entities\r\n  }\r\n\r\n  /**\r\n   * 添加实体\r\n   * @param entity 实体\r\n   */\r\n  public addEntity(entity: Entity) {\r\n    if (this.entities.indexOf(entity) === -1) {\r\n      this.entities.push(entity)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 移除实体\r\n   * @param entity 实体\r\n   */\r\n  public removeEntity(entity: Entity) {\r\n    const index = this.entities.indexOf(entity)\r\n    if (index !== -1) {\r\n      this.entities.splice(index, 1)\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * 统计查询\r\n   * @returns 统计数据\r\n   */\r\n  public stats() {\r\n    const queryComponents = this.queryComponents.map(componentClass => componentClass._id)\r\n    return {\r\n      matchType: this.matchType,\r\n      numQueryComponents: this.queryComponents.length,\r\n      numEntities: this.entities.length,\r\n      queryComponents\r\n    }\r\n  }\r\n}\r\n\r\n/** 实体查询管理 */\r\nexport class EntityQuery {\r\n  private queries: Map<string, QueryItem> = new Map()\r\n\r\n  /**\r\n   * 创建查询项目\r\n   * @param queryComponents 查询条件\r\n   * @param matchType 查询类型 all | any\r\n   * @returns 查询项目\r\n   */\r\n  public createQuery(queryComponents: IComponentClass<IComponent>[], matchType: string) {\r\n    const key = matchType + queryKey(queryComponents)\r\n    // 如果不同 system 具有相同的查询条件，就没必要创建新的查询了\r\n    if (this.queries.has(key)) {\r\n      return this.queries.get(key)\r\n    } else {\r\n      const query = new QueryItem(queryComponents, matchType)\r\n      query.key = key\r\n      this.queries.set(key, query)\r\n      return query\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 实体删除事件\r\n   * @param entity 实体\r\n   */\r\n  public onEntityRemoved(entity: Entity) {\r\n    this.queries.forEach(query => {\r\n      query.removeEntity(entity)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 实体组件变化事件\r\n   * @param entity 实体\r\n   */\r\n  public onEntityComponentChanged(entity: Entity) {\r\n    this.queries.forEach(query => {\r\n      if (query.match(entity)) {\r\n        query.addEntity(entity)\r\n      } else {\r\n        query.removeEntity(entity)\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 统计查询\r\n   * @returns 统计数据\r\n   */\r\n  public stats() {\r\n    const queries = [] as any[]\r\n    this.queries.forEach(query => {\r\n      queries.push(query.stats())\r\n    })\r\n    const numQueries = queries.length\r\n    \r\n    return {\r\n      numQueries,\r\n      queries\r\n    }\r\n  }\r\n}","import { Entity } from './entity'\r\nimport { IComponentClass, IComponent } from './component'\r\nimport { EntityQuery } from './entity-query'\r\nimport { World } from './world'\r\n\r\nexport class EntityManager {\r\n  private entities: Map<string, Entity> = new Map()\r\n  private numEntities: number = 0\r\n  private entityQuery: EntityQuery = new EntityQuery()\r\n  private entitiesWithComponentChanged: Set<Entity> = new Set()\r\n\r\n  constructor(private world: World) {}\r\n\r\n  /**\r\n   * 创建实体\r\n   * @param alias 别名\r\n   * @returns 创建的实体对象\r\n   */\r\n  public createEntity(alias?: string) {\r\n    const entity = this.initEntity(alias)\r\n    this.pushEntity(entity)\r\n    return entity\r\n  }\r\n\r\n  /**\r\n   * 初始化实体\r\n   * @param alias \r\n   */\r\n  private initEntity(alias?: string): Entity {\r\n    const entity = Entity.create(this.world, alias)\r\n    entity.onComponentChanged = entity => {\r\n      this.entitiesWithComponentChanged.add(entity)\r\n    }\r\n    return entity\r\n  }\r\n\r\n  /**\r\n   * 把实体放入实体队列\r\n   * @param entity \r\n   */\r\n  private pushEntity(entity: Entity): void {\r\n    this.numEntities++\r\n    this.entities.set(entity.id, entity)\r\n  }\r\n\r\n  /**\r\n   * 移除实体\r\n   * @param entity 实体\r\n   */\r\n  public removeEntity(entity: Entity) {\r\n    this.entityQuery.onEntityRemoved(entity)\r\n    this.numEntities--\r\n    this.entities.delete(entity.id)\r\n    Entity.destory(entity)\r\n  }\r\n\r\n  /**\r\n   * 判断是否包含实体\r\n   * @param entity \r\n   * @returns true —— 包含, false —— 不包含\r\n   */\r\n  public hasEntity(entity: Entity) {\r\n    return this.entities.has(entity.id)\r\n  }\r\n\r\n  /**\r\n   * 通过实体 id 获取指定实体\r\n   * @param {string} id \r\n   * @returns {Entity | undefined}\r\n   */\r\n  public getEntity(id: string): Entity | undefined {\r\n    return this.entities.get(id)\r\n  }\r\n\r\n  /** 销毁全部实体 */\r\n  public clear() {\r\n    this.entities.forEach(entity => {\r\n      this.removeEntity(entity)\r\n    })\r\n    Entity._pool.clear()\r\n  }\r\n\r\n  /**\r\n   * 为 System 创建实体查询\r\n   * @param QueryComponents 查询条件\r\n   * @param matchType 查询类型 all | any\r\n   * @returns 查询项目\r\n   */\r\n  public createQuery(QueryComponents: IComponentClass<IComponent>[], matchType: string) {\r\n    return this.entityQuery.createQuery(QueryComponents, matchType)\r\n  }\r\n\r\n  /**\r\n   * 更新修改过组件的实体的实体查询\r\n   */\r\n  public updateEntityQuery() {\r\n    this.entitiesWithComponentChanged.forEach(entity => {\r\n      this.entityQuery.onEntityComponentChanged(entity)\r\n    })\r\n    this.entitiesWithComponentChanged.clear()\r\n  }\r\n\r\n  /**\r\n   * 把游戏状态转换为 json 数据\r\n   * \r\n   * NOTE: 该方法会被 JSON.stringify() 隐式调用，该方法定义什么值将被序列化。\r\n   */\r\n  public toJSON() {\r\n    const json: any[] = []\r\n    this.entities.forEach(entity => {\r\n      json.push(entity)\r\n    })\r\n    return json\r\n  }\r\n\r\n  /**\r\n   * 从 json 数据还原游戏状态\r\n   */\r\n  public fromJSON(json: any) {\r\n    for (const token of json) {\r\n      const entity = this.initEntity()\r\n      entity.fromJSON(token)\r\n      this.pushEntity(entity)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 统计实体数据\r\n   * @returns 统计数据\r\n   */\r\n  public stats() {\r\n    const queryStats = this.entityQuery.stats()\r\n\r\n    const numEntities = this.numEntities\r\n    const numQueries = queryStats.numQueries\r\n    const queries = queryStats.queries\r\n    return {\r\n      numEntities,\r\n      numQueries,\r\n      queries,\r\n    }\r\n  }\r\n}\r\n","import { Entity } from './entity'\r\nimport { IComponentClass, IComponent } from './component'\r\nimport { World } from './world'\r\n\r\nexport type ISystemQuery = {\r\n  [queryName: string]: {\r\n    type: 'all' | 'any'\r\n    components: IComponentClass<IComponent>[]\r\n  } | IComponentClass<IComponent>[]\r\n}\r\n\r\nexport type ISystemQueries = {\r\n  [queryName: string]: {\r\n    results: Entity[]\r\n  }\r\n}\r\n\r\nexport type ISystemClass<T extends ISystem> = {\r\n  new (...args: any[]): T\r\n  isSystem: true\r\n  queries?: ISystemQuery\r\n}\r\n\r\n/**\r\n * 系统优先级\r\n */\r\nexport const SystemPriority = {\r\n  Begin: 0,\r\n  Start: 1,\r\n  FixedUpdate: 2,\r\n  Update: 3,\r\n  Animation: 4,\r\n  LateUpdate: 5,\r\n  BeforeRenderer: 6,\r\n  Renderer: 7,\r\n  End: 8\r\n}\r\n\r\nexport class ISystem {\r\n  public static readonly isSystem: true = true\r\n  public static queries?: ISystemQuery\r\n  public world: World = null\r\n  public queries: ISystemQueries = {}\r\n  public _priority: number = -1\r\n  public _executeTime: number = 0\r\n  public init() {}\r\n  public execute(delta: number, timestamp: number) {}\r\n}\r\n","import { World } from './world'\r\nimport { EntityManager } from './entity-manager'\r\nimport { ISystemClass, ISystem, SystemPriority } from './system'\r\nimport { now } from './utils'\r\n\r\nexport class SystemManager {\r\n  private systems: ISystem[] = []\r\n\r\n  constructor(\r\n    private world: World,\r\n    private entityManager: EntityManager\r\n  ) {}\r\n  \r\n  /**\r\n   * 向 system 中注入查询\r\n   * @param systemClass\r\n   * @param system\r\n   */\r\n  private _injectQuery<T extends ISystem>(\r\n    systemClass: ISystemClass<T>,\r\n    system: ISystem\r\n  ) {\r\n    const queries = systemClass.queries\r\n\r\n    if (queries) {\r\n      for (const key in queries) {\r\n        // 偷懒写法，如果是数组，那就当作是\"完全匹配查询\"\r\n        // 如果是 Object，那就判断下属性是否符合要求，不符合就跳过\r\n        if (Array.isArray(queries[key])) {\r\n          const query = this.entityManager.createQuery(queries[key] as any, 'all')\r\n          system.queries[key] = {\r\n            results: query.getEntity()\r\n          }\r\n        } else {\r\n          const { type = 'all', components } = queries[key] as any\r\n          if (type !== 'all' && type !== 'any' && Array.isArray(components)) {\r\n            continue\r\n          }\r\n          const query = this.entityManager.createQuery(components, type)\r\n          system.queries[key] = {\r\n            results: query.getEntity()\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 把 system 放进 system 队列\r\n   * @param system \r\n   */\r\n  private _pushSystem(system: ISystem) {\r\n    const systemCount = this.systems.length\r\n\r\n    if (systemCount > 0) {\r\n      if (system._priority < this.systems[0]._priority) {\r\n        this.systems.unshift(system)\r\n        return\r\n      } else if (system._priority >= this.systems[systemCount - 1]._priority) {\r\n        this.systems.push(system)\r\n        return\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < systemCount; i++) {\r\n      if (system._priority < this.systems[i]._priority) {\r\n        this.systems.splice(i, 0, system)\r\n        return\r\n      }\r\n    }\r\n    this.systems.push(system)\r\n  }\r\n\r\n  /**\r\n   * 注册 system\r\n   * @param systemClass system 类\r\n   * @param priority system 优先级\r\n   */\r\n  public registerSystem<T extends ISystem>(\r\n    systemClass: ISystemClass<T>,\r\n    priority: number = SystemPriority.Update\r\n  ) {\r\n    if (!systemClass.isSystem) {\r\n      throw new Error(`System \"${systemClass.name}\" must extend \"System\" class.`)\r\n    }\r\n    if (this.isRegisterSystem(systemClass)) {\r\n      console.warn(`System \"${systemClass.name}\" already registered.`)\r\n      return\r\n    }\r\n    const system = new systemClass()\r\n    system._priority = priority\r\n    system.world = this.world\r\n    this._injectQuery(systemClass, system)\r\n    this._pushSystem(system)\r\n    system.init()\r\n  }\r\n\r\n  /**\r\n   * 判断 system 是否已经注册\r\n   * @param systemClass\r\n   * @returns true - 已注册，false - 未注册\r\n   */\r\n  public isRegisterSystem<T extends ISystem>(systemClass: ISystemClass<T>) {\r\n    return this.systems.findIndex(system => system instanceof systemClass) !== -1\r\n  }\r\n\r\n  /**\r\n   * 执行 system\r\n   * @param delta 时间差\r\n   * @param timestamp 时间戳\r\n   */\r\n  public execute(delta: number, timestamp: number) {\r\n    this.systems.forEach(system => {\r\n      const startTime = now()\r\n      system.execute(delta, timestamp)\r\n      this.entityManager.updateEntityQuery()\r\n      system._executeTime = now() - startTime\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 统计 System 数据\r\n   * @returns 统计数据\r\n   */\r\n  public stats() {\r\n    return {\r\n      numSystems: this.systems.length,\r\n      executeTime: this.systems.map(system => {\r\n        const systemClass = system.constructor\r\n        return {\r\n          name: systemClass.name,\r\n          executeTime: system._executeTime\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n","import { Entity } from './entity'\r\nimport { IComponent } from './component'\r\nimport { EntityManager } from './entity-manager'\r\nimport { SystemManager } from './system-manager'\r\nimport { ISystemClass, ISystem, SystemPriority } from './system'\r\nimport { now } from './utils'\r\n\r\nexport class World {\r\n  private entityManager: EntityManager = new EntityManager(this)\r\n  private systemManager: SystemManager = new SystemManager(this, this.entityManager)\r\n  public singleton: Entity = Entity.singleton(this)\r\n  private enabled: boolean = false\r\n  private lastTimestamp: number = 0\r\n\r\n  /**\r\n   * 注册 system\r\n   * @param systemClass system 类\r\n   * @param priority system 优先级\r\n   * @returns this\r\n   */\r\n  public registerSystem<T extends ISystem>(\r\n    systemClass: ISystemClass<T>,\r\n    priority: number = SystemPriority.Update\r\n  ) {\r\n    this.systemManager.registerSystem(systemClass, priority)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 创建实体\r\n   * @param alias 实体别名\r\n   * @returns 实体\r\n   */\r\n  public createEntity(alias?: string) {\r\n    return this.entityManager.createEntity(alias)\r\n  }\r\n\r\n  /**\r\n   * 移除实体\r\n   * @param entity 实体\r\n   */\r\n  public removeEntity(entity: Entity) {\r\n    this.entityManager.removeEntity(entity)\r\n  }\r\n\r\n  /**\r\n   * 移除全部实体\r\n   * @param entity 实体\r\n   */\r\n  public removeAllEntity() {\r\n    this.entityManager.clear()\r\n  }\r\n\r\n  /**\r\n   * 判断是否包含实体\r\n   * @param entity \r\n   * @returns true —— 包含, false —— 不包含\r\n   */\r\n  public hasEntity(entity: Entity) {\r\n    return this.entityManager.hasEntity(entity)\r\n  }\r\n\r\n  /**\r\n   * 通过实体 id 获取指定实体\r\n   * @param {string} id \r\n   * @returns {Entity | undefined}\r\n   */\r\n  public getEntity(id: string): Entity | undefined {\r\n    return this.entityManager.getEntity(id)\r\n  }\r\n\r\n  /** 强制更新实体查询 */\r\n  public mandatoryUpdateEntityQuery() {\r\n    this.entityManager.updateEntityQuery()\r\n  }\r\n\r\n  /**\r\n   * 执行帧\r\n   * @param {number} timestamp - 帧时间戳\r\n   */\r\n  public execute(timestamp: number) {\r\n    if (typeof timestamp === 'undefined') {\r\n      timestamp = now()\r\n    }\r\n    let delta = 0\r\n    if (this.lastTimestamp !== 0) {\r\n      delta = timestamp - this.lastTimestamp\r\n    }\r\n    this.lastTimestamp = timestamp\r\n    if (this.enabled) {\r\n      this.systemManager.execute(delta, timestamp)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 启动 world\r\n   */\r\n  public start() {\r\n    this.enabled = true\r\n    this.lastTimestamp = 0\r\n  }\r\n\r\n  /**\r\n   * 停止 world\r\n   */\r\n  public stop() {\r\n    this.enabled = false\r\n  }\r\n\r\n  /**\r\n   * 清理 world 中的实体\r\n   */\r\n  public clear() {\r\n    this.entityManager.clear()\r\n    this.singleton.removeAllComponent()\r\n  }\r\n\r\n  /**\r\n   * 序列化游戏状态\r\n   * @returns 序列化字符串\r\n   */\r\n  public serialize() {\r\n    const token = JSON.stringify({\r\n      entity: this.entityManager,\r\n      singleton: this.singleton\r\n    })\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.log(JSON.parse(token))\r\n    }\r\n    return token\r\n  }\r\n\r\n  /**\r\n   * 反序列化游戏状态\r\n   * @param token 序列化字符串\r\n   */\r\n  public deserialize(token: string) {\r\n    this.clear()\r\n    const json = JSON.parse(token)\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.log(json)\r\n    }\r\n    this.entityManager.fromJSON(json.entity)\r\n    this.singleton.fromJSON(json.singleton)\r\n  }\r\n\r\n  /**\r\n   * 统计实体数据\r\n   * @returns 统计数据\r\n   */\r\n  public stats() {\r\n    const { numEntities, numQueries, queries } = this.entityManager.stats()\r\n    const { numSystems, executeTime } = this.systemManager.stats()\r\n\r\n    return {\r\n      overview: {\r\n        numEntities,\r\n        numSystems,\r\n        numQueries\r\n      },\r\n      systems: executeTime,\r\n      queries,\r\n      pool: {\r\n        entity: Entity.poolStats(),\r\n        component: IComponent.poolStats()\r\n      }\r\n    }\r\n  }\r\n}\r\n","import * as PIXI from 'pixi.js'\r\n\r\nexport class Stage extends PIXI.Container {\r\n  public numLayer: number = 0\r\n  public layerMap: Map<string, PIXI.Container | PIXI.ParticleContainer> = new Map()\r\n\r\n  /**\r\n   * 添加图层到 Stage 中\r\n   * @param layer \r\n   * @param id \r\n   * @param index \r\n   * @private\r\n   */\r\n  private _addLayer(\r\n    layer: PIXI.Container | PIXI.ParticleContainer,\r\n    id: string,\r\n    index?: number\r\n  ) {\r\n    if (index) {\r\n      this.addChildAt(layer, index)\r\n    } else {\r\n      this.addChild(layer)\r\n    }\r\n    this.layerMap.set(id, layer)\r\n    this.numLayer++\r\n  }\r\n\r\n  /**\r\n   * 创建图层\r\n   * @param id \r\n   * @param index \r\n   */\r\n  public createLayer(id: string, index?: number) {\r\n    const layer = new PIXI.Container()\r\n    this._addLayer(layer, id, index)\r\n  }\r\n\r\n  /**\r\n   * 创建粒子图层\r\n   * @param id \r\n   * @param index \r\n   */\r\n  public createParticleLayer(id: string, index?: number) {\r\n    const layer = new PIXI.ParticleContainer()\r\n    this._addLayer(layer, id, index)\r\n  }\r\n\r\n  /**\r\n   * 判断图层是否存在\r\n   * @param id \r\n   */\r\n  public hasLayer(id: string) {\r\n    return this.layerMap.has(id)\r\n  }\r\n\r\n  /**\r\n   * 获得图层\r\n   * @param id \r\n   */\r\n  public getLayer(id: string) {\r\n    if (!this.layerMap.has(id)) {\r\n      console.warn(`There is no layer whose id is \"${id}\".`)\r\n    }\r\n    return this.layerMap.get(id)\r\n  }\r\n\r\n  /**\r\n   * 移除图层\r\n   * @param id \r\n   */\r\n  public removeLayer(id: string) {\r\n    if (this.layerMap.has(id)) {\r\n      const layer = this.layerMap.get(id)\r\n      this.removeChild(layer)\r\n      this.numLayer--\r\n    } else {\r\n      console.warn(`There is no layer whose id is \"${id}\".`)\r\n    }\r\n  }\r\n\r\n  /**清理图层 */\r\n  public clearLayer() {\r\n    this.layerMap.forEach(layer => {\r\n      layer.removeChildren(0)\r\n    })\r\n  }\r\n}","import { World } from '../core'\r\nimport { Stage } from './stage'\r\n\r\nexport class Scene extends World {\r\n  public view: Stage\r\n\r\n  constructor() {\r\n    super()\r\n    this.view = new Stage()\r\n    // 预设11个用户图层\r\n    for (let i = 0; i <= 10; i++) {\r\n      this.addLayer(`UserLayer${i}`)\r\n    }\r\n  }\r\n\r\n  public addLayer(id: string, index?: number) {\r\n    this.view.createLayer(id, index)\r\n  }\r\n\r\n  public addParticleLayer(id: string, index?: number) {\r\n    this.view.createParticleLayer(id, index)\r\n  }\r\n\r\n  public hasLayer(id: string) {\r\n    return this.view.hasLayer(id)\r\n  }\r\n\r\n  public getLayer(id: string) {\r\n    return this.view.getLayer(id)\r\n  }\r\n\r\n  public removeLayer(id: string) {\r\n    this.view.removeLayer(id)\r\n  }\r\n\r\n  public addSprite(layerId: string, sprite: PIXI.Container) {\r\n    const layer = this.getLayer(layerId)\r\n    layer?.addChild(sprite)\r\n  }\r\n\r\n  public removeSprite(layerId: string, sprite: PIXI.Container) {\r\n    const layer = this.getLayer(layerId)\r\n    layer?.removeChild(sprite)\r\n  }\r\n}\r\n","export type InteractivePointerEvent = PointerEvent | TouchEvent | MouseEvent\r\n\r\nexport class Point {\r\n  public x: number\r\n  public y: number\r\n\r\n  constructor(x: number = 0, y: number = x) {\r\n    this.x = x\r\n    this.y = y\r\n  }\r\n\r\n  public set(x: number, y: number = x) {\r\n    this.x = x\r\n    this.y = y\r\n  }\r\n}\r\n\r\n/**\r\n * Holds all information related to an Interaction event\r\n *\r\n * @class\r\n * @memberof PIXI\r\n */\r\nexport class InteractionData {\r\n  /**\r\n   * This point stores the global coords of where the touch/mouse event happened\r\n   *\r\n   * @member {Point}\r\n   */\r\n  public global: Point\r\n\r\n  /**\r\n   * When passed to an event handler, this will be the original DOM Event that was captured\r\n   *\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent\r\n   * @member {MouseEvent|TouchEvent|PointerEvent}\r\n   */\r\n  public originalEvent: InteractivePointerEvent\r\n\r\n  /**\r\n   * Mouse or Touch is down?\r\n   * \r\n   * @member {boolean}\r\n   */\r\n  public isDown: boolean\r\n\r\n  /**\r\n   * Unique identifier for this interaction\r\n   *\r\n   * @member {number}\r\n   */\r\n  public identifier: number\r\n\r\n  /**\r\n   * Indicates whether or not the pointer device that created the event is the primary pointer.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/isPrimary\r\n   * @type {Boolean}\r\n   */\r\n  public isPrimary: boolean\r\n\r\n  /**\r\n   * Indicates which button was pressed on the mouse or pointer device to trigger the event.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/button\r\n   * @type {number}\r\n   */\r\n  public button: number\r\n\r\n  /**\r\n   * Indicates which buttons are pressed on the mouse or pointer device when the event is triggered.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/buttons\r\n   * @type {number}\r\n   */\r\n  public buttons: number\r\n\r\n  /**\r\n   * The width of the pointer's contact along the x-axis, measured in CSS pixels.\r\n   * radiusX of TouchEvents will be represented by this value.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/width\r\n   * @type {number}\r\n   */\r\n  public width: number\r\n\r\n  /**\r\n   * The height of the pointer's contact along the y-axis, measured in CSS pixels.\r\n   * radiusY of TouchEvents will be represented by this value.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/height\r\n   * @type {number}\r\n   */\r\n  public height: number\r\n\r\n  /**\r\n   * The angle, in degrees, between the pointer device and the screen.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/tiltX\r\n   * @type {number}\r\n   */\r\n  public tiltX: number\r\n\r\n  /**\r\n   * The angle, in degrees, between the pointer device and the screen.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/tiltY\r\n   * @type {number}\r\n   */\r\n  public tiltY: number\r\n\r\n  /**\r\n   * The type of pointer that triggered the event.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/pointerType\r\n   * @type {string}\r\n   */\r\n  public pointerType: string\r\n\r\n  /**\r\n   * Pressure applied by the pointing device during the event. A Touch's force property\r\n   * will be represented by this value.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/pressure\r\n   * @type {number}\r\n   */\r\n  public pressure: number\r\n\r\n  /**\r\n   * From TouchEvents (not PointerEvents triggered by touches), the rotationAngle of the Touch.\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Touch/rotationAngle\r\n   * @type {number}\r\n   */\r\n  public rotationAngle: number\r\n\r\n  /**\r\n   * Twist of a stylus pointer.\r\n   * @see https://w3c.github.io/pointerevents/#pointerevent-interface\r\n   * @type {number}\r\n   */\r\n  public twist: number\r\n\r\n  /**\r\n   * Barrel pressure on a stylus pointer.\r\n   * @see https://w3c.github.io/pointerevents/#pointerevent-interface\r\n   * @type {number}\r\n   */\r\n  public tangentialPressure: number\r\n\r\n  constructor() {\r\n    this.global = new Point()\r\n    this.originalEvent = null\r\n    this.isDown = false\r\n\r\n    this.identifier = null\r\n    this.isPrimary = false\r\n    this.button = 0\r\n    this.buttons = 0\r\n    this.width = 0\r\n    this.height = 0\r\n    this.tiltX = 0\r\n    this.tiltY = 0\r\n    this.pointerType = null\r\n    this.pressure = 0\r\n    this.rotationAngle = 0\r\n    this.twist = 0\r\n    this.tangentialPressure = 0\r\n  }\r\n\r\n  /**\r\n   * The unique identifier of the pointer. It will be the same as `identifier`.\r\n   * @readonly\r\n   * @member {number}\r\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/pointerId\r\n   */\r\n  get pointerId(): number {\r\n    return this.identifier\r\n  }\r\n\r\n  /**\r\n   * Copies properties from normalized event data.\r\n   *\r\n   * @param {Touch|MouseEvent|PointerEvent} event - The normalized event data\r\n   */\r\n  public copyEvent(event: Touch | InteractivePointerEvent): void {\r\n    // isPrimary should only change on touchstart/pointerdown, so we don't want to overwrite\r\n    // it with \"false\" on later events when our shim for it on touch events might not be\r\n    // accurate\r\n    if ('isPrimary' in event && event.isPrimary) {\r\n      this.isPrimary = true\r\n    }\r\n    this.button = 'button' in event && event.button\r\n    // event.buttons is not available in all browsers (ie. Safari), but it does have a non-standard\r\n    // event.which property instead, which conveys the same information.\r\n    const buttons = 'buttons' in event && event.buttons\r\n\r\n    this.buttons = Number.isInteger(buttons)\r\n      ? buttons\r\n      : 'which' in event && event.which\r\n    this.width = 'width' in event && event.width\r\n    this.height = 'height' in event && event.height\r\n    this.tiltX = 'tiltX' in event && event.tiltX\r\n    this.tiltY = 'tiltY' in event && event.tiltY\r\n    this.pointerType = 'pointerType' in event && event.pointerType\r\n    this.pressure = 'pressure' in event && event.pressure\r\n    this.rotationAngle = 'rotationAngle' in event && event.rotationAngle\r\n    this.twist = ('twist' in event && event.twist) || 0\r\n    this.tangentialPressure =\r\n      ('tangentialPressure' in event && event.tangentialPressure) || 0\r\n  }\r\n\r\n  /**\r\n   * Resets the data for pooling.\r\n   */\r\n  public reset(): void {\r\n    // isPrimary is the only property that we really need to reset - everything else is\r\n    // guaranteed to be overwritten\r\n    this.isPrimary = false\r\n  }\r\n}\r\n","import type { AbstractRenderer } from 'pixi.js'\r\nimport { InteractionData, Point } from './InteractionData'\r\nimport type { InteractivePointerEvent } from './InteractionData'\r\n\r\nconst MOUSE_POINTER_ID = 1\r\n\r\ninterface CrossCSSStyleDeclaration extends CSSStyleDeclaration {\r\n  msContentZooming: string\r\n  msTouchAction: string\r\n}\r\n\r\nexport class InteractionManager {\r\n  /**\r\n   * Does the device support touch events\r\n   * https://www.w3.org/TR/touch-events/\r\n   *\r\n   * @readonly\r\n   * @member {boolean}\r\n   */\r\n  public readonly supportsTouchEvents: boolean\r\n\r\n  /**\r\n   * Does the device support pointer events\r\n   * https://www.w3.org/Submission/pointer-events/\r\n   *\r\n   * @readonly\r\n   * @member {boolean}\r\n   */\r\n  public readonly supportsPointerEvents: boolean\r\n\r\n  /**\r\n   * The renderer this interaction manager works for.\r\n   *\r\n   * @member {PIXI.AbstractRenderer}\r\n   */\r\n  public renderer: AbstractRenderer\r\n\r\n  /**\r\n   * The mouse data\r\n   *\r\n   * @member {InteractionData}\r\n   */\r\n  public mouse: InteractionData\r\n\r\n  /**\r\n   * The current resolution / device pixel ratio.\r\n   *\r\n   * @member {number}\r\n   * @default 1\r\n   */\r\n  public resolution: number\r\n\r\n  /**\r\n   * The DOM element to bind to.\r\n   *\r\n   * @protected\r\n   * @member {HTMLElement}\r\n   */\r\n  protected interactionDOMElement: HTMLElement\r\n\r\n  /**\r\n   * Have events been attached to the dom element?\r\n   *\r\n   * @protected\r\n   * @member {boolean}\r\n   */\r\n  protected eventsAdded: boolean\r\n\r\n  /**\r\n   * @param {PIXI.CanvasRenderer|PIXI.Renderer} renderer - A reference to the current renderer\r\n   */\r\n  constructor(renderer: AbstractRenderer) {\r\n    this.renderer = renderer\r\n    this.mouse = new InteractionData()\r\n    this.mouse.identifier = MOUSE_POINTER_ID\r\n    this.mouse.global.set(-1)\r\n    this.interactionDOMElement = null\r\n    this.eventsAdded = false\r\n    this.supportsTouchEvents = 'ontouchstart' in window\r\n    this.supportsPointerEvents = !!window.PointerEvent\r\n    this.resolution = 1\r\n\r\n    // this will make it so that you don't have to call bind all the time\r\n    this.onPointerUp = this.onPointerUp.bind(this)\r\n    this.onPointerCancel = this.onPointerCancel.bind(this)\r\n    this.onPointerDown = this.onPointerDown.bind(this)\r\n    this.onPointerMove = this.onPointerMove.bind(this)\r\n    this.onPointerOut = this.onPointerOut.bind(this)\r\n    this.onPointerOver = this.onPointerOver.bind(this)\r\n\r\n    this.setTargetElement(this.renderer.view, this.renderer.resolution)\r\n  }\r\n\r\n  /**\r\n   * Sets the DOM element which will receive mouse/touch events. This is useful for when you have\r\n   * other DOM elements on top of the renderers Canvas element. With this you'll be bale to delegate\r\n   * another DOM element to receive those events.\r\n   *\r\n   * @param {HTMLElement} element - the DOM element which will receive mouse and touch events.\r\n   * @param {number} [resolution=1] - The resolution / device pixel ratio of the new element (relative to the canvas).\r\n   */\r\n  public setTargetElement(element: HTMLElement, resolution: number = 1): void {\r\n    this.removeEvents()\r\n\r\n    this.interactionDOMElement = element\r\n\r\n    this.resolution = resolution\r\n\r\n    this.addEvents()\r\n  }\r\n\r\n  /**\r\n   * Registers all the DOM events\r\n   *\r\n   * @private\r\n   */\r\n  private addEvents(): void {\r\n    if (this.eventsAdded || !this.interactionDOMElement) {\r\n      return\r\n    }\r\n\r\n    const style = this.interactionDOMElement.style as CrossCSSStyleDeclaration\r\n\r\n    if (window.navigator.msPointerEnabled) {\r\n      style.msContentZooming = 'none'\r\n      style.msTouchAction = 'none'\r\n    } else if (this.supportsPointerEvents) {\r\n      style.touchAction = 'none'\r\n    }\r\n\r\n    /*\r\n     * These events are added first, so that if pointer events are normalized, they are fired\r\n     * in the same order as non-normalized events. ie. pointer event 1st, mouse / touch 2nd\r\n     */\r\n    const dom = this.interactionDOMElement\r\n    if (this.supportsPointerEvents) {\r\n      window.document.addEventListener('pointermove', this.onPointerMove, true)\r\n      dom.addEventListener('pointerdown', this.onPointerDown, true)\r\n      // pointerout is fired in addition to pointerup (for touch events) and pointercancel\r\n      // we already handle those, so for the purposes of what we do in onPointerOut, we only\r\n      // care about the pointerleave event\r\n      dom.addEventListener('pointerleave', this.onPointerOut, true)\r\n      dom.addEventListener('pointerover', this.onPointerOver, true)\r\n      window.addEventListener('pointercancel', this.onPointerCancel, true)\r\n      window.addEventListener('pointerup', this.onPointerUp, true)\r\n    } else {\r\n      window.document.addEventListener('mousemove', this.onPointerMove, true)\r\n      dom.addEventListener('mousedown', this.onPointerDown, true)\r\n      dom.addEventListener('mouseout', this.onPointerOut, true)\r\n      dom.addEventListener('mouseover', this.onPointerOver, true)\r\n      window.addEventListener('mouseup', this.onPointerUp, true)\r\n    }\r\n\r\n    // always look directly for touch events so that we can provide original data\r\n    // In a future version we should change this to being just a fallback and rely solely on\r\n    // PointerEvents whenever available\r\n    if (this.supportsTouchEvents) {\r\n      dom.addEventListener('touchstart', this.onPointerDown, true)\r\n      dom.addEventListener('touchcancel', this.onPointerCancel, true)\r\n      dom.addEventListener('touchend', this.onPointerUp, true)\r\n      dom.addEventListener('touchmove', this.onPointerMove, true)\r\n    }\r\n\r\n    this.eventsAdded = true\r\n  }\r\n\r\n  /**\r\n   * Removes all the DOM events that were previously registered\r\n   *\r\n   * @private\r\n   */\r\n  private removeEvents(): void {\r\n    if (!this.eventsAdded || !this.interactionDOMElement) {\r\n      return\r\n    }\r\n\r\n    const style = this.interactionDOMElement.style as CrossCSSStyleDeclaration\r\n\r\n    if (window.navigator.msPointerEnabled) {\r\n      style.msContentZooming = ''\r\n      style.msTouchAction = ''\r\n    } else if (this.supportsPointerEvents) {\r\n      style.touchAction = ''\r\n    }\r\n\r\n    const dom = this.interactionDOMElement\r\n    if (this.supportsPointerEvents) {\r\n      window.document.removeEventListener('pointermove', this.onPointerMove, true)\r\n      dom.removeEventListener('pointerdown', this.onPointerDown, true)\r\n      dom.removeEventListener('pointerleave', this.onPointerOut, true)\r\n      dom.removeEventListener('pointerover', this.onPointerOver, true)\r\n      window.removeEventListener('pointercancel', this.onPointerCancel, true)\r\n      window.removeEventListener('pointerup', this.onPointerUp, true)\r\n    } else {\r\n      window.document.removeEventListener('mousemove', this.onPointerMove, true)\r\n      dom.removeEventListener('mousedown', this.onPointerDown, true)\r\n      dom.removeEventListener('mouseout', this.onPointerOut, true)\r\n      dom.removeEventListener('mouseover', this.onPointerOver, true)\r\n      window.removeEventListener('mouseup', this.onPointerUp, true)\r\n    }\r\n\r\n    if (this.supportsTouchEvents) {\r\n      dom.removeEventListener('touchstart', this.onPointerDown, true)\r\n      dom.removeEventListener('touchcancel', this.onPointerCancel, true)\r\n      dom.removeEventListener('touchend', this.onPointerUp, true)\r\n      dom.removeEventListener('touchmove', this.onPointerMove, true)\r\n    }\r\n\r\n    this.interactionDOMElement = null\r\n\r\n    this.eventsAdded = false\r\n  }\r\n\r\n  /**\r\n   * Maps x and y coords from a DOM object and maps them correctly to the PixiJS view. The\r\n   * resulting value is stored in the point. This takes into account the fact that the DOM\r\n   * element could be scaled and positioned anywhere on the screen.\r\n   *\r\n   * @param  {number} x - the x coord of the position to map\r\n   * @param  {number} y - the y coord of the position to map\r\n   */\r\n  public mapPositionToPoint(x: number, y: number): Point {\r\n    const point = new Point(0)\r\n    let rect\r\n\r\n    // IE 11 fix\r\n    if (!this.interactionDOMElement.parentElement) {\r\n      rect = { x: 0, y: 0, width: 0, height: 0 }\r\n    } else {\r\n      rect = this.interactionDOMElement.getBoundingClientRect()\r\n    }\r\n\r\n    const resolutionMultiplier = 1.0 / this.resolution\r\n\r\n    point.x =\r\n      (x - rect.left) *\r\n      ((this.interactionDOMElement as any).width / rect.width) *\r\n      resolutionMultiplier\r\n    point.y =\r\n      (y - rect.top) *\r\n      ((this.interactionDOMElement as any).height / rect.height) *\r\n      resolutionMultiplier\r\n\r\n    return point\r\n  }\r\n\r\n  /**\r\n   * Process mouse event.\r\n   * @param event \r\n   * @param isDown\r\n   */\r\n  public processInteractive(event: PointerEvent, isDown?: boolean): void {\r\n    const interactionData = this.getInteractionData(event)\r\n\r\n    if (typeof isDown === 'boolean') {\r\n      interactionData.isDown = isDown\r\n    } else {\r\n      interactionData.isDown = this.mouse.isDown\r\n    }\r\n\r\n    this.configureInteractionDataForDOMEvent(event, interactionData)\r\n\r\n    this.mouse = interactionData\r\n  }\r\n\r\n  /**\r\n   * Is called when the pointer button is pressed down on the renderer element\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} originalEvent - The DOM event of a pointer button being pressed down\r\n   */\r\n  private onPointerDown(originalEvent: InteractivePointerEvent): void {\r\n    // if we support touch events, then only use those for touch events, not pointer events\r\n    if (\r\n      this.supportsTouchEvents &&\r\n      (originalEvent as PointerEvent).pointerType === 'touch'\r\n    ) {\r\n      return\r\n    }\r\n\r\n    const events = this.normalizeToPointerData(originalEvent)\r\n\r\n    /*\r\n     * No need to prevent default on natural pointer events, as there are no side effects\r\n     * Normalized events, however, may have the double mousedown/touchstart issue on the native android browser,\r\n     * so still need to be prevented.\r\n     */\r\n\r\n    // Guaranteed that there will be at least one event in events, and all events must have the same pointer type\r\n\r\n    const event = events[0]\r\n\r\n    // if ((event as any).isNormalized) {\r\n    //   const cancelable =\r\n    //     originalEvent.cancelable || !('cancelable' in originalEvent)\r\n\r\n    //   if (cancelable) {\r\n    //     originalEvent.preventDefault()\r\n    //   }\r\n    // }\r\n\r\n    this.processInteractive(event, true)\r\n  }\r\n\r\n  /**\r\n   * Is called when the pointer button is released on the renderer element\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} originalEvent - The DOM event of a pointer button being released\r\n   */\r\n  private onPointerComplete(originalEvent: InteractivePointerEvent): void {\r\n    const events = this.normalizeToPointerData(originalEvent)\r\n\r\n    const event = events[0]\r\n\r\n    this.processInteractive(event, false)\r\n  }\r\n\r\n  /**\r\n   * Is called when the pointer button is cancelled\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} event - The DOM event of a pointer button being released\r\n   */\r\n  private onPointerCancel(event: InteractivePointerEvent): void {\r\n    // if we support touch events, then only use those for touch events, not pointer events\r\n    if (\r\n      this.supportsTouchEvents &&\r\n      (event as PointerEvent).pointerType === 'touch'\r\n    ) {\r\n      return\r\n    }\r\n\r\n    this.onPointerComplete(event)\r\n  }\r\n\r\n  /**\r\n   * Is called when the pointer button is released on the renderer element\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} event - The DOM event of a pointer button being released\r\n   */\r\n  private onPointerUp(event: InteractivePointerEvent): void {\r\n    // if we support touch events, then only use those for touch events, not pointer events\r\n    if (\r\n      this.supportsTouchEvents &&\r\n      (event as PointerEvent).pointerType === 'touch'\r\n    ) {\r\n      return\r\n    }\r\n\r\n    this.onPointerComplete(event)\r\n  }\r\n\r\n  /**\r\n   * Is called when the pointer moves across the renderer element\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} originalEvent - The DOM event of a pointer moving\r\n   */\r\n  private onPointerMove(originalEvent: InteractivePointerEvent): void {\r\n    // if we support touch events, then only use those for touch events, not pointer events\r\n    if (\r\n      this.supportsTouchEvents &&\r\n      (originalEvent as PointerEvent).pointerType === 'touch'\r\n    ) {\r\n      return\r\n    }\r\n\r\n    const events = this.normalizeToPointerData(originalEvent)\r\n\r\n    const event = events[0]\r\n\r\n    this.processInteractive(event)\r\n  }\r\n\r\n  /**\r\n   * Is called when the pointer is moved out of the renderer element\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} originalEvent - The DOM event of a pointer being moved out\r\n   */\r\n  private onPointerOut(originalEvent: InteractivePointerEvent): void {\r\n    // if we support touch events, then only use those for touch events, not pointer events\r\n    if (\r\n      this.supportsTouchEvents &&\r\n      (originalEvent as PointerEvent).pointerType === 'touch'\r\n    ) {\r\n      return\r\n    }\r\n\r\n    const events = this.normalizeToPointerData(originalEvent)\r\n\r\n    // Only mouse and pointer can call onPointerOut, so events will always be length 1\r\n    const event = events[0]\r\n\r\n    this.processInteractive(event)\r\n  }\r\n\r\n  /**\r\n   * Is called when the pointer is moved into the renderer element\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} originalEvent - The DOM event of a pointer button being moved into the renderer view\r\n   */\r\n  private onPointerOver(originalEvent: InteractivePointerEvent): void {\r\n    const events = this.normalizeToPointerData(originalEvent)\r\n\r\n    // Only mouse and pointer can call onPointerOver, so events will always be length 1\r\n    const event = events[0]\r\n\r\n    this.processInteractive(event)\r\n  }\r\n\r\n  /**\r\n   * Get InteractionData.\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} event - Normalized pointer event, output from normalizeToPointerData\r\n   * @return {InteractionData} - Interaction data for the given pointer identifier\r\n   */\r\n  private getInteractionData(event: PointerEvent): InteractionData {\r\n    const pointerId = event.pointerId\r\n\r\n    const interactionData = new InteractionData()\r\n    interactionData.identifier = pointerId\r\n\r\n    // copy properties from the event, so that we can make sure that touch/pointer specific\r\n    // data is available\r\n    interactionData.copyEvent(event)\r\n\r\n    return interactionData\r\n  }\r\n\r\n  /**\r\n   * Configure DOM PointerEvent and InteractionData\r\n   *\r\n   * @private\r\n   * @param {PointerEvent} pointerEvent - The DOM event that will be paired with the InteractionEvent\r\n   * @param {PIXI.InteractionData} interactionData - The InteractionData that will be paired\r\n   *        with the InteractionEvent\r\n   */\r\n  private configureInteractionDataForDOMEvent(\r\n    pointerEvent: PointerEvent,\r\n    interactionData: InteractionData\r\n  ): void {\r\n    interactionData.global = this.mapPositionToPoint(\r\n      pointerEvent.clientX,\r\n      pointerEvent.clientY\r\n    )\r\n\r\n    // Not really sure why this is happening, but it's how a previous version handled things\r\n    if (pointerEvent.pointerType === 'touch') {\r\n      ;(pointerEvent as any).globalX = interactionData.global.x\r\n      ;(pointerEvent as any).globalY = interactionData.global.y\r\n    }\r\n\r\n    interactionData.originalEvent = pointerEvent\r\n  }\r\n\r\n  /**\r\n   * Ensures that the original event object contains all data that a regular pointer event would have\r\n   *\r\n   * @private\r\n   * @param {TouchEvent|MouseEvent|PointerEvent} event - The original event data from a touch or mouse event\r\n   * @return {PointerEvent[]} An array containing a single normalized pointer event, in the case of a pointer\r\n   *  or mouse event, or a multiple normalized pointer events if there are multiple changed touches\r\n   */\r\n  private normalizeToPointerData(\r\n    event: InteractivePointerEvent\r\n  ): PointerEvent[] {\r\n    const normalizedEvents = []\r\n\r\n    if (this.supportsTouchEvents && event instanceof TouchEvent) {\r\n      for (let i = 0, li = event.changedTouches.length; i < li; i++) {\r\n        const touch = event.changedTouches[i] as TouchPointerEvent\r\n\r\n        if (typeof touch.button === 'undefined')\r\n          touch.button = event.touches.length ? 1 : 0\r\n        if (typeof touch.buttons === 'undefined')\r\n          touch.buttons = event.touches.length ? 1 : 0\r\n        if (typeof touch.isPrimary === 'undefined') {\r\n          touch.isPrimary =\r\n            event.touches.length === 1 && event.type === 'touchstart'\r\n        }\r\n        if (typeof touch.width === 'undefined') touch.width = touch.radiusX || 1\r\n        if (typeof touch.height === 'undefined')\r\n          touch.height = touch.radiusY || 1\r\n        if (typeof touch.tiltX === 'undefined') touch.tiltX = 0\r\n        if (typeof touch.tiltY === 'undefined') touch.tiltY = 0\r\n        if (typeof touch.pointerType === 'undefined')\r\n          touch.pointerType = 'touch'\r\n        if (typeof touch.pointerId === 'undefined')\r\n          touch.pointerId = touch.identifier || 0\r\n        if (typeof touch.pressure === 'undefined')\r\n          touch.pressure = touch.force || 0.5\r\n        if (typeof touch.twist === 'undefined') touch.twist = 0\r\n        if (typeof touch.tangentialPressure === 'undefined')\r\n          touch.tangentialPressure = 0\r\n        // TODO: Remove these, as layerX/Y is not a standard, is deprecated, has uneven\r\n        // support, and the fill ins are not quite the same\r\n        // offsetX/Y might be okay, but is not the same as clientX/Y when the canvas's top\r\n        // left is not 0,0 on the page\r\n        if (typeof touch.layerX === 'undefined')\r\n          touch.layerX = touch.offsetX = touch.clientX\r\n        if (typeof touch.layerY === 'undefined')\r\n          touch.layerY = touch.offsetY = touch.clientY\r\n\r\n        // mark the touch as normalized, just so that we know we did it\r\n        touch.isNormalized = true\r\n\r\n        normalizedEvents.push(touch)\r\n      }\r\n    }\r\n    // apparently PointerEvent subclasses MouseEvent, so yay\r\n    else if (\r\n      event instanceof MouseEvent &&\r\n      (!this.supportsPointerEvents || !(event instanceof window.PointerEvent))\r\n    ) {\r\n      const tempEvent = event as MousePointerEvent\r\n\r\n      if (typeof tempEvent.isPrimary === 'undefined') tempEvent.isPrimary = true\r\n      if (typeof tempEvent.width === 'undefined') tempEvent.width = 1\r\n      if (typeof tempEvent.height === 'undefined') tempEvent.height = 1\r\n      if (typeof tempEvent.tiltX === 'undefined') tempEvent.tiltX = 0\r\n      if (typeof tempEvent.tiltY === 'undefined') tempEvent.tiltY = 0\r\n      if (typeof tempEvent.pointerType === 'undefined')\r\n        tempEvent.pointerType = 'mouse'\r\n      if (typeof tempEvent.pointerId === 'undefined')\r\n        tempEvent.pointerId = MOUSE_POINTER_ID\r\n      if (typeof tempEvent.pressure === 'undefined') tempEvent.pressure = 0.5\r\n      if (typeof tempEvent.twist === 'undefined') tempEvent.twist = 0\r\n      if (typeof tempEvent.tangentialPressure === 'undefined')\r\n        tempEvent.tangentialPressure = 0\r\n\r\n      // mark the mouse event as normalized, just so that we know we did it\r\n      tempEvent.isNormalized = true\r\n\r\n      normalizedEvents.push(tempEvent)\r\n    } else {\r\n      normalizedEvents.push(event)\r\n    }\r\n\r\n    return normalizedEvents as PointerEvent[]\r\n  }\r\n\r\n  /**\r\n   * Destroys the interaction manager\r\n   *\r\n   */\r\n  public destroy(): void {\r\n    this.removeEvents()\r\n\r\n    this.renderer = null\r\n\r\n    this.mouse = null\r\n\r\n    this.interactionDOMElement = null\r\n\r\n    this.onPointerDown = null\r\n\r\n    this.onPointerUp = null\r\n\r\n    this.onPointerCancel = null\r\n\r\n    this.onPointerMove = null\r\n\r\n    this.onPointerOut = null\r\n\r\n    this.onPointerOver = null\r\n  }\r\n}\r\n\r\ninterface MousePointerEvent extends PointerEvent {\r\n  isPrimary: boolean\r\n  width: number\r\n  height: number\r\n  tiltX: number\r\n  tiltY: number\r\n  pointerType: string\r\n  pointerId: number\r\n  pressure: number\r\n  twist: number\r\n  tangentialPressure: number\r\n  isNormalized: boolean\r\n}\r\n\r\ninterface TouchPointerEvent extends Touch {\r\n  button: number\r\n  buttons: number\r\n  isPrimary: boolean\r\n  width: number\r\n  height: number\r\n  tiltX: number\r\n  tiltY: number\r\n  pointerType: string\r\n  pointerId: number\r\n  pressure: number\r\n  twist: number\r\n  tangentialPressure: number\r\n  layerX: number\r\n  layerY: number\r\n  offsetX: number\r\n  offsetY: number\r\n  isNormalized: boolean\r\n}\r\n","import { Sprite, Texture } from 'pixi.js'\r\n\r\nclass Flower extends Sprite {\r\n  constructor(texture, clientWidth, clientHeight, maxDist) {\r\n    super(texture)\r\n    this.x = Math.random() * (clientWidth + maxDist) - maxDist / 2\r\n    this.y = Math.random() * (clientHeight + maxDist) - maxDist / 2\r\n    this.z = Math.random() * 0.5 + 0.3\r\n    this.vx = (Math.random() * 1 + 1) * this.z\r\n    this.vy = (Math.random() * 0.5 + 1) * this.z\r\n    this.rotation = Math.random() * Math.PI * 2\r\n    this.anchor.set(0.5)\r\n    this.spin = this.rotation > Math.PI ? 1 : -1\r\n  }\r\n}\r\n\r\nexport default class FlowerFlyBackground {\r\n  constructor({ width, height, amount, maxDist, parent, textureId }) {\r\n    this.width = width\r\n    this.height = height\r\n    this.amount = amount\r\n    this.maxDist = maxDist\r\n    this.parent = parent\r\n    this.textureId = textureId\r\n    this.flowerArr = []\r\n\r\n    this.init()\r\n  }\r\n\r\n  init() {\r\n    const { width, height, amount, maxDist, parent } = this\r\n\r\n    for (let i = 0; i < amount; i++) {\r\n      const texture = Texture.from(`title_gold-${this.textureId}`)\r\n      const flower = new Flower(texture, width, height, maxDist)\r\n      this.flowerArr.push(flower)\r\n      parent.addChild(flower)\r\n    }\r\n  }\r\n\r\n  update(obj) {\r\n    const { width, height, maxDist } = this\r\n    obj.rotation += (0.003 * obj.spin)\r\n    obj.x += obj.vx\r\n    obj.y += obj.vy\r\n    if (obj.x > width + maxDist / 2) {\r\n      obj.x = -(maxDist / 2)\r\n    } else if (obj.xpos < -(maxDist / 2)) {\r\n      obj.x = width + maxDist / 2\r\n    }\r\n    if (obj.y > height + maxDist / 2) {\r\n      obj.y = -(maxDist / 2)\r\n    } else if (obj.y < -(maxDist / 2)) {\r\n      obj.y = height + maxDist / 2\r\n    }\r\n  }\r\n\r\n  tick() {\r\n    const { flowerArr } = this\r\n\r\n    flowerArr.forEach(obj => {\r\n      this.update(obj)\r\n    })\r\n  }\r\n}\r\n","import * as PIXI from 'pixi.js'\r\nimport { Signal } from 'signals'\r\nimport FlowerFlyBackground from './flower'\r\nimport { gameInfo, startMenuStyle } from '../../config'\r\nimport { Sound } from '../../../engine/sound'\r\n\r\nconst fontStyle = startMenuStyle\r\n\r\nconst btnDownStyle = {\r\n  fill: '#ffffff',\r\n  stroke: '#F9B541'\r\n}\r\n\r\nexport class Title {\r\n  static onStartClicked = new Signal()\r\n  static onLoadClicked = new Signal()\r\n  static onSettingClicked = new Signal()\r\n  static onAboutClicked = new Signal()\r\n\r\n  constructor() {\r\n    this.view = new PIXI.Container()\r\n    this.init()\r\n  }\r\n\r\n  init() {\r\n    this._bgmPlay()\r\n    this._addBackground()\r\n    this._addPtcLayer()\r\n    this._addMenu()\r\n  }\r\n\r\n  _addBackground() {\r\n    const background = PIXI.Sprite.from('title_background')\r\n    this.view.addChild(background)\r\n  }\r\n\r\n  _addPtcLayer() {\r\n    this.ptcLayer = new PIXI.Container()\r\n    this.view.addChild(this.ptcLayer)\r\n    this.flowerFly = []\r\n    for (let i = 0; i < 5; i++) {\r\n      let amount = 5\r\n      if (i === 2) {\r\n        amount = 2\r\n      }\r\n      this.flowerFly.push(new FlowerFlyBackground({\r\n        width: gameInfo.width,\r\n        height: gameInfo.height,\r\n        amount,\r\n        maxDist: 100,\r\n        parent: this.ptcLayer,\r\n        textureId: i\r\n      }))\r\n    }\r\n  }\r\n\r\n  _addMenu() {\r\n    const group = new PIXI.Container()\r\n    group.x = 365\r\n    group.y = 380\r\n    const start = this._createButton(0, '开始游戏', () => {\r\n      this._bgmStop()\r\n      Title.onStartClicked.dispatch()\r\n    })\r\n    const load = this._createButton(1, '继续游戏', () => {\r\n      this._bgmStop()\r\n      Title.onLoadClicked.dispatch()\r\n    })\r\n    const setup = this._createButton(2, '系统设置', () => {\r\n      Title.onSettingClicked.dispatch()\r\n    })\r\n    const about = this._createButton(3, '关于游戏', () => {\r\n      Title.onAboutClicked.dispatch()\r\n    })\r\n    group.addChild(start, load, setup, about)\r\n    this.view.addChild(group)\r\n  }\r\n\r\n  _bgmPlay() {\r\n    Sound.play('system_title', {\r\n      loop: true\r\n    })\r\n  }\r\n\r\n  _bgmStop() {\r\n    Sound.stop('system_title')\r\n  }\r\n\r\n  _createButton(index, text, clickHandle) {\r\n    const btnSpace = 30\r\n    const btn = new PIXI.Text(text, fontStyle)\r\n    btn.y = btnSpace * index\r\n    btn.interactive = true\r\n    btn.buttonMode = true\r\n    // 解决文字模糊问题\r\n    btn.resolution = 2\r\n    btn.anchor.set(0.5)\r\n    btn\r\n      .on('pointerdown', onButtonDown)\r\n      .on('pointerup', onButtonUp)\r\n      .on('pointerupoutside', onButtonUp)\r\n      .on('pointerover', onButtonOver)\r\n      .on('pointerout', onButtonOut)\r\n      .on('pointertap', (e) => {\r\n        e.data.originalEvent.preventDefault()\r\n        clickHandle()\r\n      })\r\n    return btn\r\n  }\r\n\r\n  update() {\r\n    this.flowerFly.forEach(item => {\r\n      item.tick()\r\n    })\r\n  }\r\n}\r\n\r\nfunction onButtonDown() {\r\n  const btn = this\r\n  // console.log('pointerdown')\r\n  btn.isdown = true\r\n  btn.scale.set(0.95)\r\n}\r\n\r\nfunction onButtonUp() {\r\n  const btn = this\r\n  if (btn.isOver) {\r\n    btn.style.fill = btnDownStyle.fill\r\n    btn.style.stroke = btnDownStyle.stroke\r\n  } else {\r\n    btn.style.fill = fontStyle.fill\r\n    btn.style.stroke = fontStyle.stroke\r\n  }\r\n  if (!btn.isdown) {\r\n    return\r\n  }\r\n  // console.log('pointerup')\r\n  btn.isdown = false\r\n  btn.scale.set(1)\r\n}\r\n\r\nfunction onButtonOver() {\r\n  const btn = this\r\n  btn.isOver = true\r\n  // console.log('pointerover')\r\n  if (btn.isdown) {\r\n    return\r\n  }\r\n  btn.style.fill = btnDownStyle.fill\r\n  btn.style.stroke = btnDownStyle.stroke\r\n}\r\n\r\nfunction onButtonOut() {\r\n  const btn = this\r\n  btn.isOver = false\r\n  if (btn.isdown) {\r\n    return\r\n  }\r\n  // console.log('pointerout')\r\n  btn.style.fill = fontStyle.fill\r\n  btn.style.stroke = fontStyle.stroke\r\n}\r\n","import * as PIXI from 'pixi.js'\r\nimport { IComponent } from '../../core'\r\n\r\ntype Anchor = {\r\n  x: number\r\n  y: number\r\n}\r\n\r\nexport default class RenderComponent extends IComponent {\r\n  // serialize fields\r\n  public layer: string\r\n  /** 锚点（百分比） */\r\n  public anchor: Anchor\r\n  public visible: boolean\r\n  // temp fields\r\n  public view: PIXI.Container\r\n  public isRender: boolean\r\n\r\n  constructor() {\r\n    super()\r\n    this.layer = 'UserLayer0'\r\n    this.anchor = {\r\n      x: 0,\r\n      y: 0\r\n    }\r\n    this.visible = true\r\n\r\n    this.view = null\r\n    this.isRender = false\r\n  }\r\n\r\n  public revert() {\r\n    this.layer = 'UserLayer0'\r\n    this.anchor = {\r\n      x: 0,\r\n      y: 0\r\n    }\r\n    this.visible = true\r\n\r\n    if (this.view) {\r\n      this.view.destroy()\r\n      this.view = null\r\n    }\r\n    this.isRender = false\r\n  }\r\n\r\n  public getRenderJSON() {\r\n    const { layer, anchor, visible } = this\r\n    return { layer, anchor, visible }\r\n  }\r\n}\r\n","import { Sprite, Texture } from 'pixi.js'\r\nimport RenderComponent from './base/render'\r\nimport { componentRegister } from '../core'\r\n\r\nexport class SpriteComponent extends RenderComponent {\r\n  // serialize fields\r\n  public textureId: string\r\n  // temp fields\r\n  public texture: Texture\r\n\r\n  constructor() {\r\n    super()\r\n    this.textureId = null\r\n    this.texture = null\r\n  }\r\n\r\n  public init() {\r\n    if (this.textureId) {\r\n      this.texture = Texture.from(this.textureId)\r\n    } else {\r\n      this.texture = Texture.EMPTY\r\n    }\r\n    this.view = new Sprite(this.texture)\r\n  }\r\n\r\n  public clear() {\r\n    this.revert()\r\n    this.textureId = null\r\n    this.texture = null\r\n  }\r\n\r\n  public toJSON() {\r\n    const { textureId } = this\r\n    const render = this.getRenderJSON()\r\n\r\n    return {\r\n      textureId,\r\n      ...render\r\n    }\r\n  }\r\n}\r\n\r\ncomponentRegister('SpriteComponent')(SpriteComponent)\r\n","import { AnimatedSprite, Texture } from 'pixi.js'\r\nimport RenderComponent from './base/render'\r\nimport { componentRegister } from '../core'\r\n\r\nexport class AnimationComponent extends RenderComponent {\r\n  // serialize fields\r\n  public texturesId: string[]\r\n  public loop: boolean\r\n  public animationSpeed: number\r\n  public playing: boolean\r\n  /** 动画周期 */\r\n  public cycle: number\r\n  // temp fields\r\n  public textures: Texture[]\r\n\r\n  constructor() {\r\n    super()\r\n    this.texturesId = null\r\n    this.loop = true\r\n    this.animationSpeed = 1\r\n    this.playing = true\r\n    this.cycle = 0\r\n\r\n    this.textures = null\r\n  }\r\n\r\n  public init() {\r\n    if (this.texturesId === null) {\r\n      this.textures = [Texture.EMPTY]\r\n    } else {\r\n      const count = this.texturesId.length\r\n      const fillFrames = this.getFillFrames()\r\n      this.textures = []\r\n\r\n      for (let i = 0; i < fillFrames - count; i++) {\r\n        const texture = Texture.from(this.texturesId[0])\r\n        this.textures.push(texture)\r\n      }\r\n      for (let i = 0; i < count; i++) {\r\n        const texture = Texture.from(this.texturesId[i])\r\n        this.textures.push(texture)\r\n      }\r\n    }\r\n\r\n    this.view = new AnimatedSprite(this.textures)\r\n  }\r\n\r\n  /**\r\n   * 根据动画周期计算补帧帧数\r\n   * \r\n   * @returns {number}\r\n   */\r\n  public getFillFrames(): number {\r\n    return this.cycle * this.animationSpeed / 1000 * 60\r\n  }\r\n\r\n  public clear() {\r\n    this.revert()\r\n    this.texturesId = null\r\n    this.loop = true\r\n    this.animationSpeed = 1\r\n    this.playing = true\r\n    this.cycle = 0\r\n\r\n    this.textures = null\r\n  }\r\n\r\n  public toJSON() {\r\n    const { texturesId, loop, animationSpeed, playing, cycle } = this\r\n    const render = this.getRenderJSON()\r\n\r\n    return {\r\n      texturesId, loop, animationSpeed, playing, cycle,\r\n      ...render\r\n    }\r\n  }\r\n}\r\n\r\ncomponentRegister('AnimationComponent')(AnimationComponent)\r\n","/* eslint max-depth: [2, 8] */\r\nimport { Sprite } from '@pixi/sprite';\r\nimport { Texture } from '@pixi/core';\r\nimport { settings } from '@pixi/settings';\r\nimport { Rectangle } from '@pixi/math';\r\nimport { sign, trimCanvas, hex2rgb, string2hex } from '@pixi/utils';\r\nimport { TextStyle, TextMetrics } from '@pixi/text';\r\n\r\nconst TEXT_GRADIENT = {\r\n    LINEAR_VERTICAL: 0,\r\n    LINEAR_HORIZONTAL: 1,\r\n};\r\n\r\nconst defaultDestroyOptions = {\r\n    texture: true,\r\n    children: false,\r\n    baseTexture: true,\r\n};\r\n\r\nfunction processBbcode(tokens, token, i, magic) {\r\n    let type = 'none';\r\n    let index = i;\r\n    let params = {};\r\n    if (token === '[') {\r\n        index += magic; // magic should be 3 or 7\r\n        let bbcode = tokens.slice(i, index + 1).join('');\r\n        if (bbcode === '[style={') {\r\n            let json = '';\r\n            let tmp;\r\n            do {\r\n                tmp = tokens[index];\r\n                json += tmp;\r\n                index++;\r\n            } while (tmp !== '}')\r\n            params = JSON.parse(json);\r\n            type = 'open';\r\n        } else if (bbcode === '[/style]') {\r\n            type = 'close';\r\n        }\r\n    }\r\n\r\n    return {\r\n        type,\r\n        index,\r\n        params\r\n    };\r\n}\r\n\r\nTextMetrics.tokenize = function (text) {\r\n    const tokens = [];\r\n    let token = '';\r\n    if (typeof text !== 'string') {\r\n        return tokens;\r\n    }\r\n\r\n    for (let i = 0; i < text.length; i++) {\r\n        const char = text[i];\r\n        if (!/[a-z'-]/i.test(char)) {\r\n            if (token !== '') {\r\n                tokens.push(token);\r\n                token = '';\r\n            }\r\n            tokens.push(char);\r\n        } else {\r\n            token += char;\r\n        }\r\n    }\r\n\r\n    if (token !== '') {\r\n        tokens.push(token);\r\n    }\r\n\r\n    return tokens;\r\n}\r\n\r\nTextMetrics.wordWrap = function(text, style, canvas = TextMetrics._canvas) {\r\n    const context = canvas.getContext('2d');\r\n    let width = 0;\r\n    let line = '';\r\n    let lines = '';\r\n    const cache = {};\r\n    const { letterSpacing, whiteSpace } = style;\r\n    // How to handle whitespaces\r\n    const collapseSpaces = TextMetrics.collapseSpaces(whiteSpace);\r\n    const collapseNewlines = TextMetrics.collapseNewlines(whiteSpace);\r\n    // whether or not spaces may be added to the beginning of lines\r\n    let canPrependSpaces = !collapseSpaces;\r\n    // There is letterSpacing after every char except the last one\r\n    // t_h_i_s_' '_i_s_' '_a_n_' '_e_x_a_m_p_l_e_' '_!\r\n    // so for convenience the above needs to be compared to width + 1 extra letterSpace\r\n    // t_h_i_s_' '_i_s_' '_a_n_' '_e_x_a_m_p_l_e_' '_!_\r\n    // ________________________________________________\r\n    // And then the final space is simply no appended to each line\r\n    const wordWrapWidth = style.wordWrapWidth + letterSpacing;\r\n    // break text into words, spaces and newline chars\r\n    const tokens = TextMetrics.tokenize(text);\r\n    for (let i = 0; i < tokens.length; i++) {\r\n        // get the word, space or newlineChar\r\n        let token = tokens[i];\r\n        // parse bbcode and adjust index\r\n        const result = processBbcode(tokens, token, i, 3);\r\n        if (result.type !== 'none') {\r\n            i = result.index + 1;\r\n            if (i >= tokens.length) {\r\n                continue;\r\n            }\r\n            token = tokens[i];\r\n        }\r\n        // if word is a new line\r\n        if (TextMetrics.isNewline(token)) {\r\n            // keep the new line\r\n            if (!collapseNewlines) {\r\n                lines += TextMetrics.addLine(line);\r\n                canPrependSpaces = !collapseSpaces;\r\n                line = '';\r\n                width = 0;\r\n                continue;\r\n            }\r\n            // if we should collapse new lines\r\n            // we simply convert it into a space\r\n            token = ' ';\r\n        }\r\n        // if we should collapse repeated whitespaces\r\n        if (collapseSpaces) {\r\n            // check both this and the last tokens for spaces\r\n            const currIsBreakingSpace = TextMetrics.isBreakingSpace(token);\r\n            const lastIsBreakingSpace = TextMetrics.isBreakingSpace(line[line.length - 1]);\r\n            if (currIsBreakingSpace && lastIsBreakingSpace) {\r\n                continue;\r\n            }\r\n        }\r\n        // get word width from cache if possible\r\n        const tokenWidth = TextMetrics.getFromCache(token, letterSpacing, cache, context);\r\n        // word is longer than desired bounds\r\n        if (tokenWidth > wordWrapWidth) {\r\n            // if we are not already at the beginning of a line\r\n            if (line !== '') {\r\n                // start newlines for overflow words\r\n                lines += TextMetrics.addLine(line);\r\n                line = '';\r\n                width = 0;\r\n            }\r\n            // break large word over multiple lines\r\n            if (TextMetrics.canBreakWords(token, style.breakWords)) {\r\n                // break word into characters\r\n                const characters = TextMetrics.wordWrapSplit(token);\r\n                // loop the characters\r\n                for (let j = 0; j < characters.length; j++) {\r\n                    let char = characters[j];\r\n                    let k = 1;\r\n                    // we are not at the end of the token\r\n                    while (characters[j + k]) {\r\n                        const nextChar = characters[j + k];\r\n                        const lastChar = char[char.length - 1];\r\n                        // should not split chars\r\n                        if (!TextMetrics.canBreakChars(lastChar, nextChar, token, j, style.breakWords)) {\r\n                            // combine chars & move forward one\r\n                            char += nextChar;\r\n                        }\r\n                        else {\r\n                            break;\r\n                        }\r\n                        k++;\r\n                    }\r\n                    j += char.length - 1;\r\n                    const characterWidth = TextMetrics.getFromCache(char, letterSpacing, cache, context);\r\n                    if (characterWidth + width > wordWrapWidth) {\r\n                        lines += TextMetrics.addLine(line);\r\n                        canPrependSpaces = false;\r\n                        line = '';\r\n                        width = 0;\r\n                    }\r\n                    line += char;\r\n                    width += characterWidth;\r\n                }\r\n            }\r\n            // run word out of the bounds\r\n            else {\r\n                // if there are words in this line already\r\n                // finish that line and start a new one\r\n                if (line.length > 0) {\r\n                    lines += TextMetrics.addLine(line);\r\n                    line = '';\r\n                    width = 0;\r\n                }\r\n                const isLastToken = i === tokens.length - 1;\r\n                // give it its own line if it's not the end\r\n                lines += TextMetrics.addLine(token, !isLastToken);\r\n                canPrependSpaces = false;\r\n                line = '';\r\n                width = 0;\r\n            }\r\n        }\r\n        // word could fit\r\n        else {\r\n            // word won't fit because of existing words\r\n            // start a new line\r\n            if (tokenWidth + width > wordWrapWidth) {\r\n                // if its a space we don't want it\r\n                canPrependSpaces = false;\r\n                // add a new line\r\n                lines += TextMetrics.addLine(line);\r\n                // start a new line\r\n                line = '';\r\n                width = 0;\r\n            }\r\n            // don't add spaces to the beginning of lines\r\n            if (line.length > 0 || !TextMetrics.isBreakingSpace(token) || canPrependSpaces) {\r\n                // add the word to the current line\r\n                line += token;\r\n                // update width counter\r\n                width += tokenWidth;\r\n            }\r\n        }\r\n    }\r\n    lines += TextMetrics.addLine(line, false);\r\n    return lines;\r\n}\r\n\r\nexport class RainbowText extends Sprite {\r\n    /**\r\n     * @param {string} text - The string that you would like the text to display\r\n     * @param {object|PIXI.TextStyle} [style] - The style parameters\r\n     * @param {HTMLCanvasElement} [canvas] - The canvas element for drawing text\r\n     */\r\n    constructor(text, style, canvas) {\r\n        let ownCanvas = false;\r\n        if (!canvas) {\r\n            canvas = document.createElement('canvas');\r\n            ownCanvas = true;\r\n        }\r\n        canvas.width = 3;\r\n        canvas.height = 3;\r\n        const texture = Texture.from(canvas);\r\n        texture.orig = new Rectangle();\r\n        texture.trim = new Rectangle();\r\n        super(texture);\r\n        /**\r\n         * Keep track if this Text object created it's own canvas\r\n         * element (`true`) or uses the constructor argument (`false`).\r\n         * Used to workaround a GC issues with Safari < 13 when\r\n         * destroying Text. See `destroy` for more info.\r\n         *\r\n         * @member {boolean}\r\n         * @private\r\n         */\r\n        this._ownCanvas = ownCanvas;\r\n        /**\r\n         * The canvas element that everything is drawn to\r\n         *\r\n         * @member {HTMLCanvasElement}\r\n         */\r\n        this.canvas = canvas;\r\n        /**\r\n         * The canvas 2d context that everything is drawn with\r\n         * @member {CanvasRenderingContext2D}\r\n         */\r\n        this.context = this.canvas.getContext('2d');\r\n        /**\r\n         * The resolution / device pixel ratio of the canvas.\r\n         * This is set to automatically match the renderer resolution by default, but can be overridden by setting manually.\r\n         * @member {number}\r\n         * @default 1\r\n         */\r\n        this._resolution = settings.RESOLUTION;\r\n        this._autoResolution = true;\r\n        /**\r\n         * Private tracker for the current text.\r\n         *\r\n         * @member {string}\r\n         * @private\r\n         */\r\n        this._text = null;\r\n        /**\r\n         * Private tracker for the current style.\r\n         *\r\n         * @member {object}\r\n         * @private\r\n         */\r\n        this._style = null;\r\n        /**\r\n         * Private listener to track style changes.\r\n         *\r\n         * @member {Function}\r\n         * @private\r\n         */\r\n        this._styleListener = null;\r\n        /**\r\n         * Private tracker for the current font.\r\n         *\r\n         * @member {string}\r\n         * @private\r\n         */\r\n        this._font = '';\r\n        this.text = text;\r\n        this.style = style;\r\n        this.localStyleID = -1;\r\n        this.bbcodeFillIndex = 0;\r\n        this.bbcodeStrokeIndex = 0;\r\n    }\r\n    /**\r\n     * Renders text to its canvas, and updates its texture.\r\n     * By default this is used internally to ensure the texture is correct before rendering,\r\n     * but it can be used called externally, for example from this class to 'pre-generate' the texture from a piece of text,\r\n     * and then shared across multiple Sprites.\r\n     *\r\n     * @param {boolean} respectDirty - Whether to abort updating the text if the Text isn't dirty and the function is called.\r\n     */\r\n    updateText(respectDirty) {\r\n        const style = this._style;\r\n        // check if style has changed..\r\n        if (this.localStyleID !== style.styleID) {\r\n            this.dirty = true;\r\n            this.localStyleID = style.styleID;\r\n        }\r\n        if (!this.dirty && respectDirty) {\r\n            return;\r\n        }\r\n        this._font = this._style.toFontString();\r\n        const context = this.context;\r\n        const measured = TextMetrics.measureText(this._text || ' ', this._style, this._style.wordWrap, this.canvas);\r\n        const width = measured.width;\r\n        const height = measured.height;\r\n        const lines = measured.lines;\r\n        const lineHeight = measured.lineHeight;\r\n        const lineWidths = measured.lineWidths;\r\n        const maxLineWidth = measured.maxLineWidth;\r\n        const fontProperties = measured.fontProperties;\r\n        this.canvas.width = Math.ceil((Math.max(1, width) + (style.padding * 2)) * this._resolution);\r\n        this.canvas.height = Math.ceil((Math.max(1, height) + (style.padding * 2)) * this._resolution);\r\n        context.scale(this._resolution, this._resolution);\r\n        context.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        context.font = this._font;\r\n        context.lineWidth = style.strokeThickness;\r\n        context.textBaseline = style.textBaseline;\r\n        context.lineJoin = style.lineJoin;\r\n        context.miterLimit = style.miterLimit;\r\n        let linePositionX;\r\n        let linePositionY;\r\n        // require 2 passes if a shadow; the first to draw the drop shadow, the second to draw the text\r\n        const passesCount = style.dropShadow ? 2 : 1;\r\n        // For v4, we drew text at the colours of the drop shadow underneath the normal text. This gave the correct zIndex,\r\n        // but features such as alpha and shadowblur did not look right at all, since we were using actual text as a shadow.\r\n        //\r\n        // For v5.0.0, we moved over to just use the canvas API for drop shadows, which made them look much nicer and more\r\n        // visually please, but now because the stroke is drawn and then the fill, drop shadows would appear on both the fill\r\n        // and the stroke; and fill drop shadows would appear over the top of the stroke.\r\n        //\r\n        // For v5.1.1, the new route is to revert to v4 style of drawing text first to get the drop shadows underneath normal\r\n        // text, but instead drawing text in the correct location, we'll draw it off screen (-paddingY), and then adjust the\r\n        // drop shadow so only that appears on screen (+paddingY). Now we'll have the correct draw order of the shadow\r\n        // beneath the text, whilst also having the proper text shadow styling.\r\n        for (let i = 0; i < passesCount; ++i) {\r\n            const isShadowPass = style.dropShadow && i === 0;\r\n            const dsOffsetText = isShadowPass ? height * 2 : 0; // we only want the drop shadow, so put text way off-screen\r\n            const dsOffsetShadow = dsOffsetText * this.resolution;\r\n            if (isShadowPass) {\r\n                // On Safari, text with gradient and drop shadows together do not position correctly\r\n                // if the scale of the canvas is not 1: https://bugs.webkit.org/show_bug.cgi?id=197689\r\n                // Therefore we'll set the styles to be a plain black whilst generating this drop shadow\r\n                context.fillStyle = 'black';\r\n                context.strokeStyle = 'black';\r\n                const dropShadowColor = style.dropShadowColor;\r\n                const rgb = hex2rgb(typeof dropShadowColor === 'number' ? dropShadowColor : string2hex(dropShadowColor));\r\n                context.shadowColor = `rgba(${rgb[0] * 255},${rgb[1] * 255},${rgb[2] * 255},${style.dropShadowAlpha})`;\r\n                context.shadowBlur = style.dropShadowBlur;\r\n                context.shadowOffsetX = Math.cos(style.dropShadowAngle) * style.dropShadowDistance;\r\n                context.shadowOffsetY = (Math.sin(style.dropShadowAngle) * style.dropShadowDistance) + dsOffsetShadow;\r\n            }\r\n            else {\r\n                // set canvas text styles\r\n                context.fillStyle = this._generateFillStyle(style, lines, measured);\r\n                // TODO: Can't have different types for getter and setter. The getter shouldn't have the number type as\r\n                //       the setter converts to string. See this thread for more details:\r\n                //       https://github.com/microsoft/TypeScript/issues/2521\r\n                context.strokeStyle = style.stroke;\r\n                context.shadowColor = '0';\r\n                context.shadowBlur = 0;\r\n                context.shadowOffsetX = 0;\r\n                context.shadowOffsetY = 0;\r\n            }\r\n            // draw lines line by line\r\n            const text = this._text.replace(/(?:\\r\\n|\\r|\\n)/g, '');\r\n            const originText = Array.from ? Array.from(text) : text.split('');\r\n            for (let i = 0; i < lines.length; i++) {\r\n                linePositionX = style.strokeThickness / 2;\r\n                linePositionY = ((style.strokeThickness / 2) + (i * lineHeight)) + fontProperties.ascent;\r\n                if (style.align === 'right') {\r\n                    linePositionX += maxLineWidth - lineWidths[i];\r\n                }\r\n                else if (style.align === 'center') {\r\n                    linePositionX += (maxLineWidth - lineWidths[i]) / 2;\r\n                }\r\n\r\n                if (style.stroke && style.strokeThickness) {\r\n                    this.drawLetterSpacing(originText, lines[i], linePositionX + style.padding, linePositionY + style.padding - dsOffsetText, true);\r\n                }\r\n                if (style.fill) {\r\n                    this.drawLetterSpacing(originText, lines[i], linePositionX + style.padding, linePositionY + style.padding - dsOffsetText);\r\n                }\r\n            }\r\n            this.bbcodeFillIndex = 0\r\n            this.bbcodeStrokeIndex = 0\r\n        }\r\n        this.updateTexture();\r\n    }\r\n    /**\r\n     * Render the text with letter-spacing.\r\n     * @param {string} text - The text to draw\r\n     * @param {number} x - Horizontal position to draw the text\r\n     * @param {number} y - Vertical position to draw the text\r\n     * @param {boolean} [isStroke=false] - Is this drawing for the outside stroke of the\r\n     *  text? If not, it's for the inside fill\r\n     * @private\r\n     */\r\n    drawLetterSpacing(originText, text, x, y, isStroke = false) {\r\n        const style = this._style;\r\n        // letterSpacing of 0 means normal\r\n        const letterSpacing = style.letterSpacing;\r\n        let currentPosition = x;\r\n        // Using Array.from correctly splits characters whilst keeping emoji together.\r\n        // This is not supported on IE as it requires ES6, so regular text splitting occurs.\r\n        // This also doesn't account for emoji that are multiple emoji put together to make something else.\r\n        // Handling all of this would require a big library itself.\r\n        // https://medium.com/@giltayar/iterating-over-emoji-characters-the-es6-way-f06e4589516\r\n        // https://github.com/orling/grapheme-splitter\r\n        const stringArray = Array.from ? Array.from(text) : text.split('');\r\n        let previousWidth = this.context.measureText(text).width;\r\n        let currentWidth = 0;\r\n        for (let i = 0; i < stringArray.length; ++i) {\r\n            const currentChar = stringArray[i];\r\n            if (isStroke) {\r\n                const result = processBbcode(originText, originText[this.bbcodeStrokeIndex], this.bbcodeStrokeIndex, 7);\r\n                if (result.type === 'open') {\r\n                    const params = result.params;\r\n                    if (params.fill) {\r\n                        this.context.strokeStyle = params.stroke;\r\n                    }\r\n                } else if (result.type === 'close') {\r\n                    this.context.strokeStyle = style.stroke;\r\n                }\r\n                if (result.type !== 'none') {\r\n                    const offset = result.index - this.bbcodeStrokeIndex;\r\n                    this.bbcodeStrokeIndex = this.bbcodeStrokeIndex + offset + 1;\r\n                    if (this.bbcodeStrokeIndex >= originText.length) {\r\n                        continue;\r\n                    }\r\n                }\r\n                this.bbcodeStrokeIndex++;\r\n                this.context.strokeText(currentChar, currentPosition, y);\r\n            }\r\n            else {\r\n                const result = processBbcode(originText, originText[this.bbcodeFillIndex], this.bbcodeFillIndex, 7);\r\n                if (result.type === 'open') {\r\n                    const params = result.params;\r\n                    if (params.fill) {\r\n                        this.context.fillStyle = params.fill;\r\n                    }\r\n                } else if (result.type === 'close') {\r\n                    this.context.fillStyle = style.fill;\r\n                }\r\n                if (result.type !== 'none') {\r\n                    const offset = result.index - this.bbcodeFillIndex;\r\n                    this.bbcodeFillIndex = this.bbcodeFillIndex + offset + 1;\r\n                    if (this.bbcodeFillIndex >= originText.length) {\r\n                        continue;\r\n                    }\r\n                }\r\n                this.bbcodeFillIndex++;\r\n                this.context.fillText(currentChar, currentPosition, y);\r\n            }\r\n            currentWidth = this.context.measureText(text.substring(i + 1)).width;\r\n            currentPosition += previousWidth - currentWidth + letterSpacing;\r\n            previousWidth = currentWidth;\r\n        }\r\n    }\r\n    /**\r\n     * Updates texture size based on canvas size\r\n     *\r\n     * @private\r\n     */\r\n    updateTexture() {\r\n        const canvas = this.canvas;\r\n        if (this._style.trim) {\r\n            const trimmed = trimCanvas(canvas);\r\n            if (trimmed.data) {\r\n                canvas.width = trimmed.width;\r\n                canvas.height = trimmed.height;\r\n                this.context.putImageData(trimmed.data, 0, 0);\r\n            }\r\n        }\r\n        const texture = this._texture;\r\n        const style = this._style;\r\n        const padding = style.trim ? 0 : style.padding;\r\n        const baseTexture = texture.baseTexture;\r\n        texture.trim.width = texture._frame.width = Math.ceil(canvas.width / this._resolution);\r\n        texture.trim.height = texture._frame.height = Math.ceil(canvas.height / this._resolution);\r\n        texture.trim.x = -padding;\r\n        texture.trim.y = -padding;\r\n        texture.orig.width = texture._frame.width - (padding * 2);\r\n        texture.orig.height = texture._frame.height - (padding * 2);\r\n        // call sprite onTextureUpdate to update scale if _width or _height were set\r\n        this._onTextureUpdate();\r\n        baseTexture.setRealSize(canvas.width, canvas.height, this._resolution);\r\n        // Recursively updates transform of all objects from the root to this one\r\n        this._recursivePostUpdateTransform();\r\n        this.dirty = false;\r\n    }\r\n    /**\r\n     * Renders the object using the WebGL renderer\r\n     *\r\n     * @protected\r\n     * @param {PIXI.Renderer} renderer - The renderer\r\n     */\r\n    _render(renderer) {\r\n        if (this._autoResolution && this._resolution !== renderer.resolution) {\r\n            this._resolution = renderer.resolution;\r\n            this.dirty = true;\r\n        }\r\n        this.updateText(true);\r\n        super._render(renderer);\r\n    }\r\n    /**\r\n     * Gets the local bounds of the text object.\r\n     *\r\n     * @param {PIXI.Rectangle} rect - The output rectangle.\r\n     * @return {PIXI.Rectangle} The bounds.\r\n     */\r\n    getLocalBounds(rect) {\r\n        this.updateText(true);\r\n        return super.getLocalBounds.call(this, rect);\r\n    }\r\n    /**\r\n     * calculates the bounds of the Text as a rectangle. The bounds calculation takes the worldTransform into account.\r\n     * @protected\r\n     */\r\n    _calculateBounds() {\r\n        this.updateText(true);\r\n        this.calculateVertices();\r\n        // if we have already done this on THIS frame.\r\n        this._bounds.addQuad(this.vertexData);\r\n    }\r\n    /**\r\n     * Generates the fill style. Can automatically generate a gradient based on the fill style being an array\r\n     *\r\n     * @private\r\n     * @param {object} style - The style.\r\n     * @param {string[]} lines - The lines of text.\r\n     * @return {string|number|CanvasGradient} The fill style\r\n     */\r\n    _generateFillStyle(style, lines, metrics) {\r\n        // TODO: Can't have different types for getter and setter. The getter shouldn't have the number type as\r\n        //       the setter converts to string. See this thread for more details:\r\n        //       https://github.com/microsoft/TypeScript/issues/2521\r\n        const fillStyle = style.fill;\r\n        if (!Array.isArray(fillStyle)) {\r\n            return fillStyle;\r\n        }\r\n        else if (fillStyle.length === 1) {\r\n            return fillStyle[0];\r\n        }\r\n        // the gradient will be evenly spaced out according to how large the array is.\r\n        // ['#FF0000', '#00FF00', '#0000FF'] would created stops at 0.25, 0.5 and 0.75\r\n        let gradient;\r\n        // a dropshadow will enlarge the canvas and result in the gradient being\r\n        // generated with the incorrect dimensions\r\n        const dropShadowCorrection = (style.dropShadow) ? style.dropShadowDistance : 0;\r\n        // should also take padding into account, padding can offset the gradient\r\n        const padding = style.padding || 0;\r\n        const width = Math.ceil(this.canvas.width / this._resolution) - dropShadowCorrection - (padding * 2);\r\n        const height = Math.ceil(this.canvas.height / this._resolution) - dropShadowCorrection - (padding * 2);\r\n        // make a copy of the style settings, so we can manipulate them later\r\n        const fill = fillStyle.slice();\r\n        const fillGradientStops = style.fillGradientStops.slice();\r\n        // wanting to evenly distribute the fills. So an array of 4 colours should give fills of 0.25, 0.5 and 0.75\r\n        if (!fillGradientStops.length) {\r\n            const lengthPlus1 = fill.length + 1;\r\n            for (let i = 1; i < lengthPlus1; ++i) {\r\n                fillGradientStops.push(i / lengthPlus1);\r\n            }\r\n        }\r\n        // stop the bleeding of the last gradient on the line above to the top gradient of the this line\r\n        // by hard defining the first gradient colour at point 0, and last gradient colour at point 1\r\n        fill.unshift(fillStyle[0]);\r\n        fillGradientStops.unshift(0);\r\n        fill.push(fillStyle[fillStyle.length - 1]);\r\n        fillGradientStops.push(1);\r\n        if (style.fillGradientType === TEXT_GRADIENT.LINEAR_VERTICAL) {\r\n            // start the gradient at the top center of the canvas, and end at the bottom middle of the canvas\r\n            gradient = this.context.createLinearGradient(width / 2, padding, width / 2, height + padding);\r\n            // we need to repeat the gradient so that each individual line of text has the same vertical gradient effect\r\n            // ['#FF0000', '#00FF00', '#0000FF'] over 2 lines would create stops at 0.125, 0.25, 0.375, 0.625, 0.75, 0.875\r\n            // There's potential for floating point precision issues at the seams between gradient repeats.\r\n            // The loop below generates the stops in order, so track the last generated one to prevent\r\n            // floating point precision from making us go the teeniest bit backwards, resulting in\r\n            // the first and last colors getting swapped.\r\n            let lastIterationStop = 0;\r\n            // Actual height of the text itself, not counting spacing for lineHeight/leading/dropShadow etc\r\n            const textHeight = metrics.fontProperties.fontSize + style.strokeThickness;\r\n            // textHeight, but as a 0-1 size in global gradient stop space\r\n            const gradStopLineHeight = textHeight / height;\r\n            for (let i = 0; i < lines.length; i++) {\r\n                const thisLineTop = metrics.lineHeight * i;\r\n                for (let j = 0; j < fill.length; j++) {\r\n                    // 0-1 stop point for the current line, multiplied to global space afterwards\r\n                    let lineStop = 0;\r\n                    if (typeof fillGradientStops[j] === 'number') {\r\n                        lineStop = fillGradientStops[j];\r\n                    }\r\n                    else {\r\n                        lineStop = j / fill.length;\r\n                    }\r\n                    const globalStop = (thisLineTop / height) + (lineStop * gradStopLineHeight);\r\n                    // Prevent color stop generation going backwards from floating point imprecision\r\n                    let clampedStop = Math.max(lastIterationStop, globalStop);\r\n                    clampedStop = Math.min(clampedStop, 1); // Cap at 1 as well for safety's sake to avoid a possible throw.\r\n                    gradient.addColorStop(clampedStop, fill[j]);\r\n                    lastIterationStop = clampedStop;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            // start the gradient at the center left of the canvas, and end at the center right of the canvas\r\n            gradient = this.context.createLinearGradient(padding, height / 2, width + padding, height / 2);\r\n            // can just evenly space out the gradients in this case, as multiple lines makes no difference\r\n            // to an even left to right gradient\r\n            const totalIterations = fill.length + 1;\r\n            let currentIteration = 1;\r\n            for (let i = 0; i < fill.length; i++) {\r\n                let stop;\r\n                if (typeof fillGradientStops[i] === 'number') {\r\n                    stop = fillGradientStops[i];\r\n                }\r\n                else {\r\n                    stop = currentIteration / totalIterations;\r\n                }\r\n                gradient.addColorStop(stop, fill[i]);\r\n                currentIteration++;\r\n            }\r\n        }\r\n        return gradient;\r\n    }\r\n    /**\r\n     * Destroys this text object.\r\n     * Note* Unlike a Sprite, a Text object will automatically destroy its baseTexture and texture as\r\n     * the majority of the time the texture will not be shared with any other Sprites.\r\n     *\r\n     * @param {object|boolean} [options] - Options parameter. A boolean will act as if all options\r\n     *  have been set to that value\r\n     * @param {boolean} [options.children=false] - if set to true, all the children will have their\r\n     *  destroy method called as well. 'options' will be passed on to those calls.\r\n     * @param {boolean} [options.texture=true] - Should it destroy the current texture of the sprite as well\r\n     * @param {boolean} [options.baseTexture=true] - Should it destroy the base texture of the sprite as well\r\n     */\r\n    destroy(options) {\r\n        if (typeof options === 'boolean') {\r\n            options = { children: options };\r\n        }\r\n        options = Object.assign({}, defaultDestroyOptions, options);\r\n        super.destroy(options);\r\n        // set canvas width and height to 0 to workaround memory leak in Safari < 13\r\n        // https://stackoverflow.com/questions/52532614/total-canvas-memory-use-exceeds-the-maximum-limit-safari-12\r\n        if (this._ownCanvas) {\r\n            this.canvas.height = this.canvas.width = 0;\r\n        }\r\n        // make sure to reset the the context and canvas.. dont want this hanging around in memory!\r\n        this.context = null;\r\n        this.canvas = null;\r\n        this._style = null;\r\n    }\r\n    /**\r\n     * The width of the Text, setting this will actually modify the scale to achieve the value set\r\n     *\r\n     * @member {number}\r\n     */\r\n    get width() {\r\n        this.updateText(true);\r\n        return Math.abs(this.scale.x) * this._texture.orig.width;\r\n    }\r\n    set width(value) {\r\n        this.updateText(true);\r\n        const s = sign(this.scale.x) || 1;\r\n        this.scale.x = s * value / this._texture.orig.width;\r\n        this._width = value;\r\n    }\r\n    /**\r\n     * The height of the Text, setting this will actually modify the scale to achieve the value set\r\n     *\r\n     * @member {number}\r\n     */\r\n    get height() {\r\n        this.updateText(true);\r\n        return Math.abs(this.scale.y) * this._texture.orig.height;\r\n    }\r\n    set height(value) {\r\n        this.updateText(true);\r\n        const s = sign(this.scale.y) || 1;\r\n        this.scale.y = s * value / this._texture.orig.height;\r\n        this._height = value;\r\n    }\r\n    /**\r\n     * Set the style of the text. Set up an event listener to listen for changes on the style\r\n     * object and mark the text as dirty.\r\n     *\r\n     * @member {object|PIXI.TextStyle}\r\n     */\r\n    get style() {\r\n        // TODO: Can't have different types for getter and setter. The getter shouldn't have the ITextStyle\r\n        //       since the setter creates the TextStyle. See this thread for more details:\r\n        //       https://github.com/microsoft/TypeScript/issues/2521\r\n        return this._style;\r\n    }\r\n    set style(style) {\r\n        style = style || {};\r\n        if (style instanceof TextStyle) {\r\n            this._style = style;\r\n        }\r\n        else {\r\n            this._style = new TextStyle(style);\r\n        }\r\n        this.localStyleID = -1;\r\n        this.dirty = true;\r\n    }\r\n    /**\r\n     * Set the copy for the text object. To split a line you can use '\\n'.\r\n     *\r\n     * @member {string}\r\n     */\r\n    get text() {\r\n        return this._text;\r\n    }\r\n    set text(text) {\r\n        text = String(text === null || text === undefined ? '' : text);\r\n        if (this._text === text) {\r\n            return;\r\n        }\r\n        this._text = text;\r\n        this.dirty = true;\r\n    }\r\n    /**\r\n     * The resolution / device pixel ratio of the canvas.\r\n     * This is set to automatically match the renderer resolution by default, but can be overridden by setting manually.\r\n     * @member {number}\r\n     * @default 1\r\n     */\r\n    get resolution() {\r\n        return this._resolution;\r\n    }\r\n    set resolution(value) {\r\n        this._autoResolution = false;\r\n        if (this._resolution === value) {\r\n            return;\r\n        }\r\n        this._resolution = value;\r\n        this.dirty = true;\r\n    }\r\n}\r\n","import { Sprite, Texture, Text, Container } from 'pixi.js'\r\nimport RenderComponent from './base/render'\r\nimport { componentRegister } from '../core'\r\nimport RainbowText from '../lib/rainbow-text'\r\n\r\ntype AxisPosition = {\r\n  x: 'left' | 'center' | 'right'\r\n  y: 'top' | 'center' | 'bottom'\r\n}\r\n\r\ntype TextStyle = {\r\n  fontFamily?: string | string[],\r\n  fontWeight?: string,\r\n  fontSize?: number,\r\n  fill?: string,\r\n  lineJoin?: 'round',\r\n  stroke?: string,\r\n  strokeThickness?: number,\r\n  wordWrap?: boolean,\r\n  wordWrapWidth?: number\r\n}\r\n\r\nexport class TextComponent extends RenderComponent {\r\n  // serialize fields\r\n  public text: string\r\n  public style: TextStyle\r\n  public position: AxisPosition\r\n  public bgTextureId: string\r\n  public padding: number\r\n  // temp fields\r\n  public bgTexture: Texture\r\n  public textView: Text\r\n  public btnView: Sprite\r\n\r\n  constructor() {\r\n    super()\r\n    this.text = ''\r\n    this.style = {}\r\n    this.position = {\r\n      x: 'left',\r\n      y: 'top'\r\n    }\r\n    this.bgTextureId = null\r\n    this.padding = 0\r\n\r\n    this.bgTexture = null\r\n    this.textView = null\r\n    this.btnView = null\r\n  }\r\n\r\n  public init() {\r\n    this.view = new Container()\r\n    if (this.bgTextureId) {\r\n      this.bgTexture = Texture.from(this.bgTextureId)\r\n    } else {\r\n      this.bgTexture = Texture.EMPTY\r\n    }\r\n    this.btnView = new Sprite(this.bgTexture)\r\n    if (this.bgTextureId) {\r\n      this.style = {\r\n        wordWrap: true,\r\n        wordWrapWidth: this.btnView.width - this.padding * 2,\r\n        ...this.style\r\n      }\r\n    }\r\n    this.textView = new RainbowText(this.text, this.style)\r\n    this.textView.resolution = 2\r\n    this.justifyContent()\r\n    this.view.addChild(this.btnView, this.textView)\r\n  }\r\n\r\n  public justifyContent() {\r\n    const { position } = this\r\n    const { width: btnW, height: btnH } = this.btnView\r\n    const { width: textW, height: textH } = this.textView\r\n\r\n    if (position.x === 'left') {\r\n      this.textView.x = this.padding\r\n    } else if (position.x === 'center') {\r\n      this.textView.x = Math.abs(btnW - textW) / 2\r\n    } else if (position.x === 'right') {\r\n      this.textView.x = Math.abs(btnW - textW) - this.padding\r\n    }\r\n    if (position.y === 'top') {\r\n      this.textView.y = this.padding\r\n    } else if (position.y === 'center') {\r\n      this.textView.y = Math.abs(btnH - textH) / 2\r\n    } else if (position.y === 'bottom') {\r\n      this.textView.y = Math.abs(btnH - textH) - this.padding\r\n    }\r\n  }\r\n\r\n  public clear() {\r\n    this.revert()\r\n    this.text = ''\r\n    this.style = {}\r\n    this.position = {\r\n      x: 'left',\r\n      y: 'top'\r\n    }\r\n    this.bgTextureId = null\r\n    this.padding = 0\r\n\r\n    this.textView?.destroy()\r\n    this.textView = null\r\n    this.btnView?.destroy()\r\n    this.btnView = null\r\n    this.bgTexture = null\r\n  }\r\n\r\n  public toJSON() {\r\n    const { text, style, position, bgTextureId, padding } = this\r\n    const render = this.getRenderJSON()\r\n\r\n    return { text, style, position, bgTextureId, padding,\r\n      ...render\r\n    }\r\n  }\r\n}\r\n\r\ncomponentRegister('TextComponent')(TextComponent)\r\n","import { IComponent, componentRegister } from '../core'\r\n\r\nexport class TypewriterComponent extends IComponent {\r\n  /** 完整文本 */\r\n  public text: string\r\n  /**\r\n   * 打字速度（个/秒）\r\n   */\r\n  public speed: number\r\n  /**\r\n   * 打印延时，等待指定时间后才开始打印\r\n   */\r\n  public printDelay: number\r\n\r\n  public deltaTimer: number\r\n\r\n  constructor() {\r\n    super()\r\n    this.text = ''\r\n    this.speed = 10\r\n    this.printDelay = 0\r\n    this.deltaTimer = 0\r\n  }\r\n\r\n  clear() {\r\n    this.text = ''\r\n    this.speed = 10\r\n    this.printDelay = 0\r\n    this.deltaTimer = 0\r\n  }\r\n\r\n  toJSON() {\r\n    const { text, speed, printDelay } = this\r\n    return { text, speed, printDelay }\r\n  }\r\n}\r\n\r\ncomponentRegister('TypewriterComponent')(TypewriterComponent)\r\n","import { Texture, Container } from 'pixi.js'\r\nimport { IComponent, componentRegister } from '../core'\r\n\r\nexport class ButtonComponent extends IComponent {\r\n  // serialize fields\r\n  /** button 标记 */\r\n  public tag: string\r\n  /** button down 时使用的纹理id */\r\n  public textureId: string\r\n  /** 文字样式 */\r\n  public style: any\r\n  /** 是否使用点击动画 */\r\n  public useAnimation: boolean\r\n  // temp fields\r\n  /** 纹理 */\r\n  public texture: Texture\r\n  /** 是否绑定按钮事件 */\r\n  public isBind: boolean\r\n  /** 是否点击按钮 */\r\n  public isClick: boolean\r\n  /** 按钮本体，卸载组件时清理事件用 */\r\n  public origin: Container\r\n\r\n  /** 接收点击事件，是否为点击 */\r\n  public clickEvent: boolean\r\n  /** 点击动画延时计时器 */\r\n  public deltaTimer: number\r\n\r\n  constructor() {\r\n    super()\r\n    this.tag = null\r\n    this.textureId = null\r\n    this.style = {}\r\n    this.useAnimation = true\r\n\r\n    this.texture = null\r\n    this.isBind = false\r\n    this.isClick = false\r\n    this.origin = null\r\n\r\n    this.clickEvent = false\r\n    this.deltaTimer = 0\r\n  }\r\n\r\n  public init() {\r\n    if (this.textureId) {\r\n      this.texture = Texture.from(this.textureId)\r\n    }\r\n  }\r\n\r\n  public clear() {\r\n    this.tag = null\r\n    this.textureId = null\r\n    this.style = {}\r\n    this.useAnimation = true\r\n\r\n    this.texture = null\r\n    this.isBind = false\r\n    this.isClick = false\r\n    if (this.origin) {\r\n      this.origin.interactive = false\r\n      this.origin.buttonMode = false\r\n      this.origin.removeAllListeners()\r\n    }\r\n    this.origin = null\r\n\r\n    this.clickEvent = false\r\n    this.deltaTimer = 0\r\n  }\r\n\r\n  public toJSON() {\r\n    const { tag, textureId, style, useAnimation } = this\r\n    return { tag, textureId, style, useAnimation }\r\n  }\r\n}\r\n\r\ncomponentRegister('ButtonComponent')(ButtonComponent)\r\n","import { IComponent, componentRegister } from '../core'\r\n\r\nexport class TransformComponent extends IComponent {\r\n  public x: number\r\n  public y: number\r\n  public angle: number\r\n  public scale: number\r\n\r\n  constructor() {\r\n    super()\r\n    this.x = 0\r\n    this.y = 0\r\n    this.angle = 0\r\n    this.scale = 1\r\n  }\r\n\r\n  clear() {\r\n    this.x = 0\r\n    this.y = 0\r\n    this.angle = 0\r\n    this.scale = 1\r\n  }\r\n\r\n  toJSON() {\r\n    const { x, y, angle, scale } = this\r\n    return { x, y, angle, scale }\r\n  }\r\n}\r\n\r\ncomponentRegister('TransformComponent')(TransformComponent)\r\n","import { IComponent, componentRegister } from '../core'\r\n\r\nexport class TransparentComponent extends IComponent {\r\n  public alpha : number\r\n\r\n  constructor() {\r\n    super()\r\n    this.alpha = 0\r\n  }\r\n\r\n  clear() {\r\n    this.alpha = 0\r\n  }\r\n\r\n  toJSON() {\r\n    const { alpha } = this\r\n    return { alpha }\r\n  }\r\n}\r\n\r\ncomponentRegister('TransparentComponent')(TransparentComponent)\r\n","import { IComponent, componentRegister } from '../core'\r\nimport { Sound } from '../sound'\r\n\r\ntype PlayOptions = {\r\n  start?: number\r\n  end?: number\r\n  speed?: number\r\n  loop?: boolean\r\n  sprite?: string\r\n  muted?: boolean\r\n}\r\n\r\nexport class SoundComponent extends IComponent {\r\n  public alias: string\r\n  public options: PlayOptions\r\n\r\n  public firstPlay: boolean\r\n  public isPlaying: boolean\r\n  public sound: Sound\r\n\r\n  constructor() {\r\n    super()\r\n    this.alias = null\r\n    this.options = {}\r\n\r\n    this.firstPlay = true\r\n    this.isPlaying = false\r\n    this.sound = null\r\n  }\r\n\r\n  init() {\r\n    this.sound = new Sound(this.alias)\r\n  }\r\n\r\n  clear() {\r\n    this.alias = null\r\n    this.options = {}\r\n\r\n    this.firstPlay = true\r\n    this.isPlaying = false\r\n    this.sound.stop()\r\n    this.sound = null\r\n  }\r\n\r\n  toJSON() {\r\n    const { alias, options } = this\r\n    return { alias, options }\r\n  }\r\n}\r\n\r\ncomponentRegister('SoundComponent')(SoundComponent)\r\n","import { IComponent, componentRegister } from '../core'\r\n\r\ntype Vars = {\r\n  x?: number\r\n  y?: number\r\n  angle?: number\r\n  scale?: number\r\n}\r\n\r\n/**\r\n * 位移组件\r\n */\r\nexport class DisplacementComponent extends IComponent {\r\n  public start: Vars\r\n  public end: Vars\r\n  public duration: number\r\n\r\n  constructor() {\r\n    super()\r\n    this.start = {}\r\n    this.end = {}\r\n    this.duration = 0\r\n  }\r\n\r\n  public clear() {\r\n    this.start = {}\r\n    this.end = {}\r\n    this.duration = 0\r\n  }\r\n\r\n  public toJSON() {\r\n    const { start, end, duration } = this\r\n    return { start, end, duration }\r\n  }\r\n}\r\n\r\ncomponentRegister('DisplacementComponent')(DisplacementComponent)\r\n","import { IComponent, componentRegister } from '../core'\r\n\r\ntype Vars = {\r\n  alpha?: number\r\n}\r\n\r\n/**\r\n * 淡入淡出组件\r\n */\r\nexport class FadeComponent extends IComponent {\r\n  public start: Vars\r\n  public end: Vars\r\n  public duration: number\r\n\r\n  constructor() {\r\n    super()\r\n    this.start = {}\r\n    this.end = {}\r\n    this.duration = 0\r\n  }\r\n\r\n  public clear() {\r\n    this.start = {}\r\n    this.end = {}\r\n    this.duration = 0\r\n  }\r\n\r\n  public toJSON() {\r\n    const { start, end, duration } = this\r\n    return { start, end, duration }\r\n  }\r\n}\r\n\r\ncomponentRegister('FadeComponent')(FadeComponent)\r\n","import { IComponentClass, ISystem } from '../core'\r\nimport { Entity } from '../core/entity'\r\nimport {\r\n  SpriteComponent,\r\n  AnimationComponent,\r\n  TextComponent,\r\n  TransformComponent,\r\n  TransparentComponent\r\n} from '../components'\r\nimport RenderComponent from '../components/base/render'\r\nimport { Scene } from '../render'\r\n\r\nexport class PIXIRenderSystem extends ISystem {\r\n  public execute() {\r\n    const entities = this.queries.entities.results\r\n\r\n    for (const entity of entities) {\r\n      this.match(entity, SpriteComponent)\r\n      this.match(entity, AnimationComponent)\r\n      this.match(entity, TextComponent)\r\n    }\r\n  }\r\n\r\n  private match<T extends RenderComponent>(\r\n    entity: Entity,\r\n    componentClass: IComponentClass<T>\r\n  ) {\r\n    if (entity.hasComponent(componentClass)) {\r\n      const sprite = entity.getComponent(componentClass)\r\n      this.configureSprite(sprite)\r\n      this.transform(entity, sprite)\r\n      this.transparent(entity, sprite)\r\n    }\r\n  }\r\n\r\n  private configureSprite(sprite: RenderComponent) {\r\n    sprite.view.visible = sprite.visible\r\n    const anchor = {\r\n      x: sprite.anchor.x * sprite.view.width,\r\n      y: sprite.anchor.y * sprite.view.height\r\n    }\r\n    sprite.view.pivot.set(anchor.x, anchor.y)\r\n    if (!sprite.isRender) {\r\n      const scene = this.world as Scene\r\n      sprite.isRender = true\r\n      scene.addSprite(sprite.layer, sprite.view)\r\n    }\r\n  }\r\n\r\n  private transform(entity: Entity, sprite: RenderComponent) {\r\n    if (entity.hasComponent(TransformComponent)) {\r\n      const transform = entity.getComponent(TransformComponent)\r\n      sprite.view.x = transform.x\r\n      sprite.view.y = transform.y\r\n      sprite.view.angle = transform.angle\r\n      sprite.view.scale.set(transform.scale)\r\n    }\r\n  }\r\n\r\n  private transparent(entity: Entity, sprite: RenderComponent) {\r\n    if (entity.hasComponent(TransparentComponent)) {\r\n      const transparent = entity.getComponent(TransparentComponent)\r\n      sprite.view.alpha = transparent.alpha\r\n    }\r\n  }\r\n}\r\n\r\nPIXIRenderSystem.queries = {\r\n  entities: {\r\n    type: 'any',\r\n    components: [SpriteComponent, AnimationComponent, TextComponent]\r\n  }\r\n}\r\n","import { ISystem } from '../core'\r\nimport { TextComponent } from '../components'\r\n\r\nexport class TextUpdateSystem extends ISystem {\r\n  public execute() {\r\n    const entities = this.queries.entities.results\r\n\r\n    for (const entity of entities) {\r\n      const Text = entity.getComponent(TextComponent)\r\n      if (Text.textView.text !== Text.text) {\r\n        Text.textView.text = Text.text\r\n        Text.justifyContent()\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nTextUpdateSystem.queries = {\r\n  entities: [TextComponent]\r\n}\r\n","import { ISystem } from '../core'\r\nimport { AnimationComponent } from '../components'\r\n\r\nexport class AnimationSystem extends ISystem {\r\n  public execute() {\r\n    const entities = this.queries.entities.results\r\n\r\n    for (const entity of entities) {\r\n      const animation = entity.getComponent(AnimationComponent)\r\n      const view = animation.view as PIXI.AnimatedSprite\r\n\r\n      if (view.loop !== animation.loop) {\r\n        view.loop = animation.loop\r\n      }\r\n\r\n      if (view.animationSpeed !== animation.animationSpeed) {\r\n        view.animationSpeed = animation.animationSpeed\r\n      }\r\n\r\n      if (animation.playing === true) {\r\n        if (view.playing === false) {\r\n          view.play()\r\n        }\r\n      } else {\r\n        if (view.playing === true) {\r\n          view.gotoAndStop(0)\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nAnimationSystem.queries = {\r\n  entities: [AnimationComponent]\r\n}\r\n","import { ISystem } from '../core'\r\nimport { TextComponent, TypewriterComponent } from '../components'\r\n\r\nexport class TypewriterSystem extends ISystem {\r\n  public execute(delta: number) {\r\n    const entities = this.queries.entities.results\r\n\r\n    for (const entity of entities) {\r\n      const Text = entity.getComponent(TextComponent)\r\n      const typewriter = entity.getComponent(TypewriterComponent)\r\n      if (typewriter.text.length > Text.text.length) {\r\n        if (typewriter.speed <= 0) {\r\n          typewriter.speed = 10\r\n        }\r\n        typewriter.deltaTimer += delta\r\n        let time = 1000 / typewriter.speed\r\n        if (Text.text.length === 0 && typewriter.printDelay >= 0) {\r\n          // 打印延时，不至于显示的太快\r\n          time = typewriter.printDelay\r\n        }\r\n        if (typewriter.deltaTimer >= time) {\r\n          let char\r\n          do {\r\n            char = typewriter.text.charAt(Text.text.length)\r\n            // 打印时处理下 bbcode 要不然会把标签也打印出来\r\n            const result = processBbcode(typewriter.text, char, Text.text.length, 7)\r\n            if (result.type === 'tag') {\r\n              Text.text +=  result.bbcode\r\n              char = typewriter.text.charAt(Text.text.length)\r\n            }\r\n            Text.text += char\r\n            // 干掉空格，要不然会出现不自然的等待时间\r\n          } while (char === ' ')\r\n          // Text.text += typewriter.text.charAt(Text.text.length)\r\n          typewriter.deltaTimer = 0\r\n        }\r\n      } else {\r\n        entity.removeComponent(TypewriterComponent)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nTypewriterSystem.queries = {\r\n  entities: [TextComponent, TypewriterComponent]\r\n}\r\n\r\nfunction processBbcode(string: string, char: string, i: number, magic: number) {\r\n  let type = 'none'\r\n  let bbcode = ''\r\n  if (char === '[') {\r\n    let index = i\r\n    index += magic // magic should be 7\r\n    bbcode = string.slice(i, index + 1)\r\n    if (bbcode === '[style={') {\r\n      let tmp\r\n      do {\r\n        index++\r\n        tmp = string.charAt(index)\r\n        bbcode += tmp\r\n      } while (tmp !== ']')\r\n      type = 'tag'\r\n    } else if (bbcode === '[/style]') {\r\n      type = 'tag'\r\n    }\r\n  }\r\n\r\n  return {\r\n    type,\r\n    bbcode\r\n  }\r\n}\r\n","import { ISystem } from '../core'\r\nimport { Entity } from '../core/entity'\r\nimport { TextComponent, ButtonComponent, TransformComponent } from '../components'\r\n\r\nexport class TextButtonSystem extends ISystem {\r\n  public execute(delta: number) {\r\n    const entities = this.queries.entities.results\r\n\r\n    for (const entity of entities) {\r\n      const text = entity.getComponent(TextComponent)\r\n      const button = entity.getComponent(ButtonComponent)\r\n\r\n      if (button.isBind === false) {\r\n        button.isBind = true\r\n        text.view.interactive = true\r\n        text.view.buttonMode = true\r\n        text.view\r\n          .on('pointerdown', this.processButtonDown(entity))\r\n          .on('pointerup', this.processButtonUp(entity))\r\n          .on('pointerupoutside', this.processButtonUp(entity))\r\n          .on('pointertap', () => {\r\n            button.clickEvent = true\r\n            button.deltaTimer = 0\r\n          })\r\n        button.origin = text.view\r\n      }\r\n\r\n      button.isClick = false\r\n      if (button.clickEvent === true) {\r\n        if (button.deltaTimer >= 10) {\r\n          button.isClick = true\r\n          button.clickEvent = false\r\n          button.deltaTimer = 0\r\n        } else {\r\n          button.deltaTimer += delta\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private processButtonUp(entity: Entity) {\r\n    const text = entity.getComponent(TextComponent)\r\n    const button = entity.getComponent(ButtonComponent)\r\n    const view = text.view\r\n\r\n    return () => {\r\n      if (button.useAnimation === true) {\r\n        if (entity.hasComponent(TransformComponent)) {\r\n          entity.getComponent(TransformComponent).scale = 1\r\n        } else {\r\n          view.scale.set(1)\r\n        }\r\n        text.anchor = { x: 0, y: 0 }\r\n      }\r\n\r\n      this.onButtonUp(text)\r\n    }\r\n  }\r\n\r\n  private processButtonDown(entity: Entity) {\r\n    const text = entity.getComponent(TextComponent)\r\n    const button = entity.getComponent(ButtonComponent)\r\n    const view = text.view\r\n\r\n    return () => {\r\n      if (button.useAnimation === true) {\r\n        if (entity.hasComponent(TransformComponent)) {\r\n          entity.getComponent(TransformComponent).scale = 0.95\r\n        } else {\r\n          view.scale.set(0.95)\r\n        }\r\n        // 0.025 = (1 - 0.95) / 2\r\n        text.anchor = { x: -0.025, y: -0.025 }\r\n      }\r\n\r\n      this.onButtonDown(text, button)\r\n    }\r\n  }\r\n\r\n  private onButtonUp(textC: TextComponent) {\r\n    textC.btnView.texture = textC.bgTexture\r\n    Object.assign(textC.textView.style, textC.style)\r\n  }\r\n\r\n  private onButtonDown(textC: TextComponent, btnC: ButtonComponent) {\r\n    if (btnC.texture) {\r\n      textC.btnView.texture = btnC.texture\r\n    }\r\n    Object.assign(textC.textView.style, btnC.style)\r\n  }\r\n}\r\n\r\nTextButtonSystem.queries = {\r\n  entities: [TextComponent, ButtonComponent]\r\n}\r\n","import { IComponent, ISystem } from '../core'\r\nimport {\r\n  TransformComponent,\r\n  TransparentComponent,\r\n  DisplacementComponent,\r\n  FadeComponent\r\n} from '../components'\r\n\r\nexport class TransformSystem extends ISystem {\r\n  public execute(delta: number) {\r\n    const disp = this.queries.disp.results\r\n\r\n    for (const entity of disp) {\r\n      const Transform = entity.getComponent(TransformComponent)\r\n      const Displacement = entity.getComponent(DisplacementComponent)\r\n      const result = this.transform(Transform, Displacement, delta)\r\n      if (result === true) {\r\n        entity.removeComponent(DisplacementComponent)\r\n      }\r\n    }\r\n\r\n    const fade = this.queries.fade.results\r\n\r\n    for (const entity of fade) {\r\n      const Transparent = entity.getComponent(TransparentComponent)\r\n      const Fade = entity.getComponent(FadeComponent)\r\n      const result = this.transform(Transparent, Fade, delta)\r\n      if (result === true) {\r\n        entity.removeComponent(FadeComponent)\r\n      }\r\n    }\r\n  }\r\n\r\n  public transform(\r\n    target: IComponent,\r\n    method: IComponent,\r\n    delta: number\r\n  ): boolean {\r\n    const component = target as any\r\n    const { start, end, duration } = method as any\r\n\r\n    for (const key in end) {\r\n      const offset = end[key] - start[key]\r\n      if (component[key] !== end[key]) {\r\n        component[key] += (offset / duration * delta)\r\n        if (offset >= 0) {\r\n          if (component[key] >= end[key]) {\r\n            component[key] = end[key]\r\n            return true\r\n          }\r\n        } else {\r\n          if (component[key] <= end[key]) {\r\n            component[key] = end[key]\r\n            return true\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return false\r\n  }\r\n}\r\n\r\nTransformSystem.queries = {\r\n  disp: [TransformComponent, DisplacementComponent],\r\n  fade: [TransparentComponent, FadeComponent]\r\n}\r\n","import { ISystem } from '../core'\r\nimport { SoundComponent } from '../components'\r\n\r\nexport class SoundSystem extends ISystem {\r\n  public execute() {\r\n    const entities = this.queries.entities.results\r\n\r\n    for (const entity of entities) {\r\n      const Sound = entity.getComponent(SoundComponent)\r\n\r\n      if (Sound.firstPlay === true) {\r\n        // 说明音乐还没开始播放，把声音放起来\r\n        Sound.sound.play(Sound.options)\r\n        Sound.firstPlay = false\r\n        Sound.isPlaying = true\r\n      } else {\r\n        if (Sound.isPlaying === true) {\r\n          if (Sound.sound.isPlaying === false) {\r\n            // 说明音乐已经放完了，移除声音组件\r\n            entity.removeComponent(SoundComponent)\r\n          }\r\n        } else {\r\n          // 主动停止播放，并移除组件\r\n          Sound.sound.stop()\r\n          entity.removeComponent(SoundComponent)\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nSoundSystem.queries = {\r\n  entities: [SoundComponent]\r\n}\r\n","import { IComponent, componentRegister } from '../../../engine/core'\r\n\r\nconst BtnTypes = {\r\n  letf: 0,\r\n  center: 1,\r\n  right: 2\r\n}\r\n\r\nexport class InputComponent extends IComponent {\r\n  constructor() {\r\n    super()\r\n    this.curEvent = {\r\n      isDown: false,\r\n      buttons: 0,\r\n      x: -1,\r\n      y: -1\r\n    }\r\n    this.preEvent = {\r\n      isDown: false,\r\n      buttons: 0,\r\n      x: -1,\r\n      y: -1\r\n    }\r\n\r\n    /** 按下时的坐标 */\r\n    this.downPoint = { x: 0, y: 0 }\r\n    /** 是否单击 */\r\n    this.isClick = false\r\n    /** 接收点击事件，准备改变isClick */\r\n    this.readyClick = false\r\n    /** 单击延时 */\r\n    this.deltaTimer = 0\r\n  }\r\n\r\n  clear() {\r\n    this.curEvent = {\r\n      isDown: false,\r\n      buttons: 0,\r\n      x: -1,\r\n      y: -1\r\n    }\r\n    this.preEvent = {\r\n      isDown: false,\r\n      buttons: 0,\r\n      x: -1,\r\n      y: -1\r\n    }\r\n\r\n    this.downPoint = { x: 0, y: 0 }\r\n    this.isClick = false\r\n    this.readyClick = false\r\n    this.deltaTimer = 0\r\n  }\r\n\r\n  isMouseUp(btnType) {\r\n    const { isDown, buttons: button } = this.curEvent\r\n\r\n    if (isDown) {\r\n      return false\r\n    }\r\n    if (btnType === BtnTypes.letf) {\r\n      return button === 0\r\n    } else if (btnType === BtnTypes.center) {\r\n      return button === 1\r\n    } else if (btnType === BtnTypes.right) {\r\n      return button === 2\r\n    } else {\r\n      return false\r\n    }\r\n  }\r\n\r\n  isMouseDown(btnType) {\r\n    const { isDown, buttons: button } = this.curEvent\r\n\r\n    if (!isDown) {\r\n      return false\r\n    }\r\n    if (btnType === BtnTypes.letf) {\r\n      return button === 0\r\n    } else if (btnType === BtnTypes.center) {\r\n      return button === 1\r\n    } else if (btnType === BtnTypes.right) {\r\n      return button === 2\r\n    } else {\r\n      return false\r\n    }\r\n  }\r\n}\r\n\r\ncomponentRegister('InputComponent')(InputComponent)\r\n","import { IComponent, componentRegister } from '../../../engine/core'\r\n\r\nexport class StoryComponent extends IComponent {\r\n  constructor() {\r\n    super()\r\n    this.entities = {}\r\n    this.curChapter = null\r\n    this.initialed = false\r\n    this.nodeIndex = 0\r\n    this.subIndex = 0\r\n  }\r\n\r\n  clear() {\r\n    this.entities = {}\r\n    this.curChapter = null\r\n    this.initialed = false\r\n    this.nodeIndex = 0\r\n    this.subIndex = 0\r\n  }\r\n\r\n  toJSON() {\r\n    const { entities, curChapter, initialed, nodeIndex, subIndex } = this\r\n    return { entities, curChapter, initialed, nodeIndex, subIndex }\r\n  }\r\n}\r\n\r\ncomponentRegister('StoryComponent')(StoryComponent)\r\n","import { ISystem } from '../../engine/core'\r\nimport { InputComponent } from '../components/singleton'\r\n\r\nexport class InputSystem extends ISystem {\r\n  execute(delta) {\r\n    const singleton = this.world.singleton\r\n    const input = singleton.getComponent(InputComponent)\r\n\r\n    if (this.world.interaction) {\r\n      const interaction = this.world.interaction.mouse\r\n      input.preEvent = {\r\n        ...input.curEvent\r\n      }\r\n\r\n      // 更新鼠标位置\r\n      input.curEvent.x = interaction.global.x\r\n      input.curEvent.y = interaction.global.y\r\n\r\n      // 更新按键信息\r\n      input.curEvent.buttons = interaction.buttons\r\n\r\n      // 更新鼠标按键状态\r\n      if (interaction.isDown) {\r\n        if (input.curEvent.isDown === false) {\r\n          input.downPoint.x = input.curEvent.x\r\n          input.downPoint.y = input.curEvent.y\r\n        }\r\n        input.curEvent.isDown = true\r\n      } else {\r\n        input.curEvent.isDown = false\r\n      }\r\n\r\n      if (\r\n        input.preEvent.isDown === true &&\r\n        input.preEvent.buttons === 1 &&\r\n        input.curEvent.isDown === false &&\r\n        Math.abs(input.downPoint.x - input.curEvent.x) <= 50 &&\r\n        Math.abs(input.downPoint.y - input.curEvent.y) <= 50\r\n      ) {\r\n        input.readyClick = true\r\n        input.deltaTimer = 0\r\n      }\r\n\r\n      input.isClick = false\r\n      if (input.readyClick === true) {\r\n        if (input.deltaTimer >= 10) {\r\n          input.isClick = true\r\n          input.readyClick = false\r\n          input.deltaTimer = 0\r\n        } else {\r\n          input.deltaTimer += delta\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { ISystem } from '../../engine/core'\r\nimport { InputComponent } from '../components/singleton'\r\n\r\nexport class StorySystem extends ISystem {\r\n  execute(delta) {\r\n    const singleton = this.world.singleton\r\n\r\n    if (this.world.systemData && this.world.storyScript) {\r\n      const Input = singleton.getComponent(InputComponent)\r\n      let result = true\r\n      while (result) {\r\n        result = this.processStory(delta)\r\n        // 合并多条命令的时候，需要重制下 input ，防止对后面的命令造成影响\r\n        Input.isClick = false\r\n      }\r\n    }\r\n  }\r\n\r\n  processStory(delta) {\r\n    if (typeof this.world.storyScript === 'undefined') {\r\n      return false\r\n    }\r\n\r\n    const system = this.world.systemData\r\n    const chapter = this.world.storyScript[system.chapter]\r\n\r\n    if (typeof chapter === 'undefined') {\r\n      return false\r\n    }\r\n\r\n    const nodeCount = chapter.length\r\n    const node = chapter[system.nodeIndex]\r\n\r\n    if (typeof node === 'undefined') {\r\n      return false\r\n    }\r\n\r\n    if (system.initialed === false && node.init) {\r\n      node.init(this.world)\r\n      system.initialed = true\r\n    }\r\n\r\n    const result = node.process(this.world, delta)\r\n\r\n    if (result === true) {\r\n      if (node.goto) {\r\n        // 如果节点存在 goto 命令，就开始进行跳转\r\n        const goto = node.goto()\r\n\r\n        if (\r\n          goto && (\r\n          typeof goto.chapter !== 'undefined' ||\r\n          typeof goto.node !== 'undefined')\r\n        ) {\r\n          // 跳转时清除全部实体\r\n          this.world.removeAllEntity()\r\n          system.entities = {}\r\n          system.initialed = false\r\n          system.subIndex = 0\r\n\r\n          if (typeof goto.chapter !== 'undefined') {\r\n            system.nodeIndex = 0\r\n            system.chapter = goto.chapter\r\n          }\r\n          if (typeof goto.node !== 'undefined') {\r\n            system.nodeIndex = goto.node\r\n          }\r\n        } else if (system.nodeIndex < nodeCount) {\r\n          system.nodeIndex++\r\n          system.subIndex = 0\r\n          system.initialed = false\r\n        }\r\n\r\n      } else if (system.nodeIndex < nodeCount) {\r\n        system.nodeIndex++\r\n        system.subIndex = 0\r\n        system.initialed = false\r\n      }\r\n    }\r\n\r\n    return result\r\n  }\r\n}\r\n","import { IComponent, componentRegister } from '../../../engine/core'\r\n\r\n/** 背景标记组件 */\r\nexport class BackgroundComponent extends IComponent { }\r\ncomponentRegister('BackgroundComponent')(BackgroundComponent)\r\n\r\n/** CG 标记组件 */\r\nexport class CGComponent extends IComponent { }\r\ncomponentRegister('CGComponent')(CGComponent)\r\n\r\n/** BGM 标记组件 */\r\nexport class BGMComponent extends IComponent { }\r\ncomponentRegister('BGMComponent')(BGMComponent)\r\n\r\n/** 人物标记组件 */\r\nexport class CharacterComponent extends IComponent { }\r\ncomponentRegister('CharacterComponent')(CharacterComponent)\r\n\r\n/** 对话标记组件 */\r\nexport class DialogComponent extends IComponent { }\r\ncomponentRegister('DialogComponent')(DialogComponent)\r\n\r\n/** 名称标记组件 */\r\nexport class NameComponent extends IComponent { }\r\ncomponentRegister('NameComponent')(NameComponent)\r\n\r\n/** 选项标记组件 */\r\nexport class ChoiceComponent extends IComponent { }\r\ncomponentRegister('ChoiceComponent')(ChoiceComponent)\r\n\r\n/** 移除标记组件 */\r\nexport class RemoveComponent extends IComponent { }\r\ncomponentRegister('RemoveComponent')(RemoveComponent)\r\n","import { ISystem } from '../../engine/core'\r\nimport { DisplacementComponent, FadeComponent, SoundComponent } from '../../engine/components'\r\nimport { BGMComponent, RemoveComponent } from '../components/tag'\r\n\r\nexport class RemoveSystem extends ISystem {\r\n  execute() {\r\n    const removed = this.queries.removed.results\r\n\r\n    for (const entity of removed) {\r\n      if (entity.hasAnyComponent([DisplacementComponent, FadeComponent])) {\r\n        continue\r\n      }\r\n      this.world.removeEntity(entity)\r\n    }\r\n\r\n    const bgm = this.queries.bgm.results\r\n\r\n    for (const entity of bgm) {\r\n      if (!entity.hasComponent(SoundComponent)) {\r\n        this.world.removeEntity(entity)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nRemoveSystem.queries = {\r\n  removed: [RemoveComponent],\r\n  bgm: [BGMComponent]\r\n}\r\n","export class GroupMap {\r\n  constructor(group) {\r\n    this.group = group\r\n  }\r\n\r\n  getGroup(world) {\r\n    if (typeof world.systemData.entities[this.group] === 'undefined') {\r\n      world.systemData.entities[this.group] = {}\r\n    }\r\n  \r\n    return world.systemData.entities[this.group]\r\n  }\r\n\r\n  set(world, id, value) {\r\n    this.getGroup(world)[id] = value\r\n  }\r\n\r\n  get(world, id) {\r\n    return this.getGroup(world)[id]\r\n  }\r\n\r\n  delete(world, id) {\r\n    this.set(world, id, undefined)\r\n  }\r\n}\r\n\r\nexport function colorText(texts, color) {\r\n  if (Array.isArray(texts)) {\r\n    return texts.map(text => (`[style={\"fill\": \"${color}\"}]${text}[/style]`))\r\n  } else {\r\n    return `[style={\"fill\": \"${color}\"}]${texts}[/style]`\r\n  }\r\n}\r\n","import { GroupMap } from '../util'\r\n\r\nexport const group = new GroupMap('stage')\r\n","import {\r\n  SpriteComponent,\r\n  TransparentComponent,\r\n  FadeComponent\r\n} from '../../../../engine/components'\r\nimport { group } from './util'\r\n\r\nfunction createCurtain(world, duration, alpha) {\r\n  const entity = world.createEntity()\r\n    .addComponent(SpriteComponent, {\r\n      layer: 'UserLayer10',\r\n      textureId: 'curtain'\r\n    })\r\n  \r\n  if (duration > 0) {\r\n    entity\r\n      .addComponent(TransparentComponent, {\r\n        alpha: 1 - alpha\r\n      })\r\n      .addComponent(FadeComponent, {\r\n        targetId: 'TransparentComponent',\r\n        start: {\r\n          alpha: 1 - alpha\r\n        },\r\n        end: {\r\n          alpha\r\n        },\r\n        duration\r\n      })\r\n  } else {\r\n    entity\r\n      .addComponent(TransparentComponent, {\r\n        alpha\r\n      })\r\n  }\r\n\r\n  return entity\r\n}\r\n\r\nexport function up(duration = 0) {\r\n  function init(world) {\r\n    const entityId = group.get(world, 'curtain')\r\n    if (!entityId) {\r\n      const entity = createCurtain(world, duration, 0)\r\n      group.set(world, 'curtain', entity.id)\r\n      return\r\n    }\r\n\r\n    const entity = world.getEntity(entityId)\r\n    if (entity.hasComponent(FadeComponent)) {\r\n      entity.removeComponent(FadeComponent)\r\n    }\r\n    const Transparent = entity.getComponent(TransparentComponent)\r\n\r\n    if (duration > 0) {\r\n      Transparent.alpha = 1\r\n      entity.addComponent(FadeComponent, {\r\n        targetId: 'TransparentComponent',\r\n        start: {\r\n          alpha: 1\r\n        },\r\n        end: {\r\n          alpha: 0\r\n        },\r\n        duration\r\n      })\r\n    } else {\r\n      Transparent.alpha = 0\r\n    }\r\n  }\r\n\r\n  function process(world) {\r\n    const entityId = group.get(world, 'curtain')\r\n\r\n    if (!entityId) {\r\n      return true\r\n    }\r\n\r\n    const entity = world.getEntity(entityId)\r\n    if (entity.hasComponent(FadeComponent)) {\r\n      return false\r\n    } else {\r\n      group.delete(world, 'curtain')\r\n      world.removeEntity(entity)\r\n      return true\r\n    }\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n\r\nexport function down(duration = 0) {\r\n  function init(world) {\r\n    const entityId = group.get(world, 'curtain')\r\n    if (entityId) {\r\n      return\r\n    }\r\n\r\n    const entity = createCurtain(world, duration, 1)\r\n    group.set(world, 'curtain', entity.id)\r\n  }\r\n\r\n  function process(world) {\r\n    const entityId = group.get(world, 'curtain')\r\n\r\n    if (!entityId) {\r\n      return true\r\n    }\r\n\r\n    const entity = world.getEntity(entityId)\r\n    if (entity.hasComponent(FadeComponent)) {\r\n      return false\r\n    } else {\r\n      return true\r\n    }\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n","import {\r\n  TextComponent,\r\n  TypewriterComponent\r\n} from '../../../../engine/components'\r\nimport { InputComponent } from '../../../components/singleton'\r\nimport { voiceoverStyle } from '../../../config'\r\nimport { group } from './util'\r\n\r\nconst typewriterOptions = {\r\n  speed: 22\r\n}\r\n\r\nfunction createVoiceover(world, text) {\r\n  const entityId = group.get(world, 'voiceover')\r\n  if (entityId) {\r\n    changeVoiceover(world.getEntity(entityId), text)\r\n    return\r\n  }\r\n\r\n  const entity = world.createEntity('voiceover')\r\n    .addComponent(TextComponent, {\r\n      layer: 'UserLayer9',\r\n      style: voiceoverStyle,\r\n      bgTextureId: 'voiceover',\r\n      padding: 22,\r\n      position: {\r\n        x: 'left',\r\n        y: 'center'\r\n      }\r\n    })\r\n    .addComponent(TypewriterComponent, { text, ...typewriterOptions })\r\n  \r\n  group.set(world, 'voiceover', entity.id)\r\n}\r\n\r\nfunction changeVoiceover(entity, text) {\r\n  const Text = entity.getComponent(TextComponent)\r\n  Text.text = ''\r\n\r\n  if (entity.hasComponent(TypewriterComponent)) {\r\n    const Typewriter = entity.getComponent(TypewriterComponent)\r\n    Typewriter.text = text\r\n  } else {\r\n    entity.addComponent(TypewriterComponent, { text, ...typewriterOptions })\r\n  }\r\n}\r\n\r\nexport function show(texts) {\r\n  function init(world) {\r\n    let text\r\n\r\n    if (Array.isArray(texts)) {\r\n      world.systemData.subIndex = 0\r\n      text = texts[0]\r\n      world.systemData.subIndex++\r\n    } else {\r\n      text = texts\r\n    }\r\n    createVoiceover(world, text)\r\n  }\r\n\r\n  function process(world) {\r\n    const entityId = group.get(world, 'voiceover')\r\n    const voiceover = world.getEntity(entityId)\r\n    const input = world.singleton.getComponent(InputComponent)\r\n\r\n    if (input.isClick === false) {\r\n      return false\r\n    }\r\n\r\n    if (voiceover.hasComponent(TypewriterComponent)) {\r\n      const text = voiceover.getComponent(TypewriterComponent).text\r\n      voiceover.getComponent(TextComponent).text = text\r\n      return false\r\n    }\r\n\r\n    if (\r\n      Array.isArray(texts) &&\r\n      world.systemData.subIndex < texts.length\r\n    ) {\r\n      const text = texts[world.systemData.subIndex]\r\n      world.systemData.subIndex++\r\n      changeVoiceover(voiceover, text)\r\n      return false\r\n    } else {\r\n      return true\r\n    }\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n\r\nexport function hide() {\r\n  function process(world) {\r\n    const entityId = group.get(world, 'voiceover')\r\n    if (entityId) {\r\n      const voiceover = world.getEntity(entityId)\r\n      group.delete(world, 'voiceover')\r\n      world.removeEntity(voiceover)\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  return { process }\r\n}\r\n","import { up, down } from './curtain'\r\nimport { show, hide } from './voiceover'\r\n\r\nexport default {\r\n  curtain: { up, down },\r\n  voiceover: { show, hide }\r\n}\r\n","import { InputComponent } from '../../../components/singleton'\r\n\r\nfunction wait(delay) {\r\n  let timer = 0\r\n  function process(world, delta) {\r\n    if (timer >= delay) {\r\n      timer = 0\r\n      return true\r\n    } else {\r\n      timer += delta\r\n      return false\r\n    }\r\n  }\r\n\r\n  return { process }\r\n}\r\n\r\nfunction waitClick() {\r\n  function process(world) {\r\n    const input = world.singleton.getComponent(InputComponent)\r\n\r\n    if (input.isClick === false) {\r\n      return false\r\n    } else {\r\n      return true\r\n    }\r\n  }\r\n\r\n  return {\r\n    process\r\n  }\r\n}\r\n\r\nfunction goto(chapter, node) {\r\n  function process() {\r\n    return true\r\n  }\r\n\r\n  function goto() {\r\n    return {\r\n      chapter,\r\n      node\r\n    }\r\n  }\r\n\r\n  return {\r\n    process,\r\n    goto\r\n  }\r\n}\r\n\r\nexport default { wait, waitClick, goto }","import { GroupMap } from '../util'\r\n\r\nexport const group = new GroupMap('scene')\r\n\r\nexport function addTransform(entity, componentClass, start, end, duration) {\r\n  if (entity.hasComponent(componentClass)) {\r\n    entity.removeComponent(componentClass)\r\n  }\r\n\r\n  entity.addComponent(componentClass, {\r\n    start,\r\n    end,\r\n    duration\r\n  })\r\n}\r\n\r\n\r\nexport const fadeIn = {\r\n  render: {\r\n    alpha: 0\r\n  },\r\n  animation: {\r\n    duration: 1000,\r\n    alpha: 1\r\n  }\r\n}\r\n\r\nexport const fadeOut = {\r\n  render: {\r\n    alpha: 1\r\n  },\r\n  animation: {\r\n    duration: 1000,\r\n    alpha: 0\r\n  }\r\n}\r\n\r\nexport const baseShake = {\r\n  amplitude: 10,\r\n  duration: 100\r\n}\r\n","import {\r\n  SpriteComponent,\r\n  TransformComponent,\r\n  TransparentComponent,\r\n  DisplacementComponent,\r\n  FadeComponent\r\n} from '../../../../engine/components'\r\nimport { BackgroundComponent } from '../../../components/tag'\r\nimport { group, addTransform } from './util'\r\n\r\nfunction configOption(options) {\r\n  options = options || {}\r\n\r\n  options.render = {\r\n    alpha: 1,\r\n    ...options.render\r\n  }\r\n\r\n  if (options.animation) {\r\n    options.animation = {\r\n      duration: 1000,\r\n      ...options.animation\r\n    }\r\n  }\r\n\r\n  return options\r\n}\r\n\r\nfunction createEntity(world, id, resource, options) {\r\n  options = configOption(options)\r\n  const entityId = group.get(world, id)\r\n  if (entityId) {\r\n    return\r\n  }\r\n\r\n  const { render, animation } = options\r\n  const entity = world.createEntity(id)\r\n    .addComponent(BackgroundComponent)\r\n    .addComponent(SpriteComponent, {\r\n      layer: 'UserLayer0',\r\n      textureId: resource\r\n    })\r\n    .addComponent(TransformComponent, {\r\n      ...render.position\r\n    })\r\n    .addComponent(TransparentComponent, {\r\n      alpha: render.alpha\r\n    })\r\n\r\n  group.set(world, id, entity.id)\r\n\r\n  if (typeof animation === 'undefined') {\r\n    return\r\n  }\r\n\r\n  const { position, alpha, duration = 1000 } = animation\r\n\r\n  if (position) {\r\n    addTransform(\r\n      entity,\r\n      DisplacementComponent,\r\n      render.position,\r\n      position,\r\n      duration\r\n    )\r\n  }\r\n\r\n  if (typeof alpha === 'number') {\r\n    addTransform(\r\n      entity,\r\n      FadeComponent,\r\n      { alpha: render.alpha },\r\n      { alpha },\r\n      duration\r\n    )\r\n  }\r\n}\r\n\r\nexport function show(id, resource, options) {\r\n  function init(world) {\r\n    createEntity(world, id, resource, options)\r\n  }\r\n\r\n  function process() {\r\n    return true\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n\r\nexport function show_async(id, resource, options) {\r\n  function init(world) {\r\n    createEntity(world, id, resource, options)\r\n  }\r\n\r\n  function process(world) {\r\n    const entityId = group.get(world, id)\r\n    if (entityId) {\r\n      const entity = world.getEntity(entityId)\r\n      if (\r\n        entity.hasComponent(DisplacementComponent) ||\r\n        entity.hasComponent(FadeComponent)\r\n      ) {\r\n        return false\r\n      } else {\r\n        return true\r\n      }\r\n    } else {\r\n      return true\r\n    }\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}","import {\r\n  TransformComponent,\r\n  TransparentComponent,\r\n  DisplacementComponent,\r\n  FadeComponent\r\n} from '../../../../engine/components'\r\nimport { RemoveComponent } from '../../../components/tag'\r\nimport { group, addTransform } from './util'\r\n\r\nfunction configOption(options) {\r\n  options = options || {}\r\n\r\n  if (options.animation) {\r\n    options.animation = {\r\n      duration: 1000,\r\n      ...options.animation\r\n    }\r\n  }\r\n\r\n  return options\r\n}\r\n\r\nfunction getEntity(world, id) {\r\n  const entityId = group.get(world, id)\r\n\r\n  if (!entityId) {\r\n    return null\r\n  }\r\n\r\n  const entity = world.getEntity(entityId)\r\n\r\n  if (!entity) {\r\n    return null\r\n  }\r\n\r\n  return entity\r\n}\r\n\r\nfunction setEntity(world, id, options) {\r\n  options = configOption(options)\r\n  let { render, animation } = options\r\n  const entity = getEntity(world, id)\r\n\r\n  if (entity === null) {\r\n    return\r\n  }\r\n\r\n  const Transform = entity.getComponent(TransformComponent)\r\n  const Transparent = entity.getComponent(TransparentComponent)\r\n\r\n  render = {\r\n    position: {\r\n      x: Transform.x,\r\n      y: Transform.y,\r\n    },\r\n    alpha: Transparent.alpha,\r\n    ...render\r\n  }\r\n\r\n  if (!animation) {\r\n    return\r\n  }\r\n\r\n  const { position, alpha, duration = 1000 } = animation\r\n\r\n  if (position) {\r\n    addTransform(\r\n      entity,\r\n      DisplacementComponent,\r\n      render.position,\r\n      position,\r\n      duration\r\n    )\r\n  }\r\n\r\n  if (typeof alpha === 'number') {\r\n    addTransform(\r\n      entity,\r\n      FadeComponent,\r\n      { alpha: render.alpha },\r\n      { alpha },\r\n      duration\r\n    )\r\n  }\r\n}\r\n\r\nexport function hide(id, options) {\r\n  function init(world) {\r\n    setEntity(world, id, options)\r\n  }\r\n\r\n  function process(world) {\r\n    const entity = getEntity(world, id)\r\n\r\n    if (entity === null) {\r\n      return true\r\n    } else {\r\n      group.delete(world, id)\r\n      entity.addComponent(RemoveComponent)\r\n      return true\r\n    }\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n\r\nexport function hide_async(id, options) {\r\n  function init(world) {\r\n    setEntity(world, id, options)\r\n  }\r\n\r\n  function process(world) {\r\n    const entity = getEntity(world, id)\r\n\r\n    if (entity === null) {\r\n      return true\r\n    } else {\r\n      if (\r\n        entity.hasComponent(DisplacementComponent) ||\r\n        entity.hasComponent(FadeComponent)\r\n      ) {\r\n        return false\r\n      } else {\r\n        group.delete(world, id)\r\n        world.removeEntity(entity)\r\n        return true\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n","import { show, show_async } from './show'\r\nimport { hide, hide_async } from './hide'\r\nimport { shake } from './shake'\r\nimport { fadeIn, fadeOut, baseShake } from './util'\r\n\r\nexport default { show, hide, show_async, hide_async, shake, fadeIn, fadeOut, baseShake }\r\n","import {\r\n  TransformComponent\r\n} from '../../../../engine/components'\r\nimport { group } from './util'\r\n\r\nfunction getEntity(world, id) {\r\n  const entityId = group.get(world, id)\r\n\r\n  if (!entityId) {\r\n    return null\r\n  }\r\n\r\n  const entity = world.getEntity(entityId)\r\n\r\n  if (!entity) {\r\n    return null\r\n  }\r\n\r\n  return entity\r\n}\r\n\r\nexport function shake(id, options) {\r\n  let timer = 0\r\n  options = options || {}\r\n\r\n  function process(world) {\r\n    const { amplitude = 0, duration = 0 } = options\r\n    const entity = getEntity(world, id)\r\n\r\n    if (entity === null) {\r\n      timer = 0\r\n      return true\r\n    } else {\r\n      const Transform = entity.getComponent(TransformComponent)\r\n      if (duration <= timer) {\r\n        Transform.x = 0\r\n        Transform.y = 0\r\n        timer = 0\r\n        return true\r\n      }\r\n      Transform.x = Math.round(Math.random() * amplitude * 2) - amplitude\r\n      Transform.y = Math.round(Math.random() * amplitude * 2) - amplitude\r\n      timer++\r\n      return false\r\n    }\r\n  }\r\n\r\n  return {\r\n    process\r\n  }\r\n}\r\n","import { GroupMap } from '../util'\r\n\r\nexport const group = new GroupMap('dialog')\r\n","import {\r\n  TextComponent,\r\n  TransformComponent,\r\n  TypewriterComponent\r\n} from '../../../../engine/components'\r\nimport { InputComponent } from '../../../components/singleton'\r\nimport { DialogComponent, NameComponent } from '../../../components/tag'\r\nimport { gameInfo, nameStyle, dialogStyle, textBackground } from '../../../config'\r\nimport { group } from './util'\r\n\r\nconst typewriterOptions = {\r\n  speed: 22\r\n}\r\n\r\nfunction createDialog(world, text) {\r\n  const entityId = group.get(world, 'text')\r\n  if (entityId) {\r\n    changeDialog(world.getEntity(entityId), text)\r\n    return\r\n  }\r\n\r\n  const entity = world.createEntity('dialog')\r\n    .addComponent(DialogComponent)\r\n    .addComponent(TextComponent, {\r\n      layer: 'UserLayer8',\r\n      style: dialogStyle,\r\n      bgTextureId: textBackground.dialog.id,\r\n      padding: textBackground.dialog.padding\r\n    })\r\n    .addComponent(TransformComponent, {\r\n      x: 0,\r\n      y: gameInfo.height - textBackground.dialog.height\r\n    })\r\n    .addComponent(TypewriterComponent, { text, ...typewriterOptions })\r\n\r\n  group.set(world, 'text', entity.id)\r\n}\r\n\r\nfunction changeDialog(entity, text) {\r\n  const Text = entity.getComponent(TextComponent)\r\n  Text.text = ''\r\n\r\n  if (entity.hasComponent(TypewriterComponent)) {\r\n    const Typewriter = entity.getComponent(TypewriterComponent)\r\n    Typewriter.text = text\r\n  } else {\r\n    entity.addComponent(TypewriterComponent, { text, ...typewriterOptions })\r\n  }\r\n}\r\n\r\nfunction createName(world, text) {\r\n  const entityId = group.get(world, 'name')\r\n  if (entityId) {\r\n    const Text = world.getEntity(entityId).getComponent(TextComponent)\r\n    Text.text = text\r\n    return\r\n  }\r\n\r\n  const entity = world.createEntity('name')\r\n    .addComponent(TextComponent, {\r\n      layer: 'UserLayer8',\r\n      text,\r\n      style: nameStyle,\r\n      bgTextureId: textBackground.name.id,\r\n      padding: textBackground.name.padding,\r\n      position: {\r\n        x: 'center',\r\n        y: 'center'\r\n      }\r\n    })\r\n    .addComponent(TransformComponent, {\r\n      x: 0,\r\n      y: gameInfo.height - textBackground.name.height - textBackground.dialog.height\r\n    })\r\n    .addComponent(NameComponent)\r\n\r\n  group.set(world, 'name', entity.id)\r\n}\r\n\r\nfunction removeName(world) {\r\n  const entityId = group.get(world, 'name')\r\n  if (entityId) {\r\n    const name = world.getEntity(entityId)\r\n    world.removeEntity(name)\r\n    group.delete(world, 'name')\r\n  }\r\n}\r\n\r\nexport function show(texts, name) {\r\n  function init(world) {\r\n    let text\r\n\r\n    if (Array.isArray(texts)) {\r\n      world.systemData.subIndex = 0\r\n      text = texts[0]\r\n      world.systemData.subIndex++\r\n    } else {\r\n      text = texts\r\n    }\r\n    createDialog(world, text)\r\n\r\n    if (name) {\r\n      createName(world, name)\r\n    } else {\r\n      removeName(world)\r\n    }\r\n  }\r\n\r\n  function process(world) {\r\n    const dialog = world.getEntity(group.get(world, 'text'))\r\n    const input = world.singleton.getComponent(InputComponent)\r\n\r\n    if (input.isClick === false) {\r\n      return false\r\n    }\r\n\r\n    if (dialog.hasComponent(TypewriterComponent)) {\r\n      const text = dialog.getComponent(TypewriterComponent).text\r\n      dialog.getComponent(TextComponent).text = text\r\n      dialog.removeComponent(TypewriterComponent)\r\n      return false\r\n    }\r\n\r\n    if (\r\n      Array.isArray(texts) &&\r\n      world.systemData.subIndex < texts.length\r\n    ) {\r\n      const text = texts[world.systemData.subIndex]\r\n      world.systemData.subIndex++\r\n      changeDialog(dialog, text)\r\n      return false\r\n    } else {\r\n      return true\r\n    }\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n","import { show } from './show'\r\nimport { hide } from './hide'\r\n\r\nexport default { show, hide }\r\n","import { group } from './util'\r\n\r\nexport function hide() {\r\n  function process(world) {\r\n    let entityId = group.get(world, 'text')\r\n    if (entityId) {\r\n      const dialog = world.getEntity(entityId)\r\n      group.delete(world, 'text')\r\n      world.removeEntity(dialog)\r\n    }\r\n\r\n    entityId = group.get(world, 'name')\r\n    if (entityId) {\r\n      const name = world.getEntity(entityId)\r\n      group.delete(world, 'name')\r\n      world.removeEntity(name)\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  return { process }\r\n}\r\n","import {\r\n  SpriteComponent,\r\n  AnimationComponent,\r\n  TransformComponent,\r\n  TransparentComponent,\r\n  FadeComponent\r\n} from '../../../../engine/components'\r\nimport { CharacterComponent } from '../../../components/tag'\r\nimport { GroupMap } from '../util'\r\n\r\nexport const group = new GroupMap('character')\r\n\r\nexport function createComponent(world, component) {\r\n  const entity = world.createEntity()\r\n    .addComponent(CharacterComponent)\r\n    .addComponent(TransformComponent, {\r\n      x: component.x,\r\n      y: component.y\r\n    })\r\n    .addComponent(TransparentComponent, {\r\n      alpha: 1\r\n    })\r\n\r\n  if (Array.isArray(component.res)) {\r\n    entity.addComponent(AnimationComponent, {\r\n      layer: `UserLayer${component.layer + 2}`,\r\n      texturesId: component.res,\r\n      cycle: 5000,\r\n      animationSpeed: 0.2\r\n    })\r\n  } else {\r\n    entity.addComponent(SpriteComponent, {\r\n      layer: `UserLayer${component.layer + 2}`,\r\n      textureId: component.res\r\n    })\r\n  }\r\n\r\n  return entity\r\n}\r\n\r\n/**\r\n * 添加过渡\r\n * \r\n * TODO: 当两个图层部分重叠的时候，重叠部分会有明显的差异，\r\n * 这问题弄起来太麻烦，就先凑合着用吧\r\n * \r\n * @param {Entity} entity \r\n * @param {number} alpha \r\n * @param {number} duration \r\n * @returns {Entity}\r\n */\r\nexport function addFade(entity, alpha, duration = 0) {\r\n  const Transparent = entity.getComponent(TransparentComponent)\r\n  if (duration > 0) {\r\n    Transparent.alpha = 1 - alpha\r\n    entity.addComponent(FadeComponent, {\r\n      targetId: 'TransparentComponent',\r\n      start: {\r\n        alpha: 1 - alpha\r\n      },\r\n      end: {\r\n        alpha\r\n      },\r\n      duration\r\n    })\r\n  } else {\r\n    Transparent.alpha = alpha\r\n  }\r\n\r\n  return entity\r\n}\r\n\r\n/**\r\n * 判断过渡是否完成\r\n * @param {Entity} entity 实体\r\n * @returns {boolean}\r\n */\r\nexport function fadeCompleted(entity) {\r\n  return !entity.hasComponent(FadeComponent)\r\n}\r\n","import { eyes, mouth, head, body, hand, face } from './component'\r\n\r\n// 通常服装\r\nexport const xing_nai_1 = [\r\n  eyes['1001_e'],\r\n  mouth['1001_m-01'],\r\n  body['1001_b'],\r\n  head['1001_he'],\r\n  hand['1001_ha'],\r\n  hand['1002_ha']\r\n]\r\n\r\n// 通常服装-困惑\r\nexport const xing_nai_2 = [\r\n  eyes['1006_e'],\r\n  mouth['1001_m-04'],\r\n  body['1001_b'],\r\n  head['1001_he'],\r\n  hand['1007_ha'],\r\n  hand['1002_ha']\r\n]\r\n\r\n// 通常服装-困惑 -> 尖叫表情\r\nexport const xing_nai_2_1 = [\r\n  eyes['1010_e'],\r\n  mouth['1003_m'],\r\n  body['1001_b'],\r\n  head['1001_he'],\r\n  hand['1007_ha'],\r\n  hand['1002_ha']\r\n]\r\n\r\n// 通常服装-疑问\r\nexport const xing_nai_3 = [\r\n  eyes['1007_e'],\r\n  mouth['1001_m-07'],\r\n  body['1001_b'],\r\n  head['1001_he'],\r\n  hand['1005_ha']\r\n]\r\n\r\n// 靠近-通常服装\r\nexport const xing_nai_map_1 = [\r\n  face['map02001f'],\r\n  body['map02001']\r\n]\r\n","import { createComponent, addFade, fadeCompleted, group } from './util'\r\nimport * as character from '../../../config/character'\r\n\r\n/**\r\n * 创建角色\r\n * @param {*} world engin world\r\n * @param {string} id 角色识别id\r\n * @param {string | any[]} key config 中预设的角色 key，或角色组件数组\r\n */\r\nfunction createChar(world, id, key) {\r\n  let char\r\n  if (Array.isArray(key)) {\r\n    char = key\r\n  } else {\r\n    char = character[key]\r\n  }\r\n\r\n  if (typeof char === 'undefined') {\r\n    return\r\n  }\r\n\r\n  if (typeof group.get(world, id) !== 'undefined') {\r\n    return\r\n  }\r\n\r\n  const entityIdList = []\r\n  for (const comp of char) {\r\n    const entity = createComponent(world, comp)\r\n    addFade(entity, 1)\r\n    entityIdList.push(entity.id)\r\n  }\r\n  group.set(world, id, entityIdList)\r\n}\r\n\r\nexport function show(id, key = id) {\r\n  function init(world) {\r\n    createChar(world, id, key)\r\n  }\r\n\r\n  function process(world) {\r\n    const entityIdList = group.get(world, id)\r\n    let flag = true\r\n\r\n    if (typeof entityIdList !== 'undefined') {\r\n      entityIdList.forEach(item => {\r\n        const entity = world.getEntity(item)\r\n        if (!fadeCompleted(entity)) {\r\n          flag = false\r\n        }\r\n      })\r\n    }\r\n\r\n    return flag\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}","import { show } from './show'\r\nimport { hide } from './hide'\r\nimport { update } from './update'\r\n\r\nexport default { show, hide, update }\r\n","import { group, addFade, fadeCompleted } from './util'\r\n\r\nexport function hide(id) {\r\n  function init(world) {\r\n    const entityIdList = group.get(world, id)\r\n  \r\n    if (typeof entityIdList !== 'undefined') {\r\n      entityIdList.forEach(item => {\r\n        const entity = world.getEntity(item)\r\n        addFade(entity, 0)\r\n      })\r\n    }\r\n  }\r\n\r\n  function process(world) {\r\n    const entityIdList = group.get(world, id)\r\n    let flag = true\r\n\r\n    if (typeof entityIdList !== 'undefined') {\r\n      entityIdList.forEach(item => {\r\n        const entity = world.getEntity(item)\r\n        if (fadeCompleted(entity)) {\r\n          group.delete(world, id)\r\n          world.removeEntity(entity)\r\n        } else {\r\n          flag = false\r\n        }\r\n      })\r\n    }\r\n\r\n    return flag\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n","import { createComponent, group } from './util'\r\n\r\nexport function update(id, index, component) {\r\n  function init(world) {\r\n    const entityIdList = group.get(world, id)\r\n  \r\n    if (typeof entityIdList !== 'undefined') {\r\n      const item = entityIdList[index]\r\n      let entity = world.getEntity(item)\r\n      world.removeEntity(entity)\r\n      entity = createComponent(world, component)\r\n      entityIdList[index] = entity.id\r\n    }\r\n  }\r\n\r\n  function process() {\r\n    return true\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}","import { GroupMap } from '../util'\r\n\r\nexport const group = new GroupMap('choice')\r\n","import { select } from './select'\r\nexport default { select }\r\n","import { GroupMap } from '../util'\r\n\r\nexport const group = new GroupMap('bgm')\r\n","import { SoundComponent } from '../../../../engine/components'\r\nimport { BGMComponent } from '../../../components/tag'\r\nimport { group } from './util'\r\n\r\nfunction play(alias, options) {\r\n  options = options || {}\r\n\r\n  function init(world) {\r\n    const entityId = group.get(world, alias)\r\n\r\n    if (entityId) {\r\n      return\r\n    }\r\n\r\n    const entity = world.createEntity()\r\n      .addComponent(BGMComponent)\r\n      .addComponent(SoundComponent, {\r\n        alias,\r\n        options\r\n      })\r\n\r\n    group.set(world, alias, entity.id)\r\n  }\r\n\r\n  function process() {\r\n    return true\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n\r\nfunction stop(alias) {\r\n  function init(world) {\r\n    const entityId = group.get(world, alias)\r\n\r\n    if (entityId) {\r\n      const entity = world.getEntity(entityId)\r\n      const Sound = entity.getComponent(SoundComponent)\r\n      Sound.isPlaying = false\r\n      group.delete(world, alias)\r\n    }\r\n  }\r\n\r\n  function process() {\r\n    return true\r\n  }\r\n\r\n  return {\r\n    init,\r\n    process\r\n  }\r\n}\r\n\r\nexport default {\r\n  play,\r\n  stop\r\n}\r\n","import { colorText } from './util'\r\n\r\nexport { default as stage } from './stage'\r\nexport { default as flow } from './flow'\r\nexport { default as scene } from './scene'\r\nexport { default as dialog } from './dialog'\r\nexport { default as character } from './character'\r\nexport { default as choice } from './choice'\r\nexport { default as bgm } from './bgm'\r\nexport const util = {\r\n  colorText\r\n}\r\n","import { bgm, stage, scene, dialog, character, flow, util } from './api'\r\nimport { color } from '../config'\r\n\r\nconst chapter1 = [\r\n  // character.show('xing_nai_2_1'),\r\n  // flow.waitClick(),\r\n  stage.voiceover.show([\r\n    ...util.colorText(\r\n      [\r\n        '我始终认为，人生就像一幅复杂的拼图，每个人总有属于自己的回忆碎片。',\r\n        '总是在不自觉的当下，一片片平凑着，直到看见事件的原始轮廓',\r\n        '自从那次旅行，即使到现在，我的脑海里仍深深烙印着那年夏天的艳阳、海风，以及……',\r\n        '你的微笑……'\r\n      ],\r\n      color.lightskyblue\r\n    ),\r\n    util.colorText('第一章    《 邂 逅 》', color.burlywood),\r\n    util.colorText('海边', color.deepskyblue)\r\n  ]),\r\n\r\n  stage.curtain.down(500),\r\n  stage.voiceover.hide(),\r\n  scene.show('hai_bian_d', 'map01001'),\r\n  stage.curtain.up(500),\r\n\r\n  bgm.play('shopping', {\r\n    loop: true\r\n  }),\r\n\r\n  dialog.show(\r\n    [\r\n      '哇！好刺眼的太阳啊！坐了那么久的车，终于到达海风镇啦！',\r\n      '哦！是海耶！凉爽的海风……哇……心情都好了起来啊……',\r\n      '真不愧是每年举办音浪祭的专属地点啊……',\r\n      '……\\n这么漂亮的景色……她看到也会很开心的吧……',\r\n      '虽然我们约好要在这边会和……但是她……',\r\n      '唉……有事耽搁了，也是没办法的事啊……'\r\n    ],\r\n    '？？？'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '我，以翔，一个平凡的大一生。',\r\n        '努力打工了这么久，总算存到了这趟来海风镇的旅费……',\r\n        '虽然很辛苦……',\r\n        '但是，这是我必须为她做的……',\r\n        '补偿吧……'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '彩虹天堂民宿应该离这没多远吧……',\r\n      '记得民宿的人说……下车后步行五百公尺，看到小吃店再左转三百公尺，穿过帆船公园之后再往右走一百公尺就到了……',\r\n      '……\\n还……还真不是普通的近哈……'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '阳光穿过云层，照射在阵雨过后还有些滋润的公路上。路上一大滩雨后的积水，正一点一滴因为热度而蒸发。',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '看这里也不像有计程车经过的样子……',\r\n      '好吧！只好走到民宿去了，顺便欣赏海风镇的海景也很不错啊！'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '我振奋精神，绕过脚边雨后残留的水坑，沿着路旁青翠的草地，迈开脚步准备往前走时……',\r\n        '噗呲~'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n\r\n  scene.shake('hai_bian_d', scene.baseShake),\r\n\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '一辆车子从我身旁呼啸而过，狠狠碾过我刻意避开的积水，我连忙往旁边的草地一跳，试图闪过溅起的水花。',\r\n        '但是我毕竟不是练就飞檐走壁轻功的武林高手。溅起的水花飞快地袭击了我的下半身。'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '哇啊！这……这车子怎么搞的！？这可是我为了这次旅行新买的海滩裤啊……！！',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '我低头看着惨遭“海啸”洗礼的裤子，水还意犹未尽地在裤管边缘往下滴。',\r\n        '而被水花溅透的地方，湿的有些巧妙……让我看起来活像个尿失禁的家伙……',\r\n        '这时，脚下除了柔软的草地之外，还有另一种奇怪的触感……该……该不会……',\r\n        '我紧张地缓缓抬起脚，忽然觉得脚踝沉重了起来……'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n\r\n  bgm.stop('shopping'),\r\n  bgm.play('funny', {\r\n    loop: true\r\n  }),\r\n\r\n  dialog.show(\r\n    '呃啊！',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '我抬起脚底，一坨热呼呼湿黏黏的动物排泄物，正对着我的海滩鞋死缠烂打地做亲密接触……',\r\n        '其间还有金黄灿烂的玉米粒娇羞地瑟缩在我的鞋底缝隙间……',\r\n        '我急忙就着人行道的台阶疯狂地蹭着鞋子……'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '哇啊！气死我了！',\r\n      '离民宿到底有多远啊……！？',\r\n      '方圆百里居然看不到什么商家……'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '这……这是地狱吗……！？我该不会糊里糊涂搭上通往地狱入口的班车吧？！',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '哎……想不到刚下车就遇到这些事情，真不知道后面还会有什么事在等着我……',\r\n      '如果……如果……她在的话，想必会笑我像个笨蛋吧……'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '我的脑海中不自觉浮现她的笑脸，温柔的笑声仿佛就在我的耳边回荡着……',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '……\\n是啊，计划这次旅行的目的不就是为了她吗……？',\r\n      '为了……弥补那道……裂痕……不是吗……？'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '想到这里，我收回一直蹭在阶梯上的脚，假装忘记半颗缩在鞋底的玉米粒与双腿间湿黏的闷热感……',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '看来，只好走一步算一步了。',\r\n      '反正船到桥头自然直吧！'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '揉揉鼻子，我再次拉紧背包，继续往前走去。',\r\n        '暗暗期待可以让我换下这身狼狈的地方，会出现在一个转角……'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n\r\n  bgm.stop('funny'),\r\n\r\n  stage.curtain.down(500),\r\n  dialog.hide(),\r\n  scene.hide('hai_bian_d'),\r\n  scene.show('voiceover', 'voiceover'),\r\n  stage.curtain.up(500),\r\n\r\n  stage.voiceover.show(\r\n    util.colorText('帆船公园', color.deepskyblue)\r\n  ),\r\n\r\n  stage.curtain.down(500),\r\n  stage.voiceover.hide(),\r\n  scene.hide('voiceover'),\r\n  scene.show('gong_yuan', 'map01008'),\r\n  stage.curtain.up(500),\r\n\r\n  bgm.play('shopping', {\r\n    loop: true\r\n  }),\r\n\r\n  dialog.show(\r\n    [\r\n      '这海风镇的规划也太好了吧？走到这里竟然周围连一家商店都没有……',\r\n      '民宿快到了吧！？总觉得路程比民宿的人说得还远……',\r\n      '好想快点换衣服啊……'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '我有些绝望地在心里呐喊着，从重要部位传来的闷热感，已经把我逼到悬崖的边缘.世界的尽头.神明的故乡……',\r\n        '简单的说就是“极限”啦……'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '嗯？那不是……',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '是……是上天听到我的求救吗……？',\r\n        '我看见离步道距离不远的树叶中，有个水龙头因为阳光照射，辉映着柔和的金属光泽。'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '啊……这是……是神迹吧！太……太令人感动了……！',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '现在回想起来，那个水龙头对当时的我来说，简直是……',\r\n        '神的礼物啊！！'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '太好了！我终于得到救赎了！',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '我感动不已地扭开水龙头，冰凉的水流在掌心聚集成一池迷人的水波。接着心存感激的一仰而尽，让泉水顺着食道，将体内的热气一扫而空。',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '哇啊……好舒服啊……这水有种甘甜的味道呢……',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '我贪婪地喝着，甚至奢侈地大把大把泼在脸上、手上、以及脚上，顺道将鞋上残留的不净之物给清理干净。',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '对不起，玉米粒，我想我们不合适，你还是走吧……',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    '……',\r\n    '玉米粒'\r\n  ),\r\n  dialog.show(\r\n    '哇哈哈！快滚吧你！',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '看着半颗的玉米粒从鞋底的缝隙中，顺着水流飘走，我心中升起无与伦比的成就感。',\r\n        '把脚上的东西清理干净后，我总算松了口气，现在就只剩……'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '唔……这公园的厕所在哪呢……',\r\n      '啊……还是要找个地方换掉这条裤子才行啊……是不是该找个人问问才好呢……但是又没看到什么游客……',\r\n      '嗯！？没什么游客……！？'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '看看周遭，也许是日正当中的关系，所以来公园的游客并不多，更别说那些会躲在树林中卿卿我我的情侣了。',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '对了！也许我可以……但是会不会又太……',\r\n      '如果只是一下子……说不定……',\r\n      '……',\r\n      '只要动作快一点……应该没什么问题吧……'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '想到这里，我把心一横，像是加重决心般快速将背包放在一旁齐腰高的树林上，并且拉开背包的拉链，拿出叠得十分整齐干净，还透着微微香味的换洗衣物。',\r\n        '我一边小心地吧内裤及短裤分开放在树林上，一边盘算着下一步的动作……',\r\n        '接着我深吸一口气，以迅雷不及掩耳的速度，快速脱下身上那层湿黏闷热的裤子及内裤。',\r\n        '为了争取效率，我一手将换下来的衣物丢在一旁的水龙头上，一手抓起内裤快速穿上，一气呵成！'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '呼……看来比想象中简单啊……',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '我稍稍松了口气，享受着衣服与肌肉间舒爽的快感，顺道东张西望了一下……',\r\n        '一阵清爽微凉的橙香味带着夏天的诱惑从身后传来，我连忙转身定眼一看……'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '哇……',\r\n    '以翔'\r\n  ),\r\n\r\n  bgm.stop('shopping'),\r\n  bgm.play('night', {\r\n    loop: true\r\n  }),\r\n\r\n  character.show('xing_nai_1'),\r\n\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '眼前的画面，让我不由得赞叹起来……',\r\n        '那是一个穿着白色洋装的女孩，娇小的身材被洋装轻薄似地紧裹着。',\r\n        '衣料紧贴在柔软的胸上，形成令人无限遐想的魅力曲线。',\r\n        '纤细的腰身随着走动的频率款摆着，散发着足以让任何一个男性都想为她犯罪的诱惑。',\r\n        '阳光穿过她身上的洋装，顺着形成一道微微的光晕，圣洁地令人怜惜。'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n\r\n  dialog.hide(),\r\n  character.hide('xing_nai_1'),\r\n  character.show('xing_nai_map_1'),\r\n  flow.waitClick(),\r\n\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '被微风挑逗的柔亮秀发，迎风飘散着。',\r\n        '小小耳垂上戴着一朵扶桑花耳坠，藏在秀发间随风摇曳。',\r\n        '白皙无暇的脸颊，透着如苹果般的红晕。',\r\n        '但是最令我动心的，却是那对不属于东方人的颜色眼眸，如同深邃的大海般蔚蓝……'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '呜啊！这女孩！太……',\r\n      '不行……这气质，太吸引人了……'\r\n    ],\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '刹那间彷佛时间停止了转动般，有千万个不正经的念头从我脑中一闪而过。',\r\n        '我连忙摇摇头，试图挥去那些想法。也许是我的举动，她像发现什么似的向我走来，并开口问道……'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n\r\n  character.hide('xing_nai_map_1'),\r\n  character.show('xing_nai_1'),\r\n\r\n  dialog.show(\r\n    '不好意思，请问你有看到我的钱包吗……',\r\n    '？？？'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '啊……这就是天使说话的声音么？悦耳的令人难以置信啊……！！',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n\r\n  character.hide('xing_nai_1'),\r\n  character.show('xing_nai_2'),\r\n\r\n  dialog.show(\r\n    '哈喽？有听到我说的话吗……！？',\r\n    '？？？'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '女孩越走越近，并且对着我挥了挥手，这是我才梦醒般回过神，并且发现……',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '（哇啊……!不……不会吧……！？）',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '我连忙抓起还没穿上的短裤遮住重要部位，慌张的对女孩喊道……',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '你……你……你别过来啊……！',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '女孩停下脚步，并且疑问似地歪了歪头。',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '对！没错！站在那里就好……',\r\n    '以翔'\r\n  ),\r\n\r\n  character.hide('xing_nai_2'),\r\n  character.show('xing_nai_3'),\r\n\r\n  dialog.show(\r\n    '咦？那个……我只是想问你有没有看见……',\r\n    '？？？'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '女孩又继续往前走了几步……',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    [\r\n      '啊！我说真的！你别过来啊！',\r\n      '你……你再过来我就要叫啰！'\r\n    ],\r\n    '以翔'\r\n  ),\r\n\r\n  character.hide('xing_nai_3'),\r\n  character.show('xing_nai_2'),\r\n\r\n  dialog.show(\r\n    util.colorText(\r\n      '女孩眨了眨眼，又往前走了几步。',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '（啊……那对灵动的大眼，跟细长的睫毛真是绝配啊……）',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    '叫？叫什么？',\r\n    '？？？'\r\n  ),\r\n  dialog.show(\r\n    '呃……',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '我紧张得连话都说不出口，低头看着自己的溴样，地上的积水倒映着我胀得通红的脸……',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '咦？这……',\r\n    '？？？'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '女孩得视线顺着我的眼睛看过去……',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n\r\n  bgm.stop('night'),\r\n  bgm.play('funny', {\r\n    loop: true\r\n  }),\r\n\r\n  character.hide('xing_nai_2'),\r\n  character.show('xing_nai_2_1'),\r\n\r\n  dialog.show(\r\n    '啊！变、变态！哇啊~~！',\r\n    '？？？'\r\n  ),\r\n  dialog.show(\r\n    '不……不是这样得！不是你想的那样啊！',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    '呀啊！大变态！别过来！',\r\n    '？？？'\r\n  ),\r\n  dialog.show(\r\n    '你……你才别过来！不……我是说……',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    '来人啊！有色狼啊！',\r\n    '？？？'\r\n  ),\r\n  dialog.show(\r\n    '唔啊！我不是什么色狼啊……听我解释……',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    '大色狼！大色狼！大色狼！',\r\n    '？？？'\r\n  ),\r\n  dialog.show(\r\n    '不……不是的……那个……是玉……玉米粒……不是……玉米……粒……',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    '啊！这里有色狼啊！！',\r\n    '？？？'\r\n  ),\r\n\r\n  character.hide('xing_nai_2_1'),\r\n\r\n  dialog.show(\r\n    util.colorText(\r\n      '女孩说完转身就跑，口中还不断含着「这里有色狼啊」！在慌忙的情况下，我未经思考抓住了女孩的手腕企图解释……',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n\r\n  character.show('xing_nai_2_1'),\r\n\r\n  dialog.show(\r\n    '哇啊！',\r\n    '？？？'\r\n  ),\r\n\r\n  character.hide('xing_nai_2_1'),\r\n  dialog.hide(),\r\n  scene.shake('gong_yuan', scene.baseShake),\r\n  scene.hide('gong_yuan'),\r\n  scene.show('cg03001', 'map03001'),\r\n  flow.waitClick(),\r\n\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '女孩不断挣扎着，我一个重心不稳，从齐腰高的树林里跌了出来……',\r\n        '那一瞬间，女孩清秀的脸离我好近好近，长长的眼睫毛覆盖在慧洁的大眼上，却充满着惊慌失措。'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '呜啊……痛……痛死我了……',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '我的手勉强支撑着，膝盖却重重地跪在地上……',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '啊！！！！！',\r\n    '？？？'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      '高频率的尖叫声刺痛着耳膜，我才发现自己压在女孩柔软的身体上……',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n  dialog.show(\r\n    '啊！对……对不起……！我……我不是故意的！',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    '哇！你想干什么！？',\r\n    '？？？'\r\n  ),\r\n  dialog.show(\r\n    '我……那个……车子……裤子……不是……玉米粒……',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    '快走开啊你！！',\r\n    '？？？'\r\n  ),\r\n  dialog.show(\r\n    '对……对不起……我……我马上起来……',\r\n    '以翔'\r\n  ),\r\n  dialog.show(\r\n    '大~~色~~狼~~！！',\r\n    '？？？'\r\n  ),\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '「大色狼」三个字在我耳边炸开，顿时让我愣了下。这一瞬间的破绽，使我处于毫无防备的状态。',\r\n        '说时迟那时快，突然一道冲击力冷不防地撞向我的两腿之间……'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n\r\n  dialog.hide(),\r\n  scene.shake('cg03001', scene.baseShake),\r\n\r\n  dialog.show(\r\n    util.colorText(\r\n      '咚！！！',\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n\r\n  dialog.hide(),\r\n  scene.hide('cg03001'),\r\n  scene.show('gong_yuan', 'map01008'),\r\n  scene.shake('gong_yuan', scene.baseShake),\r\n\r\n  dialog.show(\r\n    util.colorText(\r\n      [\r\n        '我无力地往旁边倒去，双手反射性地护住我胯下间最脆弱的部位。那种痛楚，足以让人脑子一片空白……',\r\n        '我眼睁睁地看着那穿着白色洋装的女孩快步离我远去。'\r\n      ],\r\n      color.lightskyblue\r\n    )\r\n  ),\r\n\r\n\r\n\r\n  // dialog.hide(),\r\n  // flow.wait(500),\r\n\r\n  // character.show('xingnai', 'xing_nai1'),\r\n  // choice.select(['海风公园', '海神神社']),\r\n  // stage.curtain.down(1000),\r\n  // character.update('xingnai', 0, eyes['1002_e']),\r\n  // character.update('xingnai', 2, body['1002_b']),\r\n  // stage.curtain.up(1000)\r\n]\r\n\r\nconsole.log('chapter1 length:', chapter1.length)\r\n\r\nexport default chapter1\r\n","import chapter1 from './chapter1'\r\n\r\nexport default {\r\n  chapter1\r\n}\r\n","import { Scene } from '../../../engine/render'\r\nimport {\r\n  PIXIRenderSystem,\r\n  AnimationSystem,\r\n  TypewriterSystem,\r\n  TextButtonSystem,\r\n  TransformSystem,\r\n  TextUpdateSystem,\r\n  SoundSystem\r\n} from '../../../engine/systems'\r\nimport {\r\n  encryptByRabbit,\r\n  decryptByRabbit,\r\n  saveToLocalStorage,\r\n  loadFromLocalStorage\r\n} from '../../../engine/utils'\r\nimport {\r\n  InputSystem,\r\n  StorySystem,\r\n  RemoveSystem\r\n} from '../../systems'\r\nimport {\r\n  InputComponent,\r\n  // StoryComponent\r\n} from '../../components/singleton'\r\n\r\nimport story from '../../story'\r\n\r\nexport class Main {\r\n  constructor(game) {\r\n    this.game = game\r\n    this.world = null\r\n    this.view = null\r\n\r\n    this.init()\r\n  }\r\n\r\n  init() {\r\n    this._initWorldModule()\r\n    this._initData()\r\n    this.world.start()\r\n  }\r\n\r\n  saveArchive() {\r\n    const data = {\r\n      engine: this.world.serialize(),\r\n      system: this.world.systemData,\r\n      story: this.world.storyData\r\n    }\r\n\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.log('save data:', data)\r\n    }\r\n\r\n    saveToLocalStorage('data', encryptByRabbit(JSON.stringify(data)))\r\n  }\r\n\r\n  loadArchive() {\r\n    let data = loadFromLocalStorage('data', true)\r\n\r\n    if (data) {\r\n      data = JSON.parse(decryptByRabbit(data))\r\n\r\n      if (process.env.NODE_ENV === 'development') {\r\n        console.log('load data:', data)\r\n      }\r\n\r\n      const { engine, system, story } = data\r\n      this.world.deserialize(engine)\r\n      this.world.systemData = system\r\n      this.world.storyData = story\r\n    }\r\n  }\r\n\r\n  _initWorldModule() {\r\n    this.world = new Scene()\r\n    this.world.interaction = this.game.renderer.plugins.interaction\r\n    this.world.storyScript = story\r\n    this.view = this.world.view\r\n    window.world = this.world\r\n\r\n    this.world\r\n      .registerSystem(InputSystem)\r\n      .registerSystem(StorySystem)\r\n      .registerSystem(TypewriterSystem)\r\n      .registerSystem(TextButtonSystem)\r\n      .registerSystem(AnimationSystem)\r\n      .registerSystem(TransformSystem)\r\n      .registerSystem(TextUpdateSystem)\r\n      .registerSystem(SoundSystem)\r\n      .registerSystem(RemoveSystem)\r\n      .registerSystem(PIXIRenderSystem)\r\n\r\n    this.world.singleton\r\n      .addComponent(InputComponent)\r\n      // .addComponent(StoryComponent, {\r\n      //   curChapter: 'chapter1',\r\n      // })\r\n  }\r\n\r\n  _initData() {\r\n    this.world.systemData = {\r\n      entities: {},\r\n      chapter: 'chapter1',\r\n      initialed: false,\r\n      nodeIndex: 0,\r\n      subIndex: 0\r\n    }\r\n    this.world.storyData = {}\r\n  }\r\n\r\n  update(delta) {\r\n    this.world.execute(delta)\r\n  }\r\n\r\n  stats(stats) {\r\n    stats.entity.update(this.world.stats().overview.numEntities, 30)\r\n  }\r\n}\r\n","import * as PIXI from 'pixi.js'\r\n\r\nexport class Cutscenes{\r\n  constructor() {\r\n    this.view = new PIXI.Container()\r\n  }\r\n\r\n  update() {}\r\n}\r\n","import Stats from 'stats.js'\r\nimport { Signal } from 'signals'\r\n\r\nimport Loader from '../engine/loader'\r\nimport { Renderer } from '../engine/render'\r\nimport { InteractionManager } from '../engine/render/plugins'\r\nimport { Sound } from '../engine/sound'\r\n\r\nimport { gameInfo, assetRootUrl, assets } from './config'\r\nimport { CutscenesScene } from './scene'\r\n\r\nRenderer.registerPlugin('interaction', InteractionManager)\r\n\r\nclass Game {\r\n  constructor(title) {\r\n    this.title = title\r\n\r\n    this.scale = 1\r\n    this.renderer = null\r\n\r\n    this.loader = new Loader(assetRootUrl)\r\n\r\n    this.cutscenes = new CutscenesScene(this)\r\n\r\n    this.prevScene = null\r\n    this.curScene = null\r\n    this.show = null\r\n\r\n    this.isPlay = true\r\n    this.updated = new Signal()\r\n\r\n    this.stats = new Stats()\r\n    this.stats.added = false\r\n    this.stats.entity = this.stats.addPanel( new Stats.Panel( 'ENTITY', '#ff8', '#221' ) )\r\n    this.stats.showPanel(0) // 0: fps, 1: ms, 2: mb, 3+: custom\r\n\r\n    this.init()\r\n  }\r\n\r\n  init() {\r\n    if (process.env.NODE_ENV === 'development') {\r\n      this.addStats()\r\n    }\r\n    this._initSoundModule()\r\n    this._initRenderModule()\r\n  }\r\n\r\n  load() {\r\n    return this.loader.load(assets)\r\n  }\r\n\r\n  addStats() {\r\n    if (!this.stats.added) {\r\n      document.body.appendChild(this.stats.dom)\r\n      this.stats.added = true\r\n    }\r\n  }\r\n\r\n  removeStats() {\r\n    if (this.stats.added) {\r\n      document.body.removeChild(this.stats.dom)\r\n      this.stats.added = false\r\n    }\r\n  }\r\n\r\n  _initSoundModule() {\r\n    Sound.loadState()\r\n  }\r\n\r\n  _initRenderModule() {\r\n    const resolution = window.devicePixelRatio || 1\r\n    const width = gameInfo.width\r\n    const height = gameInfo.height\r\n\r\n    this.renderer = new Renderer({\r\n      width,\r\n      height,\r\n      resolution\r\n    })\r\n    window.renderer = this.renderer.renderer\r\n  }\r\n\r\n  to(sceneClass, callback) {\r\n    Sound.stopAll()\r\n    const scene = new sceneClass(this)\r\n    return this._cutscenesWait(scene, callback)\r\n  }\r\n\r\n  back(callback) {\r\n    if (this.prevScene) {\r\n      Sound.stopAll()\r\n      return this._cutscenesWait(this.prevScene, callback)\r\n    } else {\r\n      return Promise.resolve()\r\n    }\r\n  }\r\n\r\n  _cutscenesWait(scene, callback) {\r\n    this.updated.addOnce(() => {\r\n      this.show = this.cutscenes\r\n    })\r\n    const cutscenesWait = new Promise(resolve => {\r\n      if (scene.load) {\r\n        // 在这里可以做些类似加载的事\r\n        scene.load().then(() => {\r\n          callback && callback(scene)\r\n          resolve()\r\n        })\r\n      } else {\r\n        callback && callback(scene)\r\n        // 否则就停一下然后切换场景\r\n        setTimeout(resolve, 150)\r\n      }\r\n    })\r\n    cutscenesWait.then(() => {\r\n      this.updated.addOnce(() => {\r\n        this._changeScene(scene)\r\n      })\r\n    })\r\n    return cutscenesWait\r\n  }\r\n\r\n  start(sceneClass) {\r\n    if (sceneClass) {\r\n      const scene = new sceneClass(this)\r\n      this._changeScene(scene)\r\n    }\r\n    requestAnimationFrame(this._update)\r\n  }\r\n\r\n  pause() {\r\n    this.isPlay = false\r\n  }\r\n\r\n  resume() {\r\n    this.isPlay = true\r\n  }\r\n\r\n  _changeScene(scene) {\r\n    this.prevScene = this.curScene\r\n    this.curScene = scene\r\n    this.show = scene\r\n    this._setSceneScale()\r\n  }\r\n\r\n  _update = delta => {\r\n    this.stats.begin()\r\n    if (this.show && this.isPlay) {\r\n      this.show.update && this.show.update(delta)\r\n      this.renderer.render(this.show.view)\r\n    }\r\n    this.updated.dispatch(this)\r\n    this.stats.end()\r\n    if (this.curScene.stats) {\r\n      this.curScene.stats(this.stats)\r\n    } else {\r\n      this.stats.entity.update(0, 30)\r\n    }\r\n    requestAnimationFrame(this._update)\r\n  }\r\n\r\n  saveArchive() {\r\n    return new Promise(resolve => {\r\n      this.updated.addOnce(() => {\r\n        if (this.curScene.saveArchive) {\r\n          this.curScene.saveArchive()\r\n        }\r\n        resolve()\r\n      })\r\n    })\r\n  }\r\n\r\n  loadArchive() {\r\n    return new Promise(resolve => {\r\n      this.updated.addOnce(() => {\r\n        if (this.curScene.loadArchive) {\r\n          this.curScene.loadArchive()\r\n        }\r\n        resolve()\r\n      })\r\n    })\r\n  }\r\n\r\n  resize = () => {\r\n    this._updateRenderScale()\r\n    this._setSceneScale()\r\n  }\r\n\r\n  _updateRenderScale() {\r\n    const windowWidth = window.innerWidth\r\n    const windowHeight = window.innerHeight\r\n\r\n    if (\r\n      windowWidth < gameInfo.width ||\r\n      windowHeight < gameInfo.height\r\n    ) {\r\n      this.scale = Math.min(\r\n        windowWidth / gameInfo.width,\r\n        windowHeight / gameInfo.height\r\n      )\r\n    }\r\n\r\n    console.log('renderScale: ', this.scale)\r\n    this.renderer.resize(\r\n      gameInfo.width * this.scale,\r\n      gameInfo.height * this.scale\r\n    )\r\n  }\r\n\r\n  _setSceneScale() {\r\n    if (this.show) {\r\n      this.show.view.scale.set(this.scale)\r\n    }\r\n  }\r\n}\r\n\r\nconst game = new Game('love-memory')\r\nwindow.love_memory = game\r\n\r\nexport default game\r\n","import React from 'react'\r\nimport './index.css'\r\n\r\nimport Loader from '../loader'\r\nimport MenuIcon from '../menu-icon'\r\nimport MenuLayout from '../menu-layout'\r\nimport Config from '../config'\r\nimport About from '../about'\r\n\r\nimport SaveDialog from '../dialog/save'\r\nimport WarningDialog from '../dialog/warning'\r\nimport '../dialog/index.css'\r\n\r\nimport game from '../../game'\r\nimport { TitleScene, MainScene } from '../../game/scene'\r\n\r\nclass LoveMemory extends React.Component {\r\n  constructor() {\r\n    super()\r\n    this.loadError = false\r\n    this.loader = React.createRef()\r\n    this.canvas = React.createRef()\r\n    this.state = {\r\n      show: 0, // 1 | 3: Config menu, 2: About menu\r\n      menu: false, // is show menu switch\r\n      loader: {\r\n        loading: true,\r\n        progress: 0,\r\n        error: null\r\n      },\r\n      width: 0,\r\n      height: 0,\r\n      dialog: 0, // 1: save dialog, 2: warning dialog\r\n      dialogStatus: ''\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.resize()\r\n    this.addEvents()\r\n    game.load().then(\r\n      () => {\r\n        // 让 loading 动画缓缓先\r\n        setTimeout(() => {\r\n          this.setState({\r\n            loader: {\r\n              ...this.state.loader,\r\n              loading: false\r\n            }\r\n          }, () => {\r\n            // show\r\n            game.start(TitleScene)\r\n            game.renderer.view.style.opacity = 1\r\n          })\r\n        }, 1000)\r\n      },\r\n      error => {\r\n        console.warn(error)\r\n        this.loadError = true\r\n        this.loader.current.detailsHandle()\r\n        this.setState({\r\n          loader: {\r\n            ...this.state.loader,\r\n            error\r\n          }\r\n        })\r\n      }\r\n    )\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.removeEvents()\r\n  }\r\n\r\n  addEvents() {\r\n    this.canvas.current.appendChild(game.renderer.view)\r\n\r\n    window.addEventListener('resize', this.resize)\r\n\r\n    game.loader.onProgressed.add(this.progressHandle)\r\n\r\n    TitleScene.onStartClicked.add(this.clickStartHandle)\r\n    TitleScene.onLoadClicked.add(this.clickLoadHandle)\r\n    TitleScene.onSettingClicked.add(this.clickSettingHandle)\r\n    TitleScene.onAboutClicked.add(this.clickAboutHandle)\r\n  }\r\n\r\n  removeEvents() {\r\n    this.canvas.current.removeChild(game.renderer.view)\r\n\r\n    window.removeEventListener('resize', this.resize)\r\n\r\n    game.loader.onProgressed.remove(this.progressHandle)\r\n\r\n    TitleScene.onStartClicked.remove(this.clickStartHandle)\r\n    TitleScene.onLoadClicked.remove(this.clickLoadHandle)\r\n    TitleScene.onSettingClicked.remove(this.clickSettingHandle)\r\n    TitleScene.onAboutClicked.remove(this.clickAboutHandle)\r\n  }\r\n\r\n  resize = () => {\r\n    game.resize()\r\n    this.setState({\r\n      width: game.renderer.view.style.width,\r\n      height: game.renderer.view.style.height\r\n    })\r\n  }\r\n\r\n  progressHandle = (progress) => {\r\n    if (this.loadError) {\r\n      return\r\n    }\r\n    progress = Math.ceil(progress)\r\n    const prevProgress = this.state.loader.progress\r\n    const offset = progress - prevProgress\r\n\r\n    if (offset >= 20 || progress >= 100) {\r\n      this.setState({\r\n        loader: {\r\n          ...this.state.loader,\r\n          progress\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  clickStartHandle = () => {\r\n    game.to(MainScene).then(() => {\r\n      this.setState({\r\n        menu: true\r\n      })\r\n    })\r\n  }\r\n\r\n  clickLoadHandle = () => {\r\n    game\r\n      .to(MainScene, scene => {\r\n        scene.loadArchive()\r\n      })\r\n      .then(() => {\r\n        this.setState({\r\n          menu: true\r\n        })\r\n      })\r\n  }\r\n\r\n  clickSettingHandle = () => {\r\n    this.setState({\r\n      show: 1\r\n    })\r\n  }\r\n\r\n  clickAboutHandle = () => {\r\n    this.setState({\r\n      show: 2\r\n    })\r\n  }\r\n\r\n  openMenuHandle = () => {\r\n    this.setState({\r\n      show: 3\r\n    })\r\n  }\r\n\r\n  closeMenuHandle = () => {\r\n    this.setState({\r\n      show: 0\r\n    })\r\n  }\r\n\r\n  togglePanelHandle = () => {\r\n    const added = game.stats.added\r\n    if (added) {\r\n      game.removeStats()\r\n    } else {\r\n      game.addStats()\r\n    }\r\n  }\r\n\r\n  closeDialogHandle = () => {\r\n    this.setState({\r\n      dialog: 0,\r\n      dialogStatus: ''\r\n    })\r\n  }\r\n\r\n  openSaveDialogHandle = () => {\r\n    this.setState({\r\n      dialog: 1,\r\n      dialogStatus: 'saving'\r\n    })\r\n    this.saveArchive()\r\n  }\r\n\r\n  openLoadDialogHandle = () => {\r\n    this.setState({\r\n      dialog: 2,\r\n      dialogStatus: 'load'\r\n    })\r\n  }\r\n\r\n  openBackTitleDialogHandle = () => {\r\n    this.setState({\r\n      dialog: 2,\r\n      dialogStatus: 'back'\r\n    })\r\n  }\r\n\r\n  confirmWarnHandle = () => {\r\n    const { dialogStatus } = this.state\r\n\r\n    if (dialogStatus === 'back') {\r\n      this.backTitle()\r\n    } else if (dialogStatus === 'load') {\r\n      this.loadArchive()\r\n    }\r\n  }\r\n\r\n  saveArchive() {\r\n    game.saveArchive().then(() => {\r\n      setTimeout(() => {\r\n        this.setState({\r\n          dialogStatus: 'saved'\r\n        })\r\n      }, 500)\r\n    })\r\n  }\r\n\r\n  loadArchive() {\r\n    game.loadArchive().then(() => {\r\n      this.closeDialogHandle()\r\n      // 因为 dialog 有个 200ms 的动画，所以这里延迟 200ms\r\n      setTimeout(() => {\r\n        this.setState({\r\n          show: 0\r\n        })\r\n      }, 200)\r\n    })\r\n  }\r\n\r\n  getArchive = () => {\r\n  }\r\n\r\n  backTitle() {\r\n    game.to(TitleScene).then(() => {\r\n      this.closeDialogHandle()\r\n      // 因为 dialog 有个 200ms 的动画，所以这里延迟 200ms\r\n      setTimeout(() => {\r\n        this.setState({\r\n          show: 0,\r\n          menu: false\r\n        })\r\n      }, 200)\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const { show, menu, width, height, loader } = this.state\r\n    const style = {\r\n      width,\r\n      height\r\n    }\r\n\r\n    if (show > 0) {\r\n      game.pause()\r\n    } else if (game.isPlay === false) {\r\n      game.resume()\r\n    }\r\n\r\n    return (\r\n      <>\r\n        <div className=\"love-memory\" style={style}>\r\n          <Loader ref={this.loader} loader={loader} />\r\n          {menu && (\r\n            <div className=\"menu-icon-wrapper\">\r\n              <MenuIcon onClick={this.openMenuHandle} />\r\n            </div>\r\n          )}\r\n          <MenuLayout show={show} onClose={this.closeMenuHandle}>\r\n            {(show === 1 || show === 3) && (\r\n              <Config\r\n                show={show}\r\n                onPanel={this.togglePanelHandle}\r\n                onSave={this.openSaveDialogHandle}\r\n                onLoad={this.openLoadDialogHandle}\r\n                onBack={this.openBackTitleDialogHandle}\r\n                getArchive={this.getArchive}\r\n              />\r\n            )}\r\n            {show === 2 && <About />}\r\n          </MenuLayout>\r\n          <div ref={this.canvas}></div>\r\n        </div>\r\n        <SaveDialog\r\n          isOpen={this.state.dialog === 1}\r\n          status={this.state.dialogStatus}\r\n          onClose={this.closeDialogHandle}\r\n        />\r\n        <WarningDialog\r\n          isOpen={this.state.dialog === 2}\r\n          onConfirm={this.confirmWarnHandle}\r\n          onClose={this.closeDialogHandle}\r\n        />\r\n      </>\r\n    )\r\n  }\r\n}\r\n\r\nexport default LoveMemory\r\n"],"sourceRoot":""}